(function(Re,f){typeof exports=="object"&&typeof module<"u"?f(exports,require("vue"),require("konva")):typeof define=="function"&&define.amd?define(["exports","vue","konva"],f):(Re=typeof globalThis<"u"?globalThis:Re||self,f(Re.patron={},Re.Vue,Re.konva))})(this,function(Re,f,Or){"use strict";var k3=Object.defineProperty;var S3=(Re,f,Or)=>f in Re?k3(Re,f,{enumerable:!0,configurable:!0,writable:!0,value:Or}):Re[f]=Or;var X=(Re,f,Or)=>S3(Re,typeof f!="symbol"?f+"":f,Or);class $b{constructor(e){e.value(this)}give(e){return document.title=e,this}introduction(){return"patron"}}class yl{constructor(e){this.guestReceiver=e}value(e){return this.guestReceiver(e),e}}function zn(n,e,t){typeof e=="function"?e(n,t):e.give(n,t)}class Nr{constructor(e){this.receiver=e}give(e,t){return this.receiver(e,t),this}}class ui{constructor(e,t){this.sourceGuest=e,this.targetGuest=t}introduction(){return typeof this.sourceGuest=="function"||!this.sourceGuest.introduction?"guest":this.sourceGuest.introduction()}give(e,t){return zn(e,this.targetGuest,t),this}disposed(e){const t=this.sourceGuest;return t.disposed?t.disposed(e):!1}}var jb=Object.defineProperty,zb=(n,e,t)=>e in n?jb(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Kf=(n,e,t)=>zb(n,typeof e!="symbol"?e+"":e,t);const Yf=new Map,qf=n=>{Yf.forEach(e=>{e.delete(n)})};class vo{constructor(e){this.initiator=e,Kf(this,"patrons"),Kf(this,"give"),this.patrons=new Set,Yf.set(this,this.patrons);let t=null;const r=(i,s)=>{this.patrons.forEach(o=>{this.sendValueToGuest(i,o,s)})};this.give=(i,s)=>{const o=()=>{o===t&&r(i,s)};return t=o,queueMicrotask(o),this}}size(){return this.patrons.size}add(e){if(!e)throw new Error("PatronPool add method received nothing!");return typeof e!="function"&&e.introduction&&e.introduction()==="patron"&&this.patrons.add(e),this}remove(e){return this.patrons.delete(e),this}distribute(e,t){return this.add(t),this.sendValueToGuest(e,t,{}),this}sendValueToGuest(e,t,r){this.guestDisposed(e,t)||zn(e,t,{...r,data:{...(r==null?void 0:r.data)??{},initiator:this.initiator,pool:this}})}guestDisposed(e,t){var r;return(r=t.disposed)!=null&&r.call(t,e)?(this.remove(t),!0):!1}}var Hb=Object.defineProperty,Gb=(n,e,t)=>e in n?Hb(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Ub=(n,e,t)=>Gb(n,e+"",t);class is{constructor(e){this.sourceDocument=e,Ub(this,"thePool",new vo(this))}pool(){return this.thePool}give(e){return this.sourceDocument=e,this.thePool.give(this.sourceDocument),this}value(e){return typeof e=="function"?this.thePool.distribute(this.sourceDocument,new Nr(e)):this.thePool.distribute(this.sourceDocument,e),this}}class wo{constructor(e){this.baseGuest=e}give(e,t){let r=this.baseGuest;return typeof r=="function"&&(r=new Nr(r)),r.give(e,t),this}introduction(){return typeof this.baseGuest=="function"||!this.baseGuest.introduction?"guest":this.baseGuest.introduction()}disposed(e){const t=this.baseGuest;return t.disposed?t.disposed(e):!1}}var Wb=Object.defineProperty,Kb=(n,e,t)=>e in n?Wb(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Xf=(n,e,t)=>Kb(n,typeof e!="symbol"?e+"":e,t);class Yb{constructor(e){Xf(this,"guests",new Set),Xf(this,"patronPool"),this.patronPool=new vo(e)}give(e,t){return this.deliverToGuests(e,t),this.patronPool.give(e,t),this}add(e){return(typeof e=="function"||!e.introduction||e.introduction()==="guest")&&this.guests.add(e),this.patronPool.add(e),this}remove(e){return this.guests.delete(e),this.patronPool.remove(e),this}distribute(e,t){return this.add(t),this.give(e),this}size(){return this.patronPool.size()+this.guests.size}deliverToGuests(e,t){this.guests.forEach(r=>{zn(e,r,t)}),this.guests.clear()}}var qb=Object.defineProperty,Xb=(n,e,t)=>e in n?qb(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Co=(n,e,t)=>Xb(n,typeof e!="symbol"?e+"":e,t);class Jb{constructor(){Co(this,"theChain"),Co(this,"keysKnown",new Set),Co(this,"keysFilled",new Set),Co(this,"filledChainPool",new Yb(this)),this.theChain=new is({})}resultArray(e){const t=new wo(e);return this.filledChainPool.add(new ui(t,r=>{t.give(Object.values(r))})),this.isChainFilled()&&this.theChain.value(new Nr(r=>{this.filledChainPool.give(Object.values(r))})),this}result(e){const t=new wo(e);return this.isChainFilled()?(this.filledChainPool.add(t),this.theChain.value(new Nr(r=>{this.filledChainPool.give(r)}))):this.filledChainPool.add(t),this}receiveKey(e){return this.keysKnown.add(e),new Nr(t=>{queueMicrotask(()=>{this.theChain.value(new Nr(r=>{this.keysFilled.add(e);const i={...r,[e]:t};this.theChain.give(i),this.isChainFilled()&&this.filledChainPool.give(i)}))})})}isChainFilled(){return this.keysFilled.size>0&&this.keysFilled.size===this.keysKnown.size}}class Qb{constructor(e){this.theValue=e}give(e){return this.theValue=e,this}value(){return this.theValue}}class Zb{constructor(e){this.willBePatron=e}introduction(){return"patron"}give(e,t){return zn(e,this.willBePatron,t),this}disposed(e){var r;const t=this.willBePatron;return((r=t==null?void 0:t.disposed)==null?void 0:r.call(t,e))||!1}}var e1=Object.defineProperty,t1=(n,e,t)=>e in n?e1(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,n1=(n,e,t)=>t1(n,e+"",t);class r1{constructor(e){this.baseGuest=e,n1(this,"received",!1)}introduction(){return"patron"}give(e,t){this.received||zn(e,this.baseGuest,t);const r=t==null?void 0:t.data;return r!=null&&r.pool&&r.pool.remove(this),this}disposed(e){const t=this.baseGuest;return t.disposed?t.disposed(e):!1}}var i1=Object.defineProperty,s1=(n,e,t)=>e in n?i1(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,o1=(n,e,t)=>s1(n,e+"",t);class fi{constructor(){o1(this,"baseSource",new is(null))}value(e){return this.baseSource.value(new ui(e,t=>{t!==null&&zn(t,e)})),this}give(e){return this.baseSource.give(e),this}pool(){return this.baseSource.pool()}}let Oe=class{constructor(e,t={}){this.constructorFn=e,this.factories=t}create(...e){return new this.constructorFn(...e,this.factories)}};class ss extends Error{constructor(e,t){super(e,t)}}class a1{constructor(e){this.fileHandler=e}content(e){return this.fileHandler.getFile().then(async t=>await new Response(t).text()).then(t=>{e.give(t)}).catch(t=>{throw new ss("Problem when reading file in SystemFileFromHandler",{cause:t})}),this}}class l1{constructor(e){this.fileHandler=e}save(e){return this.fileHandler.createWritable().then(t=>(t.write(e).catch(r=>{throw new ss("Cant save file in browser",{cause:r})}),t)).then(t=>{t.close().catch(r=>{throw new ss("Cant close written file in browser",{cause:r})})}),this}}class c1{constructor(e){this.content=e}result(){return JSON.parse(this.content)}}class u1{constructor(e){this.content=e}result(){return JSON.stringify(this.content)}}class f1{constructor(e,t=100,r=100){this.svgContent=e,this.width=t,this.height=r}markup(){return this.svgContent.replaceAll("${width}",String(this.width)).replaceAll("${height}",String(this.height))}}class d1{constructor(e,t){this.type=e,this.factories=t}markup(){return this.factories.svgImage.create(this.type.svg,this.type.width,this.type.height).markup()}}class h1{constructor(e,t,r){this.chunksCount=e,this.baseNumber=t,this.factories=r}chunks(e){return this.baseNumber.value(this.factories.guestInTheMiddle.create(e,t=>{const r=Math.round(t/this.chunksCount),i=[];for(let s=1;s<=this.chunksCount;s+=1)i.push(s*r);e.give(i)})),e}}class p1{constructor(e,t){this.mapUrl=e,this.factories=t}name(e){this.mapUrl.value(this.factories.guestInTheMiddle.create(e,t=>{let r=t.replace("/","").replaceAll("/","_");r.match("_")&&(r=`_${r}`),e.give(r)}))}}class m1{constructor(e,t){this.text=e,this.factories=t}noHtml(e){return this.text.value(this.factories.guestInTheMiddle.create(e,t=>{const r=document.createElement("DIV");r.innerHTML=t;const i=r.textContent||r.innerText||"";e.give(i)})),e}}var Jf;const ko=typeof window<"u",g1=n=>typeof n<"u",y1=n=>typeof n=="function",b1=n=>typeof n=="string",bl=()=>{};ko&&((Jf=window==null?void 0:window.navigator)!=null&&Jf.userAgent)&&/iP(ad|hone|od)/.test(window.navigator.userAgent);function Mr(n){return typeof n=="function"?n():f.unref(n)}function v1(n){return n}function w1(n){return f.getCurrentScope()?(f.onScopeDispose(n),!0):!1}function Qf(n,e=!0){f.getCurrentInstance()?f.onMounted(n):e?n():f.nextTick(n)}function C1(n){f.getCurrentInstance()&&f.onUnmounted(n)}function k1(n){var e;const t=Mr(n);return(e=t==null?void 0:t.$el)!=null?e:t}const Zf=ko?window:void 0,S1=ko?window.document:void 0,x1=ko?window.navigator:void 0;function So(...n){let e,t,r,i;if(b1(n[0])||Array.isArray(n[0])?([t,r,i]=n,e=Zf):[e,t,r,i]=n,!e)return bl;Array.isArray(t)||(t=[t]),Array.isArray(r)||(r=[r]);const s=[],o=()=>{s.forEach(u=>u()),s.length=0},a=(u,d,h,m)=>(u.addEventListener(d,h,m),()=>u.removeEventListener(d,h,m)),l=f.watch(()=>[k1(e),Mr(i)],([u,d])=>{o(),u&&s.push(...t.flatMap(h=>r.map(m=>a(u,h,m,d))))},{immediate:!0,flush:"post"}),c=()=>{l(),o()};return w1(c),c}function _1(n,e=!1){const t=f.ref(),r=()=>t.value=!!n();return r(),Qf(r,e),t}function E1(n){return JSON.parse(JSON.stringify(n))}const ed=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},td="__vueuse_ssr_handlers__";ed[td]=ed[td]||{};const T1={ctrl:"control",command:"meta",cmd:"meta",option:"alt",up:"arrowup",down:"arrowdown",left:"arrowleft",right:"arrowright"};function O1(n={}){const{reactive:e=!1,target:t=Zf,aliasMap:r=T1,passive:i=!0,onEventFired:s=bl}=n,o=f.reactive(new Set),a={toJSON(){return{}},current:o},l=e?f.reactive(a):a,c=new Set,u=new Set;function d(g,y){g in l&&(e?l[g]=y:l[g].value=y)}function h(){o.clear();for(const g of u)d(g,!1)}function m(g,y){var v,C;const w=(v=g.key)==null?void 0:v.toLowerCase(),E=[(C=g.code)==null?void 0:C.toLowerCase(),w].filter(Boolean);w&&(y?o.add(w):o.delete(w));for(const k of E)u.add(k),d(k,y);w==="meta"&&!y?(c.forEach(k=>{o.delete(k),d(k,!1)}),c.clear()):typeof g.getModifierState=="function"&&g.getModifierState("Meta")&&y&&[...o,...E].forEach(k=>c.add(k))}So(t,"keydown",g=>(m(g,!0),s(g)),{passive:i}),So(t,"keyup",g=>(m(g,!1),s(g)),{passive:i}),So("blur",h,{passive:!0}),So("focus",h,{passive:!0});const p=new Proxy(l,{get(g,y,v){if(typeof y!="string")return Reflect.get(g,y,v);if(y=y.toLowerCase(),y in r&&(y=r[y]),!(y in l))if(/[+_-]/.test(y)){const w=y.split(/[+_-]/g).map(b=>b.trim());l[y]=f.computed(()=>w.every(b=>f.unref(p[b])))}else l[y]=f.ref(!1);const C=Reflect.get(g,y,v);return e?f.unref(C):C}});return p}var nd;(function(n){n.UP="UP",n.RIGHT="RIGHT",n.DOWN="DOWN",n.LEFT="LEFT",n.NONE="NONE"})(nd||(nd={}));function N1(n,e=bl,t={}){const{immediate:r=!0,manual:i=!1,type:s="text/javascript",async:o=!0,crossOrigin:a,referrerPolicy:l,noModule:c,defer:u,document:d=S1,attrs:h={}}=t,m=f.ref(null);let p=null;const g=C=>new Promise((w,b)=>{const E=O=>(m.value=O,w(O),O);if(!d){w(!1);return}let k=!1,x=d.querySelector(`script[src="${Mr(n)}"]`);x?x.hasAttribute("data-loaded")&&E(x):(x=d.createElement("script"),x.type=s,x.async=o,x.src=Mr(n),u&&(x.defer=u),a&&(x.crossOrigin=a),c&&(x.noModule=c),l&&(x.referrerPolicy=l),Object.entries(h).forEach(([O,T])=>x==null?void 0:x.setAttribute(O,T)),k=!0),x.addEventListener("error",O=>b(O)),x.addEventListener("abort",O=>b(O)),x.addEventListener("load",()=>{x.setAttribute("data-loaded","true"),e(x),E(x)}),k&&(x=d.head.appendChild(x)),C||E(x)}),y=(C=!0)=>(p||(p=g(C)),p),v=()=>{if(!d)return;p=null,m.value&&(m.value=null);const C=d.querySelector(`script[src="${Mr(n)}"]`);C&&d.head.removeChild(C)};return r&&!i&&Qf(y),i||C1(v),{scriptTag:m,load:y,unload:v}}var M1=Object.defineProperty,rd=Object.getOwnPropertySymbols,A1=Object.prototype.hasOwnProperty,P1=Object.prototype.propertyIsEnumerable,id=(n,e,t)=>e in n?M1(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,sd=(n,e)=>{for(var t in e||(e={}))A1.call(e,t)&&id(n,t,e[t]);if(rd)for(var t of rd(e))P1.call(e,t)&&id(n,t,e[t]);return n};function I1(n={},e={}){const{navigator:t=x1}=e,r=t,i=_1(()=>r&&"canShare"in r);return{isSupported:i,share:async(o={})=>{if(i.value){const a=sd(sd({},Mr(n)),Mr(o));let l=!0;if(a.files&&r.canShare&&(l=r.canShare({files:a.files})),l)return r.share(a)}}}}var D1=Object.defineProperty,od=Object.getOwnPropertySymbols,L1=Object.prototype.hasOwnProperty,R1=Object.prototype.propertyIsEnumerable,ad=(n,e,t)=>e in n?D1(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,F1=(n,e)=>{for(var t in e||(e={}))L1.call(e,t)&&ad(n,t,e[t]);if(od)for(var t of od(e))R1.call(e,t)&&ad(n,t,e[t]);return n};F1({linear:v1},{easeInSine:[.12,0,.39,0],easeOutSine:[.61,1,.88,1],easeInOutSine:[.37,0,.63,1],easeInQuad:[.11,0,.5,0],easeOutQuad:[.5,1,.89,1],easeInOutQuad:[.45,0,.55,1],easeInCubic:[.32,0,.67,0],easeOutCubic:[.33,1,.68,1],easeInOutCubic:[.65,0,.35,1],easeInQuart:[.5,0,.75,0],easeOutQuart:[.25,1,.5,1],easeInOutQuart:[.76,0,.24,1],easeInQuint:[.64,0,.78,0],easeOutQuint:[.22,1,.36,1],easeInOutQuint:[.83,0,.17,1],easeInExpo:[.7,0,.84,0],easeOutExpo:[.16,1,.3,1],easeInOutExpo:[.87,0,.13,1],easeInCirc:[.55,0,1,.45],easeOutCirc:[0,.55,.45,1],easeInOutCirc:[.85,0,.15,1],easeInBack:[.36,0,.66,-.56],easeOutBack:[.34,1.56,.64,1],easeInOutBack:[.68,-.6,.32,1.6]});function xo(n,e,t,r={}){var i,s,o;const{clone:a=!1,passive:l=!1,eventName:c,deep:u=!1,defaultValue:d}=r,h=f.getCurrentInstance(),m=t||(h==null?void 0:h.emit)||((i=h==null?void 0:h.$emit)==null?void 0:i.bind(h))||((o=(s=h==null?void 0:h.proxy)==null?void 0:s.$emit)==null?void 0:o.bind(h==null?void 0:h.proxy));let p=c;p=c||p||`update:${e.toString()}`;const g=v=>a?y1(a)?a(v):E1(v):v,y=()=>g1(n[e])?g(n[e]):d;if(l){const v=y(),C=f.ref(v);return f.watch(()=>n[e],w=>C.value=g(w)),f.watch(C,w=>{(w!==n[e]||u)&&m(p,w)},{deep:u}),C}else return f.computed({get(){return y()},set(v){m(p,v)}})}class B1{constructor(e,t,r,i){X(this,"loadingCache");this.callbackName=e,this.url=t,this.emptyValue=r,this.factories=i,this.loadingCache=i.sourceEmpty.create()}content(e){this.loadingCache.give(!0);const t=setTimeout(()=>{this.loadingCache.give(!1),e.give(this.emptyValue)},1e4);return N1(this.url,()=>{var i;clearInterval(t);const r=((i=window[this.callbackName])==null?void 0:i.call(window))||this.emptyValue;e.give(r),this.loadingCache.give(!1)}),e}loading(e){return this.loadingCache.value(e),e}}class V1{constructor(e){this.text=e}asString(e){return e.give(this.text),e}}class $1{constructor(e,t){this.baseText=e,this.factories=t}asString(e){return this.baseText.asString(this.factories.guestInTheMiddle.create(e,t=>{e.give((t??"").replace(/<\/?[^>]+>/gi," "))})),e}}var _o=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function vl(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var wl={exports:{}},Cl,ld;function j1(){if(ld)return Cl;ld=1;var n=1e3,e=n*60,t=e*60,r=t*24,i=r*7,s=r*365.25;Cl=function(u,d){d=d||{};var h=typeof u;if(h==="string"&&u.length>0)return o(u);if(h==="number"&&isFinite(u))return d.long?l(u):a(u);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(u))};function o(u){if(u=String(u),!(u.length>100)){var d=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(u);if(d){var h=parseFloat(d[1]),m=(d[2]||"ms").toLowerCase();switch(m){case"years":case"year":case"yrs":case"yr":case"y":return h*s;case"weeks":case"week":case"w":return h*i;case"days":case"day":case"d":return h*r;case"hours":case"hour":case"hrs":case"hr":case"h":return h*t;case"minutes":case"minute":case"mins":case"min":case"m":return h*e;case"seconds":case"second":case"secs":case"sec":case"s":return h*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return h;default:return}}}}function a(u){var d=Math.abs(u);return d>=r?Math.round(u/r)+"d":d>=t?Math.round(u/t)+"h":d>=e?Math.round(u/e)+"m":d>=n?Math.round(u/n)+"s":u+"ms"}function l(u){var d=Math.abs(u);return d>=r?c(u,d,r,"day"):d>=t?c(u,d,t,"hour"):d>=e?c(u,d,e,"minute"):d>=n?c(u,d,n,"second"):u+" ms"}function c(u,d,h,m){var p=d>=h*1.5;return Math.round(u/h)+" "+m+(p?"s":"")}return Cl}function z1(n){t.debug=t,t.default=t,t.coerce=l,t.disable=s,t.enable=i,t.enabled=o,t.humanize=j1(),t.destroy=c,Object.keys(n).forEach(u=>{t[u]=n[u]}),t.names=[],t.skips=[],t.formatters={};function e(u){let d=0;for(let h=0;h<u.length;h++)d=(d<<5)-d+u.charCodeAt(h),d|=0;return t.colors[Math.abs(d)%t.colors.length]}t.selectColor=e;function t(u){let d,h=null,m,p;function g(...y){if(!g.enabled)return;const v=g,C=Number(new Date),w=C-(d||C);v.diff=w,v.prev=d,v.curr=C,d=C,y[0]=t.coerce(y[0]),typeof y[0]!="string"&&y.unshift("%O");let b=0;y[0]=y[0].replace(/%([a-zA-Z%])/g,(k,x)=>{if(k==="%%")return"%";b++;const O=t.formatters[x];if(typeof O=="function"){const T=y[b];k=O.call(v,T),y.splice(b,1),b--}return k}),t.formatArgs.call(v,y),(v.log||t.log).apply(v,y)}return g.namespace=u,g.useColors=t.useColors(),g.color=t.selectColor(u),g.extend=r,g.destroy=t.destroy,Object.defineProperty(g,"enabled",{enumerable:!0,configurable:!1,get:()=>h!==null?h:(m!==t.namespaces&&(m=t.namespaces,p=t.enabled(u)),p),set:y=>{h=y}}),typeof t.init=="function"&&t.init(g),g}function r(u,d){const h=t(this.namespace+(typeof d>"u"?":":d)+u);return h.log=this.log,h}function i(u){t.save(u),t.namespaces=u,t.names=[],t.skips=[];let d;const h=(typeof u=="string"?u:"").split(/[\s,]+/),m=h.length;for(d=0;d<m;d++)h[d]&&(u=h[d].replace(/\*/g,".*?"),u[0]==="-"?t.skips.push(new RegExp("^"+u.slice(1)+"$")):t.names.push(new RegExp("^"+u+"$")))}function s(){const u=[...t.names.map(a),...t.skips.map(a).map(d=>"-"+d)].join(",");return t.enable(""),u}function o(u){if(u[u.length-1]==="*")return!0;let d,h;for(d=0,h=t.skips.length;d<h;d++)if(t.skips[d].test(u))return!1;for(d=0,h=t.names.length;d<h;d++)if(t.names[d].test(u))return!0;return!1}function a(u){return u.toString().substring(2,u.toString().length-2).replace(/\.\*\?$/,"*")}function l(u){return u instanceof Error?u.stack||u.message:u}function c(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}var H1=z1;(function(n,e){e.formatArgs=r,e.save=i,e.load=s,e.useColors=t,e.storage=o(),e.destroy=(()=>{let l=!1;return()=>{l||(l=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function t(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let l;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(l=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(l[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function r(l){if(l[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+l[0]+(this.useColors?"%c ":" ")+"+"+n.exports.humanize(this.diff),!this.useColors)return;const c="color: "+this.color;l.splice(1,0,c,"color: inherit");let u=0,d=0;l[0].replace(/%[a-zA-Z%]/g,h=>{h!=="%%"&&(u++,h==="%c"&&(d=u))}),l.splice(d,0,c)}e.log=console.debug||console.log||(()=>{});function i(l){try{l?e.storage.setItem("debug",l):e.storage.removeItem("debug")}catch{}}function s(){let l;try{l=e.storage.getItem("debug")}catch{}return!l&&typeof process<"u"&&"env"in process&&(l=process.env.DEBUG),l}function o(){try{return localStorage}catch{}}n.exports=H1(e);const{formatters:a}=n.exports;a.j=function(l){try{return JSON.stringify(l)}catch(c){return"[UnexpectedJSONParseError]: "+c.message}}})(wl,wl.exports);var ie=wl.exports;const cd=vl(ie),G1=ie.debug("TextNlAsBr");class U1{constructor(e,t){this.baseText=e,this.factories=t}asString(e){return this.baseText.asString(this.factories.guestInTheMiddle.create(e,t=>{if(typeof t>"u"||t===null)return"";const r="<br />";return G1(t),e.give((t??"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,`$1${r}$2`)),!0})),e}}const W1=new Oe(is),K1=new Oe(is),Y1=new Oe(fi),q1=new Oe(Nr),X1=new Oe(ui),J1=new Oe(yl),Q1=new Oe(vo),Z1=new Oe(Zb),ev=new Oe(r1),tv=new Oe(ui),nv=new Oe(Jb),rv=new Oe(Qb),Hn={cache:W1,chain:nv,guest:q1,guestCast:X1,guestAware:J1,guestInTheMiddle:tv,guestSync:rv,patron:Z1,patronOnce:ev,pool:Q1,source:K1,sourceEmpty:Y1},iv=new Oe(a1),sv=new Oe(l1),ov=new Oe(u1),av=new Oe(c1),ud=new Oe(f1),lv=new Oe(d1,{...Hn,svgImage:ud}),cv=new Oe(h1,Hn),uv=new Oe(p1,Hn),fv=new Oe(m1,Hn),dv=new Oe(B1,Hn),hv=new Oe(V1),pv=new Oe($1,Hn),mv=new Oe(U1,Hn),gv={...Hn,fileHandlerContent:iv,browserFileSaved:sv,transformToString:ov,transformToObject:av,svgImage:ud,svgMapTypeImage:lv,numberChunks:cv,mapNameFromUrl:uv,textNoHtml:fv,jsonp:dv,textOf:hv,textNlAsBr:mv,textWithoutHTML:pv},yt=()=>gv;class kl{constructor(e,t,r){this.notification=e,this.check=t,this.factories=r}breakOnFail(e,t){return this.check.check(e,this.factories.guest.create(r=>{r===!0?t.give(!0):this.notification.give({type:"error",text:r})})),this}continueOnFail(e,t){return this.check.check(e,this.factories.guest.create(r=>{t.give(r),r!==!0&&this.notification.give({type:"error",text:r})})),this}}const Sl=ie.debug("MapCurrent");class fd{constructor(e,t,r){X(this,"objectsCache");X(this,"settingsCache");X(this,"typesCache");this.mapFile=e,this.mapId=t,this.factories=r,this.objectsCache=r.sourceEmpty.create(),this.settingsCache=r.sourceEmpty.create(),this.typesCache=r.sourceEmpty.create(),e.currentMap(r.patron.create(r.guest.create(i=>{Sl("current map changed",i),this.settingsCache.give(i.settings),this.objectsCache.give(Object.values(i.objects)),this.typesCache.give(Object.entries(i.types).map(([s,o])=>({...o,id:s})))})))}settings(e){return this.settingsCache.value(e),e}objects(e){return Sl("notify about new objects"),this.objectsCache.value(e),e}types(e){return this.typesCache.value(e),e}give(e){return Sl("save map document",e),this.mapId.id(this.factories.guest.create(t=>{this.mapFile.mapFile(this.factories.guest.create(r=>{this.mapFile.give({...r,[t]:e})}))})),this}}class yv{constructor(e){X(this,"idCache");this.idCache=e.cache.create("current")}id(e){return this.idCache.value(e),e}give(e){return this.idCache.give(e),this}}class bv{constructor(e){this.mapFile=e}value(e){return this.mapFile.currentMap(new ui(e,t=>{e.give(t.settings.title)})),this}}const Eo=ie.debug("MapHistory"),dd=n=>{const e=JSON.parse(JSON.stringify(n));return Object.values(e.objects).forEach(t=>{t.width=0,t.height=0}),JSON.stringify(e)};class vv{constructor(e,t,r,i){X(this,"mapsHistory");X(this,"historyIndex");this.mapFile=e,this.map=t,this.mapId=r,this.factories=i,this.mapsHistory=i.cache.create([]),this.historyIndex=i.cache.create(0),this.mapFile.currentMap(i.patron.create(this)),this.mapId.id(i.patron.create(i.guest.create(()=>{this.mapsHistory.give([]),this.historyIndex.give(0)})))}give(e){return requestIdleCallback(()=>{this.historyIndex.value(this.factories.guest.create(t=>{this.mapsHistory.value(this.factories.guest.create(r=>{Eo("add map to history",r,e);const i=r.some(s=>dd(s)===dd(e));if(Eo("isMapFromHistory",i),!i){const s=r[t]?[r[t]]:[];this.historyIndex.give(0),this.mapsHistory.give([e,...s,...r.slice(0,9)])}}))}))}),this}isPrevPossible(e){const t=this.factories.chain.create(this);return this.historyIndex.value(this.factories.guestCast.create(e,t.receiveKey("historyIndex"))),this.mapsHistory.value(this.factories.guestCast.create(e,t.receiveKey("mapsHistory"))),t.result(this.factories.guestInTheMiddle.create(e,({historyIndex:r,mapsHistory:i})=>{const s=r<i.length-1;Eo("recalculate is prev possible",s),e.give(s)})),e}prev(){this.historyIndex.value(this.factories.guest.create(e=>{const t=e+1;this.historyIndex.give(t),this.mapsHistory.value(this.factories.guest.create(r=>{const i=r[t];this.map.give(i)}))}))}isNextPossible(e){const t=this.factories.chain.create(this);return this.historyIndex.value(this.factories.guestCast.create(e,t.receiveKey("historyIndex"))),this.mapsHistory.value(this.factories.guestCast.create(e,t.receiveKey("mapsHistory"))),t.result(this.factories.guestInTheMiddle.create(e,({historyIndex:r,mapsHistory:i})=>{const s=r>0&&r<=i.length-1;Eo("recalculate is next possible",s),e.give(s)})),e}next(){this.historyIndex.value(this.factories.guest.create(e=>{const t=e-1;this.historyIndex.give(t),this.mapsHistory.value(this.factories.guest.create(r=>{const i=r[t];this.map.give(i)}))}))}}class wv{constructor(e,t,r){this.mapFile=e,this.mapId=t,this.factories=r}give(e){const{guest:t}=this.factories;return this.mapFile.mapFile(t.create(r=>{delete r[e],this.mapFile.give(r),this.mapId.give("current")})),this}}const To=ie.debug("MapFileOfContent");class Cv{constructor(e,t,r){X(this,"currentMapPatrons");X(this,"mapFileCache");this.mapFileContent=e,this.mapId=t,this.factories=r,this.currentMapPatrons=r.pool.create(this),this.mapFileCache=r.cache.create(!1),e.value(r.patron.create(i=>{if(!i)return;const s=this.factories.transformToObject.create(i).result();To("get map file",s),this.mapFileCache.give(s)}))}currentMap(e){const t=this.factories.chain.create();return this.mapId.id(this.factories.guestCast.create(e,t.receiveKey("mapId"))),this.mapFile(this.factories.guestCast.create(e,t.receiveKey("mapFile"))),t.result(this.factories.guestInTheMiddle.create(e,({mapId:r,mapFile:i})=>{if(To("get current map",r,i,typeof i),!i[r])this.createEmptyMapByName(r,e);else{const s=i[r];this.currentMapPatrons.distribute(s!=null&&s.structure?s.structure:s,e)}})),e}give(e){return To("save map file document",e),this.mapFileContent.give(this.factories.transformToString.create(e).result()),this}mapFile(e){return this.mapFileCache.value(e),e}createEmptyMapByName(e,t){To("creating empty map by name",e);const r=this.factories.transformToObject.create(this.generateEmptyMapFile()).result();this.mapFile(this.factories.guest.create(i=>{this.give({...i,[e]:r.current}),t.give(r.current)}))}generateEmptyMapFile(){return'{"current":{"progress":0,"settings":{"colored":false,"title":"current"},"objects":{},"types":{},"url":"/current","parent":""}}'}}const kv=ie.debug("MapFileForRendering");class Sv{constructor(e,t,r){X(this,"mapCache");this.mapId=t,this.factories=r,this.mapCache=r.cache.create({objects:{},types:{},settings:{}}),e.currentMap(r.patron.create(this.mapCache))}currentMap(e){return this.mapCache.value(e),e}mapFile(e){return this.mapCache.value(this.factories.guestInTheMiddle.create(e,t=>{this.mapId.id(this.factories.guest.create(r=>{e.give({[r]:t})}))})),e}give(e){return this.mapId.id(this.factories.guest.create(t=>{kv("received map file, objects = ",e[t].objects),this.mapCache.give(e[t])})),this}}class hd{constructor(e,t,r){this.map=e,this.mapFile=t,this.factories=r}give(e){return this.mapFile.currentMap(this.factories.guest.create(t=>{this.map.give({...t,objects:{...t.objects,[e.id]:{...e,createTimestamp:e.createTimestamp??Date.now(),changeTimestamp:Date.now()}}})})),this}}const pd=cd("app:MapObjectCurrent");class xv{constructor(e,t){X(this,"idCache");X(this,"silenceActivator");this.drawer=e,this.factories=t,this.idCache=t.sourceEmpty.create(),this.silenceActivator=t.source.create(!1),this.idCache.value(t.patron.create(t.guest.create(r=>{r&&e.give("object")})))}silenceOn(e){return this.silenceActivator.give(e),this}silenceOff(){return this.silenceActivator.give(!1),this}objectId(e){return this.idCache.value(e),e}give(e){return pd("new value current object",e),this.silenceActivator.value(this.factories.guest.create(t=>{pd("silence activator",t),t?t.give(e):this.idCache.give(e)})),this}}class _v{constructor(e,t){this.mapFile=e,this.factories=t}check(e,t){return this.mapFile.currentMap(this.factories.guest.create(r=>{let i=!1;Object.values(r.objects).forEach(s=>{i=i||s.arrows.some(o=>o.id===e.id)}),t.give(!i||"У объекта есть входящие связи!")})),this}}const xl=ie.debug("MapObjectNew");class Ev{constructor(e,t,r,i,s){this.map=e,this.mapObject=t,this.canvas=r,this.stagePosition=i,this.factories=s}byTypeName(e,t){return xl("start to add new type",e,t),this.stagePosition.position(this.factories.guest.create(r=>{this.map.types(this.factories.guest.create(i=>{this.canvas.canvas(this.factories.guest.create(s=>{const o=s.getBoundingClientRect(),a=i.find(u=>u.id===e);xl("is type found",a);const l=t.x-o.left,c=t.y-o.top;a&&(xl("add new type"),this.mapObject.give({additionalName:"",arrows:[],description:"",inMenu:!1,lastClick:Date.now(),linked:!1,menuOrder:0,name:"",outlink:"",targetBlank:!1,type:e,width:a.width,height:a.height,zindex:0,id:new Date().getTime().toString(),createTimestamp:Date.now(),changeTimestamp:Date.now(),position:[l>0?l+r.x:0,c>0?c+r.y:0]}))}))}))})),this}}class Tv{constructor(e,t){this.mapId=e,this.factories=t}names(e){return this.mapId.id(this.factories.guestInTheMiddle.create(e,t=>{const r=t.split("_").filter(o=>!!o);let i="";const s=r.map(o=>{const a=`${i}${o}`;return i||(i="_"),i+=`${o}_`,a});i="",e.give(s)})),e}}class Ov{constructor(e){this.mapObject=e}give(e){const{arrows:t}=e.object;return t.splice(e.index,1),this.mapObject.give({...e.object,arrows:t}),this}}class Nv{constructor(e,t,r,i){this.map=e,this.mapFile=t,this.checks=r,this.factories=i}give(e){const t=this.factories.chain.create(this);return this.checks.forEach((r,i)=>{r.breakOnFail(e,t.receiveKey(String(i)))}),t.result(this.factories.guest.create(()=>{this.mapFile.currentMap(this.factories.guest.create(r=>{delete r.objects[e.id],this.map.give(r)}))})),this}}const Mv=ie.debug("MapObjectsLink");class Av{constructor(e,t,r,i,s){X(this,"objectIdsCache");this.mapObjectCurrent=e,this.map=t,this.mapObject=r,this.newArrow=i,this.factories=s,this.objectIdsCache=s.cache.create([])}objectIds(e){return this.objectIdsCache.value(e),e}startLink(){this.mapObjectCurrent.give(""),this.objectIdsCache.value(this.factories.guest.create(e=>{if(e.length){this.mapObjectCurrent.silenceOff(),this.objectIdsCache.give([]);return}const t=["first"];this.objectIdsCache.give(t),this.mapObjectCurrent.silenceOn(this.factories.guest.create(r=>{t.push(r),this.objectIdsCache.give([...t]),Mv("object ids",t),t.length===2&&this.map.objects(this.factories.guest.create(i=>{const[,s]=t,o=i.find(a=>a.id===s);o&&this.newArrow.forObject(o)})),t.length===3&&(this.newArrow.dispose(),this.mapObjectCurrent.silenceOff(),this.map.objects(this.factories.guest.create(i=>{const[,s,o]=t,a=i.find(l=>l.id===s);a&&o&&(this.objectIdsCache.give([]),this.mapObject.give({...a,arrows:[...a.arrows,{id:o,label:""}]}))})))}))}))}}function Pv(n){var e=typeof n;return n!=null&&(e=="object"||e=="function")}var _l=Pv,Iv=typeof _o=="object"&&_o&&_o.Object===Object&&_o,Dv=Iv,Lv=Dv,Rv=typeof self=="object"&&self&&self.Object===Object&&self,Fv=Lv||Rv||Function("return this")(),md=Fv,Bv=md,Vv=function(){return Bv.Date.now()},$v=Vv,jv=/\s/;function zv(n){for(var e=n.length;e--&&jv.test(n.charAt(e)););return e}var Hv=zv,Gv=Hv,Uv=/^\s+/;function Wv(n){return n&&n.slice(0,Gv(n)+1).replace(Uv,"")}var Kv=Wv,Yv=md,qv=Yv.Symbol,gd=qv,yd=gd,bd=Object.prototype,Xv=bd.hasOwnProperty,Jv=bd.toString,as=yd?yd.toStringTag:void 0;function Qv(n){var e=Xv.call(n,as),t=n[as];try{n[as]=void 0;var r=!0}catch{}var i=Jv.call(n);return r&&(e?n[as]=t:delete n[as]),i}var Zv=Qv,ew=Object.prototype,tw=ew.toString;function nw(n){return tw.call(n)}var rw=nw,vd=gd,iw=Zv,sw=rw,ow="[object Null]",aw="[object Undefined]",wd=vd?vd.toStringTag:void 0;function lw(n){return n==null?n===void 0?aw:ow:wd&&wd in Object(n)?iw(n):sw(n)}var cw=lw;function uw(n){return n!=null&&typeof n=="object"}var fw=uw,dw=cw,hw=fw,pw="[object Symbol]";function mw(n){return typeof n=="symbol"||hw(n)&&dw(n)==pw}var gw=mw,yw=Kv,Cd=_l,bw=gw,kd=NaN,vw=/^[-+]0x[0-9a-f]+$/i,ww=/^0b[01]+$/i,Cw=/^0o[0-7]+$/i,kw=parseInt;function Sw(n){if(typeof n=="number")return n;if(bw(n))return kd;if(Cd(n)){var e=typeof n.valueOf=="function"?n.valueOf():n;n=Cd(e)?e+"":e}if(typeof n!="string")return n===0?n:+n;n=yw(n);var t=ww.test(n);return t||Cw.test(n)?kw(n.slice(2),t?2:8):vw.test(n)?kd:+n}var xw=Sw,_w=_l,El=$v,Sd=xw,Ew="Expected a function",Tw=Math.max,Ow=Math.min;function Nw(n,e,t){var r,i,s,o,a,l,c=0,u=!1,d=!1,h=!0;if(typeof n!="function")throw new TypeError(Ew);e=Sd(e)||0,_w(t)&&(u=!!t.leading,d="maxWait"in t,s=d?Tw(Sd(t.maxWait)||0,e):s,h="trailing"in t?!!t.trailing:h);function m(k){var x=r,O=i;return r=i=void 0,c=k,o=n.apply(O,x),o}function p(k){return c=k,a=setTimeout(v,e),u?m(k):o}function g(k){var x=k-l,O=k-c,T=e-x;return d?Ow(T,s-O):T}function y(k){var x=k-l,O=k-c;return l===void 0||x>=e||x<0||d&&O>=s}function v(){var k=El();if(y(k))return C(k);a=setTimeout(v,g(k))}function C(k){return a=void 0,h&&r?m(k):(r=i=void 0,o)}function w(){a!==void 0&&clearTimeout(a),c=0,r=l=i=a=void 0}function b(){return a===void 0?o:C(El())}function E(){var k=El(),x=y(k);if(r=arguments,i=this,l=k,x){if(a===void 0)return p(l);if(d)return clearTimeout(a),a=setTimeout(v,e),m(l)}return a===void 0&&(a=setTimeout(v,e)),o}return E.cancel=w,E.flush=b,E}var xd=Nw;const di=vl(xd),Mw=n=>{if(n[n.length-1]==="/"){const e=n.split("");return e.splice(e.length-1,1),e.join("")}return n},Aw=di(n=>{window==null||window.open(n)},200),Tl=ie.debug("MapObjectUrl");class Pw{constructor(e,t){this.mapId=e,this.factories=t}open(e,t){if(e!=null&&e.linked){const r=e.outlink;e.targetBlank?Aw(r):(Tl("open new map",r),this.factories.mapNameFromUrl.create(this.factories.source.create(r)).name(this.factories.guest.create(s=>{Tl("open map name",r,s),t.give(s)})))}return this}url(e,t){return e.value(this.factories.guestInTheMiddle.create(t,r=>{this.mapId.id(this.factories.guest.create(i=>{const s=i[0]==="_"?i.replaceAll("_","/"):"/current",o=r.name?r.name:r.additionalName?r.additionalName:"";this.factories.textNoHtml.create(this.factories.source.create(o)).noHtml(this.factories.guest.create(a=>{let l=r.outlink?r.outlink:`${s}/${Iw(a)}`;Tl("link is",l),l=Mw(l),t.give(l)}))}))})),t}}function Iw(n){return n.toLowerCase().replace(/ /g,"-").replace(/[^\w-]+/g,"")}const Dw=ie.debug("ObjectPositionBounds");class Lw{constructor(e,t){this.stageSize=e,this.factories=t}position(e,t,r){return this.stageSize.value(this.factories.guestInTheMiddle.create(r,i=>{let{x:s,y:o}=t;s<30&&(s=30),o<30&&(o=30);const a=i.width-e.width;s>a&&(s=a);const l=i.height-e.height;o>l&&(o=l),Dw("position",s,o),r.give({x:s,y:o})})),r}}const Oo=15;class Rw{constructor(e,t){this.baseRestriction=e,this.factories=t}position(e,t,r){return this.baseRestriction.position(e,t,this.factories.guestInTheMiddle.create(r,i=>{r.give({x:Math.round(i.x/Oo)*Oo,y:Math.round(i.y/Oo)*Oo})})),r}}const _d={x:"width",y:"height"},Ol={x:0,y:1},Fw={positive:1,negative:-1},Ed=ie.debug("ObjectsOutsideScreen");class Bw{constructor(e,t,r,i){this.map=e,this.stageSize=t,this.layer=r,this.factories=i}count(e,t){const r=e.direction==="positive",i=this.factories.chain.create();return this.map.objects(this.factories.guestCast.create(t,i.receiveKey("objects"))),this.layer.layer(this.factories.guestCast.create(t,i.receiveKey("layer"))),this.layer.position(this.factories.guestCast.create(t,i.receiveKey("position"))),i.result(this.factories.guestInTheMiddle.create(t,({objects:s,layer:o,position:a})=>{var d;const l=Fw[e.direction],u=s.sort((h,m)=>h.position[Ol[e.axis]]*l-m.position[Ol[e.axis]]*l).filter(h=>{const m=h.position[Ol[e.axis]]+(r?0:h[_d[e.axis]]),p=a[e.axis]*-1+(r?o[_d[e.axis]]():0);return Ed("mb nearest points",e.direction,"objectP=",m,"screenP=",p),r?m>p:m<p});Ed("nearest",u),t.give({count:u.length,nearestObjectId:((d=u.at(r?-1:0))==null?void 0:d.id)??""})})),t}}class Vw{constructor(e,t,r){this.mapFile=e,this.map=t,this.factories=r}give(e){return this.mapFile.currentMap(this.factories.guest.create(t=>{this.map.give({...t,settings:e})})),this}}class $w{constructor(e){X(this,"idCache");this.idCache=e.sourceEmpty.create()}typeId(e){return this.idCache.value(e),e}give(e){return this.idCache.give(e),this}}class jw{constructor(e){this.mapType=e}byName(){const e=String(new Date().getTime());this.mapType.give({name:e,type:{id:e,name:"Новый тип",svg:'<div style="background: lightyellow;border: 1px solid #ccc;">type</div>',width:100,height:40}})}}class zw{constructor(e,t,r,i){this.map=e,this.mapFile=t,this.checks=r,this.factories=i}give(e){const t=this.factories.chain.create(this);return this.checks.forEach((r,i)=>{r.breakOnFail({name:e.id,type:e},t.receiveKey(String(i)))}),t.result(this.factories.guest.create(()=>{this.mapFile.currentMap(this.factories.guest.create(r=>{delete r.types[e.id],this.map.give(r)}))})),this}}class Hw{constructor(e,t,r,i){this.map=e,this.mapFile=t,this.checks=r,this.factories=i}give(e){const t=this.factories.chain.create(this);return this.checks.forEach((r,i)=>{r.breakOnFail(e,t.receiveKey(String(i)))}),t.result(this.factories.guest.create(()=>{this.mapFile.currentMap(this.factories.guest.create(r=>{delete r.types[e.name],this.map.give({...r,types:{...r.types,[e.type.name]:e.type}})}))})),this}}const Gw=ie.debug("MapTypeUsed");class Uw{constructor(e,t){this.mapFile=e,this.factories=t}check(e,t){return this.mapFile.currentMap(this.factories.guest.create(r=>{const i=Object.values(r.objects).some(s=>s.type===e.name);Gw("is type used",i),t.give(!i||"Тип карты использован")})),this}}class Ww{constructor(e,t){this.mapTypeUsedCheck=e,this.factories=t}check(e,t){return this.mapTypeUsedCheck.check(e,this.factories.guest.create(r=>{r!==!0&&e.name!==e.type.name?t.give("Нельзя изменять имя типа, который использован!"):t.give(!0)})),this}}const Td=ie.debug("ParentTypes");class Kw{constructor(e,t,r){this.parentNames=e,this.mapFile=t,this.factories=r}types(e){Td("parent types requested");const t=this.factories.chain.create();return this.parentNames.names(this.factories.guestCast.create(e,t.receiveKey("parentNames"))),this.mapFile.mapFile(this.factories.guestCast.create(e,t.receiveKey("mapFile"))),t.result(this.factories.guestInTheMiddle.create(e,({parentNames:r,mapFile:i})=>{const s=r.slice(0,-1);Td("parent names",s);const o={};s.map(l=>i[l]).forEach(l=>{Object.values(l.types).forEach(c=>{o[c.name]=c})}),e.give(Object.values(o))})),e}}const Od=ie.debug("ObjectsMatchedToQuery");class Yw{constructor(e,t){this.map=e,this.factories=t}objects(e,t){return e.value(this.factories.guestInTheMiddle.create(t,di(i=>{i=i.toLowerCase(),this.map.objects(this.factories.guest.create(s=>{if(!i){Od("reset results"),t.give([]);return}const o=s.filter(a=>{var l;return a.name.toLowerCase().includes(i)||((l=a.additionalName)==null?void 0:l.toLowerCase().includes(i))||Object.values(a.additionalFields??{}).join(" ").toLowerCase().includes(i)});Od("objects in searching",o,i),t.give(o)}))},500))),t}}const qw={height:3e3,width:3e3};class Xw{value(e){return e.give(qw),e}}const Nd=ie.debug("StageMoveRestriction");class Jw{constructor(e,t,r){this.canvasDep=e,this.stageSize=t,this.factories=r}position(e,t){return this.canvasDep.canvas(this.factories.guest.create(r=>{this.stageSize.value(this.factories.guest.create(i=>{Nd("income position",e);const s=i.width-r.clientWidth,o=i.height-r.clientHeight,a=e.x*-1,l=e.y*-1;if(o<0||s<0)return{x:0,y:0};Nd("boundings",o,s,l,a),t.give({x:e.x>0?0:a>s?s*-1:e.x,y:e.y>0?0:l>o?o*-1:e.y})}))})),t}}const ls=ie.debug("app:MapObjectsVisible");class Qw{constructor(e,t,r,i){X(this,"visibleObjectsCache",new fi);ls("constructor initialized");const s=i.chain.create();t.size(i.patron.create(s.receiveKey("size"))),e.position(i.patron.create(s.receiveKey("position"))),r.currentMap(i.patron.create(s.receiveKey("map"))),s.result(i.patron.create(i.guest.create(({position:o,size:a,map:l})=>{const c=Object.values(l.objects);ls("objects come to result",c);const u=c.filter(d=>{const h=l.types[d.type]??{},m={width:d.width||h.width,height:d.height||h.height};return this.isInBounding(o,a,d.position,m)});ls("visible objects calculated",u),this.visibleObjectsCache.give(u)})))}objects(e){return this.visibleObjectsCache.value(e),this}isInBounding(e,t,r,i){const s=e.x,o=e.x-t.width,a=e.y,l=e.y-t.height,[c,u]=r;return ls("bounding vars",s,o,a,l),ls("object position",r),s>-c-i.width&&-c>o&&a>-u-i.height&&-u>l}}const Zw=(n,e)=>{const t=n.matchAll(e);return Array.from(t).map(r=>r[1])},eC=(n,e)=>n.reduce((t,r)=>(t[r]=e[r]||r,t),{});class tC{constructor(e,t,r,i){this.mapFile=t,this.mapObject=r,this.factories=i,e.objectId(this)}give(e){return this.mapFile.currentMap(this.factories.guest.create(t=>{const r=t.objects[e];if(!r)return;const i=t.types[r.type],s=/\$\{([a-zA-Z1-9]+)\}/g,a=Zw(i.svg,s).filter(l=>l!=="width"&&l!=="height");r.additionalFields=eC(a,r.additionalFields??{}),this.mapObject.give(r)})),this}introduction(){return"patron"}}class nC{constructor(){X(this,"filledPoints",new Map)}clear(){this.filledPoints.clear()}breakPoints(e,t,r){const i=this.arrowPointPosition(e.shapeGeometry,e.shapePosition,e.lookToGeometry,e.lookToPosition),s=this.arrowPointPosition(t.shapeGeometry,t.shapePosition,t.lookToGeometry,t.lookToPosition);return r.give([+i.point.x+i.shift.x,+i.point.y+i.shift.y,+i.breakPoint.x+i.shift.x,+i.breakPoint.y+i.shift.y,+s.breakPoint.x+s.shift.x,+s.breakPoint.y+s.shift.y,+s.point.x+s.shift.x,+s.point.y+s.shift.y]),this}arrowPointPosition(e,t,r,i){const s={x:+i.x+Math.round(r.width/2),y:+i.y+Math.round(r.height/2)},o={x:+t.x+Math.round(e.width/2),y:+t.y+Math.round(e.height/2)},a=o.x-s.x,l=o.y-s.y,c=Math.abs(l)>Math.abs(a);let u=+t.x,d=+t.y;const h=c&&l>=0,m=!c&&a>=0,p=c&&l<0,g=!c&&a<0,y={x:0,y:0};let v=0,C=0;h?(u+=Math.round(e.width/2),y.x=u,y.y=(t.y+i.y+r.height)/2,v=i.x>t.x?1:-1):g?(d+=Math.round(e.height/2),u+=+e.width,y.x=(t.x+e.width+i.x)/2,y.y=d,C=i.y>t.y?1:-1):p?(u+=Math.round(e.width/2),d+=+e.height,y.x=u,y.y=(t.y+e.height+i.y)/2,v=i.x>t.x?1:-1):m&&(d+=Math.round(e.height/2),y.x=(t.x+i.x+r.width)/2,y.y=d,C=i.y>t.y?1:-1);const w=[u,d].join("-"),b=this.filledPoints.get(w)||0;return this.filledPoints.set(w,b+1),{point:{x:u,y:d},breakPoint:y,shift:{x:v*b*10,y:C*b*10}}}}var rC=Math.PI/180;function iC(){return typeof window<"u"&&({}.toString.call(window)==="[object Window]"||{}.toString.call(window)==="[object global]")}const Nl=typeof global<"u"?global:typeof window<"u"?window:typeof WorkerGlobalScope<"u"?self:{},J={_global:Nl,version:"8.4.3",isBrowser:iC(),isUnminified:/param/.test((function(n){}).toString()),dblClickWindow:400,getAngle(n){return J.angleDeg?n*rC:n},enableTrace:!1,pointerEventsEnabled:!0,autoDrawEnabled:!0,hitOnDragEnabled:!1,capturePointerEventsEnabled:!1,_mouseListenClick:!1,_touchListenClick:!1,_pointerListenClick:!1,_mouseInDblClickWindow:!1,_touchInDblClickWindow:!1,_pointerInDblClickWindow:!1,_mouseDblClickPointerId:null,_touchDblClickPointerId:null,_pointerDblClickPointerId:null,pixelRatio:typeof window<"u"&&window.devicePixelRatio||1,dragDistance:3,angleDeg:!0,showWarnings:!0,dragButtons:[0,1],isDragging(){return J.DD.isDragging},isDragReady(){return!!J.DD.node},releaseCanvasOnDestroy:!0,document:Nl.document,_injectGlobal(n){Nl.Konva=n}},hi=n=>{J[n.prototype.getClassName()]=n};J._injectGlobal(J);let cs=class Bb{constructor(e=[1,0,0,1,0,0]){this.dirty=!1,this.m=e&&e.slice()||[1,0,0,1,0,0]}reset(){this.m[0]=1,this.m[1]=0,this.m[2]=0,this.m[3]=1,this.m[4]=0,this.m[5]=0}copy(){return new Bb(this.m)}copyInto(e){e.m[0]=this.m[0],e.m[1]=this.m[1],e.m[2]=this.m[2],e.m[3]=this.m[3],e.m[4]=this.m[4],e.m[5]=this.m[5]}point(e){var t=this.m;return{x:t[0]*e.x+t[2]*e.y+t[4],y:t[1]*e.x+t[3]*e.y+t[5]}}translate(e,t){return this.m[4]+=this.m[0]*e+this.m[2]*t,this.m[5]+=this.m[1]*e+this.m[3]*t,this}scale(e,t){return this.m[0]*=e,this.m[1]*=e,this.m[2]*=t,this.m[3]*=t,this}rotate(e){var t=Math.cos(e),r=Math.sin(e),i=this.m[0]*t+this.m[2]*r,s=this.m[1]*t+this.m[3]*r,o=this.m[0]*-r+this.m[2]*t,a=this.m[1]*-r+this.m[3]*t;return this.m[0]=i,this.m[1]=s,this.m[2]=o,this.m[3]=a,this}getTranslation(){return{x:this.m[4],y:this.m[5]}}skew(e,t){var r=this.m[0]+this.m[2]*t,i=this.m[1]+this.m[3]*t,s=this.m[2]+this.m[0]*e,o=this.m[3]+this.m[1]*e;return this.m[0]=r,this.m[1]=i,this.m[2]=s,this.m[3]=o,this}multiply(e){var t=this.m[0]*e.m[0]+this.m[2]*e.m[1],r=this.m[1]*e.m[0]+this.m[3]*e.m[1],i=this.m[0]*e.m[2]+this.m[2]*e.m[3],s=this.m[1]*e.m[2]+this.m[3]*e.m[3],o=this.m[0]*e.m[4]+this.m[2]*e.m[5]+this.m[4],a=this.m[1]*e.m[4]+this.m[3]*e.m[5]+this.m[5];return this.m[0]=t,this.m[1]=r,this.m[2]=i,this.m[3]=s,this.m[4]=o,this.m[5]=a,this}invert(){var e=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),t=this.m[3]*e,r=-this.m[1]*e,i=-this.m[2]*e,s=this.m[0]*e,o=e*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),a=e*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);return this.m[0]=t,this.m[1]=r,this.m[2]=i,this.m[3]=s,this.m[4]=o,this.m[5]=a,this}getMatrix(){return this.m}decompose(){var e=this.m[0],t=this.m[1],r=this.m[2],i=this.m[3],s=this.m[4],o=this.m[5],a=e*i-t*r;let l={x:s,y:o,rotation:0,scaleX:0,scaleY:0,skewX:0,skewY:0};if(e!=0||t!=0){var c=Math.sqrt(e*e+t*t);l.rotation=t>0?Math.acos(e/c):-Math.acos(e/c),l.scaleX=c,l.scaleY=a/c,l.skewX=(e*r+t*i)/a,l.skewY=0}else if(r!=0||i!=0){var u=Math.sqrt(r*r+i*i);l.rotation=Math.PI/2-(i>0?Math.acos(-r/u):-Math.acos(r/u)),l.scaleX=a/u,l.scaleY=u,l.skewX=0,l.skewY=(e*r+t*i)/a}return l.rotation=A._getRotation(l.rotation),l}};var sC="[object Array]",oC="[object Number]",aC="[object String]",lC="[object Boolean]",cC=Math.PI/180,uC=180/Math.PI,Ml="#",fC="",dC="0",hC="Konva warning: ",Md="Konva error: ",pC="rgb(",Al={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],transparent:[255,255,255,0],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]},mC=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/,No=[];const gC=typeof requestAnimationFrame<"u"&&requestAnimationFrame||function(n){setTimeout(n,60)},A={_isElement(n){return!!(n&&n.nodeType==1)},_isFunction(n){return!!(n&&n.constructor&&n.call&&n.apply)},_isPlainObject(n){return!!n&&n.constructor===Object},_isArray(n){return Object.prototype.toString.call(n)===sC},_isNumber(n){return Object.prototype.toString.call(n)===oC&&!isNaN(n)&&isFinite(n)},_isString(n){return Object.prototype.toString.call(n)===aC},_isBoolean(n){return Object.prototype.toString.call(n)===lC},isObject(n){return n instanceof Object},isValidSelector(n){if(typeof n!="string")return!1;var e=n[0];return e==="#"||e==="."||e===e.toUpperCase()},_sign(n){return n===0||n>0?1:-1},requestAnimFrame(n){No.push(n),No.length===1&&gC(function(){const e=No;No=[],e.forEach(function(t){t()})})},createCanvasElement(){var n=document.createElement("canvas");try{n.style=n.style||{}}catch{}return n},createImageElement(){return document.createElement("img")},_isInDocument(n){for(;n=n.parentNode;)if(n==document)return!0;return!1},_urlToImage(n,e){var t=A.createImageElement();t.onload=function(){e(t)},t.src=n},_rgbToHex(n,e,t){return((1<<24)+(n<<16)+(e<<8)+t).toString(16).slice(1)},_hexToRgb(n){n=n.replace(Ml,fC);var e=parseInt(n,16);return{r:e>>16&255,g:e>>8&255,b:e&255}},getRandomColor(){for(var n=(Math.random()*16777215<<0).toString(16);n.length<6;)n=dC+n;return Ml+n},getRGB(n){var e;return n in Al?(e=Al[n],{r:e[0],g:e[1],b:e[2]}):n[0]===Ml?this._hexToRgb(n.substring(1)):n.substr(0,4)===pC?(e=mC.exec(n.replace(/ /g,"")),{r:parseInt(e[1],10),g:parseInt(e[2],10),b:parseInt(e[3],10)}):{r:0,g:0,b:0}},colorToRGBA(n){return n=n||"black",A._namedColorToRBA(n)||A._hex3ColorToRGBA(n)||A._hex4ColorToRGBA(n)||A._hex6ColorToRGBA(n)||A._hex8ColorToRGBA(n)||A._rgbColorToRGBA(n)||A._rgbaColorToRGBA(n)||A._hslColorToRGBA(n)},_namedColorToRBA(n){var e=Al[n.toLowerCase()];return e?{r:e[0],g:e[1],b:e[2],a:1}:null},_rgbColorToRGBA(n){if(n.indexOf("rgb(")===0){n=n.match(/rgb\(([^)]+)\)/)[1];var e=n.split(/ *, */).map(Number);return{r:e[0],g:e[1],b:e[2],a:1}}},_rgbaColorToRGBA(n){if(n.indexOf("rgba(")===0){n=n.match(/rgba\(([^)]+)\)/)[1];var e=n.split(/ *, */).map((t,r)=>t.slice(-1)==="%"?r===3?parseInt(t)/100:parseInt(t)/100*255:Number(t));return{r:e[0],g:e[1],b:e[2],a:e[3]}}},_hex8ColorToRGBA(n){if(n[0]==="#"&&n.length===9)return{r:parseInt(n.slice(1,3),16),g:parseInt(n.slice(3,5),16),b:parseInt(n.slice(5,7),16),a:parseInt(n.slice(7,9),16)/255}},_hex6ColorToRGBA(n){if(n[0]==="#"&&n.length===7)return{r:parseInt(n.slice(1,3),16),g:parseInt(n.slice(3,5),16),b:parseInt(n.slice(5,7),16),a:1}},_hex4ColorToRGBA(n){if(n[0]==="#"&&n.length===5)return{r:parseInt(n[1]+n[1],16),g:parseInt(n[2]+n[2],16),b:parseInt(n[3]+n[3],16),a:parseInt(n[4]+n[4],16)/255}},_hex3ColorToRGBA(n){if(n[0]==="#"&&n.length===4)return{r:parseInt(n[1]+n[1],16),g:parseInt(n[2]+n[2],16),b:parseInt(n[3]+n[3],16),a:1}},_hslColorToRGBA(n){if(/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.test(n)){const[e,...t]=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(n),r=Number(t[0])/360,i=Number(t[1])/100,s=Number(t[2])/100;let o,a,l;if(i===0)return l=s*255,{r:Math.round(l),g:Math.round(l),b:Math.round(l),a:1};s<.5?o=s*(1+i):o=s+i-s*i;const c=2*s-o,u=[0,0,0];for(let d=0;d<3;d++)a=r+1/3*-(d-1),a<0&&a++,a>1&&a--,6*a<1?l=c+(o-c)*6*a:2*a<1?l=o:3*a<2?l=c+(o-c)*(2/3-a)*6:l=c,u[d]=l*255;return{r:Math.round(u[0]),g:Math.round(u[1]),b:Math.round(u[2]),a:1}}},haveIntersection(n,e){return!(e.x>n.x+n.width||e.x+e.width<n.x||e.y>n.y+n.height||e.y+e.height<n.y)},cloneObject(n){var e={};for(var t in n)this._isPlainObject(n[t])?e[t]=this.cloneObject(n[t]):this._isArray(n[t])?e[t]=this.cloneArray(n[t]):e[t]=n[t];return e},cloneArray(n){return n.slice(0)},degToRad(n){return n*cC},radToDeg(n){return n*uC},_degToRad(n){return A.warn("Util._degToRad is removed. Please use public Util.degToRad instead."),A.degToRad(n)},_radToDeg(n){return A.warn("Util._radToDeg is removed. Please use public Util.radToDeg instead."),A.radToDeg(n)},_getRotation(n){return J.angleDeg?A.radToDeg(n):n},_capitalize(n){return n.charAt(0).toUpperCase()+n.slice(1)},throw(n){throw new Error(Md+n)},error(n){console.error(Md+n)},warn(n){J.showWarnings&&console.warn(hC+n)},each(n,e){for(var t in n)e(t,n[t])},_inRange(n,e,t){return e<=n&&n<t},_getProjectionToSegment(n,e,t,r,i,s){var o,a,l,c=(n-t)*(n-t)+(e-r)*(e-r);if(c==0)o=n,a=e,l=(i-t)*(i-t)+(s-r)*(s-r);else{var u=((i-n)*(t-n)+(s-e)*(r-e))/c;u<0?(o=n,a=e,l=(n-i)*(n-i)+(e-s)*(e-s)):u>1?(o=t,a=r,l=(t-i)*(t-i)+(r-s)*(r-s)):(o=n+u*(t-n),a=e+u*(r-e),l=(o-i)*(o-i)+(a-s)*(a-s))}return[o,a,l]},_getProjectionToLine(n,e,t){var r=A.cloneObject(n),i=Number.MAX_VALUE;return e.forEach(function(s,o){if(!(!t&&o===e.length-1)){var a=e[(o+1)%e.length],l=A._getProjectionToSegment(s.x,s.y,a.x,a.y,n.x,n.y),c=l[0],u=l[1],d=l[2];d<i&&(r.x=c,r.y=u,i=d)}}),r},_prepareArrayForTween(n,e,t){var r,i=[],s=[];if(n.length>e.length){var o=e;e=n,n=o}for(r=0;r<n.length;r+=2)i.push({x:n[r],y:n[r+1]});for(r=0;r<e.length;r+=2)s.push({x:e[r],y:e[r+1]});var a=[];return s.forEach(function(l){var c=A._getProjectionToLine(l,i,t);a.push(c.x),a.push(c.y)}),a},_prepareToStringify(n){var e;n.visitedByCircularReferenceRemoval=!0;for(var t in n)if(n.hasOwnProperty(t)&&n[t]&&typeof n[t]=="object"){if(e=Object.getOwnPropertyDescriptor(n,t),n[t].visitedByCircularReferenceRemoval||A._isElement(n[t]))if(e.configurable)delete n[t];else return null;else if(A._prepareToStringify(n[t])===null)if(e.configurable)delete n[t];else return null}return delete n.visitedByCircularReferenceRemoval,n},_assign(n,e){for(var t in e)n[t]=e[t];return n},_getFirstPointerId(n){return n.touches?n.changedTouches[0].identifier:n.pointerId||999},releaseCanvas(...n){J.releaseCanvasOnDestroy&&n.forEach(e=>{e.width=0,e.height=0})},drawRoundedRectPath(n,e,t,r){let i=0,s=0,o=0,a=0;typeof r=="number"?i=s=o=a=Math.min(r,e/2,t/2):(i=Math.min(r[0]||0,e/2,t/2),s=Math.min(r[1]||0,e/2,t/2),a=Math.min(r[2]||0,e/2,t/2),o=Math.min(r[3]||0,e/2,t/2)),n.moveTo(i,0),n.lineTo(e-s,0),n.arc(e-s,s,s,Math.PI*3/2,0,!1),n.lineTo(e,t-a),n.arc(e-a,t-a,a,0,Math.PI/2,!1),n.lineTo(o,t),n.arc(o,t-o,o,Math.PI/2,Math.PI,!1),n.lineTo(0,i),n.arc(i,i,i,Math.PI,Math.PI*3/2,!1)}};function Gn(n){return A._isString(n)?'"'+n+'"':Object.prototype.toString.call(n)==="[object Number]"||A._isBoolean(n)?n:Object.prototype.toString.call(n)}function ue(){if(J.isUnminified)return function(n,e){return A._isNumber(n)||A.warn(Gn(n)+' is a not valid value for "'+e+'" attribute. The value should be a number.'),n}}function yC(n){if(J.isUnminified)return function(e,t){let r=A._isNumber(e),i=A._isArray(e)&&e.length==n;return!r&&!i&&A.warn(Gn(e)+' is a not valid value for "'+t+'" attribute. The value should be a number or Array<number>('+n+")"),e}}function bC(){if(J.isUnminified)return function(n,e){var t=A._isNumber(n),r=n==="auto";return t||r||A.warn(Gn(n)+' is a not valid value for "'+e+'" attribute. The value should be a number or "auto".'),n}}function us(){if(J.isUnminified)return function(n,e){return A._isString(n)||A.warn(Gn(n)+' is a not valid value for "'+e+'" attribute. The value should be a string.'),n}}function Ad(){if(J.isUnminified)return function(n,e){const t=A._isString(n),r=Object.prototype.toString.call(n)==="[object CanvasGradient]"||n&&n.addColorStop;return t||r||A.warn(Gn(n)+' is a not valid value for "'+e+'" attribute. The value should be a string or a native gradient.'),n}}function vC(){if(J.isUnminified)return function(n,e){const t=Int8Array?Object.getPrototypeOf(Int8Array):null;return t&&n instanceof t||(A._isArray(n)?n.forEach(function(r){A._isNumber(r)||A.warn('"'+e+'" attribute has non numeric element '+r+". Make sure that all elements are numbers.")}):A.warn(Gn(n)+' is a not valid value for "'+e+'" attribute. The value should be a array of numbers.')),n}}function Ar(){if(J.isUnminified)return function(n,e){var t=n===!0||n===!1;return t||A.warn(Gn(n)+' is a not valid value for "'+e+'" attribute. The value should be a boolean.'),n}}function wC(n){if(J.isUnminified)return function(e,t){return e==null||A.isObject(e)||A.warn(Gn(e)+' is a not valid value for "'+t+'" attribute. The value should be an object with properties '+n),e}}var fs="get",ds="set";const L={addGetterSetter(n,e,t,r,i){L.addGetter(n,e,t),L.addSetter(n,e,r,i),L.addOverloadedGetterSetter(n,e)},addGetter(n,e,t){var r=fs+A._capitalize(e);n.prototype[r]=n.prototype[r]||function(){var i=this.attrs[e];return i===void 0?t:i}},addSetter(n,e,t,r){var i=ds+A._capitalize(e);n.prototype[i]||L.overWriteSetter(n,e,t,r)},overWriteSetter(n,e,t,r){var i=ds+A._capitalize(e);n.prototype[i]=function(s){return t&&s!==void 0&&s!==null&&(s=t.call(this,s,e)),this._setAttr(e,s),r&&r.call(this),this}},addComponentsGetterSetter(n,e,t,r,i){var s=t.length,o=A._capitalize,a=fs+o(e),l=ds+o(e),c,u;n.prototype[a]=function(){var h={};for(c=0;c<s;c++)u=t[c],h[u]=this.getAttr(e+o(u));return h};var d=wC(t);n.prototype[l]=function(h){var m=this.attrs[e],p;r&&(h=r.call(this,h)),d&&d.call(this,h,e);for(p in h)h.hasOwnProperty(p)&&this._setAttr(e+o(p),h[p]);return h||t.forEach(g=>{this._setAttr(e+o(g),void 0)}),this._fireChangeEvent(e,m,h),i&&i.call(this),this},L.addOverloadedGetterSetter(n,e)},addOverloadedGetterSetter(n,e){var t=A._capitalize(e),r=ds+t,i=fs+t;n.prototype[e]=function(){return arguments.length?(this[r](arguments[0]),this):this[i]()}},addDeprecatedGetterSetter(n,e,t,r){A.error("Adding deprecated "+e);var i=fs+A._capitalize(e),s=e+" property is deprecated and will be removed soon. Look at Konva change log for more information.";n.prototype[i]=function(){A.error(s);var o=this.attrs[e];return o===void 0?t:o},L.addSetter(n,e,r,function(){A.error(s)}),L.addOverloadedGetterSetter(n,e)},backCompat(n,e){A.each(e,function(t,r){var i=n.prototype[r],s=fs+A._capitalize(t),o=ds+A._capitalize(t);function a(){i.apply(this,arguments),A.error('"'+t+'" method is deprecated and will be removed soon. Use ""'+r+'" instead.')}n.prototype[t]=a,n.prototype[s]=a,n.prototype[o]=a})},afterSetFilter(){this._filterUpToDate=!1}};function CC(n){var e=[],t=n.length,r=A,i,s;for(i=0;i<t;i++)s=n[i],r._isNumber(s)?s=Math.round(s*1e3)/1e3:r._isString(s)||(s=s+""),e.push(s);return e}var Pd=",",kC="(",SC=")",xC="([",_C="])",EC=";",TC="()",OC="=",Id=["arc","arcTo","beginPath","bezierCurveTo","clearRect","clip","closePath","createLinearGradient","createPattern","createRadialGradient","drawImage","ellipse","fill","fillText","getImageData","createImageData","lineTo","moveTo","putImageData","quadraticCurveTo","rect","restore","rotate","save","scale","setLineDash","setTransform","stroke","strokeText","transform","translate"],NC=["fillStyle","strokeStyle","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","lineCap","lineDashOffset","lineJoin","lineWidth","miterLimit","font","textAlign","textBaseline","globalAlpha","globalCompositeOperation","imageSmoothingEnabled"];const MC=100;class Pl{constructor(e){this.canvas=e,J.enableTrace&&(this.traceArr=[],this._enableTrace())}fillShape(e){e.fillEnabled()&&this._fill(e)}_fill(e){}strokeShape(e){e.hasStroke()&&this._stroke(e)}_stroke(e){}fillStrokeShape(e){e.attrs.fillAfterStrokeEnabled?(this.strokeShape(e),this.fillShape(e)):(this.fillShape(e),this.strokeShape(e))}getTrace(e,t){var r=this.traceArr,i=r.length,s="",o,a,l,c;for(o=0;o<i;o++)a=r[o],l=a.method,l?(c=a.args,s+=l,e?s+=TC:A._isArray(c[0])?s+=xC+c.join(Pd)+_C:(t&&(c=c.map(u=>typeof u=="number"?Math.floor(u):u)),s+=kC+c.join(Pd)+SC)):(s+=a.property,e||(s+=OC+a.val)),s+=EC;return s}clearTrace(){this.traceArr=[]}_trace(e){var t=this.traceArr,r;t.push(e),r=t.length,r>=MC&&t.shift()}reset(){var e=this.getCanvas().getPixelRatio();this.setTransform(1*e,0,0,1*e,0,0)}getCanvas(){return this.canvas}clear(e){var t=this.getCanvas();e?this.clearRect(e.x||0,e.y||0,e.width||0,e.height||0):this.clearRect(0,0,t.getWidth()/t.pixelRatio,t.getHeight()/t.pixelRatio)}_applyLineCap(e){const t=e.attrs.lineCap;t&&this.setAttr("lineCap",t)}_applyOpacity(e){var t=e.getAbsoluteOpacity();t!==1&&this.setAttr("globalAlpha",t)}_applyLineJoin(e){const t=e.attrs.lineJoin;t&&this.setAttr("lineJoin",t)}setAttr(e,t){this._context[e]=t}arc(e,t,r,i,s,o){this._context.arc(e,t,r,i,s,o)}arcTo(e,t,r,i,s){this._context.arcTo(e,t,r,i,s)}beginPath(){this._context.beginPath()}bezierCurveTo(e,t,r,i,s,o){this._context.bezierCurveTo(e,t,r,i,s,o)}clearRect(e,t,r,i){this._context.clearRect(e,t,r,i)}clip(){this._context.clip()}closePath(){this._context.closePath()}createImageData(e,t){var r=arguments;if(r.length===2)return this._context.createImageData(e,t);if(r.length===1)return this._context.createImageData(e)}createLinearGradient(e,t,r,i){return this._context.createLinearGradient(e,t,r,i)}createPattern(e,t){return this._context.createPattern(e,t)}createRadialGradient(e,t,r,i,s,o){return this._context.createRadialGradient(e,t,r,i,s,o)}drawImage(e,t,r,i,s,o,a,l,c){var u=arguments,d=this._context;u.length===3?d.drawImage(e,t,r):u.length===5?d.drawImage(e,t,r,i,s):u.length===9&&d.drawImage(e,t,r,i,s,o,a,l,c)}ellipse(e,t,r,i,s,o,a,l){this._context.ellipse(e,t,r,i,s,o,a,l)}isPointInPath(e,t,r,i){return r?this._context.isPointInPath(r,e,t,i):this._context.isPointInPath(e,t,i)}fill(e){e?this._context.fill(e):this._context.fill()}fillRect(e,t,r,i){this._context.fillRect(e,t,r,i)}strokeRect(e,t,r,i){this._context.strokeRect(e,t,r,i)}fillText(e,t,r,i){i?this._context.fillText(e,t,r,i):this._context.fillText(e,t,r)}measureText(e){return this._context.measureText(e)}getImageData(e,t,r,i){return this._context.getImageData(e,t,r,i)}lineTo(e,t){this._context.lineTo(e,t)}moveTo(e,t){this._context.moveTo(e,t)}rect(e,t,r,i){this._context.rect(e,t,r,i)}putImageData(e,t,r){this._context.putImageData(e,t,r)}quadraticCurveTo(e,t,r,i){this._context.quadraticCurveTo(e,t,r,i)}restore(){this._context.restore()}rotate(e){this._context.rotate(e)}save(){this._context.save()}scale(e,t){this._context.scale(e,t)}setLineDash(e){this._context.setLineDash?this._context.setLineDash(e):"mozDash"in this._context?this._context.mozDash=e:"webkitLineDash"in this._context&&(this._context.webkitLineDash=e)}getLineDash(){return this._context.getLineDash()}setTransform(e,t,r,i,s,o){this._context.setTransform(e,t,r,i,s,o)}stroke(e){e?this._context.stroke(e):this._context.stroke()}strokeText(e,t,r,i){this._context.strokeText(e,t,r,i)}transform(e,t,r,i,s,o){this._context.transform(e,t,r,i,s,o)}translate(e,t){this._context.translate(e,t)}_enableTrace(){var e=this,t=Id.length,r=this.setAttr,i,s,o=function(a){var l=e[a],c;e[a]=function(){return s=CC(Array.prototype.slice.call(arguments,0)),c=l.apply(e,arguments),e._trace({method:a,args:s}),c}};for(i=0;i<t;i++)o(Id[i]);e.setAttr=function(){r.apply(e,arguments);var a=arguments[0],l=arguments[1];(a==="shadowOffsetX"||a==="shadowOffsetY"||a==="shadowBlur")&&(l=l/this.canvas.getPixelRatio()),e._trace({property:a,val:l})}}_applyGlobalCompositeOperation(e){const t=e.attrs.globalCompositeOperation;var r=!t||t==="source-over";r||this.setAttr("globalCompositeOperation",t)}}NC.forEach(function(n){Object.defineProperty(Pl.prototype,n,{get(){return this._context[n]},set(e){this._context[n]=e}})});class AC extends Pl{constructor(e){super(e),this._context=e._canvas.getContext("2d")}_fillColor(e){var t=e.fill();this.setAttr("fillStyle",t),e._fillFunc(this)}_fillPattern(e){this.setAttr("fillStyle",e._getFillPattern()),e._fillFunc(this)}_fillLinearGradient(e){var t=e._getLinearGradient();t&&(this.setAttr("fillStyle",t),e._fillFunc(this))}_fillRadialGradient(e){const t=e._getRadialGradient();t&&(this.setAttr("fillStyle",t),e._fillFunc(this))}_fill(e){const t=e.fill(),r=e.getFillPriority();if(t&&r==="color"){this._fillColor(e);return}const i=e.getFillPatternImage();if(i&&r==="pattern"){this._fillPattern(e);return}const s=e.getFillLinearGradientColorStops();if(s&&r==="linear-gradient"){this._fillLinearGradient(e);return}const o=e.getFillRadialGradientColorStops();if(o&&r==="radial-gradient"){this._fillRadialGradient(e);return}t?this._fillColor(e):i?this._fillPattern(e):s?this._fillLinearGradient(e):o&&this._fillRadialGradient(e)}_strokeLinearGradient(e){const t=e.getStrokeLinearGradientStartPoint(),r=e.getStrokeLinearGradientEndPoint(),i=e.getStrokeLinearGradientColorStops(),s=this.createLinearGradient(t.x,t.y,r.x,r.y);if(i){for(var o=0;o<i.length;o+=2)s.addColorStop(i[o],i[o+1]);this.setAttr("strokeStyle",s)}}_stroke(e){var t=e.dash(),r=e.getStrokeScaleEnabled();if(e.hasStroke()){if(!r){this.save();var i=this.getCanvas().getPixelRatio();this.setTransform(i,0,0,i,0,0)}this._applyLineCap(e),t&&e.dashEnabled()&&(this.setLineDash(t),this.setAttr("lineDashOffset",e.dashOffset())),this.setAttr("lineWidth",e.strokeWidth()),e.getShadowForStrokeEnabled()||this.setAttr("shadowColor","rgba(0,0,0,0)");var s=e.getStrokeLinearGradientColorStops();s?this._strokeLinearGradient(e):this.setAttr("strokeStyle",e.stroke()),e._strokeFunc(this),r||this.restore()}}_applyShadow(e){var t,r,i,s=(t=e.getShadowRGBA())!==null&&t!==void 0?t:"black",o=(r=e.getShadowBlur())!==null&&r!==void 0?r:5,a=(i=e.getShadowOffset())!==null&&i!==void 0?i:{x:0,y:0},l=e.getAbsoluteScale(),c=this.canvas.getPixelRatio(),u=l.x*c,d=l.y*c;this.setAttr("shadowColor",s),this.setAttr("shadowBlur",o*Math.min(Math.abs(u),Math.abs(d))),this.setAttr("shadowOffsetX",a.x*u),this.setAttr("shadowOffsetY",a.y*d)}}class PC extends Pl{constructor(e){super(e),this._context=e._canvas.getContext("2d",{willReadFrequently:!0})}_fill(e){this.save(),this.setAttr("fillStyle",e.colorKey),e._fillFuncHit(this),this.restore()}strokeShape(e){e.hasHitStroke()&&this._stroke(e)}_stroke(e){if(e.hasHitStroke()){const s=e.getStrokeScaleEnabled();if(!s){this.save();var t=this.getCanvas().getPixelRatio();this.setTransform(t,0,0,t,0,0)}this._applyLineCap(e);var r=e.hitStrokeWidth(),i=r==="auto"?e.strokeWidth():r;this.setAttr("lineWidth",i),this.setAttr("strokeStyle",e.colorKey),e._strokeFuncHit(this),s||this.restore()}}}var Mo;function IC(){if(Mo)return Mo;var n=A.createCanvasElement(),e=n.getContext("2d");return Mo=function(){var t=J._global.devicePixelRatio||1,r=e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1;return t/r}(),A.releaseCanvas(n),Mo}class Il{constructor(e){this.pixelRatio=1,this.width=0,this.height=0,this.isCache=!1;var t=e||{},r=t.pixelRatio||J.pixelRatio||IC();this.pixelRatio=r,this._canvas=A.createCanvasElement(),this._canvas.style.padding="0",this._canvas.style.margin="0",this._canvas.style.border="0",this._canvas.style.background="transparent",this._canvas.style.position="absolute",this._canvas.style.top="0",this._canvas.style.left="0"}getContext(){return this.context}getPixelRatio(){return this.pixelRatio}setPixelRatio(e){var t=this.pixelRatio;this.pixelRatio=e,this.setSize(this.getWidth()/t,this.getHeight()/t)}setWidth(e){this.width=this._canvas.width=e*this.pixelRatio,this._canvas.style.width=e+"px";var t=this.pixelRatio,r=this.getContext()._context;r.scale(t,t)}setHeight(e){this.height=this._canvas.height=e*this.pixelRatio,this._canvas.style.height=e+"px";var t=this.pixelRatio,r=this.getContext()._context;r.scale(t,t)}getWidth(){return this.width}getHeight(){return this.height}setSize(e,t){this.setWidth(e||0),this.setHeight(t||0)}toDataURL(e,t){try{return this._canvas.toDataURL(e,t)}catch{try{return this._canvas.toDataURL()}catch(i){return A.error("Unable to get data URL. "+i.message+" For more info read https://konvajs.org/docs/posts/Tainted_Canvas.html."),""}}}}L.addGetterSetter(Il,"pixelRatio",void 0,ue());class hs extends Il{constructor(e={width:0,height:0}){super(e),this.context=new AC(this),this.setSize(e.width,e.height)}}class Dd extends Il{constructor(e={width:0,height:0}){super(e),this.hitCanvas=!0,this.context=new PC(this),this.setSize(e.width,e.height)}}const me={get isDragging(){var n=!1;return me._dragElements.forEach(e=>{e.dragStatus==="dragging"&&(n=!0)}),n},justDragged:!1,get node(){var n;return me._dragElements.forEach(e=>{n=e.node}),n},_dragElements:new Map,_drag(n){const e=[];me._dragElements.forEach((t,r)=>{const{node:i}=t,s=i.getStage();s.setPointersPositions(n),t.pointerId===void 0&&(t.pointerId=A._getFirstPointerId(n));const o=s._changedPointerPositions.find(c=>c.id===t.pointerId);if(o){if(t.dragStatus!=="dragging"){var a=i.dragDistance(),l=Math.max(Math.abs(o.x-t.startPointerPos.x),Math.abs(o.y-t.startPointerPos.y));if(l<a||(i.startDrag({evt:n}),!i.isDragging()))return}i._setDragPosition(n,t),e.push(i)}}),e.forEach(t=>{t.fire("dragmove",{type:"dragmove",target:t,evt:n},!0)})},_endDragBefore(n){const e=[];me._dragElements.forEach(t=>{const{node:r}=t,i=r.getStage();if(n&&i.setPointersPositions(n),!i._changedPointerPositions.find(a=>a.id===t.pointerId))return;(t.dragStatus==="dragging"||t.dragStatus==="stopped")&&(me.justDragged=!0,J._mouseListenClick=!1,J._touchListenClick=!1,J._pointerListenClick=!1,t.dragStatus="stopped");const o=t.node.getLayer()||t.node instanceof J.Stage&&t.node;o&&e.indexOf(o)===-1&&e.push(o)}),e.forEach(t=>{t.draw()})},_endDragAfter(n){me._dragElements.forEach((e,t)=>{e.dragStatus==="stopped"&&e.node.fire("dragend",{type:"dragend",target:e.node,evt:n},!0),e.dragStatus!=="dragging"&&me._dragElements.delete(t)})}};J.isBrowser&&(window.addEventListener("mouseup",me._endDragBefore,!0),window.addEventListener("touchend",me._endDragBefore,!0),window.addEventListener("mousemove",me._drag),window.addEventListener("touchmove",me._drag),window.addEventListener("mouseup",me._endDragAfter,!1),window.addEventListener("touchend",me._endDragAfter,!1));var Ao="absoluteOpacity",Po="allEventListeners",_n="absoluteTransform",Ld="absoluteScale",Pr="canvas",DC="Change",LC="children",RC="konva",Dl="listening",Rd="mouseenter",Fd="mouseleave",Bd="set",Vd="Shape",Io=" ",$d="stage",Un="transform",FC="Stage",Ll="visible",BC=["xChange.konva","yChange.konva","scaleXChange.konva","scaleYChange.konva","skewXChange.konva","skewYChange.konva","rotationChange.konva","offsetXChange.konva","offsetYChange.konva","transformsEnabledChange.konva"].join(Io);let VC=1,ee=class Hf{constructor(e){this._id=VC++,this.eventListeners={},this.attrs={},this.index=0,this._allEventListeners=null,this.parent=null,this._cache=new Map,this._attachedDepsListeners=new Map,this._lastPos=null,this._batchingTransformChange=!1,this._needClearTransformCache=!1,this._filterUpToDate=!1,this._isUnderCache=!1,this._dragEventId=null,this._shouldFireChangeEvents=!1,this.setAttrs(e),this._shouldFireChangeEvents=!0}hasChildren(){return!1}_clearCache(e){(e===Un||e===_n)&&this._cache.get(e)?this._cache.get(e).dirty=!0:e?this._cache.delete(e):this._cache.clear()}_getCache(e,t){var r=this._cache.get(e),i=e===Un||e===_n,s=r===void 0||i&&r.dirty===!0;return s&&(r=t.call(this),this._cache.set(e,r)),r}_calculate(e,t,r){if(!this._attachedDepsListeners.get(e)){const i=t.map(s=>s+"Change.konva").join(Io);this.on(i,()=>{this._clearCache(e)}),this._attachedDepsListeners.set(e,!0)}return this._getCache(e,r)}_getCanvasCache(){return this._cache.get(Pr)}_clearSelfAndDescendantCache(e){this._clearCache(e),e===_n&&this.fire("absoluteTransformChange")}clearCache(){if(this._cache.has(Pr)){const{scene:e,filter:t,hit:r}=this._cache.get(Pr);A.releaseCanvas(e,t,r),this._cache.delete(Pr)}return this._clearSelfAndDescendantCache(),this._requestDraw(),this}cache(e){var t=e||{},r={};(t.x===void 0||t.y===void 0||t.width===void 0||t.height===void 0)&&(r=this.getClientRect({skipTransform:!0,relativeTo:this.getParent()}));var i=Math.ceil(t.width||r.width),s=Math.ceil(t.height||r.height),o=t.pixelRatio,a=t.x===void 0?Math.floor(r.x):t.x,l=t.y===void 0?Math.floor(r.y):t.y,c=t.offset||0,u=t.drawBorder||!1,d=t.hitCanvasPixelRatio||1;if(!i||!s){A.error("Can not cache the node. Width or height of the node equals 0. Caching is skipped.");return}i+=c*2+1,s+=c*2+1,a-=c,l-=c;var h=new hs({pixelRatio:o,width:i,height:s}),m=new hs({pixelRatio:o,width:0,height:0}),p=new Dd({pixelRatio:d,width:i,height:s}),g=h.getContext(),y=p.getContext();return p.isCache=!0,h.isCache=!0,this._cache.delete(Pr),this._filterUpToDate=!1,t.imageSmoothingEnabled===!1&&(h.getContext()._context.imageSmoothingEnabled=!1,m.getContext()._context.imageSmoothingEnabled=!1),g.save(),y.save(),g.translate(-a,-l),y.translate(-a,-l),this._isUnderCache=!0,this._clearSelfAndDescendantCache(Ao),this._clearSelfAndDescendantCache(Ld),this.drawScene(h,this),this.drawHit(p,this),this._isUnderCache=!1,g.restore(),y.restore(),u&&(g.save(),g.beginPath(),g.rect(0,0,i,s),g.closePath(),g.setAttr("strokeStyle","red"),g.setAttr("lineWidth",5),g.stroke(),g.restore()),this._cache.set(Pr,{scene:h,filter:m,hit:p,x:a,y:l}),this._requestDraw(),this}isCached(){return this._cache.has(Pr)}getClientRect(e){throw new Error('abstract "getClientRect" method call')}_transformedRect(e,t){var r=[{x:e.x,y:e.y},{x:e.x+e.width,y:e.y},{x:e.x+e.width,y:e.y+e.height},{x:e.x,y:e.y+e.height}],i,s,o,a,l=this.getAbsoluteTransform(t);return r.forEach(function(c){var u=l.point(c);i===void 0&&(i=o=u.x,s=a=u.y),i=Math.min(i,u.x),s=Math.min(s,u.y),o=Math.max(o,u.x),a=Math.max(a,u.y)}),{x:i,y:s,width:o-i,height:a-s}}_drawCachedSceneCanvas(e){e.save(),e._applyOpacity(this),e._applyGlobalCompositeOperation(this);const t=this._getCanvasCache();e.translate(t.x,t.y);var r=this._getCachedSceneCanvas(),i=r.pixelRatio;e.drawImage(r._canvas,0,0,r.width/i,r.height/i),e.restore()}_drawCachedHitCanvas(e){var t=this._getCanvasCache(),r=t.hit;e.save(),e.translate(t.x,t.y),e.drawImage(r._canvas,0,0,r.width/r.pixelRatio,r.height/r.pixelRatio),e.restore()}_getCachedSceneCanvas(){var e=this.filters(),t=this._getCanvasCache(),r=t.scene,i=t.filter,s=i.getContext(),o,a,l,c;if(e){if(!this._filterUpToDate){var u=r.pixelRatio;i.setSize(r.width/r.pixelRatio,r.height/r.pixelRatio);try{for(o=e.length,s.clear(),s.drawImage(r._canvas,0,0,r.getWidth()/u,r.getHeight()/u),a=s.getImageData(0,0,i.getWidth(),i.getHeight()),l=0;l<o;l++){if(c=e[l],typeof c!="function"){A.error("Filter should be type of function, but got "+typeof c+" instead. Please check correct filters");continue}c.call(this,a),s.putImageData(a,0,0)}}catch(d){A.error("Unable to apply filter. "+d.message+" This post my help you https://konvajs.org/docs/posts/Tainted_Canvas.html.")}this._filterUpToDate=!0}return i}return r}on(e,t){if(this._cache&&this._cache.delete(Po),arguments.length===3)return this._delegate.apply(this,arguments);var r=e.split(Io),i=r.length,s,o,a,l,c;for(s=0;s<i;s++)o=r[s],a=o.split("."),l=a[0],c=a[1]||"",this.eventListeners[l]||(this.eventListeners[l]=[]),this.eventListeners[l].push({name:c,handler:t});return this}off(e,t){var r=(e||"").split(Io),i=r.length,s,o,a,l,c,u;if(this._cache&&this._cache.delete(Po),!e)for(o in this.eventListeners)this._off(o);for(s=0;s<i;s++)if(a=r[s],l=a.split("."),c=l[0],u=l[1],c)this.eventListeners[c]&&this._off(c,u,t);else for(o in this.eventListeners)this._off(o,u,t);return this}dispatchEvent(e){var t={target:this,type:e.type,evt:e};return this.fire(e.type,t),this}addEventListener(e,t){return this.on(e,function(r){t.call(this,r.evt)}),this}removeEventListener(e){return this.off(e),this}_delegate(e,t,r){var i=this;this.on(e,function(s){for(var o=s.target.findAncestors(t,!0,i),a=0;a<o.length;a++)s=A.cloneObject(s),s.currentTarget=o[a],r.call(o[a],s)})}remove(){return this.isDragging()&&this.stopDrag(),me._dragElements.delete(this._id),this._remove(),this}_clearCaches(){this._clearSelfAndDescendantCache(_n),this._clearSelfAndDescendantCache(Ao),this._clearSelfAndDescendantCache(Ld),this._clearSelfAndDescendantCache($d),this._clearSelfAndDescendantCache(Ll),this._clearSelfAndDescendantCache(Dl)}_remove(){this._clearCaches();var e=this.getParent();e&&e.children&&(e.children.splice(this.index,1),e._setChildrenIndices(),this.parent=null)}destroy(){return this.remove(),this.clearCache(),this}getAttr(e){var t="get"+A._capitalize(e);return A._isFunction(this[t])?this[t]():this.attrs[e]}getAncestors(){for(var e=this.getParent(),t=[];e;)t.push(e),e=e.getParent();return t}getAttrs(){return this.attrs||{}}setAttrs(e){return this._batchTransformChanges(()=>{var t,r;if(!e)return this;for(t in e)t!==LC&&(r=Bd+A._capitalize(t),A._isFunction(this[r])?this[r](e[t]):this._setAttr(t,e[t]))}),this}isListening(){return this._getCache(Dl,this._isListening)}_isListening(e){if(!this.listening())return!1;const r=this.getParent();return r&&r!==e&&this!==e?r._isListening(e):!0}isVisible(){return this._getCache(Ll,this._isVisible)}_isVisible(e){if(!this.visible())return!1;const r=this.getParent();return r&&r!==e&&this!==e?r._isVisible(e):!0}shouldDrawHit(e,t=!1){if(e)return this._isVisible(e)&&this._isListening(e);var r=this.getLayer(),i=!1;me._dragElements.forEach(o=>{o.dragStatus==="dragging"&&(o.node.nodeType==="Stage"||o.node.getLayer()===r)&&(i=!0)});var s=!t&&!J.hitOnDragEnabled&&i;return this.isListening()&&this.isVisible()&&!s}show(){return this.visible(!0),this}hide(){return this.visible(!1),this}getZIndex(){return this.index||0}getAbsoluteZIndex(){var e=this.getDepth(),t=this,r=0,i,s,o,a;function l(c){for(i=[],s=c.length,o=0;o<s;o++)a=c[o],r++,a.nodeType!==Vd&&(i=i.concat(a.getChildren().slice())),a._id===t._id&&(o=s);i.length>0&&i[0].getDepth()<=e&&l(i)}return t.nodeType!==FC&&l(t.getStage().getChildren()),r}getDepth(){for(var e=0,t=this.parent;t;)e++,t=t.parent;return e}_batchTransformChanges(e){this._batchingTransformChange=!0,e(),this._batchingTransformChange=!1,this._needClearTransformCache&&(this._clearCache(Un),this._clearSelfAndDescendantCache(_n)),this._needClearTransformCache=!1}setPosition(e){return this._batchTransformChanges(()=>{this.x(e.x),this.y(e.y)}),this}getPosition(){return{x:this.x(),y:this.y()}}getRelativePointerPosition(){if(!this.getStage())return null;var e=this.getStage().getPointerPosition();if(!e)return null;var t=this.getAbsoluteTransform().copy();return t.invert(),t.point(e)}getAbsolutePosition(e){let t=!1,r=this.parent;for(;r;){if(r.isCached()){t=!0;break}r=r.parent}t&&!e&&(e=!0);var i=this.getAbsoluteTransform(e).getMatrix(),s=new cs,o=this.offset();return s.m=i.slice(),s.translate(o.x,o.y),s.getTranslation()}setAbsolutePosition(e){var t=this._clearTransform();this.attrs.x=t.x,this.attrs.y=t.y,delete t.x,delete t.y,this._clearCache(Un);var r=this._getAbsoluteTransform().copy();return r.invert(),r.translate(e.x,e.y),e={x:this.attrs.x+r.getTranslation().x,y:this.attrs.y+r.getTranslation().y},this._setTransform(t),this.setPosition({x:e.x,y:e.y}),this._clearCache(Un),this._clearSelfAndDescendantCache(_n),this}_setTransform(e){var t;for(t in e)this.attrs[t]=e[t]}_clearTransform(){var e={x:this.x(),y:this.y(),rotation:this.rotation(),scaleX:this.scaleX(),scaleY:this.scaleY(),offsetX:this.offsetX(),offsetY:this.offsetY(),skewX:this.skewX(),skewY:this.skewY()};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scaleX=1,this.attrs.scaleY=1,this.attrs.offsetX=0,this.attrs.offsetY=0,this.attrs.skewX=0,this.attrs.skewY=0,e}move(e){var t=e.x,r=e.y,i=this.x(),s=this.y();return t!==void 0&&(i+=t),r!==void 0&&(s+=r),this.setPosition({x:i,y:s}),this}_eachAncestorReverse(e,t){var r=[],i=this.getParent(),s,o;if(!(t&&t._id===this._id)){for(r.unshift(this);i&&(!t||i._id!==t._id);)r.unshift(i),i=i.parent;for(s=r.length,o=0;o<s;o++)e(r[o])}}rotate(e){return this.rotation(this.rotation()+e),this}moveToTop(){if(!this.parent)return A.warn("Node has no parent. moveToTop function is ignored."),!1;var e=this.index,t=this.parent.getChildren().length;return e<t-1?(this.parent.children.splice(e,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0):!1}moveUp(){if(!this.parent)return A.warn("Node has no parent. moveUp function is ignored."),!1;var e=this.index,t=this.parent.getChildren().length;return e<t-1?(this.parent.children.splice(e,1),this.parent.children.splice(e+1,0,this),this.parent._setChildrenIndices(),!0):!1}moveDown(){if(!this.parent)return A.warn("Node has no parent. moveDown function is ignored."),!1;var e=this.index;return e>0?(this.parent.children.splice(e,1),this.parent.children.splice(e-1,0,this),this.parent._setChildrenIndices(),!0):!1}moveToBottom(){if(!this.parent)return A.warn("Node has no parent. moveToBottom function is ignored."),!1;var e=this.index;return e>0?(this.parent.children.splice(e,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0):!1}setZIndex(e){if(!this.parent)return A.warn("Node has no parent. zIndex parameter is ignored."),this;(e<0||e>=this.parent.children.length)&&A.warn("Unexpected value "+e+" for zIndex property. zIndex is just index of a node in children of its parent. Expected value is from 0 to "+(this.parent.children.length-1)+".");var t=this.index;return this.parent.children.splice(t,1),this.parent.children.splice(e,0,this),this.parent._setChildrenIndices(),this}getAbsoluteOpacity(){return this._getCache(Ao,this._getAbsoluteOpacity)}_getAbsoluteOpacity(){var e=this.opacity(),t=this.getParent();return t&&!t._isUnderCache&&(e*=t.getAbsoluteOpacity()),e}moveTo(e){return this.getParent()!==e&&(this._remove(),e.add(this)),this}toObject(){var e={},t=this.getAttrs(),r,i,s,o,a;e.attrs={};for(r in t)i=t[r],a=A.isObject(i)&&!A._isPlainObject(i)&&!A._isArray(i),!a&&(s=typeof this[r]=="function"&&this[r],delete t[r],o=s?s.call(this):null,t[r]=i,o!==i&&(e.attrs[r]=i));return e.className=this.getClassName(),A._prepareToStringify(e)}toJSON(){return JSON.stringify(this.toObject())}getParent(){return this.parent}findAncestors(e,t,r){var i=[];t&&this._isMatch(e)&&i.push(this);for(var s=this.parent;s;){if(s===r)return i;s._isMatch(e)&&i.push(s),s=s.parent}return i}isAncestorOf(e){return!1}findAncestor(e,t,r){return this.findAncestors(e,t,r)[0]}_isMatch(e){if(!e)return!1;if(typeof e=="function")return e(this);var t=e.replace(/ /g,"").split(","),r=t.length,i,s;for(i=0;i<r;i++)if(s=t[i],A.isValidSelector(s)||(A.warn('Selector "'+s+'" is invalid. Allowed selectors examples are "#foo", ".bar" or "Group".'),A.warn('If you have a custom shape with such className, please change it to start with upper letter like "Triangle".'),A.warn("Konva is awesome, right?")),s.charAt(0)==="#"){if(this.id()===s.slice(1))return!0}else if(s.charAt(0)==="."){if(this.hasName(s.slice(1)))return!0}else if(this.className===s||this.nodeType===s)return!0;return!1}getLayer(){var e=this.getParent();return e?e.getLayer():null}getStage(){return this._getCache($d,this._getStage)}_getStage(){var e=this.getParent();if(e)return e.getStage()}fire(e,t={},r){return t.target=t.target||this,r?this._fireAndBubble(e,t):this._fire(e,t),this}getAbsoluteTransform(e){return e?this._getAbsoluteTransform(e):this._getCache(_n,this._getAbsoluteTransform)}_getAbsoluteTransform(e){var t;if(e)return t=new cs,this._eachAncestorReverse(function(i){var s=i.transformsEnabled();s==="all"?t.multiply(i.getTransform()):s==="position"&&t.translate(i.x()-i.offsetX(),i.y()-i.offsetY())},e),t;t=this._cache.get(_n)||new cs,this.parent?this.parent.getAbsoluteTransform().copyInto(t):t.reset();var r=this.transformsEnabled();if(r==="all")t.multiply(this.getTransform());else if(r==="position"){const i=this.attrs.x||0,s=this.attrs.y||0,o=this.attrs.offsetX||0,a=this.attrs.offsetY||0;t.translate(i-o,s-a)}return t.dirty=!1,t}getAbsoluteScale(e){for(var t=this;t;)t._isUnderCache&&(e=t),t=t.getParent();const i=this.getAbsoluteTransform(e).decompose();return{x:i.scaleX,y:i.scaleY}}getAbsoluteRotation(){return this.getAbsoluteTransform().decompose().rotation}getTransform(){return this._getCache(Un,this._getTransform)}_getTransform(){var e,t,r=this._cache.get(Un)||new cs;r.reset();var i=this.x(),s=this.y(),o=J.getAngle(this.rotation()),a=(e=this.attrs.scaleX)!==null&&e!==void 0?e:1,l=(t=this.attrs.scaleY)!==null&&t!==void 0?t:1,c=this.attrs.skewX||0,u=this.attrs.skewY||0,d=this.attrs.offsetX||0,h=this.attrs.offsetY||0;return(i!==0||s!==0)&&r.translate(i,s),o!==0&&r.rotate(o),(c!==0||u!==0)&&r.skew(c,u),(a!==1||l!==1)&&r.scale(a,l),(d!==0||h!==0)&&r.translate(-1*d,-1*h),r.dirty=!1,r}clone(e){var t=A.cloneObject(this.attrs),r,i,s,o,a;for(r in e)t[r]=e[r];var l=new this.constructor(t);for(r in this.eventListeners)for(i=this.eventListeners[r],s=i.length,o=0;o<s;o++)a=i[o],a.name.indexOf(RC)<0&&(l.eventListeners[r]||(l.eventListeners[r]=[]),l.eventListeners[r].push(a));return l}_toKonvaCanvas(e){e=e||{};var t=this.getClientRect(),r=this.getStage(),i=e.x!==void 0?e.x:Math.floor(t.x),s=e.y!==void 0?e.y:Math.floor(t.y),o=e.pixelRatio||1,a=new hs({width:e.width||Math.ceil(t.width)||(r?r.width():0),height:e.height||Math.ceil(t.height)||(r?r.height():0),pixelRatio:o}),l=a.getContext();return e.imageSmoothingEnabled===!1&&(l._context.imageSmoothingEnabled=!1),l.save(),(i||s)&&l.translate(-1*i,-1*s),this.drawScene(a),l.restore(),a}toCanvas(e){return this._toKonvaCanvas(e)._canvas}toDataURL(e){e=e||{};var t=e.mimeType||null,r=e.quality||null,i=this._toKonvaCanvas(e).toDataURL(t,r);return e.callback&&e.callback(i),i}toImage(e){return new Promise((t,r)=>{try{const i=e==null?void 0:e.callback;i&&delete e.callback,A._urlToImage(this.toDataURL(e),function(s){t(s),i==null||i(s)})}catch(i){r(i)}})}toBlob(e){return new Promise((t,r)=>{try{const i=e==null?void 0:e.callback;i&&delete e.callback,this.toCanvas(e).toBlob(s=>{t(s),i==null||i(s)})}catch(i){r(i)}})}setSize(e){return this.width(e.width),this.height(e.height),this}getSize(){return{width:this.width(),height:this.height()}}getClassName(){return this.className||this.nodeType}getType(){return this.nodeType}getDragDistance(){return this.attrs.dragDistance!==void 0?this.attrs.dragDistance:this.parent?this.parent.getDragDistance():J.dragDistance}_off(e,t,r){var i=this.eventListeners[e],s,o,a;for(s=0;s<i.length;s++)if(o=i[s].name,a=i[s].handler,(o!=="konva"||t==="konva")&&(!t||o===t)&&(!r||r===a)){if(i.splice(s,1),i.length===0){delete this.eventListeners[e];break}s--}}_fireChangeEvent(e,t,r){this._fire(e+DC,{oldVal:t,newVal:r})}addName(e){if(!this.hasName(e)){var t=this.name(),r=t?t+" "+e:e;this.name(r)}return this}hasName(e){if(!e)return!1;const t=this.name();if(!t)return!1;var r=(t||"").split(/\s/g);return r.indexOf(e)!==-1}removeName(e){var t=(this.name()||"").split(/\s/g),r=t.indexOf(e);return r!==-1&&(t.splice(r,1),this.name(t.join(" "))),this}setAttr(e,t){var r=this[Bd+A._capitalize(e)];return A._isFunction(r)?r.call(this,t):this._setAttr(e,t),this}_requestDraw(){if(J.autoDrawEnabled){const e=this.getLayer()||this.getStage();e==null||e.batchDraw()}}_setAttr(e,t){var r=this.attrs[e];r===t&&!A.isObject(t)||(t==null?delete this.attrs[e]:this.attrs[e]=t,this._shouldFireChangeEvents&&this._fireChangeEvent(e,r,t),this._requestDraw())}_setComponentAttr(e,t,r){var i;r!==void 0&&(i=this.attrs[e],i||(this.attrs[e]=this.getAttr(e)),this.attrs[e][t]=r,this._fireChangeEvent(e,i,r))}_fireAndBubble(e,t,r){t&&this.nodeType===Vd&&(t.target=this);var i=(e===Rd||e===Fd)&&(r&&(this===r||this.isAncestorOf&&this.isAncestorOf(r))||this.nodeType==="Stage"&&!r);if(!i){this._fire(e,t);var s=(e===Rd||e===Fd)&&r&&r.isAncestorOf&&r.isAncestorOf(this)&&!r.isAncestorOf(this.parent);(t&&!t.cancelBubble||!t)&&this.parent&&this.parent.isListening()&&!s&&(r&&r.parent?this._fireAndBubble.call(this.parent,e,t,r):this._fireAndBubble.call(this.parent,e,t))}}_getProtoListeners(e){let t=this._cache.get(Po);if(!t){t={};let i=Object.getPrototypeOf(this);for(;i;){if(!i.eventListeners){i=Object.getPrototypeOf(i);continue}for(var r in i.eventListeners){const s=i.eventListeners[r],o=t[r]||[];t[r]=s.concat(o)}i=Object.getPrototypeOf(i)}this._cache.set(Po,t)}return t[e]}_fire(e,t){t=t||{},t.currentTarget=this,t.type=e;const r=this._getProtoListeners(e);if(r)for(var i=0;i<r.length;i++)r[i].handler.call(this,t);const s=this.eventListeners[e];if(s)for(var i=0;i<s.length;i++)s[i].handler.call(this,t)}draw(){return this.drawScene(),this.drawHit(),this}_createDragElement(e){var t=e?e.pointerId:void 0,r=this.getStage(),i=this.getAbsolutePosition(),s=r._getPointerById(t)||r._changedPointerPositions[0]||i;me._dragElements.set(this._id,{node:this,startPointerPos:s,offset:{x:s.x-i.x,y:s.y-i.y},dragStatus:"ready",pointerId:t})}startDrag(e,t=!0){me._dragElements.has(this._id)||this._createDragElement(e);const r=me._dragElements.get(this._id);r.dragStatus="dragging",this.fire("dragstart",{type:"dragstart",target:this,evt:e&&e.evt},t)}_setDragPosition(e,t){const r=this.getStage()._getPointerById(t.pointerId);if(r){var i={x:r.x-t.offset.x,y:r.y-t.offset.y},s=this.dragBoundFunc();if(s!==void 0){const o=s.call(this,i,e);o?i=o:A.warn("dragBoundFunc did not return any value. That is unexpected behavior. You must return new absolute position from dragBoundFunc.")}(!this._lastPos||this._lastPos.x!==i.x||this._lastPos.y!==i.y)&&(this.setAbsolutePosition(i),this._requestDraw()),this._lastPos=i}}stopDrag(e){const t=me._dragElements.get(this._id);t&&(t.dragStatus="stopped"),me._endDragBefore(e),me._endDragAfter(e)}setDraggable(e){this._setAttr("draggable",e),this._dragChange()}isDragging(){const e=me._dragElements.get(this._id);return e?e.dragStatus==="dragging":!1}_listenDrag(){this._dragCleanup(),this.on("mousedown.konva touchstart.konva",function(e){var t=e.evt.button!==void 0,r=!t||J.dragButtons.indexOf(e.evt.button)>=0;if(r&&!this.isDragging()){var i=!1;me._dragElements.forEach(s=>{this.isAncestorOf(s.node)&&(i=!0)}),i||this._createDragElement(e)}})}_dragChange(){if(this.attrs.draggable)this._listenDrag();else{this._dragCleanup();var e=this.getStage();if(!e)return;const t=me._dragElements.get(this._id),r=t&&t.dragStatus==="dragging",i=t&&t.dragStatus==="ready";r?this.stopDrag():i&&me._dragElements.delete(this._id)}}_dragCleanup(){this.off("mousedown.konva"),this.off("touchstart.konva")}isClientRectOnScreen(e={x:0,y:0}){const t=this.getStage();if(!t)return!1;const r={x:-e.x,y:-e.y,width:t.width()+2*e.x,height:t.height()+2*e.y};return A.haveIntersection(r,this.getClientRect())}static create(e,t){return A._isString(e)&&(e=JSON.parse(e)),this._createNode(e,t)}static _createNode(e,t){var r=Hf.prototype.getClassName.call(e),i=e.children,s,o,a;t&&(e.attrs.container=t),J[r]||(A.warn('Can not find a node with class name "'+r+'". Fallback to "Shape".'),r="Shape");const l=J[r];if(s=new l(e.attrs),i)for(o=i.length,a=0;a<o;a++)s.add(Hf._createNode(i[a]));return s}};ee.prototype.nodeType="Node",ee.prototype._attrsAffectingSize=[],ee.prototype.eventListeners={},ee.prototype.on.call(ee.prototype,BC,function(){if(this._batchingTransformChange){this._needClearTransformCache=!0;return}this._clearCache(Un),this._clearSelfAndDescendantCache(_n)}),ee.prototype.on.call(ee.prototype,"visibleChange.konva",function(){this._clearSelfAndDescendantCache(Ll)}),ee.prototype.on.call(ee.prototype,"listeningChange.konva",function(){this._clearSelfAndDescendantCache(Dl)}),ee.prototype.on.call(ee.prototype,"opacityChange.konva",function(){this._clearSelfAndDescendantCache(Ao)});const we=L.addGetterSetter;we(ee,"zIndex"),we(ee,"absolutePosition"),we(ee,"position"),we(ee,"x",0,ue()),we(ee,"y",0,ue()),we(ee,"globalCompositeOperation","source-over",us()),we(ee,"opacity",1,ue()),we(ee,"name","",us()),we(ee,"id","",us()),we(ee,"rotation",0,ue()),L.addComponentsGetterSetter(ee,"scale",["x","y"]),we(ee,"scaleX",1,ue()),we(ee,"scaleY",1,ue()),L.addComponentsGetterSetter(ee,"skew",["x","y"]),we(ee,"skewX",0,ue()),we(ee,"skewY",0,ue()),L.addComponentsGetterSetter(ee,"offset",["x","y"]),we(ee,"offsetX",0,ue()),we(ee,"offsetY",0,ue()),we(ee,"dragDistance",null,ue()),we(ee,"width",0,ue()),we(ee,"height",0,ue()),we(ee,"listening",!0,Ar()),we(ee,"preventDefault",!0,Ar()),we(ee,"filters",null,function(n){return this._filterUpToDate=!1,n}),we(ee,"visible",!0,Ar()),we(ee,"transformsEnabled","all",us()),we(ee,"size"),we(ee,"dragBoundFunc"),we(ee,"draggable",!1,Ar()),L.backCompat(ee,{rotateDeg:"rotate",setRotationDeg:"setRotation",getRotationDeg:"getRotation"});const ps=new Map,jd=J._global.PointerEvent!==void 0;function Rl(n){return ps.get(n)}function Fl(n){return{evt:n,pointerId:n.pointerId}}function zd(n,e){return ps.get(n)===e}function Hd(n,e){ms(n),e.getStage()&&(ps.set(n,e),jd&&e._fire("gotpointercapture",Fl(new PointerEvent("gotpointercapture"))))}function ms(n,e){const t=ps.get(n);if(!t)return;const r=t.getStage();r&&r.content,ps.delete(n),jd&&t._fire("lostpointercapture",Fl(new PointerEvent("lostpointercapture")))}var Gd="hasShadow",Ud="shadowRGBA",Wd="patternImage",Kd="linearGradient",Yd="radialGradient";let Do;function Bl(){return Do||(Do=A.createCanvasElement().getContext("2d"),Do)}const Vl={};function $C(n){n.fill()}function jC(n){n.stroke()}function zC(n){n.fill()}function HC(n){n.stroke()}function GC(){this._clearCache(Gd)}function UC(){this._clearCache(Ud)}function WC(){this._clearCache(Wd)}function KC(){this._clearCache(Kd)}function YC(){this._clearCache(Yd)}class F extends ee{constructor(e){super(e);let t;for(;t=A.getRandomColor(),!(t&&!(t in Vl)););this.colorKey=t,Vl[t]=this}getContext(){return A.warn("shape.getContext() method is deprecated. Please do not use it."),this.getLayer().getContext()}getCanvas(){return A.warn("shape.getCanvas() method is deprecated. Please do not use it."),this.getLayer().getCanvas()}getSceneFunc(){return this.attrs.sceneFunc||this._sceneFunc}getHitFunc(){return this.attrs.hitFunc||this._hitFunc}hasShadow(){return this._getCache(Gd,this._hasShadow)}_hasShadow(){return this.shadowEnabled()&&this.shadowOpacity()!==0&&!!(this.shadowColor()||this.shadowBlur()||this.shadowOffsetX()||this.shadowOffsetY())}_getFillPattern(){return this._getCache(Wd,this.__getFillPattern)}__getFillPattern(){if(this.fillPatternImage()){var e=Bl();const t=e.createPattern(this.fillPatternImage(),this.fillPatternRepeat()||"repeat");if(t&&t.setTransform){const r=new cs;r.translate(this.fillPatternX(),this.fillPatternY()),r.rotate(J.getAngle(this.fillPatternRotation())),r.scale(this.fillPatternScaleX(),this.fillPatternScaleY()),r.translate(-1*this.fillPatternOffsetX(),-1*this.fillPatternOffsetY());const i=r.getMatrix(),s=typeof DOMMatrix>"u"?{a:i[0],b:i[1],c:i[2],d:i[3],e:i[4],f:i[5]}:new DOMMatrix(i);t.setTransform(s)}return t}}_getLinearGradient(){return this._getCache(Kd,this.__getLinearGradient)}__getLinearGradient(){var e=this.fillLinearGradientColorStops();if(e){for(var t=Bl(),r=this.fillLinearGradientStartPoint(),i=this.fillLinearGradientEndPoint(),s=t.createLinearGradient(r.x,r.y,i.x,i.y),o=0;o<e.length;o+=2)s.addColorStop(e[o],e[o+1]);return s}}_getRadialGradient(){return this._getCache(Yd,this.__getRadialGradient)}__getRadialGradient(){var e=this.fillRadialGradientColorStops();if(e){for(var t=Bl(),r=this.fillRadialGradientStartPoint(),i=this.fillRadialGradientEndPoint(),s=t.createRadialGradient(r.x,r.y,this.fillRadialGradientStartRadius(),i.x,i.y,this.fillRadialGradientEndRadius()),o=0;o<e.length;o+=2)s.addColorStop(e[o],e[o+1]);return s}}getShadowRGBA(){return this._getCache(Ud,this._getShadowRGBA)}_getShadowRGBA(){if(this.hasShadow()){var e=A.colorToRGBA(this.shadowColor());if(e)return"rgba("+e.r+","+e.g+","+e.b+","+e.a*(this.shadowOpacity()||1)+")"}}hasFill(){return this._calculate("hasFill",["fillEnabled","fill","fillPatternImage","fillLinearGradientColorStops","fillRadialGradientColorStops"],()=>this.fillEnabled()&&!!(this.fill()||this.fillPatternImage()||this.fillLinearGradientColorStops()||this.fillRadialGradientColorStops()))}hasStroke(){return this._calculate("hasStroke",["strokeEnabled","strokeWidth","stroke","strokeLinearGradientColorStops"],()=>this.strokeEnabled()&&this.strokeWidth()&&!!(this.stroke()||this.strokeLinearGradientColorStops()))}hasHitStroke(){const e=this.hitStrokeWidth();return e==="auto"?this.hasStroke():this.strokeEnabled()&&!!e}intersects(e){var t=this.getStage(),r=t.bufferHitCanvas,i;return r.getContext().clear(),this.drawHit(r,null,!0),i=r.context.getImageData(Math.round(e.x),Math.round(e.y),1,1).data,i[3]>0}destroy(){return ee.prototype.destroy.call(this),delete Vl[this.colorKey],delete this.colorKey,this}_useBufferCanvas(e){var t;if(!this.getStage()||!((t=this.attrs.perfectDrawEnabled)!==null&&t!==void 0?t:!0))return!1;const i=e||this.hasFill(),s=this.hasStroke(),o=this.getAbsoluteOpacity()!==1;if(i&&s&&o)return!0;const a=this.hasShadow(),l=this.shadowForStrokeEnabled();return!!(i&&s&&a&&l)}setStrokeHitEnabled(e){A.warn("strokeHitEnabled property is deprecated. Please use hitStrokeWidth instead."),e?this.hitStrokeWidth("auto"):this.hitStrokeWidth(0)}getStrokeHitEnabled(){return this.hitStrokeWidth()!==0}getSelfRect(){var e=this.size();return{x:this._centroid?-e.width/2:0,y:this._centroid?-e.height/2:0,width:e.width,height:e.height}}getClientRect(e={}){const t=e.skipTransform,r=e.relativeTo,i=this.getSelfRect(),o=!e.skipStroke&&this.hasStroke()&&this.strokeWidth()||0,a=i.width+o,l=i.height+o,c=!e.skipShadow&&this.hasShadow(),u=c?this.shadowOffsetX():0,d=c?this.shadowOffsetY():0,h=a+Math.abs(u),m=l+Math.abs(d),p=c&&this.shadowBlur()||0,g=h+p*2,y=m+p*2,v={width:g,height:y,x:-(o/2+p)+Math.min(u,0)+i.x,y:-(o/2+p)+Math.min(d,0)+i.y};return t?v:this._transformedRect(v,r)}drawScene(e,t){var r=this.getLayer(),i=e||r.getCanvas(),s=i.getContext(),o=this._getCanvasCache(),a=this.getSceneFunc(),l=this.hasShadow(),c,u,d,h=i.isCache,m=t===this;if(!this.isVisible()&&!m)return this;if(o){s.save();var p=this.getAbsoluteTransform(t).getMatrix();return s.transform(p[0],p[1],p[2],p[3],p[4],p[5]),this._drawCachedSceneCanvas(s),s.restore(),this}if(!a)return this;if(s.save(),this._useBufferCanvas()&&!h){c=this.getStage(),u=c.bufferCanvas,d=u.getContext(),d.clear(),d.save(),d._applyLineJoin(this);var g=this.getAbsoluteTransform(t).getMatrix();d.transform(g[0],g[1],g[2],g[3],g[4],g[5]),a.call(this,d,this),d.restore();var y=u.pixelRatio;l&&s._applyShadow(this),s._applyOpacity(this),s._applyGlobalCompositeOperation(this),s.drawImage(u._canvas,0,0,u.width/y,u.height/y)}else{if(s._applyLineJoin(this),!m){var g=this.getAbsoluteTransform(t).getMatrix();s.transform(g[0],g[1],g[2],g[3],g[4],g[5]),s._applyOpacity(this),s._applyGlobalCompositeOperation(this)}l&&s._applyShadow(this),a.call(this,s,this)}return s.restore(),this}drawHit(e,t,r=!1){if(!this.shouldDrawHit(t,r))return this;var i=this.getLayer(),s=e||i.hitCanvas,o=s&&s.getContext(),a=this.hitFunc()||this.sceneFunc(),l=this._getCanvasCache(),c=l&&l.hit;if(this.colorKey||A.warn("Looks like your canvas has a destroyed shape in it. Do not reuse shape after you destroyed it. If you want to reuse shape you should call remove() instead of destroy()"),c){o.save();var u=this.getAbsoluteTransform(t).getMatrix();return o.transform(u[0],u[1],u[2],u[3],u[4],u[5]),this._drawCachedHitCanvas(o),o.restore(),this}if(!a)return this;if(o.save(),o._applyLineJoin(this),!(this===t)){var h=this.getAbsoluteTransform(t).getMatrix();o.transform(h[0],h[1],h[2],h[3],h[4],h[5])}return a.call(this,o,this),o.restore(),this}drawHitFromCache(e=0){var t=this._getCanvasCache(),r=this._getCachedSceneCanvas(),i=t.hit,s=i.getContext(),o=i.getWidth(),a=i.getHeight(),l,c,u,d,h,m;s.clear(),s.drawImage(r._canvas,0,0,o,a);try{for(l=s.getImageData(0,0,o,a),c=l.data,u=c.length,d=A._hexToRgb(this.colorKey),h=0;h<u;h+=4)m=c[h+3],m>e?(c[h]=d.r,c[h+1]=d.g,c[h+2]=d.b,c[h+3]=255):c[h+3]=0;s.putImageData(l,0,0)}catch(p){A.error("Unable to draw hit graph from cached scene canvas. "+p.message)}return this}hasPointerCapture(e){return zd(e,this)}setPointerCapture(e){Hd(e,this)}releaseCapture(e){ms(e)}}F.prototype._fillFunc=$C,F.prototype._strokeFunc=jC,F.prototype._fillFuncHit=zC,F.prototype._strokeFuncHit=HC,F.prototype._centroid=!1,F.prototype.nodeType="Shape",hi(F),F.prototype.eventListeners={},F.prototype.on.call(F.prototype,"shadowColorChange.konva shadowBlurChange.konva shadowOffsetChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",GC),F.prototype.on.call(F.prototype,"shadowColorChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",UC),F.prototype.on.call(F.prototype,"fillPriorityChange.konva fillPatternImageChange.konva fillPatternRepeatChange.konva fillPatternScaleXChange.konva fillPatternScaleYChange.konva fillPatternOffsetXChange.konva fillPatternOffsetYChange.konva fillPatternXChange.konva fillPatternYChange.konva fillPatternRotationChange.konva",WC),F.prototype.on.call(F.prototype,"fillPriorityChange.konva fillLinearGradientColorStopsChange.konva fillLinearGradientStartPointXChange.konva fillLinearGradientStartPointYChange.konva fillLinearGradientEndPointXChange.konva fillLinearGradientEndPointYChange.konva",KC),F.prototype.on.call(F.prototype,"fillPriorityChange.konva fillRadialGradientColorStopsChange.konva fillRadialGradientStartPointXChange.konva fillRadialGradientStartPointYChange.konva fillRadialGradientEndPointXChange.konva fillRadialGradientEndPointYChange.konva fillRadialGradientStartRadiusChange.konva fillRadialGradientEndRadiusChange.konva",YC),L.addGetterSetter(F,"stroke",void 0,Ad()),L.addGetterSetter(F,"strokeWidth",2,ue()),L.addGetterSetter(F,"fillAfterStrokeEnabled",!1),L.addGetterSetter(F,"hitStrokeWidth","auto",bC()),L.addGetterSetter(F,"strokeHitEnabled",!0,Ar()),L.addGetterSetter(F,"perfectDrawEnabled",!0,Ar()),L.addGetterSetter(F,"shadowForStrokeEnabled",!0,Ar()),L.addGetterSetter(F,"lineJoin"),L.addGetterSetter(F,"lineCap"),L.addGetterSetter(F,"sceneFunc"),L.addGetterSetter(F,"hitFunc"),L.addGetterSetter(F,"dash"),L.addGetterSetter(F,"dashOffset",0,ue()),L.addGetterSetter(F,"shadowColor",void 0,us()),L.addGetterSetter(F,"shadowBlur",0,ue()),L.addGetterSetter(F,"shadowOpacity",1,ue()),L.addComponentsGetterSetter(F,"shadowOffset",["x","y"]),L.addGetterSetter(F,"shadowOffsetX",0,ue()),L.addGetterSetter(F,"shadowOffsetY",0,ue()),L.addGetterSetter(F,"fillPatternImage"),L.addGetterSetter(F,"fill",void 0,Ad()),L.addGetterSetter(F,"fillPatternX",0,ue()),L.addGetterSetter(F,"fillPatternY",0,ue()),L.addGetterSetter(F,"fillLinearGradientColorStops"),L.addGetterSetter(F,"strokeLinearGradientColorStops"),L.addGetterSetter(F,"fillRadialGradientStartRadius",0),L.addGetterSetter(F,"fillRadialGradientEndRadius",0),L.addGetterSetter(F,"fillRadialGradientColorStops"),L.addGetterSetter(F,"fillPatternRepeat","repeat"),L.addGetterSetter(F,"fillEnabled",!0),L.addGetterSetter(F,"strokeEnabled",!0),L.addGetterSetter(F,"shadowEnabled",!0),L.addGetterSetter(F,"dashEnabled",!0),L.addGetterSetter(F,"strokeScaleEnabled",!0),L.addGetterSetter(F,"fillPriority","color"),L.addComponentsGetterSetter(F,"fillPatternOffset",["x","y"]),L.addGetterSetter(F,"fillPatternOffsetX",0,ue()),L.addGetterSetter(F,"fillPatternOffsetY",0,ue()),L.addComponentsGetterSetter(F,"fillPatternScale",["x","y"]),L.addGetterSetter(F,"fillPatternScaleX",1,ue()),L.addGetterSetter(F,"fillPatternScaleY",1,ue()),L.addComponentsGetterSetter(F,"fillLinearGradientStartPoint",["x","y"]),L.addComponentsGetterSetter(F,"strokeLinearGradientStartPoint",["x","y"]),L.addGetterSetter(F,"fillLinearGradientStartPointX",0),L.addGetterSetter(F,"strokeLinearGradientStartPointX",0),L.addGetterSetter(F,"fillLinearGradientStartPointY",0),L.addGetterSetter(F,"strokeLinearGradientStartPointY",0),L.addComponentsGetterSetter(F,"fillLinearGradientEndPoint",["x","y"]),L.addComponentsGetterSetter(F,"strokeLinearGradientEndPoint",["x","y"]),L.addGetterSetter(F,"fillLinearGradientEndPointX",0),L.addGetterSetter(F,"strokeLinearGradientEndPointX",0),L.addGetterSetter(F,"fillLinearGradientEndPointY",0),L.addGetterSetter(F,"strokeLinearGradientEndPointY",0),L.addComponentsGetterSetter(F,"fillRadialGradientStartPoint",["x","y"]),L.addGetterSetter(F,"fillRadialGradientStartPointX",0),L.addGetterSetter(F,"fillRadialGradientStartPointY",0),L.addComponentsGetterSetter(F,"fillRadialGradientEndPoint",["x","y"]),L.addGetterSetter(F,"fillRadialGradientEndPointX",0),L.addGetterSetter(F,"fillRadialGradientEndPointY",0),L.addGetterSetter(F,"fillPatternRotation",0),L.backCompat(F,{dashArray:"dash",getDashArray:"getDash",setDashArray:"getDash",drawFunc:"sceneFunc",getDrawFunc:"getSceneFunc",setDrawFunc:"setSceneFunc",drawHitFunc:"hitFunc",getDrawHitFunc:"getHitFunc",setDrawHitFunc:"setHitFunc"});function $l(n,e,t,r,i,s,o){var a=Math.sqrt(Math.pow(t-n,2)+Math.pow(r-e,2)),l=Math.sqrt(Math.pow(i-t,2)+Math.pow(s-r,2)),c=o*a/(a+l),u=o*l/(a+l),d=t-c*(i-n),h=r-c*(s-e),m=t+u*(i-n),p=r+u*(s-e);return[d,h,m,p]}function qd(n,e){var t=n.length,r=[],i,s;for(i=2;i<t-2;i+=2)s=$l(n[i-2],n[i-1],n[i],n[i+1],n[i+2],n[i+3],e),!isNaN(s[0])&&(r.push(s[0]),r.push(s[1]),r.push(n[i]),r.push(n[i+1]),r.push(s[2]),r.push(s[3]));return r}class Wn extends F{constructor(e){super(e),this.on("pointsChange.konva tensionChange.konva closedChange.konva bezierChange.konva",function(){this._clearCache("tensionPoints")})}_sceneFunc(e){var t=this.points(),r=t.length,i=this.tension(),s=this.closed(),o=this.bezier(),a,l,c;if(r){if(e.beginPath(),e.moveTo(t[0],t[1]),i!==0&&r>4){for(a=this.getTensionPoints(),l=a.length,c=s?0:4,s||e.quadraticCurveTo(a[0],a[1],a[2],a[3]);c<l-2;)e.bezierCurveTo(a[c++],a[c++],a[c++],a[c++],a[c++],a[c++]);s||e.quadraticCurveTo(a[l-2],a[l-1],t[r-2],t[r-1])}else if(o)for(c=2;c<r;)e.bezierCurveTo(t[c++],t[c++],t[c++],t[c++],t[c++],t[c++]);else for(c=2;c<r;c+=2)e.lineTo(t[c],t[c+1]);s?(e.closePath(),e.fillStrokeShape(this)):e.strokeShape(this)}}getTensionPoints(){return this._getCache("tensionPoints",this._getTensionPoints)}_getTensionPoints(){return this.closed()?this._getTensionPointsClosed():qd(this.points(),this.tension())}_getTensionPointsClosed(){var e=this.points(),t=e.length,r=this.tension(),i=$l(e[t-2],e[t-1],e[0],e[1],e[2],e[3],r),s=$l(e[t-4],e[t-3],e[t-2],e[t-1],e[0],e[1],r),o=qd(e,r),a=[i[2],i[3]].concat(o).concat([s[0],s[1],e[t-2],e[t-1],s[2],s[3],i[0],i[1],e[0],e[1]]);return a}getWidth(){return this.getSelfRect().width}getHeight(){return this.getSelfRect().height}getSelfRect(){var e=this.points();if(e.length<4)return{x:e[0]||0,y:e[1]||0,width:0,height:0};this.tension()!==0?e=[e[0],e[1],...this._getTensionPoints(),e[e.length-2],e[e.length-1]]:e=this.points();for(var t=e[0],r=e[0],i=e[1],s=e[1],o,a,l=0;l<e.length/2;l++)o=e[l*2],a=e[l*2+1],t=Math.min(t,o),r=Math.max(r,o),i=Math.min(i,a),s=Math.max(s,a);return{x:t,y:i,width:r-t,height:s-i}}}Wn.prototype.className="Line",Wn.prototype._attrsAffectingSize=["points","bezier","tension"],hi(Wn),L.addGetterSetter(Wn,"closed",!1),L.addGetterSetter(Wn,"bezier",!1),L.addGetterSetter(Wn,"tension",0,ue()),L.addGetterSetter(Wn,"points",[],vC());class Xe extends F{constructor(e){super(e),this.dataArray=[],this.pathLength=0,this.dataArray=Xe.parsePathData(this.data()),this.pathLength=0;for(var t=0;t<this.dataArray.length;++t)this.pathLength+=this.dataArray[t].pathLength;this.on("dataChange.konva",function(){this.dataArray=Xe.parsePathData(this.data()),this.pathLength=0;for(var r=0;r<this.dataArray.length;++r)this.pathLength+=this.dataArray[r].pathLength})}_sceneFunc(e){var t=this.dataArray;e.beginPath();for(var r=!1,i=0;i<t.length;i++){var s=t[i].command,o=t[i].points;switch(s){case"L":e.lineTo(o[0],o[1]);break;case"M":e.moveTo(o[0],o[1]);break;case"C":e.bezierCurveTo(o[0],o[1],o[2],o[3],o[4],o[5]);break;case"Q":e.quadraticCurveTo(o[0],o[1],o[2],o[3]);break;case"A":var a=o[0],l=o[1],c=o[2],u=o[3],d=o[4],h=o[5],m=o[6],p=o[7],g=c>u?c:u,y=c>u?1:c/u,v=c>u?u/c:1;e.translate(a,l),e.rotate(m),e.scale(y,v),e.arc(0,0,g,d,d+h,1-p),e.scale(1/y,1/v),e.rotate(-m),e.translate(-a,-l);break;case"z":r=!0,e.closePath();break}}!r&&!this.hasFill()?e.strokeShape(this):e.fillStrokeShape(this)}getSelfRect(){var e=[];this.dataArray.forEach(function(c){if(c.command==="A"){var u=c.points[4],d=c.points[5],h=c.points[4]+d,m=Math.PI/180;if(Math.abs(u-h)<m&&(m=Math.abs(u-h)),d<0)for(let p=u-m;p>h;p-=m){const g=Xe.getPointOnEllipticalArc(c.points[0],c.points[1],c.points[2],c.points[3],p,0);e.push(g.x,g.y)}else for(let p=u+m;p<h;p+=m){const g=Xe.getPointOnEllipticalArc(c.points[0],c.points[1],c.points[2],c.points[3],p,0);e.push(g.x,g.y)}}else if(c.command==="C")for(let p=0;p<=1;p+=.01){const g=Xe.getPointOnCubicBezier(p,c.start.x,c.start.y,c.points[0],c.points[1],c.points[2],c.points[3],c.points[4],c.points[5]);e.push(g.x,g.y)}else e=e.concat(c.points)});for(var t=e[0],r=e[0],i=e[1],s=e[1],o,a,l=0;l<e.length/2;l++)o=e[l*2],a=e[l*2+1],isNaN(o)||(t=Math.min(t,o),r=Math.max(r,o)),isNaN(a)||(i=Math.min(i,a),s=Math.max(s,a));return{x:t,y:i,width:r-t,height:s-i}}getLength(){return this.pathLength}getPointAtLength(e){var t,r=0,i=this.dataArray.length;if(!i)return null;for(;r<i&&e>this.dataArray[r].pathLength;)e-=this.dataArray[r].pathLength,++r;if(r===i)return t=this.dataArray[r-1].points.slice(-2),{x:t[0],y:t[1]};if(e<.01)return t=this.dataArray[r].points.slice(0,2),{x:t[0],y:t[1]};var s=this.dataArray[r],o=s.points;switch(s.command){case"L":return Xe.getPointOnLine(e,s.start.x,s.start.y,o[0],o[1]);case"C":return Xe.getPointOnCubicBezier(e/s.pathLength,s.start.x,s.start.y,o[0],o[1],o[2],o[3],o[4],o[5]);case"Q":return Xe.getPointOnQuadraticBezier(e/s.pathLength,s.start.x,s.start.y,o[0],o[1],o[2],o[3]);case"A":var a=o[0],l=o[1],c=o[2],u=o[3],d=o[4],h=o[5],m=o[6];return d+=h*e/s.pathLength,Xe.getPointOnEllipticalArc(a,l,c,u,d,m)}return null}static getLineLength(e,t,r,i){return Math.sqrt((r-e)*(r-e)+(i-t)*(i-t))}static getPointOnLine(e,t,r,i,s,o,a){o===void 0&&(o=t),a===void 0&&(a=r);var l=(s-r)/(i-t+1e-8),c=Math.sqrt(e*e/(1+l*l));i<t&&(c*=-1);var u=l*c,d;if(i===t)d={x:o,y:a+u};else if((a-r)/(o-t+1e-8)===l)d={x:o+c,y:a+u};else{var h,m,p=this.getLineLength(t,r,i,s),g=(o-t)*(i-t)+(a-r)*(s-r);g=g/(p*p),h=t+g*(i-t),m=r+g*(s-r);var y=this.getLineLength(o,a,h,m),v=Math.sqrt(e*e-y*y);c=Math.sqrt(v*v/(1+l*l)),i<t&&(c*=-1),u=l*c,d={x:h+c,y:m+u}}return d}static getPointOnCubicBezier(e,t,r,i,s,o,a,l,c){function u(y){return y*y*y}function d(y){return 3*y*y*(1-y)}function h(y){return 3*y*(1-y)*(1-y)}function m(y){return(1-y)*(1-y)*(1-y)}var p=l*u(e)+o*d(e)+i*h(e)+t*m(e),g=c*u(e)+a*d(e)+s*h(e)+r*m(e);return{x:p,y:g}}static getPointOnQuadraticBezier(e,t,r,i,s,o,a){function l(m){return m*m}function c(m){return 2*m*(1-m)}function u(m){return(1-m)*(1-m)}var d=o*l(e)+i*c(e)+t*u(e),h=a*l(e)+s*c(e)+r*u(e);return{x:d,y:h}}static getPointOnEllipticalArc(e,t,r,i,s,o){var a=Math.cos(o),l=Math.sin(o),c={x:r*Math.cos(s),y:i*Math.sin(s)};return{x:e+(c.x*a-c.y*l),y:t+(c.x*l+c.y*a)}}static parsePathData(e){if(!e)return[];var t=e,r=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"];t=t.replace(new RegExp(" ","g"),",");for(var i=0;i<r.length;i++)t=t.replace(new RegExp(r[i],"g"),"|"+r[i]);var s=t.split("|"),o=[],a=[],l=0,c=0,u=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/gi,d;for(i=1;i<s.length;i++){var h=s[i],m=h.charAt(0);for(h=h.slice(1),a.length=0;d=u.exec(h);)a.push(d[0]);for(var p=[],g=0,y=a.length;g<y;g++){if(a[g]==="00"){p.push(0,0);continue}var v=parseFloat(a[g]);isNaN(v)?p.push(0):p.push(v)}for(;p.length>0&&!isNaN(p[0]);){var C=null,w=[],b=l,E=c,k,x,O,T,B,U,$,K,_e,Ee;switch(m){case"l":l+=p.shift(),c+=p.shift(),C="L",w.push(l,c);break;case"L":l=p.shift(),c=p.shift(),w.push(l,c);break;case"m":var fe=p.shift(),ve=p.shift();if(l+=fe,c+=ve,C="M",o.length>2&&o[o.length-1].command==="z"){for(var he=o.length-2;he>=0;he--)if(o[he].command==="M"){l=o[he].points[0]+fe,c=o[he].points[1]+ve;break}}w.push(l,c),m="l";break;case"M":l=p.shift(),c=p.shift(),C="M",w.push(l,c),m="L";break;case"h":l+=p.shift(),C="L",w.push(l,c);break;case"H":l=p.shift(),C="L",w.push(l,c);break;case"v":c+=p.shift(),C="L",w.push(l,c);break;case"V":c=p.shift(),C="L",w.push(l,c);break;case"C":w.push(p.shift(),p.shift(),p.shift(),p.shift()),l=p.shift(),c=p.shift(),w.push(l,c);break;case"c":w.push(l+p.shift(),c+p.shift(),l+p.shift(),c+p.shift()),l+=p.shift(),c+=p.shift(),C="C",w.push(l,c);break;case"S":x=l,O=c,k=o[o.length-1],k.command==="C"&&(x=l+(l-k.points[2]),O=c+(c-k.points[3])),w.push(x,O,p.shift(),p.shift()),l=p.shift(),c=p.shift(),C="C",w.push(l,c);break;case"s":x=l,O=c,k=o[o.length-1],k.command==="C"&&(x=l+(l-k.points[2]),O=c+(c-k.points[3])),w.push(x,O,l+p.shift(),c+p.shift()),l+=p.shift(),c+=p.shift(),C="C",w.push(l,c);break;case"Q":w.push(p.shift(),p.shift()),l=p.shift(),c=p.shift(),w.push(l,c);break;case"q":w.push(l+p.shift(),c+p.shift()),l+=p.shift(),c+=p.shift(),C="Q",w.push(l,c);break;case"T":x=l,O=c,k=o[o.length-1],k.command==="Q"&&(x=l+(l-k.points[0]),O=c+(c-k.points[1])),l=p.shift(),c=p.shift(),C="Q",w.push(x,O,l,c);break;case"t":x=l,O=c,k=o[o.length-1],k.command==="Q"&&(x=l+(l-k.points[0]),O=c+(c-k.points[1])),l+=p.shift(),c+=p.shift(),C="Q",w.push(x,O,l,c);break;case"A":T=p.shift(),B=p.shift(),U=p.shift(),$=p.shift(),K=p.shift(),_e=l,Ee=c,l=p.shift(),c=p.shift(),C="A",w=this.convertEndpointToCenterParameterization(_e,Ee,l,c,$,K,T,B,U);break;case"a":T=p.shift(),B=p.shift(),U=p.shift(),$=p.shift(),K=p.shift(),_e=l,Ee=c,l+=p.shift(),c+=p.shift(),C="A",w=this.convertEndpointToCenterParameterization(_e,Ee,l,c,$,K,T,B,U);break}o.push({command:C||m,points:w,start:{x:b,y:E},pathLength:this.calcLength(b,E,C||m,w)})}(m==="z"||m==="Z")&&o.push({command:"z",points:[],start:void 0,pathLength:0})}return o}static calcLength(e,t,r,i){var s,o,a,l,c=Xe;switch(r){case"L":return c.getLineLength(e,t,i[0],i[1]);case"C":for(s=0,o=c.getPointOnCubicBezier(0,e,t,i[0],i[1],i[2],i[3],i[4],i[5]),l=.01;l<=1;l+=.01)a=c.getPointOnCubicBezier(l,e,t,i[0],i[1],i[2],i[3],i[4],i[5]),s+=c.getLineLength(o.x,o.y,a.x,a.y),o=a;return s;case"Q":for(s=0,o=c.getPointOnQuadraticBezier(0,e,t,i[0],i[1],i[2],i[3]),l=.01;l<=1;l+=.01)a=c.getPointOnQuadraticBezier(l,e,t,i[0],i[1],i[2],i[3]),s+=c.getLineLength(o.x,o.y,a.x,a.y),o=a;return s;case"A":s=0;var u=i[4],d=i[5],h=i[4]+d,m=Math.PI/180;if(Math.abs(u-h)<m&&(m=Math.abs(u-h)),o=c.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],u,0),d<0)for(l=u-m;l>h;l-=m)a=c.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],l,0),s+=c.getLineLength(o.x,o.y,a.x,a.y),o=a;else for(l=u+m;l<h;l+=m)a=c.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],l,0),s+=c.getLineLength(o.x,o.y,a.x,a.y),o=a;return a=c.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],h,0),s+=c.getLineLength(o.x,o.y,a.x,a.y),s}return 0}static convertEndpointToCenterParameterization(e,t,r,i,s,o,a,l,c){var u=c*(Math.PI/180),d=Math.cos(u)*(e-r)/2+Math.sin(u)*(t-i)/2,h=-1*Math.sin(u)*(e-r)/2+Math.cos(u)*(t-i)/2,m=d*d/(a*a)+h*h/(l*l);m>1&&(a*=Math.sqrt(m),l*=Math.sqrt(m));var p=Math.sqrt((a*a*(l*l)-a*a*(h*h)-l*l*(d*d))/(a*a*(h*h)+l*l*(d*d)));s===o&&(p*=-1),isNaN(p)&&(p=0);var g=p*a*h/l,y=p*-l*d/a,v=(e+r)/2+Math.cos(u)*g-Math.sin(u)*y,C=(t+i)/2+Math.sin(u)*g+Math.cos(u)*y,w=function(B){return Math.sqrt(B[0]*B[0]+B[1]*B[1])},b=function(B,U){return(B[0]*U[0]+B[1]*U[1])/(w(B)*w(U))},E=function(B,U){return(B[0]*U[1]<B[1]*U[0]?-1:1)*Math.acos(b(B,U))},k=E([1,0],[(d-g)/a,(h-y)/l]),x=[(d-g)/a,(h-y)/l],O=[(-1*d-g)/a,(-1*h-y)/l],T=E(x,O);return b(x,O)<=-1&&(T=Math.PI),b(x,O)>=1&&(T=0),o===0&&T>0&&(T=T-2*Math.PI),o===1&&T<0&&(T=T+2*Math.PI),[v,C,a,l,k,T,u,o]}}Xe.prototype.className="Path",Xe.prototype._attrsAffectingSize=["data"],hi(Xe),L.addGetterSetter(Xe,"data");class Kn extends Wn{_sceneFunc(e){super._sceneFunc(e);var t=Math.PI*2,r=this.points(),i=r,s=this.tension()!==0&&r.length>4;s&&(i=this.getTensionPoints());var o=this.pointerLength(),a=r.length,l,c;if(s){const h=[i[i.length-4],i[i.length-3],i[i.length-2],i[i.length-1],r[a-2],r[a-1]],m=Xe.calcLength(i[i.length-4],i[i.length-3],"C",h),p=Xe.getPointOnQuadraticBezier(Math.min(1,1-o/m),h[0],h[1],h[2],h[3],h[4],h[5]);l=r[a-2]-p.x,c=r[a-1]-p.y}else l=r[a-2]-r[a-4],c=r[a-1]-r[a-3];var u=(Math.atan2(c,l)+t)%t,d=this.pointerWidth();this.pointerAtEnding()&&(e.save(),e.beginPath(),e.translate(r[a-2],r[a-1]),e.rotate(u),e.moveTo(0,0),e.lineTo(-o,d/2),e.lineTo(-o,-d/2),e.closePath(),e.restore(),this.__fillStroke(e)),this.pointerAtBeginning()&&(e.save(),e.beginPath(),e.translate(r[0],r[1]),s?(l=(i[0]+i[2])/2-r[0],c=(i[1]+i[3])/2-r[1]):(l=r[2]-r[0],c=r[3]-r[1]),e.rotate((Math.atan2(-c,-l)+t)%t),e.moveTo(0,0),e.lineTo(-o,d/2),e.lineTo(-o,-d/2),e.closePath(),e.restore(),this.__fillStroke(e))}__fillStroke(e){var t=this.dashEnabled();t&&(this.attrs.dashEnabled=!1,e.setLineDash([])),e.fillStrokeShape(this),t&&(this.attrs.dashEnabled=!0)}getSelfRect(){const e=super.getSelfRect(),t=this.pointerWidth()/2;return{x:e.x-t,y:e.y-t,width:e.width+t*2,height:e.height+t*2}}}Kn.prototype.className="Arrow",hi(Kn),L.addGetterSetter(Kn,"pointerLength",10,ue()),L.addGetterSetter(Kn,"pointerWidth",10,ue()),L.addGetterSetter(Kn,"pointerAtBeginning",!1),L.addGetterSetter(Kn,"pointerAtEnding",!0);var qC=xd,XC=_l,JC="Expected a function";function QC(n,e,t){var r=!0,i=!0;if(typeof n!="function")throw new TypeError(JC);return XC(t)&&(r="leading"in t?!!t.leading:r,i="trailing"in t?!!t.trailing:i),qC(n,e,{leading:r,maxWait:e,trailing:i})}var ZC=QC;const ek=vl(ZC),Lo=ie.debug("MapObjectsArrows");class tk{constructor(e,t,r,i,s){X(this,"previouslyRenderedArrows",new Map);this.konvaLayer=e,this.mapFile=t,this.mapDep=r,this.arrowPath=i,this.factories=s,Lo("draw arrows on canvas");const o=this.factories.chain.create();this.konvaLayer.layer(this.factories.patron.create(o.receiveKey("layer"))),this.mapFile.currentMap(this.factories.patron.create(o.receiveKey("map"))),this.mapDep.objects(this.factories.patron.create(o.receiveKey("objects"))),o.result(this.factories.patron.create(this.factories.guest.create(ek(({layer:a,map:l,objects:c})=>{const u=(d,h)=>{const m=l.types[h.type];this.arrowPath.breakPoints({shapeGeometry:{width:d.width,height:d.height},shapePosition:{x:d.position[0],y:d.position[1]},lookToGeometry:{width:h.width,height:h.height},lookToPosition:{x:h.position[0],y:h.position[1]}},{shapeGeometry:{width:h.width||m.width,height:h.height||m.height},shapePosition:{x:h.position[0],y:h.position[1]},lookToGeometry:{width:d.width,height:d.height},lookToPosition:{x:d.position[0],y:d.position[1]}},this.factories.guest.create(p=>{const g=p.join("-"),y=[d.id,h.id].join("-");if(Lo("points",p),Lo(d,h),this.previouslyRenderedArrows.has(y)){const C=this.previouslyRenderedArrows.get(y);C.arrow.show(),C.arrow.points(p);return}const v=new Kn({x:0,y:0,points:p,pointerLength:20,pointerWidth:10,fill:"#ccc",stroke:"#bbb",strokeWidth:2,zIndex:2});this.previouslyRenderedArrows.set(y,{arrow:v,arrowKey:g}),a.add(v)}))};this.arrowPath.clear(),this.previouslyRenderedArrows.forEach(d=>d.arrow.hide()),c.forEach(d=>{d.arrows&&(Lo("visible objects",c.length),d.arrows.forEach(h=>{const m=c.find(p=>p.id===h.id)||l.objects[h.id];m&&u(d,m)}))})},50))))}introduction(){return"patron"}}const jl=ie.debug("NewArrow"),Xd={width:10,height:10};class nk{constructor(e,t,r,i){X(this,"cursorGuest");X(this,"arrowCache");this.konvaLayer=e,this.cursorPosition=t,this.arrowPath=r,this.factories=i,this.cursorGuest=this.factories.sourceEmpty.create(),this.arrowCache=this.factories.sourceEmpty.create()}forObject(e){jl("start watch cursor"),this.cursorGuest.value(this.factories.guest.create(i=>{qf(i)}));let t=null;const r=this.factories.patron.create(this.factories.guest.create(i=>{jl("cursor moves"),this.konvaLayer.layer(this.factories.guest.create(s=>{jl("cursor moves in layer"),this.arrowPath.breakPoints({shapeGeometry:{width:e.width,height:e.height},shapePosition:{x:e.position[0],y:e.position[1]},lookToGeometry:Xd,lookToPosition:i},{lookToGeometry:{width:e.width,height:e.height},lookToPosition:{x:e.position[0],y:e.position[1]},shapeGeometry:Xd,shapePosition:i},this.factories.guest.create(o=>{if(t){t.points(o);return}t=new Kn({x:0,y:0,points:o,pointerLength:20,pointerWidth:10,fill:"#ccc",stroke:"#bbb",strokeWidth:2,zIndex:2}),s.add(t),this.arrowCache.give(t)}))})),this.arrowPath.clear()}));this.cursorPosition.value(r),this.cursorGuest.give(r)}dispose(){this.cursorGuest.value(this.factories.guest.create(e=>{qf(e)})),this.arrowCache.value(this.factories.guest.create(e=>{e.remove()}))}}const zl=ie.debug("MapObjectBackground");class rk{constructor(e,t,r,i){X(this,"mapNameCache");this.konvaLayer=e,this.mapFile=t,this.zIndex=r,this.factories=i,this.mapNameCache=i.cache.create(""),this.mapFile.currentMap(i.patron.create(this))}give(e){return this.konvaLayer.layer(this.factories.patronOnce.create(t=>{zl("map received in background",e),this.mapNameCache.value(this.factories.guest.create(r=>{if(r===e.url)return;zl("background cache is not equals",r),this.mapNameCache.give(e.url),new Image;const i=document.querySelector(".grid-example");zl("grid example",i)}))})),this}}const ik=ie.debug("Breadcrumbs");class sk{constructor(e,t,r){this.parentNames=e,this.mapFile=t,this.factories=r}list(e){const t=this.factories.chain.create();return this.parentNames.names(this.factories.guestCast.create(e,t.receiveKey("names"))),this.mapFile.mapFile(this.factories.guestCast.create(e,t.receiveKey("mapFile"))),t.result(this.factories.guestInTheMiddle.create(e,({names:r,mapFile:i})=>{ik("map id",r,i),e.give(r.map(s=>{var o,a;return{title:((a=(o=i[s])==null?void 0:o.settings)==null?void 0:a.title)||"unknown",name:s}}))})),e}}const Jd=ie.debug("CursorWithObjects");class ok{constructor(e,t,r){this.objectsVisible=e,this.cursor=t,this.factories=r}value(e){const t=this.factories.chain.create();return this.cursor.value(this.factories.guestCast.create(e,t.receiveKey("cursor"))),this.objectsVisible.objects(this.factories.guestCast.create(e,t.receiveKey("objects"))),t.result(this.factories.guestInTheMiddle.create(e,({cursor:r,objects:i})=>{const s=i.find(o=>{const a=o.position[0],l=o.position[0]+o.width||100,c=o.position[1],u=o.position[1]+o.height||100;return r.x>=a&&r.x<=l&&r.y>=c&&r.y<=u});s?(Jd("crossed with",s),e.give({x:s.position[0]+s.width/2,y:s.position[1]+s.height/2})):(Jd("cursor pos",r),e.give(r))})),this}}const Qd=ie.debug("Drawer");class ak{constructor(e,t){X(this,"drawerNameCache");this.keyboard=e,this.factories=t,this.drawerNameCache=t.cache.create(""),this.keyboard.pressed(this.factories.patron.create(this.factories.guest.create(r=>{Qd("new key in drawer",r),r==="Escape"&&this.give("")})))}isOpenedByName(e,t){return this.drawerNameCache.value(this.factories.guestInTheMiddle.create(t,r=>{Qd("new drawer name",r),t.give(r===e)})),t}openedByName(e){return this.factories.guestAware.create(t=>{this.isOpenedByName(e,t)})}give(e){return this.drawerNameCache.give(e),this}}class lk{value(e){typeof performance>"u"&&e.give(0);const t=10;let r=performance.now(),i=0;const s=()=>requestAnimationFrame(()=>{if(i+=1,i>=t){const o=performance.now(),a=o-r;e.give(Math.round(1e3/(a/i))),r=o,i=0}s()});return s(),e}}class ck{constructor(e,t){this.mapFile=e,this.factories=t}menuObjects(e){return this.mapFile.currentMap(this.factories.guestInTheMiddle.create(e,t=>{const r=Object.values(t.objects).filter(i=>i.inMenu);e.give(r)})),e}}const Zd=ie.debug("app:MiniMap"),eh=130;class uk{constructor(e,t,r,i){X(this,"theSize");X(this,"thePoints");X(this,"viewportSizeCache");this.map=e,this.layer=t,this.stageSize=r,this.factories=i,this.theSize=i.sourceEmpty.create(),this.thePoints=i.sourceEmpty.create(),this.viewportSizeCache=i.sourceEmpty.create();const s=i.chain.create();e.objects(i.patron.create(s.receiveKey("objects"))),t.layer(i.patron.create(s.receiveKey("layer"))),r.value(i.patron.create(s.receiveKey("size"))),s.result(i.patron.create(i.guest.create(({layer:o,size:a,objects:l})=>{const c=eh/a.width,u={width:Math.round(o.width()*c),height:Math.round(o.height()*c)};this.viewportSizeCache.give(u);const d={width:Math.round(a.width*c),height:Math.round(a.height*c)};this.theSize.give(d);const h=l.map(m=>({id:m.id,x:Math.round(m.position[0]*c),y:Math.round(m.position[1]*c),width:Math.round(m.width*c),height:Math.round(m.height*c)}));Zd("minimap points",h),this.thePoints.give(h)})))}viewportPosition(e){const t=this.factories.chain.create();return this.stageSize.value(this.factories.guestCast.create(e,t.receiveKey("size"))),this.layer.position(this.factories.guestCast.create(e,t.receiveKey("position"))),t.result(this.factories.guestInTheMiddle.create(e,({size:r,position:i})=>{const s=eh/r.width,o={x:i.x*s*-1,y:i.y*s*-1};Zd("scaled position is",o),e.give(o)})),e}viewportSize(e){return this.viewportSizeCache.value(e),e}size(e){return this.theSize.value(e),e}points(e){return this.thePoints.value(e),e}}const th=ie.debug("Modal");class fk{constructor(e,t){X(this,"modalNameCache");this.keyboard=e,this.factories=t,th("modal created"),this.modalNameCache=t.cache.create(""),this.keyboard.pressed(this.factories.patron.create(this.factories.guest.create(r=>{th("new key in modal",r),r==="Escape"&&this.give("")})))}isOpenedByName(e,t){return this.modalNameCache.value(this.factories.guestInTheMiddle.create(t,r=>{t.give(r===e)})),t}openedByName(e){return this.factories.guestAware.create(t=>{this.isOpenedByName(e,t)})}give(e){return this.modalNameCache.give(e),this}}class dk{constructor(e){X(this,"messageCache");X(this,"notificationLifetimeDelay",3500);X(this,"lastTimerHead",null);this.messageCache=e.sourceEmpty.create()}message(e){return this.messageCache.value(e),e}give(e){return this.messageCache.give(e),this.lastTimerHead&&clearTimeout(this.lastTimerHead),this.lastTimerHead=setTimeout(()=>{this.messageCache.give({type:"success",text:"hide"})},this.notificationLifetimeDelay),this}}const gs=ie.debug("ObjectGeometryFix");class hk{constructor(e,t,r,i){X(this,"innerReceive");this.mapFile=t,this.map=r,this.factories=i,e.objects(i.patron.create(this)),this.innerReceive=di(s=>{this.mapFile.currentMap(this.factories.guest.create(o=>{gs("objects to fix",s);const a=document.querySelectorAll(".objects-container .rendered-object"),l=o.objects;let c=!1;a.forEach(u=>{const d=u.getAttribute("data-object-id");if(gs("i see id",d),!d)return;const h=l[d];if(h&&(gs("dom object geometry",u.clientWidth,u.clientHeight),gs("saved object geometry",h.width,h.height),(h.width!==u.clientWidth||h.height!==u.clientHeight)&&(c=!0,gs("update object geometry"),h.width=u.clientWidth,h.height=u.clientHeight),!h.width||!h.height)){const m=o.types[h.type];h.width=m.width,h.height=m.height}}),c&&this.map.give({...o,objects:l})}))},500)}give(e){return this.innerReceive(e),this}}class Ro extends F{_sceneFunc(e){var t=this.cornerRadius(),r=this.width(),i=this.height();e.beginPath(),t?A.drawRoundedRectPath(e,r,i,t):e.rect(0,0,r,i),e.closePath(),e.fillStrokeShape(this)}}Ro.prototype.className="Rect",hi(Ro),L.addGetterSetter(Ro,"cornerRadius",0,yC(4));const ys=ie.debug("MapObjectsRectsPatron");class pk{constructor(e,t,r,i,s,o,a,l,c){X(this,"previouslyRenderedRects",new Map);this.konvaLayer=e,this.mapFile=t,this.mapObject=r,this.mapObjectCurrent=s,this.mapObjectForRendering=o,this.objectPosition=a,this.settings=l,this.factories=c,i.objects(this)}give(e){return this.konvaLayer.layer(this.factories.patronOnce.create(this.factories.guest.create(t=>{const r=this.factories.chain.create();this.mapFile.currentMap(r.receiveKey("map")),this.settings.value(r.receiveKey("settings")),r.result(this.factories.guest.create(i=>{const{map:s,settings:o}=i;ys("rerender object rects"),this.previouslyRenderedRects.forEach(a=>{a.hide()}),e.forEach(a=>{const l=s.types[a.type],c=+a.width||+l.width||100,u=+a.height||+l.height||100;if(this.previouslyRenderedRects.has(a)){const h=this.previouslyRenderedRects.get(a);h.width(c),h.height(u),h.x(+a.position[0]),h.y(+a.position[1]),h.show();return}ys("rect object",a,l);const d=new Ro({x:+a.position[0],y:+a.position[1],width:c,height:u,name:a.id,draggable:!o.readonly,objectId:a.id,zIndex:3});this.previouslyRenderedRects.set(a,d),t.add(d),d.on("mouseenter",()=>{t.getStage().container().style.cursor="pointer"}),d.on("mouseleave",()=>{t.getStage().container().style.cursor="default"}),d.on("dragend",()=>{ys("drag ended"),this.objectPosition.position(a,{x:d.x(),y:d.y()},this.factories.guest.create(h=>{this.mapObject.give({...a,position:[h.x,h.y]})}))}),d.on("dragmove",()=>{ys("dragmove works",d.x(),d.y()),t.getStage().container().style.cursor="move",this.objectPosition.position(a,{x:d.x(),y:d.y()},this.factories.guest.create(h=>{this.mapObjectForRendering.give({...a,position:[h.x,h.y]})}))}),d.on("click",()=>{ys("object clicked with id",a.id),this.mapObjectCurrent.give(a.id)})})}))}))),this}introduction(){return"patron"}}class mk{constructor(e,t,r,i){this.canvas=t,this.konvaLayer=r,this.factories=i,e.currentMap(this)}give(){const e=new ResizeObserver(r=>{requestAnimationFrame(()=>{const[i]=r;this.canvas.canvas(this.factories.guest.create(s=>{const o=s.getBoundingClientRect();this.konvaLayer.layer(this.factories.guest.create(a=>{a.getStage().width(i.contentRect.width-o.left),a.getStage().height(i.contentRect.height-o.top),this.canvas.give(s),this.konvaLayer.give(a)}))}))})}),t=document.querySelector("body");return t&&e.observe(t),this}}const gk=ie.debug("StagePosition");class yk{constructor(e){this.stageMove=e}give(e){return gk("received position",e),this.stageMove.move(e),this}}class bk{constructor(e,t){this.stageMove=e,this.factories=t}move(e,t){return e.value(this.factories.guest.create(r=>{this.stageMove.move(r.objects[t])})),this}}const nh=ie.debug("Zindex");class vk{constructor(e){X(this,"fnsCache");this.factories=e,this.fnsCache=e.cache.create([]),this.fnsCache.value(e.patron.create(e.guest.create(di(t=>{nh("zindex fns run"),t.forEach(r=>r())},50))))}give(e){return nh("zindex received value"),this.fnsCache.value(this.factories.guest.create(t=>{this.fnsCache.give(t.concat(e))})),this}}const rh=ie.debug("app:BrowserCanvas");class wk{constructor(e){X(this,"canvasCache");this.factories=e,this.canvasCache=e.sourceEmpty.create()}canvas(e){return this.canvasCache.value(e),this}size(e){return this.canvasCache.value(this.factories.guestInTheMiddle.create(e,t=>{const r=t.width||t.clientWidth,i=t.height||t.clientHeight;rh("canvas size",r,i),e.give({height:i,width:r})})),this}give(e){return rh("receive new canvas",e),this.canvasCache.give(e),this}}const Ck=ie.debug("Cursor");class kk{constructor(e,t){X(this,"cursorPool");this.cursorPool=t.pool.create(this);const r={x:0,y:0};window==null||window.addEventListener("mousemove",i=>{const s={x:i.offsetX+-r.x,y:i.offsetY+-r.y};Ck("move cursor fired",s),this.cursorPool.give(s)}),e.position(t.patron.create(t.guest.create(i=>{r.x=i.x,r.y=i.y})))}value(e){return this.cursorPool.add(e),this}}class Sk{constructor(e){this.el=e,e.value(this)}give(e){return e.addEventListener("dragstart",t=>{const r=t.target;if(!r)return;const i=r.cloneNode(!0);i.style.transform="translate(0,0)",i.style.position="absolute",i.style.top="0",i.style.left="0",i.style.zIndex="999",t.dataTransfer&&t.dataTransfer.setDragImage(i,0,0),document.body.append(i);const s=o=>{i.style.transform=`translate(${o.clientX}px, ${o.clientY}px)`};r.addEventListener("drag",s,{passive:!0}),r.addEventListener("dragend",()=>{i.removeEventListener("drag",s),i.remove()})}),this}introduction(){return"patron"}}const Fo=ie.debug("ControlCombo");class xk{constructor(e,t){this.keyboard=e,this.factories=t}happened(e,t){this.keyboard.event(this.factories.guestInTheMiddle.create(t,r=>{Fo("combo happened look for key",e,"received",r.code),r.ctrlKey&&r.code===e&&r.type==="keydown"&&(r.preventDefault(),t.give(r))}))}happenedConditional(e,t,r){Fo("combo control happened registration"),this.keyboard.event(this.factories.guestInTheMiddle.create(r,i=>{Fo("keyboard event come"),t.value(this.factories.guest.create(s=>{Fo("combo happened look for key",e,"received",i.code),s&&i.ctrlKey&&i.code===e&&i.type==="keydown"&&(i.preventDefault(),r.give(i))}))}))}}const bs=ie.debug("Keyboard");class _k{constructor(e){X(this,"pressedPool");X(this,"combinationsPool");bs("keyboard created"),this.pressedPool=e.pool.create(this),this.combinationsPool=e.pool.create(this),window==null||window.addEventListener("keyup",t=>{bs("keyboard pressed",t.key),this.pressedPool.give(t.key)}),O1({passive:!1,onEventFired:t=>{bs("magic combination happens 11",t.ctrlKey,t.key),this.combinationsPool.give(t)}})}pressed(e){return bs("keyboard receive pressed subscriber"),this.pressedPool.add(e),this}event(e){return bs("keyboard receive combination subscriber"),this.combinationsPool.add(e),this}}class Yn extends ee{constructor(){super(...arguments),this.children=[]}getChildren(e){if(!e)return this.children||[];const t=this.children||[];var r=[];return t.forEach(function(i){e(i)&&r.push(i)}),r}hasChildren(){return this.getChildren().length>0}removeChildren(){return this.getChildren().forEach(e=>{e.parent=null,e.index=0,e.remove()}),this.children=[],this._requestDraw(),this}destroyChildren(){return this.getChildren().forEach(e=>{e.parent=null,e.index=0,e.destroy()}),this.children=[],this._requestDraw(),this}add(...e){if(e.length===0)return this;if(e.length>1){for(var t=0;t<e.length;t++)this.add(e[t]);return this}const r=e[0];return r.getParent()?(r.moveTo(this),this):(this._validateAdd(r),r.index=this.getChildren().length,r.parent=this,r._clearCaches(),this.getChildren().push(r),this._fire("add",{child:r}),this._requestDraw(),this)}destroy(){return this.hasChildren()&&this.destroyChildren(),super.destroy(),this}find(e){return this._generalFind(e,!1)}findOne(e){var t=this._generalFind(e,!0);return t.length>0?t[0]:void 0}_generalFind(e,t){var r=[];return this._descendants(i=>{const s=i._isMatch(e);return s&&r.push(i),!!(s&&t)}),r}_descendants(e){let t=!1;const r=this.getChildren();for(const i of r){if(t=e(i),t)return!0;if(i.hasChildren()&&(t=i._descendants(e),t))return!0}return!1}toObject(){var e=ee.prototype.toObject.call(this);return e.children=[],this.getChildren().forEach(t=>{e.children.push(t.toObject())}),e}isAncestorOf(e){for(var t=e.getParent();t;){if(t._id===this._id)return!0;t=t.getParent()}return!1}clone(e){var t=ee.prototype.clone.call(this,e);return this.getChildren().forEach(function(r){t.add(r.clone())}),t}getAllIntersections(e){var t=[];return this.find("Shape").forEach(function(r){r.isVisible()&&r.intersects(e)&&t.push(r)}),t}_clearSelfAndDescendantCache(e){var t;super._clearSelfAndDescendantCache(e),!this.isCached()&&((t=this.children)===null||t===void 0||t.forEach(function(r){r._clearSelfAndDescendantCache(e)}))}_setChildrenIndices(){var e;(e=this.children)===null||e===void 0||e.forEach(function(t,r){t.index=r}),this._requestDraw()}drawScene(e,t){var r=this.getLayer(),i=e||r&&r.getCanvas(),s=i&&i.getContext(),o=this._getCanvasCache(),a=o&&o.scene,l=i&&i.isCache;if(!this.isVisible()&&!l)return this;if(a){s.save();var c=this.getAbsoluteTransform(t).getMatrix();s.transform(c[0],c[1],c[2],c[3],c[4],c[5]),this._drawCachedSceneCanvas(s),s.restore()}else this._drawChildren("drawScene",i,t);return this}drawHit(e,t){if(!this.shouldDrawHit(t))return this;var r=this.getLayer(),i=e||r&&r.hitCanvas,s=i&&i.getContext(),o=this._getCanvasCache(),a=o&&o.hit;if(a){s.save();var l=this.getAbsoluteTransform(t).getMatrix();s.transform(l[0],l[1],l[2],l[3],l[4],l[5]),this._drawCachedHitCanvas(s),s.restore()}else this._drawChildren("drawHit",i,t);return this}_drawChildren(e,t,r){var i,s=t&&t.getContext(),o=this.clipWidth(),a=this.clipHeight(),l=this.clipFunc(),c=o&&a||l;const u=r===this;if(c){s.save();var d=this.getAbsoluteTransform(r),h=d.getMatrix();if(s.transform(h[0],h[1],h[2],h[3],h[4],h[5]),s.beginPath(),l)l.call(this,s,this);else{var m=this.clipX(),p=this.clipY();s.rect(m,p,o,a)}s.clip(),h=d.copy().invert().getMatrix(),s.transform(h[0],h[1],h[2],h[3],h[4],h[5])}var g=!u&&this.globalCompositeOperation()!=="source-over"&&e==="drawScene";g&&(s.save(),s._applyGlobalCompositeOperation(this)),(i=this.children)===null||i===void 0||i.forEach(function(y){y[e](t,r)}),g&&s.restore(),c&&s.restore()}getClientRect(e){var t;e=e||{};var r=e.skipTransform,i=e.relativeTo,s,o,a,l,c={x:1/0,y:1/0,width:0,height:0},u=this;(t=this.children)===null||t===void 0||t.forEach(function(g){if(g.visible()){var y=g.getClientRect({relativeTo:u,skipShadow:e.skipShadow,skipStroke:e.skipStroke});y.width===0&&y.height===0||(s===void 0?(s=y.x,o=y.y,a=y.x+y.width,l=y.y+y.height):(s=Math.min(s,y.x),o=Math.min(o,y.y),a=Math.max(a,y.x+y.width),l=Math.max(l,y.y+y.height)))}});for(var d=this.find("Shape"),h=!1,m=0;m<d.length;m++){var p=d[m];if(p._isVisible(this)){h=!0;break}}return h&&s!==void 0?c={x:s,y:o,width:a-s,height:l-o}:c={x:0,y:0,width:0,height:0},r?c:this._transformedRect(c,i)}}L.addComponentsGetterSetter(Yn,"clip",["x","y","width","height"]),L.addGetterSetter(Yn,"clipX",void 0,ue()),L.addGetterSetter(Yn,"clipY",void 0,ue()),L.addGetterSetter(Yn,"clipWidth",void 0,ue()),L.addGetterSetter(Yn,"clipHeight",void 0,ue()),L.addGetterSetter(Yn,"clipFunc");var Ek="Stage",Tk="string",ih="px",Ok="mouseout",sh="mouseleave",oh="mouseover",ah="mouseenter",lh="mousemove",ch="mousedown",uh="mouseup",vs="pointermove",ws="pointerdown",pi="pointerup",Cs="pointercancel",Nk="lostpointercapture",Bo="pointerout",Vo="pointerleave",$o="pointerover",jo="pointerenter",Hl="contextmenu",fh="touchstart",dh="touchend",hh="touchmove",ph="touchcancel",Gl="wheel",Mk=5,Ak=[[ah,"_pointerenter"],[ch,"_pointerdown"],[lh,"_pointermove"],[uh,"_pointerup"],[sh,"_pointerleave"],[fh,"_pointerdown"],[hh,"_pointermove"],[dh,"_pointerup"],[ph,"_pointercancel"],[oh,"_pointerover"],[Gl,"_wheel"],[Hl,"_contextmenu"],[ws,"_pointerdown"],[vs,"_pointermove"],[pi,"_pointerup"],[Cs,"_pointercancel"],[Nk,"_lostpointercapture"]];const Ul={mouse:{[Bo]:Ok,[Vo]:sh,[$o]:oh,[jo]:ah,[vs]:lh,[ws]:ch,[pi]:uh,[Cs]:"mousecancel",pointerclick:"click",pointerdblclick:"dblclick"},touch:{[Bo]:"touchout",[Vo]:"touchleave",[$o]:"touchover",[jo]:"touchenter",[vs]:hh,[ws]:fh,[pi]:dh,[Cs]:ph,pointerclick:"tap",pointerdblclick:"dbltap"},pointer:{[Bo]:Bo,[Vo]:Vo,[$o]:$o,[jo]:jo,[vs]:vs,[ws]:ws,[pi]:pi,[Cs]:Cs,pointerclick:"pointerclick",pointerdblclick:"pointerdblclick"}},ks=n=>n.indexOf("pointer")>=0?"pointer":n.indexOf("touch")>=0?"touch":"mouse",mi=n=>{const e=ks(n);if(e==="pointer")return J.pointerEventsEnabled&&Ul.pointer;if(e==="touch")return Ul.touch;if(e==="mouse")return Ul.mouse};function mh(n={}){return(n.clipFunc||n.clipWidth||n.clipHeight)&&A.warn("Stage does not support clipping. Please use clip for Layers or Groups."),n}const Pk="Pointer position is missing and not registered by the stage. Looks like it is outside of the stage container. You can set it manually from event: stage.setPointersPositions(event);";class Ss extends Yn{constructor(e){super(mh(e)),this._pointerPositions=[],this._changedPointerPositions=[],this._buildDOM(),this._bindContentEvents(),this.on("widthChange.konva heightChange.konva",this._resizeDOM),this.on("visibleChange.konva",this._checkVisibility),this.on("clipWidthChange.konva clipHeightChange.konva clipFuncChange.konva",()=>{mh(this.attrs)}),this._checkVisibility()}_validateAdd(e){const t=e.getType()==="Layer",r=e.getType()==="FastLayer";t||r||A.throw("You may only add layers to the stage.")}_checkVisibility(){if(!this.content)return;const e=this.visible()?"":"none";this.content.style.display=e}setContainer(e){if(typeof e===Tk){if(e.charAt(0)==="."){var t=e.slice(1);e=document.getElementsByClassName(t)[0]}else{var r;e.charAt(0)!=="#"?r=e:r=e.slice(1),e=document.getElementById(r)}if(!e)throw"Can not find container in document with id "+r}return this._setAttr("container",e),this.content&&(this.content.parentElement&&this.content.parentElement.removeChild(this.content),e.appendChild(this.content)),this}shouldDrawHit(){return!0}clear(){var e=this.children,t=e.length,r;for(r=0;r<t;r++)e[r].clear();return this}clone(e){return e||(e={}),e.container=typeof document<"u"&&document.createElement("div"),Yn.prototype.clone.call(this,e)}destroy(){super.destroy();var e=this.content;return e&&A._isInDocument(e)&&this.container().removeChild(e),A.releaseCanvas(this.bufferCanvas._canvas,this.bufferHitCanvas._canvas),this}getPointerPosition(){const e=this._pointerPositions[0]||this._changedPointerPositions[0];return e?{x:e.x,y:e.y}:(A.warn(Pk),null)}_getPointerById(e){return this._pointerPositions.find(t=>t.id===e)}getPointersPositions(){return this._pointerPositions}getStage(){return this}getContent(){return this.content}_toKonvaCanvas(e){e=e||{},e.x=e.x||0,e.y=e.y||0,e.width=e.width||this.width(),e.height=e.height||this.height();var t=new hs({width:e.width,height:e.height,pixelRatio:e.pixelRatio||1}),r=t.getContext()._context,i=this.children;return(e.x||e.y)&&r.translate(-1*e.x,-1*e.y),i.forEach(function(s){if(s.isVisible()){var o=s._toKonvaCanvas(e);r.drawImage(o._canvas,e.x,e.y,o.getWidth()/o.getPixelRatio(),o.getHeight()/o.getPixelRatio())}}),t}getIntersection(e){if(!e)return null;var t=this.children,r=t.length,i=r-1,s;for(s=i;s>=0;s--){const o=t[s].getIntersection(e);if(o)return o}return null}_resizeDOM(){var e=this.width(),t=this.height();this.content&&(this.content.style.width=e+ih,this.content.style.height=t+ih),this.bufferCanvas.setSize(e,t),this.bufferHitCanvas.setSize(e,t),this.children.forEach(r=>{r.setSize({width:e,height:t}),r.draw()})}add(e,...t){if(arguments.length>1){for(var r=0;r<arguments.length;r++)this.add(arguments[r]);return this}super.add(e);var i=this.children.length;return i>Mk&&A.warn("The stage has "+i+" layers. Recommended maximum number of layers is 3-5. Adding more layers into the stage may drop the performance. Rethink your tree structure, you can use Konva.Group."),e.setSize({width:this.width(),height:this.height()}),e.draw(),J.isBrowser&&this.content.appendChild(e.canvas._canvas),this}getParent(){return null}getLayer(){return null}hasPointerCapture(e){return zd(e,this)}setPointerCapture(e){Hd(e,this)}releaseCapture(e){ms(e)}getLayers(){return this.children}_bindContentEvents(){J.isBrowser&&Ak.forEach(([e,t])=>{this.content.addEventListener(e,r=>{this[t](r)},{passive:!1})})}_pointerenter(e){this.setPointersPositions(e);const t=mi(e.type);this._fire(t.pointerenter,{evt:e,target:this,currentTarget:this})}_pointerover(e){this.setPointersPositions(e);const t=mi(e.type);this._fire(t.pointerover,{evt:e,target:this,currentTarget:this})}_getTargetShape(e){let t=this[e+"targetShape"];return t&&!t.getStage()&&(t=null),t}_pointerleave(e){const t=mi(e.type),r=ks(e.type);if(t){this.setPointersPositions(e);var i=this._getTargetShape(r),s=!me.isDragging||J.hitOnDragEnabled;i&&s?(i._fireAndBubble(t.pointerout,{evt:e}),i._fireAndBubble(t.pointerleave,{evt:e}),this._fire(t.pointerleave,{evt:e,target:this,currentTarget:this}),this[r+"targetShape"]=null):s&&(this._fire(t.pointerleave,{evt:e,target:this,currentTarget:this}),this._fire(t.pointerout,{evt:e,target:this,currentTarget:this})),this.pointerPos=void 0,this._pointerPositions=[]}}_pointerdown(e){const t=mi(e.type),r=ks(e.type);if(t){this.setPointersPositions(e);var i=!1;this._changedPointerPositions.forEach(s=>{var o=this.getIntersection(s);if(me.justDragged=!1,J["_"+r+"ListenClick"]=!0,!(o&&o.isListening()))return;J.capturePointerEventsEnabled&&o.setPointerCapture(s.id),this[r+"ClickStartShape"]=o,o._fireAndBubble(t.pointerdown,{evt:e,pointerId:s.id}),i=!0;const l=e.type.indexOf("touch")>=0;o.preventDefault()&&e.cancelable&&l&&e.preventDefault()}),i||this._fire(t.pointerdown,{evt:e,target:this,currentTarget:this,pointerId:this._pointerPositions[0].id})}}_pointermove(e){const t=mi(e.type),r=ks(e.type);if(!t)return;me.isDragging&&me.node.preventDefault()&&e.cancelable&&e.preventDefault(),this.setPointersPositions(e);var i=!me.isDragging||J.hitOnDragEnabled;if(!i)return;var s={};let o=!1;var a=this._getTargetShape(r);this._changedPointerPositions.forEach(l=>{const c=Rl(l.id)||this.getIntersection(l),u=l.id,d={evt:e,pointerId:u};var h=a!==c;if(h&&a&&(a._fireAndBubble(t.pointerout,Object.assign({},d),c),a._fireAndBubble(t.pointerleave,Object.assign({},d),c)),c){if(s[c._id])return;s[c._id]=!0}c&&c.isListening()?(o=!0,h&&(c._fireAndBubble(t.pointerover,Object.assign({},d),a),c._fireAndBubble(t.pointerenter,Object.assign({},d),a),this[r+"targetShape"]=c),c._fireAndBubble(t.pointermove,Object.assign({},d))):a&&(this._fire(t.pointerover,{evt:e,target:this,currentTarget:this,pointerId:u}),this[r+"targetShape"]=null)}),o||this._fire(t.pointermove,{evt:e,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id})}_pointerup(e){const t=mi(e.type),r=ks(e.type);if(!t)return;this.setPointersPositions(e);const i=this[r+"ClickStartShape"],s=this[r+"ClickEndShape"];var o={};let a=!1;this._changedPointerPositions.forEach(l=>{const c=Rl(l.id)||this.getIntersection(l);if(c){if(c.releaseCapture(l.id),o[c._id])return;o[c._id]=!0}const u=l.id,d={evt:e,pointerId:u};let h=!1;J["_"+r+"InDblClickWindow"]?(h=!0,clearTimeout(this[r+"DblTimeout"])):me.justDragged||(J["_"+r+"InDblClickWindow"]=!0,clearTimeout(this[r+"DblTimeout"])),this[r+"DblTimeout"]=setTimeout(function(){J["_"+r+"InDblClickWindow"]=!1},J.dblClickWindow),c&&c.isListening()?(a=!0,this[r+"ClickEndShape"]=c,c._fireAndBubble(t.pointerup,Object.assign({},d)),J["_"+r+"ListenClick"]&&i&&i===c&&(c._fireAndBubble(t.pointerclick,Object.assign({},d)),h&&s&&s===c&&c._fireAndBubble(t.pointerdblclick,Object.assign({},d)))):(this[r+"ClickEndShape"]=null,J["_"+r+"ListenClick"]&&this._fire(t.pointerclick,{evt:e,target:this,currentTarget:this,pointerId:u}),h&&this._fire(t.pointerdblclick,{evt:e,target:this,currentTarget:this,pointerId:u}))}),a||this._fire(t.pointerup,{evt:e,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),J["_"+r+"ListenClick"]=!1,e.cancelable&&r!=="touch"&&e.preventDefault()}_contextmenu(e){this.setPointersPositions(e);var t=this.getIntersection(this.getPointerPosition());t&&t.isListening()?t._fireAndBubble(Hl,{evt:e}):this._fire(Hl,{evt:e,target:this,currentTarget:this})}_wheel(e){this.setPointersPositions(e);var t=this.getIntersection(this.getPointerPosition());t&&t.isListening()?t._fireAndBubble(Gl,{evt:e}):this._fire(Gl,{evt:e,target:this,currentTarget:this})}_pointercancel(e){this.setPointersPositions(e);const t=Rl(e.pointerId)||this.getIntersection(this.getPointerPosition());t&&t._fireAndBubble(pi,Fl(e)),ms(e.pointerId)}_lostpointercapture(e){ms(e.pointerId)}setPointersPositions(e){var t=this._getContentPosition(),r=null,i=null;e=e||window.event,e.touches!==void 0?(this._pointerPositions=[],this._changedPointerPositions=[],Array.prototype.forEach.call(e.touches,s=>{this._pointerPositions.push({id:s.identifier,x:(s.clientX-t.left)/t.scaleX,y:(s.clientY-t.top)/t.scaleY})}),Array.prototype.forEach.call(e.changedTouches||e.touches,s=>{this._changedPointerPositions.push({id:s.identifier,x:(s.clientX-t.left)/t.scaleX,y:(s.clientY-t.top)/t.scaleY})})):(r=(e.clientX-t.left)/t.scaleX,i=(e.clientY-t.top)/t.scaleY,this.pointerPos={x:r,y:i},this._pointerPositions=[{x:r,y:i,id:A._getFirstPointerId(e)}],this._changedPointerPositions=[{x:r,y:i,id:A._getFirstPointerId(e)}])}_setPointerPosition(e){A.warn('Method _setPointerPosition is deprecated. Use "stage.setPointersPositions(event)" instead.'),this.setPointersPositions(e)}_getContentPosition(){if(!this.content||!this.content.getBoundingClientRect)return{top:0,left:0,scaleX:1,scaleY:1};var e=this.content.getBoundingClientRect();return{top:e.top,left:e.left,scaleX:e.width/this.content.clientWidth||1,scaleY:e.height/this.content.clientHeight||1}}_buildDOM(){if(this.bufferCanvas=new hs({width:this.width(),height:this.height()}),this.bufferHitCanvas=new Dd({pixelRatio:1,width:this.width(),height:this.height()}),!!J.isBrowser){var e=this.container();if(!e)throw"Stage has no container. A container is required.";e.innerHTML="",this.content=document.createElement("div"),this.content.style.position="relative",this.content.style.userSelect="none",this.content.className="konvajs-content",this.content.setAttribute("role","presentation"),e.appendChild(this.content),this._resizeDOM()}}cache(){return A.warn("Cache function is not allowed for stage. You may use cache only for layers, groups and shapes."),this}clearCache(){return this}batchDraw(){return this.getChildren().forEach(function(e){e.batchDraw()}),this}}Ss.prototype.nodeType=Ek,hi(Ss),L.addGetterSetter(Ss,"container");const gh=ie.debug("app:konva:KonvaLayer");class Ik{constructor(e,t,r,i){X(this,"guestChain");X(this,"positionCache");X(this,"layerCache");this.canvasDep=e,this.stageMoveRestriction=r,this.factories=i,this.positionCache=i.cache.create({x:0,y:0}),this.guestChain=i.chain.create(),this.layerCache=i.sourceEmpty.create(),this.canvasDep.canvas(i.patron.create(this.guestChain.receiveKey("canvas"))),t.value(this.guestChain.receiveKey("stageSize")),this.guestChain.result(i.guest.create(({canvas:s})=>{gh("create new konva stage");const o=new Or.Stage({width:s.clientWidth,height:s.clientHeight,container:s,fill:"#ffeeee",draggable:!0}),a=new Or.Layer;o.add(a),a.draw(),this.layerCache.give(a),o.on("dragend",c=>{if(!(c.target instanceof Ss))return;const u={x:o.x(),y:o.y()};gh("new position",u),this.positionCache.give(u)}),o.on("dragmove",c=>{if(!(c.target instanceof Ss))return;const u={x:o.x(),y:o.y()};this.positionCache.give(u)});const l=this.factories.guestSync.create({x:0,y:0});o.dragBoundFunc(c=>(r.position(c,l),l.value()))}))}layer(e){return this.layerCache.value(e),e}position(e){return this.positionCache.value(e),e}give(e){this.layerCache.give(e);const t=e.getStage();return this.positionCache.give({x:t.x(),y:t.y()}),this}}class Dk{constructor(e,t){this.konvaLayer=e,this.factories=t}position(e){return this.konvaLayer.position(this.factories.guestInTheMiddle.create(e,t=>{e.give({x:t.x*-1,y:t.y*-1})})),e}}const Lk=ie.debug("position");class Rk{constructor(e,t,r,i,s){this.layer=e,this.canvas=t,this.stageSize=r,this.stageMoveRestriction=i,this.factories=s}move(e){Lk("move stage to new point",e.position),this.stageSize.value(this.factories.guest.create(()=>{this.canvas.size(this.factories.guest.create(t=>{this.layer.layer(this.factories.guest.create(r=>{const[i,s]=e.position,o={x:-i-Math.round(e.width/2)+Math.round(t.width/2),y:-s-Math.round(e.height/2)+Math.round(t.height/2)};this.stageMoveRestriction.position(o,this.factories.guest.create(a=>{r.getStage().position(a),setTimeout(()=>{this.layer.give(r)})}))}))}))}))}}const Y=yt(),zo=new _k(Y),yh=new is({readonly:!1,presets:{}}),Fk=new fk(zo,Y),bh=new ak(zo,Y),Ho=new dk(Y),En=new yv(Y),vh=Y.sourceEmpty.create(),Pe=new Cv(vh,En,Y),Bk=new bv(Pe),Vk=new $b(Bk),Wl=new Sv(Pe,En,Y),Kl=new fd(Wl,En,Y),$k=new hd(Kl,Wl,Y),At=new fd(Pe,En,Y),jk=new yl(n=>{Pe.currentMap(new wo(n))}),Go=new xv(bh,Y),zk=new $w(Y),Hk=new Vw(Pe,At,Y),Ir=new wk(Y),Dr=new Xw,wh=new Jw(Ir,Dr,Y),Pt=new Ik(Ir,Dr,wh,Y),Gk=new vk(Y),Uk=new rk(Pt,Pe,Gk,Y),gi=new hd(At,Pe,Y),Wk=new Nv(At,Pe,[new kl(Ho,new _v(Pe,Y),Y)],Y),Kk=new Dk(Pt,Y),Yk=new Ev(At,gi,Ir,Kk,Y),Ch=new Uw(Pe,Y),kh=new Hw(At,Pe,[new kl(Ho,new Ww(Ch,Y),Y)],Y),qk=new zw(At,Pe,[new kl(Ho,Ch,Y)],Y),Xk=new jw(kh),Uo=new Qw(Pt,Ir,Wl,Y),Jk=new hk(Uo,Pe,At,Y),Qk=new pk(Pt,Pe,gi,Uo,Go,$k,new Rw(new Lw(Dr,Y),Y),yh,Y),Zk=new kk(Pt,Y),eS=new ok(Uo,Zk,Y),Sh=new nC,xh=new nk(Pt,eS,Sh,Y),tS=new tk(Pt,Pe,Kl,Sh,Y),nS=new uk(Kl,Pt,Dr,Y),rS=new Av(Go,At,gi,xh,Y),iS=new mk(Pe,Ir,Pt,Y),sS=new tC(Go,Pe,gi,Y),oS=new wv(Pe,En,Y),aS=new Ov(gi),lS=new lk,Yl=new Tv(En,Y),cS=new sk(Yl,Pe,Y),uS=new Pw(En,Y),fS=new Kw(Yl,Pe,Y),dS=new xk(zo,Y),hS=new ck(Pe,Y),_h=new Rk(Pt,Ir,Dr,wh,Y),pS=new yk(_h),mS=new bk(_h,Y),gS=new Yw(At,Y),yS=new vv(Pe,At,En,Y),bS=new Bw(At,Dr,Pt,Y),Eh=new fi;new Sk(Eh);const vS={mapCurrentID:En,mapFile:Pe,mapCurrent:At,mapCurrentSource:jk,mapRemoved:oS,mapSettings:Hk,mapObject:gi,mapObjectRemoved:Wk,mapType:kh,mapTypeRemoved:qk,mapTypeNew:Xk,mapObjectsVisible:Uo,mapObjectCurrent:Go,mapObjectNew:Yk,mapObjectsLink:rS,mapTypeCurrent:zk,mapRects:Qk,mapBackground:Uk,mapObjectArrows:tS,mapObjectsGeometryFix:Jk,canvas:Ir,miniMap:nS,notification:Ho,modal:Fk,drawer:bh,konvaLayer:Pt,resizing:iS,objectAdditionalFieldsFix:sS,mapObjectRelationRemoved:aS,fps:lS,breadcrumbs:cS,mapObjectUrl:uS,keyboard:zo,parentNames:Yl,parentTypes:fS,controlCombo:dS,menu:hS,stagePosition:pS,stagePositionByObjectId:mS,objectsMatchedToQuery:gS,stageSize:Dr,mapHistory:yS,fileContent:vh,newArrow:xh,objectsOutsideScreen:bS,settings:yh,documentTitle:Vk,sidebarDraggable:Eh},Fe=()=>vS;class ae{constructor(e=void 0){X(this,"innerRef");this.innerRef=f.ref(e)}get value(){return this.innerRef.value}ref(){return this.innerRef}give(e){return this.innerRef.value=e,this}introduction(){return"patron"}}/**
* @vue/shared v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function wS(n){const e=Object.create(null);for(const t of n.split(","))e[t]=1;return t=>t in e}const ql={},Wo=()=>{},Th=Object.assign,CS=Object.prototype.hasOwnProperty,Xl=(n,e)=>CS.call(n,e),Xt=Array.isArray,xs=n=>Ko(n)==="[object Map]",kS=n=>Ko(n)==="[object Set]",qn=n=>typeof n=="function",SS=n=>typeof n=="string",_s=n=>typeof n=="symbol",yi=n=>n!==null&&typeof n=="object",xS=n=>(yi(n)||qn(n))&&qn(n.then)&&qn(n.catch),_S=Object.prototype.toString,Ko=n=>_S.call(n),ES=n=>Ko(n).slice(8,-1),TS=n=>Ko(n)==="[object Object]",Jl=n=>SS(n)&&n!=="NaN"&&n[0]!=="-"&&""+parseInt(n,10)===n,Xn=(n,e)=>!Object.is(n,e);let Oh;const Ql=()=>Oh||(Oh=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});/**
* @vue/reactivity v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Te;const Zl=new WeakSet;class OS{constructor(e){this.fn=e,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,Zl.has(this)&&(Zl.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||Mh(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,Lh(this),Ah(this);const e=Te,t=Jt;Te=this,Jt=!0;try{return this.fn()}finally{Ph(this),Te=e,Jt=t,this.flags&=-3}}stop(){if(this.flags&1){for(let e=this.deps;e;e=e.nextDep)rc(e);this.deps=this.depsTail=void 0,Lh(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?Zl.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){nc(this)&&this.run()}get dirty(){return nc(this)}}let Nh=0,Es,Ts;function Mh(n,e=!1){if(n.flags|=8,e){n.next=Ts,Ts=n;return}n.next=Es,Es=n}function ec(){Nh++}function tc(){if(--Nh>0)return;if(Ts){let e=Ts;for(Ts=void 0;e;){const t=e.next;e.next=void 0,e.flags&=-9,e=t}}let n;for(;Es;){let e=Es;for(Es=void 0;e;){const t=e.next;if(e.next=void 0,e.flags&=-9,e.flags&1)try{e.trigger()}catch(r){n||(n=r)}e=t}}if(n)throw n}function Ah(n){for(let e=n.deps;e;e=e.nextDep)e.version=-1,e.prevActiveLink=e.dep.activeLink,e.dep.activeLink=e}function Ph(n){let e,t=n.depsTail,r=t;for(;r;){const i=r.prevDep;r.version===-1?(r===t&&(t=i),rc(r),NS(r)):e=r,r.dep.activeLink=r.prevActiveLink,r.prevActiveLink=void 0,r=i}n.deps=e,n.depsTail=t}function nc(n){for(let e=n.deps;e;e=e.nextDep)if(e.dep.version!==e.version||e.dep.computed&&(Ih(e.dep.computed)||e.dep.version!==e.version))return!0;return!!n._dirty}function Ih(n){if(n.flags&4&&!(n.flags&16)||(n.flags&=-17,n.globalVersion===Os))return;n.globalVersion=Os;const e=n.dep;if(n.flags|=2,e.version>0&&!n.isSSR&&n.deps&&!nc(n)){n.flags&=-3;return}const t=Te,r=Jt;Te=n,Jt=!0;try{Ah(n);const i=n.fn(n._value);(e.version===0||Xn(i,n._value))&&(n._value=i,e.version++)}catch(i){throw e.version++,i}finally{Te=t,Jt=r,Ph(n),n.flags&=-3}}function rc(n,e=!1){const{dep:t,prevSub:r,nextSub:i}=n;if(r&&(r.nextSub=i,n.prevSub=void 0),i&&(i.prevSub=r,n.nextSub=void 0),t.subs===n&&(t.subs=r,!r&&t.computed)){t.computed.flags&=-5;for(let s=t.computed.deps;s;s=s.nextDep)rc(s,!0)}!e&&!--t.sc&&t.map&&t.map.delete(t.key)}function NS(n){const{prevDep:e,nextDep:t}=n;e&&(e.nextDep=t,n.prevDep=void 0),t&&(t.prevDep=e,n.nextDep=void 0)}let Jt=!0;const Dh=[];function ic(){Dh.push(Jt),Jt=!1}function sc(){const n=Dh.pop();Jt=n===void 0?!0:n}function Lh(n){const{cleanup:e}=n;if(n.cleanup=void 0,e){const t=Te;Te=void 0;try{e()}finally{Te=t}}}let Os=0;class MS{constructor(e,t){this.sub=e,this.dep=t,this.version=t.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class oc{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0}track(e){if(!Te||!Jt||Te===this.computed)return;let t=this.activeLink;if(t===void 0||t.sub!==Te)t=this.activeLink=new MS(Te,this),Te.deps?(t.prevDep=Te.depsTail,Te.depsTail.nextDep=t,Te.depsTail=t):Te.deps=Te.depsTail=t,Rh(t);else if(t.version===-1&&(t.version=this.version,t.nextDep)){const r=t.nextDep;r.prevDep=t.prevDep,t.prevDep&&(t.prevDep.nextDep=r),t.prevDep=Te.depsTail,t.nextDep=void 0,Te.depsTail.nextDep=t,Te.depsTail=t,Te.deps===t&&(Te.deps=r)}return t}trigger(e){this.version++,Os++,this.notify(e)}notify(e){ec();try{for(let t=this.subs;t;t=t.prevSub)t.sub.notify()&&t.sub.dep.notify()}finally{tc()}}}function Rh(n){if(n.dep.sc++,n.sub.flags&4){const e=n.dep.computed;if(e&&!n.dep.subs){e.flags|=20;for(let r=e.deps;r;r=r.nextDep)Rh(r)}const t=n.dep.subs;t!==n&&(n.prevSub=t,t&&(t.nextSub=n)),n.dep.subs=n}}const ac=new WeakMap,Lr=Symbol(""),lc=Symbol(""),Ns=Symbol("");function bt(n,e,t){if(Jt&&Te){let r=ac.get(n);r||ac.set(n,r=new Map);let i=r.get(t);i||(r.set(t,i=new oc),i.map=r,i.key=t),i.track()}}function Jn(n,e,t,r,i,s){const o=ac.get(n);if(!o){Os++;return}const a=l=>{l&&l.trigger()};if(ec(),e==="clear")o.forEach(a);else{const l=Xt(n),c=l&&Jl(t);if(l&&t==="length"){const u=Number(r);o.forEach((d,h)=>{(h==="length"||h===Ns||!_s(h)&&h>=u)&&a(d)})}else switch((t!==void 0||o.has(void 0))&&a(o.get(t)),c&&a(o.get(Ns)),e){case"add":l?c&&a(o.get("length")):(a(o.get(Lr)),xs(n)&&a(o.get(lc)));break;case"delete":l||(a(o.get(Lr)),xs(n)&&a(o.get(lc)));break;case"set":xs(n)&&a(o.get(Lr));break}}tc()}function bi(n){const e=Ce(n);return e===n?e:(bt(e,"iterate",Ns),Qt(n)?e:e.map(lt))}function cc(n){return bt(n=Ce(n),"iterate",Ns),n}const AS={__proto__:null,[Symbol.iterator](){return uc(this,Symbol.iterator,lt)},concat(...n){return bi(this).concat(...n.map(e=>Xt(e)?bi(e):e))},entries(){return uc(this,"entries",n=>(n[1]=lt(n[1]),n))},every(n,e){return Tn(this,"every",n,e,void 0,arguments)},filter(n,e){return Tn(this,"filter",n,e,t=>t.map(lt),arguments)},find(n,e){return Tn(this,"find",n,e,lt,arguments)},findIndex(n,e){return Tn(this,"findIndex",n,e,void 0,arguments)},findLast(n,e){return Tn(this,"findLast",n,e,lt,arguments)},findLastIndex(n,e){return Tn(this,"findLastIndex",n,e,void 0,arguments)},forEach(n,e){return Tn(this,"forEach",n,e,void 0,arguments)},includes(...n){return fc(this,"includes",n)},indexOf(...n){return fc(this,"indexOf",n)},join(n){return bi(this).join(n)},lastIndexOf(...n){return fc(this,"lastIndexOf",n)},map(n,e){return Tn(this,"map",n,e,void 0,arguments)},pop(){return Ms(this,"pop")},push(...n){return Ms(this,"push",n)},reduce(n,...e){return Fh(this,"reduce",n,e)},reduceRight(n,...e){return Fh(this,"reduceRight",n,e)},shift(){return Ms(this,"shift")},some(n,e){return Tn(this,"some",n,e,void 0,arguments)},splice(...n){return Ms(this,"splice",n)},toReversed(){return bi(this).toReversed()},toSorted(n){return bi(this).toSorted(n)},toSpliced(...n){return bi(this).toSpliced(...n)},unshift(...n){return Ms(this,"unshift",n)},values(){return uc(this,"values",lt)}};function uc(n,e,t){const r=cc(n),i=r[e]();return r!==n&&!Qt(n)&&(i._next=i.next,i.next=()=>{const s=i._next();return s.value&&(s.value=t(s.value)),s}),i}const PS=Array.prototype;function Tn(n,e,t,r,i,s){const o=cc(n),a=o!==n&&!Qt(n),l=o[e];if(l!==PS[e]){const d=l.apply(n,s);return a?lt(d):d}let c=t;o!==n&&(a?c=function(d,h){return t.call(this,lt(d),h,n)}:t.length>2&&(c=function(d,h){return t.call(this,d,h,n)}));const u=l.call(o,c,r);return a&&i?i(u):u}function Fh(n,e,t,r){const i=cc(n);let s=t;return i!==n&&(Qt(n)?t.length>3&&(s=function(o,a,l){return t.call(this,o,a,l,n)}):s=function(o,a,l){return t.call(this,o,lt(a),l,n)}),i[e](s,...r)}function fc(n,e,t){const r=Ce(n);bt(r,"iterate",Ns);const i=r[e](...t);return(i===-1||i===!1)&&KS(t[0])?(t[0]=Ce(t[0]),r[e](...t)):i}function Ms(n,e,t=[]){ic(),ec();const r=Ce(n)[e].apply(n,t);return tc(),sc(),r}const IS=wS("__proto__,__v_isRef,__isVue"),Bh=new Set(Object.getOwnPropertyNames(Symbol).filter(n=>n!=="arguments"&&n!=="caller").map(n=>Symbol[n]).filter(_s));function DS(n){_s(n)||(n=String(n));const e=Ce(this);return bt(e,"has",n),e.hasOwnProperty(n)}class Vh{constructor(e=!1,t=!1){this._isReadonly=e,this._isShallow=t}get(e,t,r){if(t==="__v_skip")return e.__v_skip;const i=this._isReadonly,s=this._isShallow;if(t==="__v_isReactive")return!i;if(t==="__v_isReadonly")return i;if(t==="__v_isShallow")return s;if(t==="__v_raw")return r===(i?s?GS:zh:s?HS:jh).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(r)?e:void 0;const o=Xt(e);if(!i){let l;if(o&&(l=AS[t]))return l;if(t==="hasOwnProperty")return DS}const a=Reflect.get(e,t,On(e)?e:r);return(_s(t)?Bh.has(t):IS(t))||(i||bt(e,"get",t),s)?a:On(a)?o&&Jl(t)?a:a.value:yi(a)?i?Gh(a):Hh(a):a}}class LS extends Vh{constructor(e=!1){super(!1,e)}set(e,t,r,i){let s=e[t];if(!this._isShallow){const l=Rr(s);if(!Qt(r)&&!Rr(r)&&(s=Ce(s),r=Ce(r)),!Xt(e)&&On(s)&&!On(r))return l?!1:(s.value=r,!0)}const o=Xt(e)&&Jl(t)?Number(t)<e.length:Xl(e,t),a=Reflect.set(e,t,r,On(e)?e:i);return e===Ce(i)&&(o?Xn(r,s)&&Jn(e,"set",t,r):Jn(e,"add",t,r)),a}deleteProperty(e,t){const r=Xl(e,t);e[t];const i=Reflect.deleteProperty(e,t);return i&&r&&Jn(e,"delete",t,void 0),i}has(e,t){const r=Reflect.has(e,t);return(!_s(t)||!Bh.has(t))&&bt(e,"has",t),r}ownKeys(e){return bt(e,"iterate",Xt(e)?"length":Lr),Reflect.ownKeys(e)}}class RS extends Vh{constructor(e=!1){super(!0,e)}set(e,t){return!0}deleteProperty(e,t){return!0}}const FS=new LS,BS=new RS,dc=n=>n,Yo=n=>Reflect.getPrototypeOf(n);function VS(n,e,t){return function(...r){const i=this.__v_raw,s=Ce(i),o=xs(s),a=n==="entries"||n===Symbol.iterator&&o,l=n==="keys"&&o,c=i[n](...r),u=t?dc:e?hc:lt;return!e&&bt(s,"iterate",l?lc:Lr),{next(){const{value:d,done:h}=c.next();return h?{value:d,done:h}:{value:a?[u(d[0]),u(d[1])]:u(d),done:h}},[Symbol.iterator](){return this}}}}function qo(n){return function(...e){return n==="delete"?!1:n==="clear"?void 0:this}}function $S(n,e){const t={get(i){const s=this.__v_raw,o=Ce(s),a=Ce(i);n||(Xn(i,a)&&bt(o,"get",i),bt(o,"get",a));const{has:l}=Yo(o),c=e?dc:n?hc:lt;if(l.call(o,i))return c(s.get(i));if(l.call(o,a))return c(s.get(a));s!==o&&s.get(i)},get size(){const i=this.__v_raw;return!n&&bt(Ce(i),"iterate",Lr),Reflect.get(i,"size",i)},has(i){const s=this.__v_raw,o=Ce(s),a=Ce(i);return n||(Xn(i,a)&&bt(o,"has",i),bt(o,"has",a)),i===a?s.has(i):s.has(i)||s.has(a)},forEach(i,s){const o=this,a=o.__v_raw,l=Ce(a),c=e?dc:n?hc:lt;return!n&&bt(l,"iterate",Lr),a.forEach((u,d)=>i.call(s,c(u),c(d),o))}};return Th(t,n?{add:qo("add"),set:qo("set"),delete:qo("delete"),clear:qo("clear")}:{add(i){!e&&!Qt(i)&&!Rr(i)&&(i=Ce(i));const s=Ce(this);return Yo(s).has.call(s,i)||(s.add(i),Jn(s,"add",i,i)),this},set(i,s){!e&&!Qt(s)&&!Rr(s)&&(s=Ce(s));const o=Ce(this),{has:a,get:l}=Yo(o);let c=a.call(o,i);c||(i=Ce(i),c=a.call(o,i));const u=l.call(o,i);return o.set(i,s),c?Xn(s,u)&&Jn(o,"set",i,s):Jn(o,"add",i,s),this},delete(i){const s=Ce(this),{has:o,get:a}=Yo(s);let l=o.call(s,i);l||(i=Ce(i),l=o.call(s,i)),a&&a.call(s,i);const c=s.delete(i);return l&&Jn(s,"delete",i,void 0),c},clear(){const i=Ce(this),s=i.size!==0,o=i.clear();return s&&Jn(i,"clear",void 0,void 0),o}}),["keys","values","entries",Symbol.iterator].forEach(i=>{t[i]=VS(i,n,e)}),t}function $h(n,e){const t=$S(n,e);return(r,i,s)=>i==="__v_isReactive"?!n:i==="__v_isReadonly"?n:i==="__v_raw"?r:Reflect.get(Xl(t,i)&&i in r?t:r,i,s)}const jS={get:$h(!1,!1)},zS={get:$h(!0,!1)},jh=new WeakMap,HS=new WeakMap,zh=new WeakMap,GS=new WeakMap;function US(n){switch(n){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function WS(n){return n.__v_skip||!Object.isExtensible(n)?0:US(ES(n))}function Hh(n){return Rr(n)?n:Uh(n,!1,FS,jS,jh)}function Gh(n){return Uh(n,!0,BS,zS,zh)}function Uh(n,e,t,r,i){if(!yi(n)||n.__v_raw&&!(e&&n.__v_isReactive))return n;const s=i.get(n);if(s)return s;const o=WS(n);if(o===0)return n;const a=new Proxy(n,o===2?r:t);return i.set(n,a),a}function Xo(n){return Rr(n)?Xo(n.__v_raw):!!(n&&n.__v_isReactive)}function Rr(n){return!!(n&&n.__v_isReadonly)}function Qt(n){return!!(n&&n.__v_isShallow)}function KS(n){return n?!!n.__v_raw:!1}function Ce(n){const e=n&&n.__v_raw;return e?Ce(e):n}const lt=n=>yi(n)?Hh(n):n,hc=n=>yi(n)?Gh(n):n;function On(n){return n?n.__v_isRef===!0:!1}function Jo(n){return YS(n,!1)}function YS(n,e){return On(n)?n:new qS(n,e)}class qS{constructor(e,t){this.dep=new oc,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=t?e:Ce(e),this._value=t?e:lt(e),this.__v_isShallow=t}get value(){return this.dep.track(),this._value}set value(e){const t=this._rawValue,r=this.__v_isShallow||Qt(e)||Rr(e);e=r?e:Ce(e),Xn(e,t)&&(this._rawValue=e,this._value=r?e:lt(e),this.dep.trigger())}}class XS{constructor(e,t,r){this.fn=e,this.setter=t,this._value=void 0,this.dep=new oc(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=Os-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!t,this.isSSR=r}notify(){if(this.flags|=16,!(this.flags&8)&&Te!==this)return Mh(this,!0),!0}get value(){const e=this.dep.track();return Ih(this),e&&(e.version=this.dep.version),this._value}set value(e){this.setter&&this.setter(e)}}function JS(n,e,t=!1){let r,i;return qn(n)?r=n:(r=n.get,i=n.set),new XS(r,i,t)}const Qo={},Zo=new WeakMap;let Fr;function QS(n,e=!1,t=Fr){if(t){let r=Zo.get(t);r||Zo.set(t,r=[]),r.push(n)}}function ZS(n,e,t=ql){const{immediate:r,deep:i,once:s,scheduler:o,augmentJob:a,call:l}=t,c=w=>i?w:Qt(w)||i===!1||i===0?Qn(w,1):Qn(w);let u,d,h,m,p=!1,g=!1;if(On(n)?(d=()=>n.value,p=Qt(n)):Xo(n)?(d=()=>c(n),p=!0):Xt(n)?(g=!0,p=n.some(w=>Xo(w)||Qt(w)),d=()=>n.map(w=>{if(On(w))return w.value;if(Xo(w))return c(w);if(qn(w))return l?l(w,2):w()})):qn(n)?e?d=l?()=>l(n,2):n:d=()=>{if(h){ic();try{h()}finally{sc()}}const w=Fr;Fr=u;try{return l?l(n,3,[m]):n(m)}finally{Fr=w}}:d=Wo,e&&i){const w=d,b=i===!0?1/0:i;d=()=>Qn(w(),b)}const y=()=>{u.stop()};if(s&&e){const w=e;e=(...b)=>{w(...b),y()}}let v=g?new Array(n.length).fill(Qo):Qo;const C=w=>{if(!(!(u.flags&1)||!u.dirty&&!w))if(e){const b=u.run();if(i||p||(g?b.some((E,k)=>Xn(E,v[k])):Xn(b,v))){h&&h();const E=Fr;Fr=u;try{const k=[b,v===Qo?void 0:g&&v[0]===Qo?[]:v,m];l?l(e,3,k):e(...k),v=b}finally{Fr=E}}}else u.run()};return a&&a(C),u=new OS(d),u.scheduler=o?()=>o(C,!1):C,m=w=>QS(w,!1,u),h=u.onStop=()=>{const w=Zo.get(u);if(w){if(l)l(w,4);else for(const b of w)b();Zo.delete(u)}},e?r?C(!0):v=u.run():o?o(C.bind(null,!0),!0):u.run(),y.pause=u.pause.bind(u),y.resume=u.resume.bind(u),y.stop=y,y}function Qn(n,e=1/0,t){if(e<=0||!yi(n)||n.__v_skip||(t=t||new Set,t.has(n)))return n;if(t.add(n),e--,On(n))Qn(n.value,e,t);else if(Xt(n))for(let r=0;r<n.length;r++)Qn(n[r],e,t);else if(kS(n)||xs(n))n.forEach(r=>{Qn(r,e,t)});else if(TS(n)){for(const r in n)Qn(n[r],e,t);for(const r of Object.getOwnPropertySymbols(n))Object.prototype.propertyIsEnumerable.call(n,r)&&Qn(n[r],e,t)}return n}const ex={key:0},tx={class:"flex-grow overflow-y-auto"},nx={key:1,class:"flex gap-1"},pc=f.defineComponent({__name:"BaseDrawer",props:{name:{type:String,required:!0},direction:{type:String,default:"ltr",validator:n=>["ltr","rtl","ttb","btt"].includes(n)}},emits:["close"],setup(n,{emit:e}){const t=n,r=e,i=JS(()=>["e2e-drawer-back absolute z-10 top-0 left-0 w-full h-full bg-black/50"]),s={ltr:"top-0 left-0 w-[50%] max-w-[900px] ",rtl:"top-0 right-0 w-[50%] max-w-[900px] ",ttb:"top-0 right-0 left-0",btt:"top-auto h-[900px] max-h-[50%] bottom-0 right-0 left-0"},{drawer:o}=Fe(),a=()=>{o.give(""),r("close")},l=o.isOpenedByName(t.name,new ae).ref();return(c,u)=>(f.openBlock(),f.createBlock(f.Transition,{name:"fade"},{default:f.withCtx(()=>[f.unref(l)?(f.openBlock(),f.createElementBlock("div",{key:0,class:f.normalizeClass(f.unref(i)),onClick:a},[f.createElementVNode("div",{class:f.normalizeClass(["absolute bg-white h-full p-3 flex flex-col overflow-hidden",s[n.direction]]),onClick:u[0]||(u[0]=f.withModifiers(()=>{},["stop"]))},[c.$slots.header?(f.openBlock(),f.createElementBlock("div",ex,[f.renderSlot(c.$slots,"header",{class:"BaseDrawer-Header"})])):f.createCommentVNode("",!0),f.createElementVNode("div",tx,[f.renderSlot(c.$slots,"default")]),c.$slots.footer?(f.openBlock(),f.createElementBlock("div",nx,[f.renderSlot(c.$slots,"footer")])):f.createCommentVNode("",!0)],2)],2)):f.createCommentVNode("",!0)]),_:3}))}}),Wh=()=>{};let mc={},Kh={},Yh=null,qh={mark:Wh,measure:Wh};try{typeof window<"u"&&(mc=window),typeof document<"u"&&(Kh=document),typeof MutationObserver<"u"&&(Yh=MutationObserver),typeof performance<"u"&&(qh=performance)}catch{}const{userAgent:Xh=""}=mc.navigator||{},Zn=mc,Ne=Kh,Jh=Yh,ea=qh;Zn.document;const Nn=!!Ne.documentElement&&!!Ne.head&&typeof Ne.addEventListener=="function"&&typeof Ne.createElement=="function",Qh=~Xh.indexOf("MSIE")||~Xh.indexOf("Trident/");var Me="classic",Zh="duotone",xt="sharp",_t="sharp-duotone",rx=[Me,Zh,xt,_t],ix={classic:{900:"fas",400:"far",normal:"far",300:"fal",100:"fat"},sharp:{900:"fass",400:"fasr",300:"fasl",100:"fast"},"sharp-duotone":{900:"fasds"}},ep={kit:{fak:"kit","fa-kit":"kit"},"kit-duotone":{fakd:"kit-duotone","fa-kit-duotone":"kit-duotone"}},sx=["kit"],ox=/fa(s|r|l|t|d|b|k|kd|ss|sr|sl|st|sds)?[\-\ ]/,ax=/Font ?Awesome ?([56 ]*)(Solid|Regular|Light|Thin|Duotone|Brands|Free|Pro|Sharp Duotone|Sharp|Kit)?.*/i,lx={"Font Awesome 5 Free":{900:"fas",400:"far"},"Font Awesome 5 Pro":{900:"fas",400:"far",normal:"far",300:"fal"},"Font Awesome 5 Brands":{400:"fab",normal:"fab"},"Font Awesome 5 Duotone":{900:"fad"}},cx={"Font Awesome 6 Free":{900:"fas",400:"far"},"Font Awesome 6 Pro":{900:"fas",400:"far",normal:"far",300:"fal",100:"fat"},"Font Awesome 6 Brands":{400:"fab",normal:"fab"},"Font Awesome 6 Duotone":{900:"fad"},"Font Awesome 6 Sharp":{900:"fass",400:"fasr",normal:"fasr",300:"fasl",100:"fast"},"Font Awesome 6 Sharp Duotone":{900:"fasds"}},ux={classic:{"fa-brands":"fab","fa-duotone":"fad","fa-light":"fal","fa-regular":"far","fa-solid":"fas","fa-thin":"fat"},sharp:{"fa-solid":"fass","fa-regular":"fasr","fa-light":"fasl","fa-thin":"fast"},"sharp-duotone":{"fa-solid":"fasds"}},fx={classic:["fas","far","fal","fat"],sharp:["fass","fasr","fasl","fast"],"sharp-duotone":["fasds"]},dx={classic:{fab:"fa-brands",fad:"fa-duotone",fal:"fa-light",far:"fa-regular",fas:"fa-solid",fat:"fa-thin"},sharp:{fass:"fa-solid",fasr:"fa-regular",fasl:"fa-light",fast:"fa-thin"},"sharp-duotone":{fasds:"fa-solid"}},hx={classic:{solid:"fas",regular:"far",light:"fal",thin:"fat",duotone:"fad",brands:"fab"},sharp:{solid:"fass",regular:"fasr",light:"fasl",thin:"fast"},"sharp-duotone":{solid:"fasds"}},tp={classic:{fa:"solid",fas:"solid","fa-solid":"solid",far:"regular","fa-regular":"regular",fal:"light","fa-light":"light",fat:"thin","fa-thin":"thin",fad:"duotone","fa-duotone":"duotone",fab:"brands","fa-brands":"brands"},sharp:{fa:"solid",fass:"solid","fa-solid":"solid",fasr:"regular","fa-regular":"regular",fasl:"light","fa-light":"light",fast:"thin","fa-thin":"thin"},"sharp-duotone":{fa:"solid",fasds:"solid","fa-solid":"solid"}},px=["solid","regular","light","thin","duotone","brands"],np=[1,2,3,4,5,6,7,8,9,10],mx=np.concat([11,12,13,14,15,16,17,18,19,20]),As={GROUP:"duotone-group",SWAP_OPACITY:"swap-opacity",PRIMARY:"primary",SECONDARY:"secondary"},gx=[...Object.keys(fx),...px,"2xs","xs","sm","lg","xl","2xl","beat","border","fade","beat-fade","bounce","flip-both","flip-horizontal","flip-vertical","flip","fw","inverse","layers-counter","layers-text","layers","li","pull-left","pull-right","pulse","rotate-180","rotate-270","rotate-90","rotate-by","shake","spin-pulse","spin-reverse","spin","stack-1x","stack-2x","stack","ul",As.GROUP,As.SWAP_OPACITY,As.PRIMARY,As.SECONDARY].concat(np.map(n=>"".concat(n,"x"))).concat(mx.map(n=>"w-".concat(n))),yx={"Font Awesome Kit":{400:"fak",normal:"fak"},"Font Awesome Kit Duotone":{400:"fakd",normal:"fakd"}},bx={kit:{"fa-kit":"fak"},"kit-duotone":{"fa-kit-duotone":"fakd"}},vx={kit:{fak:"fa-kit"},"kit-duotone":{fakd:"fa-kit-duotone"}},rp={kit:{kit:"fak"},"kit-duotone":{"kit-duotone":"fakd"}};const Mn="___FONT_AWESOME___",gc=16,ip="fa",sp="svg-inline--fa",Br="data-fa-i2svg",yc="data-fa-pseudo-element",wx="data-fa-pseudo-element-pending",bc="data-prefix",vc="data-icon",op="fontawesome-i2svg",Cx="async",kx=["HTML","HEAD","STYLE","SCRIPT"],ap=(()=>{try{return!0}catch{return!1}})(),lp=[Me,xt,_t];function Ps(n){return new Proxy(n,{get(e,t){return t in e?e[t]:e[Me]}})}const cp={...tp};cp[Me]={...tp[Me],...ep.kit,...ep["kit-duotone"]};const Vr=Ps(cp),wc={...hx};wc[Me]={...wc[Me],...rp.kit,...rp["kit-duotone"]};const Is=Ps(wc),Cc={...dx};Cc[Me]={...Cc[Me],...vx.kit};const $r=Ps(Cc),kc={...ux};kc[Me]={...kc[Me],...bx.kit};const Sx=Ps(kc),xx=ox,up="fa-layers-text",_x=ax,Ex={...ix};Ps(Ex);const Tx=["class","data-prefix","data-icon","data-fa-transform","data-fa-mask"],Sc=As,vi=new Set;Object.keys(Is[Me]).map(vi.add.bind(vi)),Object.keys(Is[xt]).map(vi.add.bind(vi)),Object.keys(Is[_t]).map(vi.add.bind(vi));const Ox=[...sx,...gx],Ds=Zn.FontAwesomeConfig||{};function Nx(n){var e=Ne.querySelector("script["+n+"]");if(e)return e.getAttribute(n)}function Mx(n){return n===""?!0:n==="false"?!1:n==="true"?!0:n}Ne&&typeof Ne.querySelector=="function"&&[["data-family-prefix","familyPrefix"],["data-css-prefix","cssPrefix"],["data-family-default","familyDefault"],["data-style-default","styleDefault"],["data-replacement-class","replacementClass"],["data-auto-replace-svg","autoReplaceSvg"],["data-auto-add-css","autoAddCss"],["data-auto-a11y","autoA11y"],["data-search-pseudo-elements","searchPseudoElements"],["data-observe-mutations","observeMutations"],["data-mutate-approach","mutateApproach"],["data-keep-original-source","keepOriginalSource"],["data-measure-performance","measurePerformance"],["data-show-missing-icons","showMissingIcons"]].forEach(e=>{let[t,r]=e;const i=Mx(Nx(t));i!=null&&(Ds[r]=i)});const fp={styleDefault:"solid",familyDefault:"classic",cssPrefix:ip,replacementClass:sp,autoReplaceSvg:!0,autoAddCss:!0,autoA11y:!0,searchPseudoElements:!1,observeMutations:!0,mutateApproach:"async",keepOriginalSource:!0,measurePerformance:!1,showMissingIcons:!0};Ds.familyPrefix&&(Ds.cssPrefix=Ds.familyPrefix);const wi={...fp,...Ds};wi.autoReplaceSvg||(wi.observeMutations=!1);const G={};Object.keys(fp).forEach(n=>{Object.defineProperty(G,n,{enumerable:!0,set:function(e){wi[n]=e,Ls.forEach(t=>t(G))},get:function(){return wi[n]}})}),Object.defineProperty(G,"familyPrefix",{enumerable:!0,set:function(n){wi.cssPrefix=n,Ls.forEach(e=>e(G))},get:function(){return wi.cssPrefix}}),Zn.FontAwesomeConfig=G;const Ls=[];function Ax(n){return Ls.push(n),()=>{Ls.splice(Ls.indexOf(n),1)}}const er=gc,un={size:16,x:0,y:0,rotate:0,flipX:!1,flipY:!1};function Px(n){if(!n||!Nn)return;const e=Ne.createElement("style");e.setAttribute("type","text/css"),e.innerHTML=n;const t=Ne.head.childNodes;let r=null;for(let i=t.length-1;i>-1;i--){const s=t[i],o=(s.tagName||"").toUpperCase();["STYLE","LINK"].indexOf(o)>-1&&(r=s)}return Ne.head.insertBefore(e,r),n}const Ix="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";function Rs(){let n=12,e="";for(;n-- >0;)e+=Ix[Math.random()*62|0];return e}function Ci(n){const e=[];for(let t=(n||[]).length>>>0;t--;)e[t]=n[t];return e}function xc(n){return n.classList?Ci(n.classList):(n.getAttribute("class")||"").split(" ").filter(e=>e)}function dp(n){return"".concat(n).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function Dx(n){return Object.keys(n||{}).reduce((e,t)=>e+"".concat(t,'="').concat(dp(n[t]),'" '),"").trim()}function ta(n){return Object.keys(n||{}).reduce((e,t)=>e+"".concat(t,": ").concat(n[t].trim(),";"),"")}function _c(n){return n.size!==un.size||n.x!==un.x||n.y!==un.y||n.rotate!==un.rotate||n.flipX||n.flipY}function Lx(n){let{transform:e,containerWidth:t,iconWidth:r}=n;const i={transform:"translate(".concat(t/2," 256)")},s="translate(".concat(e.x*32,", ").concat(e.y*32,") "),o="scale(".concat(e.size/16*(e.flipX?-1:1),", ").concat(e.size/16*(e.flipY?-1:1),") "),a="rotate(".concat(e.rotate," 0 0)"),l={transform:"".concat(s," ").concat(o," ").concat(a)},c={transform:"translate(".concat(r/2*-1," -256)")};return{outer:i,inner:l,path:c}}function Rx(n){let{transform:e,width:t=gc,height:r=gc,startCentered:i=!1}=n,s="";return i&&Qh?s+="translate(".concat(e.x/er-t/2,"em, ").concat(e.y/er-r/2,"em) "):i?s+="translate(calc(-50% + ".concat(e.x/er,"em), calc(-50% + ").concat(e.y/er,"em)) "):s+="translate(".concat(e.x/er,"em, ").concat(e.y/er,"em) "),s+="scale(".concat(e.size/er*(e.flipX?-1:1),", ").concat(e.size/er*(e.flipY?-1:1),") "),s+="rotate(".concat(e.rotate,"deg) "),s}var Fx=`:root, :host {
  --fa-font-solid: normal 900 1em/1 "Font Awesome 6 Free";
  --fa-font-regular: normal 400 1em/1 "Font Awesome 6 Free";
  --fa-font-light: normal 300 1em/1 "Font Awesome 6 Pro";
  --fa-font-thin: normal 100 1em/1 "Font Awesome 6 Pro";
  --fa-font-duotone: normal 900 1em/1 "Font Awesome 6 Duotone";
  --fa-font-brands: normal 400 1em/1 "Font Awesome 6 Brands";
  --fa-font-sharp-solid: normal 900 1em/1 "Font Awesome 6 Sharp";
  --fa-font-sharp-regular: normal 400 1em/1 "Font Awesome 6 Sharp";
  --fa-font-sharp-light: normal 300 1em/1 "Font Awesome 6 Sharp";
  --fa-font-sharp-thin: normal 100 1em/1 "Font Awesome 6 Sharp";
  --fa-font-sharp-duotone-solid: normal 900 1em/1 "Font Awesome 6 Sharp Duotone";
}

svg:not(:root).svg-inline--fa, svg:not(:host).svg-inline--fa {
  overflow: visible;
  box-sizing: content-box;
}

.svg-inline--fa {
  display: var(--fa-display, inline-block);
  height: 1em;
  overflow: visible;
  vertical-align: -0.125em;
}
.svg-inline--fa.fa-2xs {
  vertical-align: 0.1em;
}
.svg-inline--fa.fa-xs {
  vertical-align: 0em;
}
.svg-inline--fa.fa-sm {
  vertical-align: -0.0714285705em;
}
.svg-inline--fa.fa-lg {
  vertical-align: -0.2em;
}
.svg-inline--fa.fa-xl {
  vertical-align: -0.25em;
}
.svg-inline--fa.fa-2xl {
  vertical-align: -0.3125em;
}
.svg-inline--fa.fa-pull-left {
  margin-right: var(--fa-pull-margin, 0.3em);
  width: auto;
}
.svg-inline--fa.fa-pull-right {
  margin-left: var(--fa-pull-margin, 0.3em);
  width: auto;
}
.svg-inline--fa.fa-li {
  width: var(--fa-li-width, 2em);
  top: 0.25em;
}
.svg-inline--fa.fa-fw {
  width: var(--fa-fw-width, 1.25em);
}

.fa-layers svg.svg-inline--fa {
  bottom: 0;
  left: 0;
  margin: auto;
  position: absolute;
  right: 0;
  top: 0;
}

.fa-layers-counter, .fa-layers-text {
  display: inline-block;
  position: absolute;
  text-align: center;
}

.fa-layers {
  display: inline-block;
  height: 1em;
  position: relative;
  text-align: center;
  vertical-align: -0.125em;
  width: 1em;
}
.fa-layers svg.svg-inline--fa {
  transform-origin: center center;
}

.fa-layers-text {
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  transform-origin: center center;
}

.fa-layers-counter {
  background-color: var(--fa-counter-background-color, #ff253a);
  border-radius: var(--fa-counter-border-radius, 1em);
  box-sizing: border-box;
  color: var(--fa-inverse, #fff);
  line-height: var(--fa-counter-line-height, 1);
  max-width: var(--fa-counter-max-width, 5em);
  min-width: var(--fa-counter-min-width, 1.5em);
  overflow: hidden;
  padding: var(--fa-counter-padding, 0.25em 0.5em);
  right: var(--fa-right, 0);
  text-overflow: ellipsis;
  top: var(--fa-top, 0);
  transform: scale(var(--fa-counter-scale, 0.25));
  transform-origin: top right;
}

.fa-layers-bottom-right {
  bottom: var(--fa-bottom, 0);
  right: var(--fa-right, 0);
  top: auto;
  transform: scale(var(--fa-layers-scale, 0.25));
  transform-origin: bottom right;
}

.fa-layers-bottom-left {
  bottom: var(--fa-bottom, 0);
  left: var(--fa-left, 0);
  right: auto;
  top: auto;
  transform: scale(var(--fa-layers-scale, 0.25));
  transform-origin: bottom left;
}

.fa-layers-top-right {
  top: var(--fa-top, 0);
  right: var(--fa-right, 0);
  transform: scale(var(--fa-layers-scale, 0.25));
  transform-origin: top right;
}

.fa-layers-top-left {
  left: var(--fa-left, 0);
  right: auto;
  top: var(--fa-top, 0);
  transform: scale(var(--fa-layers-scale, 0.25));
  transform-origin: top left;
}

.fa-1x {
  font-size: 1em;
}

.fa-2x {
  font-size: 2em;
}

.fa-3x {
  font-size: 3em;
}

.fa-4x {
  font-size: 4em;
}

.fa-5x {
  font-size: 5em;
}

.fa-6x {
  font-size: 6em;
}

.fa-7x {
  font-size: 7em;
}

.fa-8x {
  font-size: 8em;
}

.fa-9x {
  font-size: 9em;
}

.fa-10x {
  font-size: 10em;
}

.fa-2xs {
  font-size: 0.625em;
  line-height: 0.1em;
  vertical-align: 0.225em;
}

.fa-xs {
  font-size: 0.75em;
  line-height: 0.0833333337em;
  vertical-align: 0.125em;
}

.fa-sm {
  font-size: 0.875em;
  line-height: 0.0714285718em;
  vertical-align: 0.0535714295em;
}

.fa-lg {
  font-size: 1.25em;
  line-height: 0.05em;
  vertical-align: -0.075em;
}

.fa-xl {
  font-size: 1.5em;
  line-height: 0.0416666682em;
  vertical-align: -0.125em;
}

.fa-2xl {
  font-size: 2em;
  line-height: 0.03125em;
  vertical-align: -0.1875em;
}

.fa-fw {
  text-align: center;
  width: 1.25em;
}

.fa-ul {
  list-style-type: none;
  margin-left: var(--fa-li-margin, 2.5em);
  padding-left: 0;
}
.fa-ul > li {
  position: relative;
}

.fa-li {
  left: calc(-1 * var(--fa-li-width, 2em));
  position: absolute;
  text-align: center;
  width: var(--fa-li-width, 2em);
  line-height: inherit;
}

.fa-border {
  border-color: var(--fa-border-color, #eee);
  border-radius: var(--fa-border-radius, 0.1em);
  border-style: var(--fa-border-style, solid);
  border-width: var(--fa-border-width, 0.08em);
  padding: var(--fa-border-padding, 0.2em 0.25em 0.15em);
}

.fa-pull-left {
  float: left;
  margin-right: var(--fa-pull-margin, 0.3em);
}

.fa-pull-right {
  float: right;
  margin-left: var(--fa-pull-margin, 0.3em);
}

.fa-beat {
  animation-name: fa-beat;
  animation-delay: var(--fa-animation-delay, 0s);
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 1s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, ease-in-out);
}

.fa-bounce {
  animation-name: fa-bounce;
  animation-delay: var(--fa-animation-delay, 0s);
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 1s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, cubic-bezier(0.28, 0.84, 0.42, 1));
}

.fa-fade {
  animation-name: fa-fade;
  animation-delay: var(--fa-animation-delay, 0s);
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 1s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, cubic-bezier(0.4, 0, 0.6, 1));
}

.fa-beat-fade {
  animation-name: fa-beat-fade;
  animation-delay: var(--fa-animation-delay, 0s);
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 1s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, cubic-bezier(0.4, 0, 0.6, 1));
}

.fa-flip {
  animation-name: fa-flip;
  animation-delay: var(--fa-animation-delay, 0s);
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 1s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, ease-in-out);
}

.fa-shake {
  animation-name: fa-shake;
  animation-delay: var(--fa-animation-delay, 0s);
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 1s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, linear);
}

.fa-spin {
  animation-name: fa-spin;
  animation-delay: var(--fa-animation-delay, 0s);
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 2s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, linear);
}

.fa-spin-reverse {
  --fa-animation-direction: reverse;
}

.fa-pulse,
.fa-spin-pulse {
  animation-name: fa-spin;
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 1s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, steps(8));
}

@media (prefers-reduced-motion: reduce) {
  .fa-beat,
.fa-bounce,
.fa-fade,
.fa-beat-fade,
.fa-flip,
.fa-pulse,
.fa-shake,
.fa-spin,
.fa-spin-pulse {
    animation-delay: -1ms;
    animation-duration: 1ms;
    animation-iteration-count: 1;
    transition-delay: 0s;
    transition-duration: 0s;
  }
}
@keyframes fa-beat {
  0%, 90% {
    transform: scale(1);
  }
  45% {
    transform: scale(var(--fa-beat-scale, 1.25));
  }
}
@keyframes fa-bounce {
  0% {
    transform: scale(1, 1) translateY(0);
  }
  10% {
    transform: scale(var(--fa-bounce-start-scale-x, 1.1), var(--fa-bounce-start-scale-y, 0.9)) translateY(0);
  }
  30% {
    transform: scale(var(--fa-bounce-jump-scale-x, 0.9), var(--fa-bounce-jump-scale-y, 1.1)) translateY(var(--fa-bounce-height, -0.5em));
  }
  50% {
    transform: scale(var(--fa-bounce-land-scale-x, 1.05), var(--fa-bounce-land-scale-y, 0.95)) translateY(0);
  }
  57% {
    transform: scale(1, 1) translateY(var(--fa-bounce-rebound, -0.125em));
  }
  64% {
    transform: scale(1, 1) translateY(0);
  }
  100% {
    transform: scale(1, 1) translateY(0);
  }
}
@keyframes fa-fade {
  50% {
    opacity: var(--fa-fade-opacity, 0.4);
  }
}
@keyframes fa-beat-fade {
  0%, 100% {
    opacity: var(--fa-beat-fade-opacity, 0.4);
    transform: scale(1);
  }
  50% {
    opacity: 1;
    transform: scale(var(--fa-beat-fade-scale, 1.125));
  }
}
@keyframes fa-flip {
  50% {
    transform: rotate3d(var(--fa-flip-x, 0), var(--fa-flip-y, 1), var(--fa-flip-z, 0), var(--fa-flip-angle, -180deg));
  }
}
@keyframes fa-shake {
  0% {
    transform: rotate(-15deg);
  }
  4% {
    transform: rotate(15deg);
  }
  8%, 24% {
    transform: rotate(-18deg);
  }
  12%, 28% {
    transform: rotate(18deg);
  }
  16% {
    transform: rotate(-22deg);
  }
  20% {
    transform: rotate(22deg);
  }
  32% {
    transform: rotate(-12deg);
  }
  36% {
    transform: rotate(12deg);
  }
  40%, 100% {
    transform: rotate(0deg);
  }
}
@keyframes fa-spin {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}
.fa-rotate-90 {
  transform: rotate(90deg);
}

.fa-rotate-180 {
  transform: rotate(180deg);
}

.fa-rotate-270 {
  transform: rotate(270deg);
}

.fa-flip-horizontal {
  transform: scale(-1, 1);
}

.fa-flip-vertical {
  transform: scale(1, -1);
}

.fa-flip-both,
.fa-flip-horizontal.fa-flip-vertical {
  transform: scale(-1, -1);
}

.fa-rotate-by {
  transform: rotate(var(--fa-rotate-angle, 0));
}

.fa-stack {
  display: inline-block;
  vertical-align: middle;
  height: 2em;
  position: relative;
  width: 2.5em;
}

.fa-stack-1x,
.fa-stack-2x {
  bottom: 0;
  left: 0;
  margin: auto;
  position: absolute;
  right: 0;
  top: 0;
  z-index: var(--fa-stack-z-index, auto);
}

.svg-inline--fa.fa-stack-1x {
  height: 1em;
  width: 1.25em;
}
.svg-inline--fa.fa-stack-2x {
  height: 2em;
  width: 2.5em;
}

.fa-inverse {
  color: var(--fa-inverse, #fff);
}

.sr-only,
.fa-sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border-width: 0;
}

.sr-only-focusable:not(:focus),
.fa-sr-only-focusable:not(:focus) {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border-width: 0;
}

.svg-inline--fa .fa-primary {
  fill: var(--fa-primary-color, currentColor);
  opacity: var(--fa-primary-opacity, 1);
}

.svg-inline--fa .fa-secondary {
  fill: var(--fa-secondary-color, currentColor);
  opacity: var(--fa-secondary-opacity, 0.4);
}

.svg-inline--fa.fa-swap-opacity .fa-primary {
  opacity: var(--fa-secondary-opacity, 0.4);
}

.svg-inline--fa.fa-swap-opacity .fa-secondary {
  opacity: var(--fa-primary-opacity, 1);
}

.svg-inline--fa mask .fa-primary,
.svg-inline--fa mask .fa-secondary {
  fill: black;
}

.fad.fa-inverse,
.fa-duotone.fa-inverse {
  color: var(--fa-inverse, #fff);
}`;function hp(){const n=ip,e=sp,t=G.cssPrefix,r=G.replacementClass;let i=Fx;if(t!==n||r!==e){const s=new RegExp("\\.".concat(n,"\\-"),"g"),o=new RegExp("\\--".concat(n,"\\-"),"g"),a=new RegExp("\\.".concat(e),"g");i=i.replace(s,".".concat(t,"-")).replace(o,"--".concat(t,"-")).replace(a,".".concat(r))}return i}let pp=!1;function Ec(){G.autoAddCss&&!pp&&(Px(hp()),pp=!0)}var Bx={mixout(){return{dom:{css:hp,insertCss:Ec}}},hooks(){return{beforeDOMElementCreation(){Ec()},beforeI2svg(){Ec()}}}};const An=Zn||{};An[Mn]||(An[Mn]={}),An[Mn].styles||(An[Mn].styles={}),An[Mn].hooks||(An[Mn].hooks={}),An[Mn].shims||(An[Mn].shims=[]);var fn=An[Mn];const mp=[],gp=function(){Ne.removeEventListener("DOMContentLoaded",gp),na=1,mp.map(n=>n())};let na=!1;Nn&&(na=(Ne.documentElement.doScroll?/^loaded|^c/:/^loaded|^i|^c/).test(Ne.readyState),na||Ne.addEventListener("DOMContentLoaded",gp));function Vx(n){Nn&&(na?setTimeout(n,0):mp.push(n))}function Fs(n){const{tag:e,attributes:t={},children:r=[]}=n;return typeof n=="string"?dp(n):"<".concat(e," ").concat(Dx(t),">").concat(r.map(Fs).join(""),"</").concat(e,">")}function yp(n,e,t){if(n&&n[e]&&n[e][t])return{prefix:e,iconName:t,icon:n[e][t]}}var Tc=function(e,t,r,i){var s=Object.keys(e),o=s.length,a=t,l,c,u;for(r===void 0?(l=1,u=e[s[0]]):(l=0,u=r);l<o;l++)c=s[l],u=a(u,e[c],c,e);return u};function $x(n){const e=[];let t=0;const r=n.length;for(;t<r;){const i=n.charCodeAt(t++);if(i>=55296&&i<=56319&&t<r){const s=n.charCodeAt(t++);(s&64512)==56320?e.push(((i&1023)<<10)+(s&1023)+65536):(e.push(i),t--)}else e.push(i)}return e}function Oc(n){const e=$x(n);return e.length===1?e[0].toString(16):null}function jx(n,e){const t=n.length;let r=n.charCodeAt(e),i;return r>=55296&&r<=56319&&t>e+1&&(i=n.charCodeAt(e+1),i>=56320&&i<=57343)?(r-55296)*1024+i-56320+65536:r}function bp(n){return Object.keys(n).reduce((e,t)=>{const r=n[t];return!!r.icon?e[r.iconName]=r.icon:e[t]=r,e},{})}function Nc(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{skipHooks:r=!1}=t,i=bp(e);typeof fn.hooks.addPack=="function"&&!r?fn.hooks.addPack(n,bp(e)):fn.styles[n]={...fn.styles[n]||{},...i},n==="fas"&&Nc("fa",e)}const{styles:jr,shims:zx}=fn,Hx={[Me]:Object.values($r[Me]),[xt]:Object.values($r[xt]),[_t]:Object.values($r[_t])};let Mc=null,vp={},wp={},Cp={},kp={},Sp={};const Gx={[Me]:Object.keys(Vr[Me]),[xt]:Object.keys(Vr[xt]),[_t]:Object.keys(Vr[_t])};function Ux(n){return~Ox.indexOf(n)}function Wx(n,e){const t=e.split("-"),r=t[0],i=t.slice(1).join("-");return r===n&&i!==""&&!Ux(i)?i:null}const xp=()=>{const n=r=>Tc(jr,(i,s,o)=>(i[o]=Tc(s,r,{}),i),{});vp=n((r,i,s)=>(i[3]&&(r[i[3]]=s),i[2]&&i[2].filter(a=>typeof a=="number").forEach(a=>{r[a.toString(16)]=s}),r)),wp=n((r,i,s)=>(r[s]=s,i[2]&&i[2].filter(a=>typeof a=="string").forEach(a=>{r[a]=s}),r)),Sp=n((r,i,s)=>{const o=i[2];return r[s]=s,o.forEach(a=>{r[a]=s}),r});const e="far"in jr||G.autoFetchSvg,t=Tc(zx,(r,i)=>{const s=i[0];let o=i[1];const a=i[2];return o==="far"&&!e&&(o="fas"),typeof s=="string"&&(r.names[s]={prefix:o,iconName:a}),typeof s=="number"&&(r.unicodes[s.toString(16)]={prefix:o,iconName:a}),r},{names:{},unicodes:{}});Cp=t.names,kp=t.unicodes,Mc=ra(G.styleDefault,{family:G.familyDefault})};Ax(n=>{Mc=ra(n.styleDefault,{family:G.familyDefault})}),xp();function Ac(n,e){return(vp[n]||{})[e]}function Kx(n,e){return(wp[n]||{})[e]}function tr(n,e){return(Sp[n]||{})[e]}function _p(n){return Cp[n]||{prefix:null,iconName:null}}function Yx(n){const e=kp[n],t=Ac("fas",n);return e||(t?{prefix:"fas",iconName:t}:null)||{prefix:null,iconName:null}}function nr(){return Mc}const Pc=()=>({prefix:null,iconName:null,rest:[]});function ra(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{family:t=Me}=e,r=Vr[t][n],i=Is[t][n]||Is[t][r],s=n in fn.styles?n:null;return i||s||null}const qx={[Me]:Object.keys($r[Me]),[xt]:Object.keys($r[xt]),[_t]:Object.keys($r[_t])};function ia(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{skipLookups:t=!1}=e,r={[Me]:"".concat(G.cssPrefix,"-").concat(Me),[xt]:"".concat(G.cssPrefix,"-").concat(xt),[_t]:"".concat(G.cssPrefix,"-").concat(_t)};let i=null,s=Me;const o=rx.filter(l=>l!==Zh);o.forEach(l=>{(n.includes(r[l])||n.some(c=>qx[l].includes(c)))&&(s=l)});const a=n.reduce((l,c)=>{const u=Wx(G.cssPrefix,c);if(jr[c]?(c=Hx[s].includes(c)?Sx[s][c]:c,i=c,l.prefix=c):Gx[s].indexOf(c)>-1?(i=c,l.prefix=ra(c,{family:s})):u?l.iconName=u:c!==G.replacementClass&&!o.some(d=>c===r[d])&&l.rest.push(c),!t&&l.prefix&&l.iconName){const d=i==="fa"?_p(l.iconName):{},h=tr(l.prefix,l.iconName);d.prefix&&(i=null),l.iconName=d.iconName||h||l.iconName,l.prefix=d.prefix||l.prefix,l.prefix==="far"&&!jr.far&&jr.fas&&!G.autoFetchSvg&&(l.prefix="fas")}return l},Pc());return(n.includes("fa-brands")||n.includes("fab"))&&(a.prefix="fab"),(n.includes("fa-duotone")||n.includes("fad"))&&(a.prefix="fad"),!a.prefix&&s===xt&&(jr.fass||G.autoFetchSvg)&&(a.prefix="fass",a.iconName=tr(a.prefix,a.iconName)||a.iconName),!a.prefix&&s===_t&&(jr.fasds||G.autoFetchSvg)&&(a.prefix="fasds",a.iconName=tr(a.prefix,a.iconName)||a.iconName),(a.prefix==="fa"||i==="fa")&&(a.prefix=nr()||"fas"),a}class Xx{constructor(){this.definitions={}}add(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const i=t.reduce(this._pullDefinitions,{});Object.keys(i).forEach(s=>{this.definitions[s]={...this.definitions[s]||{},...i[s]},Nc(s,i[s]);const o=$r[Me][s];o&&Nc(o,i[s]),xp()})}reset(){this.definitions={}}_pullDefinitions(e,t){const r=t.prefix&&t.iconName&&t.icon?{0:t}:t;return Object.keys(r).map(i=>{const{prefix:s,iconName:o,icon:a}=r[i],l=a[2];e[s]||(e[s]={}),l.length>0&&l.forEach(c=>{typeof c=="string"&&(e[s][c]=a)}),e[s][o]=a}),e}}let Ep=[],ki={};const Si={},Jx=Object.keys(Si);function Qx(n,e){let{mixoutsTo:t}=e;return Ep=n,ki={},Object.keys(Si).forEach(r=>{Jx.indexOf(r)===-1&&delete Si[r]}),Ep.forEach(r=>{const i=r.mixout?r.mixout():{};if(Object.keys(i).forEach(s=>{typeof i[s]=="function"&&(t[s]=i[s]),typeof i[s]=="object"&&Object.keys(i[s]).forEach(o=>{t[s]||(t[s]={}),t[s][o]=i[s][o]})}),r.hooks){const s=r.hooks();Object.keys(s).forEach(o=>{ki[o]||(ki[o]=[]),ki[o].push(s[o])})}r.provides&&r.provides(Si)}),t}function Ic(n,e){for(var t=arguments.length,r=new Array(t>2?t-2:0),i=2;i<t;i++)r[i-2]=arguments[i];return(ki[n]||[]).forEach(o=>{e=o.apply(null,[e,...r])}),e}function zr(n){for(var e=arguments.length,t=new Array(e>1?e-1:0),r=1;r<e;r++)t[r-1]=arguments[r];(ki[n]||[]).forEach(s=>{s.apply(null,t)})}function rr(){const n=arguments[0],e=Array.prototype.slice.call(arguments,1);return Si[n]?Si[n].apply(null,e):void 0}function Dc(n){n.prefix==="fa"&&(n.prefix="fas");let{iconName:e}=n;const t=n.prefix||nr();if(e)return e=tr(t,e)||e,yp(Tp.definitions,t,e)||yp(fn.styles,t,e)}const Tp=new Xx,Et={noAuto:()=>{G.autoReplaceSvg=!1,G.observeMutations=!1,zr("noAuto")},config:G,dom:{i2svg:function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Nn?(zr("beforeI2svg",n),rr("pseudoElements2svg",n),rr("i2svg",n)):Promise.reject(new Error("Operation requires a DOM of some kind."))},watch:function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{autoReplaceSvgRoot:e}=n;G.autoReplaceSvg===!1&&(G.autoReplaceSvg=!0),G.observeMutations=!0,Vx(()=>{Zx({autoReplaceSvgRoot:e}),zr("watch",n)})}},parse:{icon:n=>{if(n===null)return null;if(typeof n=="object"&&n.prefix&&n.iconName)return{prefix:n.prefix,iconName:tr(n.prefix,n.iconName)||n.iconName};if(Array.isArray(n)&&n.length===2){const e=n[1].indexOf("fa-")===0?n[1].slice(3):n[1],t=ra(n[0]);return{prefix:t,iconName:tr(t,e)||e}}if(typeof n=="string"&&(n.indexOf("".concat(G.cssPrefix,"-"))>-1||n.match(xx))){const e=ia(n.split(" "),{skipLookups:!0});return{prefix:e.prefix||nr(),iconName:tr(e.prefix,e.iconName)||e.iconName}}if(typeof n=="string"){const e=nr();return{prefix:e,iconName:tr(e,n)||n}}}},library:Tp,findIconDefinition:Dc,toHtml:Fs},Zx=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{autoReplaceSvgRoot:e=Ne}=n;(Object.keys(fn.styles).length>0||G.autoFetchSvg)&&Nn&&G.autoReplaceSvg&&Et.dom.i2svg({node:e})};function sa(n,e){return Object.defineProperty(n,"abstract",{get:e}),Object.defineProperty(n,"html",{get:function(){return n.abstract.map(t=>Fs(t))}}),Object.defineProperty(n,"node",{get:function(){if(!Nn)return;const t=Ne.createElement("div");return t.innerHTML=n.html,t.children}}),n}function e_(n){let{children:e,main:t,mask:r,attributes:i,styles:s,transform:o}=n;if(_c(o)&&t.found&&!r.found){const{width:a,height:l}=t,c={x:a/l/2,y:.5};i.style=ta({...s,"transform-origin":"".concat(c.x+o.x/16,"em ").concat(c.y+o.y/16,"em")})}return[{tag:"svg",attributes:i,children:e}]}function t_(n){let{prefix:e,iconName:t,children:r,attributes:i,symbol:s}=n;const o=s===!0?"".concat(e,"-").concat(G.cssPrefix,"-").concat(t):s;return[{tag:"svg",attributes:{style:"display: none;"},children:[{tag:"symbol",attributes:{...i,id:o},children:r}]}]}function Lc(n){const{icons:{main:e,mask:t},prefix:r,iconName:i,transform:s,symbol:o,title:a,maskId:l,titleId:c,extra:u,watchable:d=!1}=n,{width:h,height:m}=t.found?t:e,p=r==="fak",g=[G.replacementClass,i?"".concat(G.cssPrefix,"-").concat(i):""].filter(E=>u.classes.indexOf(E)===-1).filter(E=>E!==""||!!E).concat(u.classes).join(" ");let y={children:[],attributes:{...u.attributes,"data-prefix":r,"data-icon":i,class:g,role:u.attributes.role||"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 ".concat(h," ").concat(m)}};const v=p&&!~u.classes.indexOf("fa-fw")?{width:"".concat(h/m*16*.0625,"em")}:{};d&&(y.attributes[Br]=""),a&&(y.children.push({tag:"title",attributes:{id:y.attributes["aria-labelledby"]||"title-".concat(c||Rs())},children:[a]}),delete y.attributes.title);const C={...y,prefix:r,iconName:i,main:e,mask:t,maskId:l,transform:s,symbol:o,styles:{...v,...u.styles}},{children:w,attributes:b}=t.found&&e.found?rr("generateAbstractMask",C)||{children:[],attributes:{}}:rr("generateAbstractIcon",C)||{children:[],attributes:{}};return C.children=w,C.attributes=b,o?t_(C):e_(C)}function Op(n){const{content:e,width:t,height:r,transform:i,title:s,extra:o,watchable:a=!1}=n,l={...o.attributes,...s?{title:s}:{},class:o.classes.join(" ")};a&&(l[Br]="");const c={...o.styles};_c(i)&&(c.transform=Rx({transform:i,startCentered:!0,width:t,height:r}),c["-webkit-transform"]=c.transform);const u=ta(c);u.length>0&&(l.style=u);const d=[];return d.push({tag:"span",attributes:l,children:[e]}),s&&d.push({tag:"span",attributes:{class:"sr-only"},children:[s]}),d}function n_(n){const{content:e,title:t,extra:r}=n,i={...r.attributes,...t?{title:t}:{},class:r.classes.join(" ")},s=ta(r.styles);s.length>0&&(i.style=s);const o=[];return o.push({tag:"span",attributes:i,children:[e]}),t&&o.push({tag:"span",attributes:{class:"sr-only"},children:[t]}),o}const{styles:Rc}=fn;function Fc(n){const e=n[0],t=n[1],[r]=n.slice(4);let i=null;return Array.isArray(r)?i={tag:"g",attributes:{class:"".concat(G.cssPrefix,"-").concat(Sc.GROUP)},children:[{tag:"path",attributes:{class:"".concat(G.cssPrefix,"-").concat(Sc.SECONDARY),fill:"currentColor",d:r[0]}},{tag:"path",attributes:{class:"".concat(G.cssPrefix,"-").concat(Sc.PRIMARY),fill:"currentColor",d:r[1]}}]}:i={tag:"path",attributes:{fill:"currentColor",d:r}},{found:!0,width:e,height:t,icon:i}}const r_={found:!1,width:512,height:512};function i_(n,e){!ap&&!G.showMissingIcons&&n&&console.error('Icon with name "'.concat(n,'" and prefix "').concat(e,'" is missing.'))}function Bc(n,e){let t=e;return e==="fa"&&G.styleDefault!==null&&(e=nr()),new Promise((r,i)=>{if(t==="fa"){const s=_p(n)||{};n=s.iconName||n,e=s.prefix||e}if(n&&e&&Rc[e]&&Rc[e][n]){const s=Rc[e][n];return r(Fc(s))}i_(n,e),r({...r_,icon:G.showMissingIcons&&n?rr("missingIconAbstract")||{}:{}})})}const Np=()=>{},Vc=G.measurePerformance&&ea&&ea.mark&&ea.measure?ea:{mark:Np,measure:Np},Bs='FA "6.6.0"',s_=n=>(Vc.mark("".concat(Bs," ").concat(n," begins")),()=>Mp(n)),Mp=n=>{Vc.mark("".concat(Bs," ").concat(n," ends")),Vc.measure("".concat(Bs," ").concat(n),"".concat(Bs," ").concat(n," begins"),"".concat(Bs," ").concat(n," ends"))};var $c={begin:s_,end:Mp};const oa=()=>{};function Ap(n){return typeof(n.getAttribute?n.getAttribute(Br):null)=="string"}function o_(n){const e=n.getAttribute?n.getAttribute(bc):null,t=n.getAttribute?n.getAttribute(vc):null;return e&&t}function a_(n){return n&&n.classList&&n.classList.contains&&n.classList.contains(G.replacementClass)}function l_(){return G.autoReplaceSvg===!0?aa.replace:aa[G.autoReplaceSvg]||aa.replace}function c_(n){return Ne.createElementNS("http://www.w3.org/2000/svg",n)}function u_(n){return Ne.createElement(n)}function Pp(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{ceFn:t=n.tag==="svg"?c_:u_}=e;if(typeof n=="string")return Ne.createTextNode(n);const r=t(n.tag);return Object.keys(n.attributes||[]).forEach(function(s){r.setAttribute(s,n.attributes[s])}),(n.children||[]).forEach(function(s){r.appendChild(Pp(s,{ceFn:t}))}),r}function f_(n){let e=" ".concat(n.outerHTML," ");return e="".concat(e,"Font Awesome fontawesome.com "),e}const aa={replace:function(n){const e=n[0];if(e.parentNode)if(n[1].forEach(t=>{e.parentNode.insertBefore(Pp(t),e)}),e.getAttribute(Br)===null&&G.keepOriginalSource){let t=Ne.createComment(f_(e));e.parentNode.replaceChild(t,e)}else e.remove()},nest:function(n){const e=n[0],t=n[1];if(~xc(e).indexOf(G.replacementClass))return aa.replace(n);const r=new RegExp("".concat(G.cssPrefix,"-.*"));if(delete t[0].attributes.id,t[0].attributes.class){const s=t[0].attributes.class.split(" ").reduce((o,a)=>(a===G.replacementClass||a.match(r)?o.toSvg.push(a):o.toNode.push(a),o),{toNode:[],toSvg:[]});t[0].attributes.class=s.toSvg.join(" "),s.toNode.length===0?e.removeAttribute("class"):e.setAttribute("class",s.toNode.join(" "))}const i=t.map(s=>Fs(s)).join(`
`);e.setAttribute(Br,""),e.innerHTML=i}};function Ip(n){n()}function Dp(n,e){const t=typeof e=="function"?e:oa;if(n.length===0)t();else{let r=Ip;G.mutateApproach===Cx&&(r=Zn.requestAnimationFrame||Ip),r(()=>{const i=l_(),s=$c.begin("mutate");n.map(i),s(),t()})}}let jc=!1;function Lp(){jc=!0}function zc(){jc=!1}let la=null;function Rp(n){if(!Jh||!G.observeMutations)return;const{treeCallback:e=oa,nodeCallback:t=oa,pseudoElementsCallback:r=oa,observeMutationsRoot:i=Ne}=n;la=new Jh(s=>{if(jc)return;const o=nr();Ci(s).forEach(a=>{if(a.type==="childList"&&a.addedNodes.length>0&&!Ap(a.addedNodes[0])&&(G.searchPseudoElements&&r(a.target),e(a.target)),a.type==="attributes"&&a.target.parentNode&&G.searchPseudoElements&&r(a.target.parentNode),a.type==="attributes"&&Ap(a.target)&&~Tx.indexOf(a.attributeName))if(a.attributeName==="class"&&o_(a.target)){const{prefix:l,iconName:c}=ia(xc(a.target));a.target.setAttribute(bc,l||o),c&&a.target.setAttribute(vc,c)}else a_(a.target)&&t(a.target)})}),Nn&&la.observe(i,{childList:!0,attributes:!0,characterData:!0,subtree:!0})}function d_(){la&&la.disconnect()}function h_(n){const e=n.getAttribute("style");let t=[];return e&&(t=e.split(";").reduce((r,i)=>{const s=i.split(":"),o=s[0],a=s.slice(1);return o&&a.length>0&&(r[o]=a.join(":").trim()),r},{})),t}function p_(n){const e=n.getAttribute("data-prefix"),t=n.getAttribute("data-icon"),r=n.innerText!==void 0?n.innerText.trim():"";let i=ia(xc(n));return i.prefix||(i.prefix=nr()),e&&t&&(i.prefix=e,i.iconName=t),i.iconName&&i.prefix||(i.prefix&&r.length>0&&(i.iconName=Kx(i.prefix,n.innerText)||Ac(i.prefix,Oc(n.innerText))),!i.iconName&&G.autoFetchSvg&&n.firstChild&&n.firstChild.nodeType===Node.TEXT_NODE&&(i.iconName=n.firstChild.data)),i}function m_(n){const e=Ci(n.attributes).reduce((i,s)=>(i.name!=="class"&&i.name!=="style"&&(i[s.name]=s.value),i),{}),t=n.getAttribute("title"),r=n.getAttribute("data-fa-title-id");return G.autoA11y&&(t?e["aria-labelledby"]="".concat(G.replacementClass,"-title-").concat(r||Rs()):(e["aria-hidden"]="true",e.focusable="false")),e}function g_(){return{iconName:null,title:null,titleId:null,prefix:null,transform:un,symbol:!1,mask:{iconName:null,prefix:null,rest:[]},maskId:null,extra:{classes:[],styles:{},attributes:{}}}}function Fp(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{styleParser:!0};const{iconName:t,prefix:r,rest:i}=p_(n),s=m_(n),o=Ic("parseNodeAttributes",{},n);let a=e.styleParser?h_(n):[];return{iconName:t,title:n.getAttribute("title"),titleId:n.getAttribute("data-fa-title-id"),prefix:r,transform:un,mask:{iconName:null,prefix:null,rest:[]},maskId:null,symbol:!1,extra:{classes:i,styles:a,attributes:s},...o}}const{styles:y_}=fn;function Bp(n){const e=G.autoReplaceSvg==="nest"?Fp(n,{styleParser:!1}):Fp(n);return~e.extra.classes.indexOf(up)?rr("generateLayersText",n,e):rr("generateSvgReplacementMutation",n,e)}let dn=new Set;lp.map(n=>{dn.add("fa-".concat(n))}),Object.keys(Vr[Me]).map(dn.add.bind(dn)),Object.keys(Vr[xt]).map(dn.add.bind(dn)),Object.keys(Vr[_t]).map(dn.add.bind(dn)),dn=[...dn];function Vp(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(!Nn)return Promise.resolve();const t=Ne.documentElement.classList,r=u=>t.add("".concat(op,"-").concat(u)),i=u=>t.remove("".concat(op,"-").concat(u)),s=G.autoFetchSvg?dn:lp.map(u=>"fa-".concat(u)).concat(Object.keys(y_));s.includes("fa")||s.push("fa");const o=[".".concat(up,":not([").concat(Br,"])")].concat(s.map(u=>".".concat(u,":not([").concat(Br,"])"))).join(", ");if(o.length===0)return Promise.resolve();let a=[];try{a=Ci(n.querySelectorAll(o))}catch{}if(a.length>0)r("pending"),i("complete");else return Promise.resolve();const l=$c.begin("onTree"),c=a.reduce((u,d)=>{try{const h=Bp(d);h&&u.push(h)}catch(h){ap||h.name==="MissingIcon"&&console.error(h)}return u},[]);return new Promise((u,d)=>{Promise.all(c).then(h=>{Dp(h,()=>{r("active"),r("complete"),i("pending"),typeof e=="function"&&e(),l(),u()})}).catch(h=>{l(),d(h)})})}function b_(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;Bp(n).then(t=>{t&&Dp([t],e)})}function v_(n){return function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=(e||{}).icon?e:Dc(e||{});let{mask:i}=t;return i&&(i=(i||{}).icon?i:Dc(i||{})),n(r,{...t,mask:i})}}const w_=function(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{transform:t=un,symbol:r=!1,mask:i=null,maskId:s=null,title:o=null,titleId:a=null,classes:l=[],attributes:c={},styles:u={}}=e;if(!n)return;const{prefix:d,iconName:h,icon:m}=n;return sa({type:"icon",...n},()=>(zr("beforeDOMElementCreation",{iconDefinition:n,params:e}),G.autoA11y&&(o?c["aria-labelledby"]="".concat(G.replacementClass,"-title-").concat(a||Rs()):(c["aria-hidden"]="true",c.focusable="false")),Lc({icons:{main:Fc(m),mask:i?Fc(i.icon):{found:!1,width:null,height:null,icon:{}}},prefix:d,iconName:h,transform:{...un,...t},symbol:r,title:o,maskId:s,titleId:a,extra:{attributes:c,styles:u,classes:l}})))};var C_={mixout(){return{icon:v_(w_)}},hooks(){return{mutationObserverCallbacks(n){return n.treeCallback=Vp,n.nodeCallback=b_,n}}},provides(n){n.i2svg=function(e){const{node:t=Ne,callback:r=()=>{}}=e;return Vp(t,r)},n.generateSvgReplacementMutation=function(e,t){const{iconName:r,title:i,titleId:s,prefix:o,transform:a,symbol:l,mask:c,maskId:u,extra:d}=t;return new Promise((h,m)=>{Promise.all([Bc(r,o),c.iconName?Bc(c.iconName,c.prefix):Promise.resolve({found:!1,width:512,height:512,icon:{}})]).then(p=>{let[g,y]=p;h([e,Lc({icons:{main:g,mask:y},prefix:o,iconName:r,transform:a,symbol:l,maskId:u,title:i,titleId:s,extra:d,watchable:!0})])}).catch(m)})},n.generateAbstractIcon=function(e){let{children:t,attributes:r,main:i,transform:s,styles:o}=e;const a=ta(o);a.length>0&&(r.style=a);let l;return _c(s)&&(l=rr("generateAbstractTransformGrouping",{main:i,transform:s,containerWidth:i.width,iconWidth:i.width})),t.push(l||i.icon),{children:t,attributes:r}}}},k_={mixout(){return{layer(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{classes:t=[]}=e;return sa({type:"layer"},()=>{zr("beforeDOMElementCreation",{assembler:n,params:e});let r=[];return n(i=>{Array.isArray(i)?i.map(s=>{r=r.concat(s.abstract)}):r=r.concat(i.abstract)}),[{tag:"span",attributes:{class:["".concat(G.cssPrefix,"-layers"),...t].join(" ")},children:r}]})}}}},S_={mixout(){return{counter(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{title:t=null,classes:r=[],attributes:i={},styles:s={}}=e;return sa({type:"counter",content:n},()=>(zr("beforeDOMElementCreation",{content:n,params:e}),n_({content:n.toString(),title:t,extra:{attributes:i,styles:s,classes:["".concat(G.cssPrefix,"-layers-counter"),...r]}})))}}}},x_={mixout(){return{text(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{transform:t=un,title:r=null,classes:i=[],attributes:s={},styles:o={}}=e;return sa({type:"text",content:n},()=>(zr("beforeDOMElementCreation",{content:n,params:e}),Op({content:n,transform:{...un,...t},title:r,extra:{attributes:s,styles:o,classes:["".concat(G.cssPrefix,"-layers-text"),...i]}})))}}},provides(n){n.generateLayersText=function(e,t){const{title:r,transform:i,extra:s}=t;let o=null,a=null;if(Qh){const l=parseInt(getComputedStyle(e).fontSize,10),c=e.getBoundingClientRect();o=c.width/l,a=c.height/l}return G.autoA11y&&!r&&(s.attributes["aria-hidden"]="true"),Promise.resolve([e,Op({content:e.innerHTML,width:o,height:a,transform:i,title:r,extra:s,watchable:!0})])}}};const __=new RegExp('"',"ug"),$p=[1105920,1112319],jp={FontAwesome:{normal:"fas",400:"fas"},...cx,...lx,...yx},Hc=Object.keys(jp).reduce((n,e)=>(n[e.toLowerCase()]=jp[e],n),{}),E_=Object.keys(Hc).reduce((n,e)=>{const t=Hc[e];return n[e]=t[900]||[...Object.entries(t)][0][1],n},{});function T_(n){const e=n.replace(__,""),t=jx(e,0),r=t>=$p[0]&&t<=$p[1],i=e.length===2?e[0]===e[1]:!1;return{value:Oc(i?e[0]:e),isSecondary:r||i}}function O_(n,e){const t=n.replace(/^['"]|['"]$/g,"").toLowerCase(),r=parseInt(e),i=isNaN(r)?"normal":r;return(Hc[t]||{})[i]||E_[t]}function zp(n,e){const t="".concat(wx).concat(e.replace(":","-"));return new Promise((r,i)=>{if(n.getAttribute(t)!==null)return r();const o=Ci(n.children).filter(h=>h.getAttribute(yc)===e)[0],a=Zn.getComputedStyle(n,e),l=a.getPropertyValue("font-family"),c=l.match(_x),u=a.getPropertyValue("font-weight"),d=a.getPropertyValue("content");if(o&&!c)return n.removeChild(o),r();if(c&&d!=="none"&&d!==""){const h=a.getPropertyValue("content");let m=O_(l,u);const{value:p,isSecondary:g}=T_(h),y=c[0].startsWith("FontAwesome");let v=Ac(m,p),C=v;if(y){const w=Yx(p);w.iconName&&w.prefix&&(v=w.iconName,m=w.prefix)}if(v&&!g&&(!o||o.getAttribute(bc)!==m||o.getAttribute(vc)!==C)){n.setAttribute(t,C),o&&n.removeChild(o);const w=g_(),{extra:b}=w;b.attributes[yc]=e,Bc(v,m).then(E=>{const k=Lc({...w,icons:{main:E,mask:Pc()},prefix:m,iconName:C,extra:b,watchable:!0}),x=Ne.createElementNS("http://www.w3.org/2000/svg","svg");e==="::before"?n.insertBefore(x,n.firstChild):n.appendChild(x),x.outerHTML=k.map(O=>Fs(O)).join(`
`),n.removeAttribute(t),r()}).catch(i)}else r()}else r()})}function N_(n){return Promise.all([zp(n,"::before"),zp(n,"::after")])}function M_(n){return n.parentNode!==document.head&&!~kx.indexOf(n.tagName.toUpperCase())&&!n.getAttribute(yc)&&(!n.parentNode||n.parentNode.tagName!=="svg")}function Hp(n){if(Nn)return new Promise((e,t)=>{const r=Ci(n.querySelectorAll("*")).filter(M_).map(N_),i=$c.begin("searchPseudoElements");Lp(),Promise.all(r).then(()=>{i(),zc(),e()}).catch(()=>{i(),zc(),t()})})}var A_={hooks(){return{mutationObserverCallbacks(n){return n.pseudoElementsCallback=Hp,n}}},provides(n){n.pseudoElements2svg=function(e){const{node:t=Ne}=e;G.searchPseudoElements&&Hp(t)}}};let Gp=!1;var P_={mixout(){return{dom:{unwatch(){Lp(),Gp=!0}}}},hooks(){return{bootstrap(){Rp(Ic("mutationObserverCallbacks",{}))},noAuto(){d_()},watch(n){const{observeMutationsRoot:e}=n;Gp?zc():Rp(Ic("mutationObserverCallbacks",{observeMutationsRoot:e}))}}}};const Up=n=>{let e={size:16,x:0,y:0,flipX:!1,flipY:!1,rotate:0};return n.toLowerCase().split(" ").reduce((t,r)=>{const i=r.toLowerCase().split("-"),s=i[0];let o=i.slice(1).join("-");if(s&&o==="h")return t.flipX=!0,t;if(s&&o==="v")return t.flipY=!0,t;if(o=parseFloat(o),isNaN(o))return t;switch(s){case"grow":t.size=t.size+o;break;case"shrink":t.size=t.size-o;break;case"left":t.x=t.x-o;break;case"right":t.x=t.x+o;break;case"up":t.y=t.y-o;break;case"down":t.y=t.y+o;break;case"rotate":t.rotate=t.rotate+o;break}return t},e)};var I_={mixout(){return{parse:{transform:n=>Up(n)}}},hooks(){return{parseNodeAttributes(n,e){const t=e.getAttribute("data-fa-transform");return t&&(n.transform=Up(t)),n}}},provides(n){n.generateAbstractTransformGrouping=function(e){let{main:t,transform:r,containerWidth:i,iconWidth:s}=e;const o={transform:"translate(".concat(i/2," 256)")},a="translate(".concat(r.x*32,", ").concat(r.y*32,") "),l="scale(".concat(r.size/16*(r.flipX?-1:1),", ").concat(r.size/16*(r.flipY?-1:1),") "),c="rotate(".concat(r.rotate," 0 0)"),u={transform:"".concat(a," ").concat(l," ").concat(c)},d={transform:"translate(".concat(s/2*-1," -256)")},h={outer:o,inner:u,path:d};return{tag:"g",attributes:{...h.outer},children:[{tag:"g",attributes:{...h.inner},children:[{tag:t.icon.tag,children:t.icon.children,attributes:{...t.icon.attributes,...h.path}}]}]}}}};const Gc={x:0,y:0,width:"100%",height:"100%"};function Wp(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return n.attributes&&(n.attributes.fill||e)&&(n.attributes.fill="black"),n}function D_(n){return n.tag==="g"?n.children:[n]}var L_={hooks(){return{parseNodeAttributes(n,e){const t=e.getAttribute("data-fa-mask"),r=t?ia(t.split(" ").map(i=>i.trim())):Pc();return r.prefix||(r.prefix=nr()),n.mask=r,n.maskId=e.getAttribute("data-fa-mask-id"),n}}},provides(n){n.generateAbstractMask=function(e){let{children:t,attributes:r,main:i,mask:s,maskId:o,transform:a}=e;const{width:l,icon:c}=i,{width:u,icon:d}=s,h=Lx({transform:a,containerWidth:u,iconWidth:l}),m={tag:"rect",attributes:{...Gc,fill:"white"}},p=c.children?{children:c.children.map(Wp)}:{},g={tag:"g",attributes:{...h.inner},children:[Wp({tag:c.tag,attributes:{...c.attributes,...h.path},...p})]},y={tag:"g",attributes:{...h.outer},children:[g]},v="mask-".concat(o||Rs()),C="clip-".concat(o||Rs()),w={tag:"mask",attributes:{...Gc,id:v,maskUnits:"userSpaceOnUse",maskContentUnits:"userSpaceOnUse"},children:[m,y]},b={tag:"defs",children:[{tag:"clipPath",attributes:{id:C},children:D_(d)},w]};return t.push(b,{tag:"rect",attributes:{fill:"currentColor","clip-path":"url(#".concat(C,")"),mask:"url(#".concat(v,")"),...Gc}}),{children:t,attributes:r}}}},R_={provides(n){let e=!1;Zn.matchMedia&&(e=Zn.matchMedia("(prefers-reduced-motion: reduce)").matches),n.missingIconAbstract=function(){const t=[],r={fill:"currentColor"},i={attributeType:"XML",repeatCount:"indefinite",dur:"2s"};t.push({tag:"path",attributes:{...r,d:"M156.5,447.7l-12.6,29.5c-18.7-9.5-35.9-21.2-51.5-34.9l22.7-22.7C127.6,430.5,141.5,440,156.5,447.7z M40.6,272H8.5 c1.4,21.2,5.4,41.7,11.7,61.1L50,321.2C45.1,305.5,41.8,289,40.6,272z M40.6,240c1.4-18.8,5.2-37,11.1-54.1l-29.5-12.6 C14.7,194.3,10,216.7,8.5,240H40.6z M64.3,156.5c7.8-14.9,17.2-28.8,28.1-41.5L69.7,92.3c-13.7,15.6-25.5,32.8-34.9,51.5 L64.3,156.5z M397,419.6c-13.9,12-29.4,22.3-46.1,30.4l11.9,29.8c20.7-9.9,39.8-22.6,56.9-37.6L397,419.6z M115,92.4 c13.9-12,29.4-22.3,46.1-30.4l-11.9-29.8c-20.7,9.9-39.8,22.6-56.8,37.6L115,92.4z M447.7,355.5c-7.8,14.9-17.2,28.8-28.1,41.5 l22.7,22.7c13.7-15.6,25.5-32.9,34.9-51.5L447.7,355.5z M471.4,272c-1.4,18.8-5.2,37-11.1,54.1l29.5,12.6 c7.5-21.1,12.2-43.5,13.6-66.8H471.4z M321.2,462c-15.7,5-32.2,8.2-49.2,9.4v32.1c21.2-1.4,41.7-5.4,61.1-11.7L321.2,462z M240,471.4c-18.8-1.4-37-5.2-54.1-11.1l-12.6,29.5c21.1,7.5,43.5,12.2,66.8,13.6V471.4z M462,190.8c5,15.7,8.2,32.2,9.4,49.2h32.1 c-1.4-21.2-5.4-41.7-11.7-61.1L462,190.8z M92.4,397c-12-13.9-22.3-29.4-30.4-46.1l-29.8,11.9c9.9,20.7,22.6,39.8,37.6,56.9 L92.4,397z M272,40.6c18.8,1.4,36.9,5.2,54.1,11.1l12.6-29.5C317.7,14.7,295.3,10,272,8.5V40.6z M190.8,50 c15.7-5,32.2-8.2,49.2-9.4V8.5c-21.2,1.4-41.7,5.4-61.1,11.7L190.8,50z M442.3,92.3L419.6,115c12,13.9,22.3,29.4,30.5,46.1 l29.8-11.9C470,128.5,457.3,109.4,442.3,92.3z M397,92.4l22.7-22.7c-15.6-13.7-32.8-25.5-51.5-34.9l-12.6,29.5 C370.4,72.1,384.4,81.5,397,92.4z"}});const s={...i,attributeName:"opacity"},o={tag:"circle",attributes:{...r,cx:"256",cy:"364",r:"28"},children:[]};return e||o.children.push({tag:"animate",attributes:{...i,attributeName:"r",values:"28;14;28;28;14;28;"}},{tag:"animate",attributes:{...s,values:"1;0;1;1;0;1;"}}),t.push(o),t.push({tag:"path",attributes:{...r,opacity:"1",d:"M263.7,312h-16c-6.6,0-12-5.4-12-12c0-71,77.4-63.9,77.4-107.8c0-20-17.8-40.2-57.4-40.2c-29.1,0-44.3,9.6-59.2,28.7 c-3.9,5-11.1,6-16.2,2.4l-13.1-9.2c-5.6-3.9-6.9-11.8-2.6-17.2c21.2-27.2,46.4-44.7,91.2-44.7c52.3,0,97.4,29.8,97.4,80.2 c0,67.6-77.4,63.5-77.4,107.8C275.7,306.6,270.3,312,263.7,312z"},children:e?[]:[{tag:"animate",attributes:{...s,values:"1;0;0;0;0;1;"}}]}),e||t.push({tag:"path",attributes:{...r,opacity:"0",d:"M232.5,134.5l7,168c0.3,6.4,5.6,11.5,12,11.5h9c6.4,0,11.7-5.1,12-11.5l7-168c0.3-6.8-5.2-12.5-12-12.5h-23 C237.7,122,232.2,127.7,232.5,134.5z"},children:[{tag:"animate",attributes:{...s,values:"0;0;1;1;0;0;"}}]}),{tag:"g",attributes:{class:"missing"},children:t}}}},F_={hooks(){return{parseNodeAttributes(n,e){const t=e.getAttribute("data-fa-symbol"),r=t===null?!1:t===""?!0:t;return n.symbol=r,n}}}},B_=[Bx,C_,k_,S_,x_,A_,P_,I_,L_,R_,F_];Qx(B_,{mixoutsTo:Et}),Et.noAuto;const Kp=Et.config;Et.library,Et.dom;const ca=Et.parse;Et.findIconDefinition,Et.toHtml;const V_=Et.icon;Et.layer;const $_=Et.text;Et.counter;function Yp(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,r)}return t}function Zt(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Yp(Object(t),!0).forEach(function(r){vt(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Yp(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function j_(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function z_(n){var e=j_(n,"string");return typeof e=="symbol"?e:e+""}function ua(n){"@babel/helpers - typeof";return ua=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ua(n)}function vt(n,e,t){return e=z_(e),e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function H_(n,e){if(n==null)return{};var t={};for(var r in n)if(Object.prototype.hasOwnProperty.call(n,r)){if(e.indexOf(r)>=0)continue;t[r]=n[r]}return t}function G_(n,e){if(n==null)return{};var t=H_(n,e),r,i;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);for(i=0;i<s.length;i++)r=s[i],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(n,r)&&(t[r]=n[r])}return t}function Uc(n){return U_(n)||W_(n)||K_(n)||Y_()}function U_(n){if(Array.isArray(n))return Wc(n)}function W_(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function K_(n,e){if(n){if(typeof n=="string")return Wc(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Wc(n,e)}}function Wc(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}function Y_(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var q_=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},qp={exports:{}};(function(n){(function(e){var t=function(v,C,w){if(!c(C)||d(C)||h(C)||m(C)||l(C))return C;var b,E=0,k=0;if(u(C))for(b=[],k=C.length;E<k;E++)b.push(t(v,C[E],w));else{b={};for(var x in C)Object.prototype.hasOwnProperty.call(C,x)&&(b[v(x,w)]=t(v,C[x],w))}return b},r=function(v,C){C=C||{};var w=C.separator||"_",b=C.split||/(?=[A-Z])/;return v.split(b).join(w)},i=function(v){return p(v)?v:(v=v.replace(/[\-_\s]+(.)?/g,function(C,w){return w?w.toUpperCase():""}),v.substr(0,1).toLowerCase()+v.substr(1))},s=function(v){var C=i(v);return C.substr(0,1).toUpperCase()+C.substr(1)},o=function(v,C){return r(v,C).toLowerCase()},a=Object.prototype.toString,l=function(v){return typeof v=="function"},c=function(v){return v===Object(v)},u=function(v){return a.call(v)=="[object Array]"},d=function(v){return a.call(v)=="[object Date]"},h=function(v){return a.call(v)=="[object RegExp]"},m=function(v){return a.call(v)=="[object Boolean]"},p=function(v){return v=v-0,v===v},g=function(v,C){var w=C&&"process"in C?C.process:C;return typeof w!="function"?v:function(b,E){return w(b,v,E)}},y={camelize:i,decamelize:o,pascalize:s,depascalize:o,camelizeKeys:function(v,C){return t(g(i,C),v)},decamelizeKeys:function(v,C){return t(g(o,C),v,C)},pascalizeKeys:function(v,C){return t(g(s,C),v)},depascalizeKeys:function(){return this.decamelizeKeys.apply(this,arguments)}};n.exports?n.exports=y:e.humps=y})(q_)})(qp);var X_=qp.exports,J_=["class","style"];function Q_(n){return n.split(";").map(function(e){return e.trim()}).filter(function(e){return e}).reduce(function(e,t){var r=t.indexOf(":"),i=X_.camelize(t.slice(0,r)),s=t.slice(r+1).trim();return e[i]=s,e},{})}function Z_(n){return n.split(/\s+/).reduce(function(e,t){return e[t]=!0,e},{})}function Kc(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(typeof n=="string")return n;var r=(n.children||[]).map(function(l){return Kc(l)}),i=Object.keys(n.attributes||{}).reduce(function(l,c){var u=n.attributes[c];switch(c){case"class":l.class=Z_(u);break;case"style":l.style=Q_(u);break;default:l.attrs[c]=u}return l},{attrs:{},class:{},style:{}});t.class;var s=t.style,o=s===void 0?{}:s,a=G_(t,J_);return f.h(n.tag,Zt(Zt(Zt({},e),{},{class:i.class,style:Zt(Zt({},i.style),o)},i.attrs),a),r)}var Xp=!1;try{Xp=!0}catch{}function eE(){if(!Xp&&console&&typeof console.error=="function"){var n;(n=console).error.apply(n,arguments)}}function Vs(n,e){return Array.isArray(e)&&e.length>0||!Array.isArray(e)&&e?vt({},n,e):{}}function tE(n){var e,t=(e={"fa-spin":n.spin,"fa-pulse":n.pulse,"fa-fw":n.fixedWidth,"fa-border":n.border,"fa-li":n.listItem,"fa-inverse":n.inverse,"fa-flip":n.flip===!0,"fa-flip-horizontal":n.flip==="horizontal"||n.flip==="both","fa-flip-vertical":n.flip==="vertical"||n.flip==="both"},vt(vt(vt(vt(vt(vt(vt(vt(vt(vt(e,"fa-".concat(n.size),n.size!==null),"fa-rotate-".concat(n.rotation),n.rotation!==null),"fa-pull-".concat(n.pull),n.pull!==null),"fa-swap-opacity",n.swapOpacity),"fa-bounce",n.bounce),"fa-shake",n.shake),"fa-beat",n.beat),"fa-fade",n.fade),"fa-beat-fade",n.beatFade),"fa-flash",n.flash),vt(vt(e,"fa-spin-pulse",n.spinPulse),"fa-spin-reverse",n.spinReverse));return Object.keys(t).map(function(r){return t[r]?r:null}).filter(function(r){return r})}function Jp(n){if(n&&ua(n)==="object"&&n.prefix&&n.iconName&&n.icon)return n;if(ca.icon)return ca.icon(n);if(n===null)return null;if(ua(n)==="object"&&n.prefix&&n.iconName)return n;if(Array.isArray(n)&&n.length===2)return{prefix:n[0],iconName:n[1]};if(typeof n=="string")return{prefix:"fas",iconName:n}}var nE=f.defineComponent({name:"FontAwesomeIcon",props:{border:{type:Boolean,default:!1},fixedWidth:{type:Boolean,default:!1},flip:{type:[Boolean,String],default:!1,validator:function(e){return[!0,!1,"horizontal","vertical","both"].indexOf(e)>-1}},icon:{type:[Object,Array,String],required:!0},mask:{type:[Object,Array,String],default:null},maskId:{type:String,default:null},listItem:{type:Boolean,default:!1},pull:{type:String,default:null,validator:function(e){return["right","left"].indexOf(e)>-1}},pulse:{type:Boolean,default:!1},rotation:{type:[String,Number],default:null,validator:function(e){return[90,180,270].indexOf(Number.parseInt(e,10))>-1}},swapOpacity:{type:Boolean,default:!1},size:{type:String,default:null,validator:function(e){return["2xs","xs","sm","lg","xl","2xl","1x","2x","3x","4x","5x","6x","7x","8x","9x","10x"].indexOf(e)>-1}},spin:{type:Boolean,default:!1},transform:{type:[String,Object],default:null},symbol:{type:[Boolean,String],default:!1},title:{type:String,default:null},titleId:{type:String,default:null},inverse:{type:Boolean,default:!1},bounce:{type:Boolean,default:!1},shake:{type:Boolean,default:!1},beat:{type:Boolean,default:!1},fade:{type:Boolean,default:!1},beatFade:{type:Boolean,default:!1},flash:{type:Boolean,default:!1},spinPulse:{type:Boolean,default:!1},spinReverse:{type:Boolean,default:!1}},setup:function(e,t){var r=t.attrs,i=f.computed(function(){return Jp(e.icon)}),s=f.computed(function(){return Vs("classes",tE(e))}),o=f.computed(function(){return Vs("transform",typeof e.transform=="string"?ca.transform(e.transform):e.transform)}),a=f.computed(function(){return Vs("mask",Jp(e.mask))}),l=f.computed(function(){return V_(i.value,Zt(Zt(Zt(Zt({},s.value),o.value),a.value),{},{symbol:e.symbol,title:e.title,titleId:e.titleId,maskId:e.maskId}))});f.watch(l,function(u){if(!u)return eE("Could not find one or more icon(s)",i.value,a.value)},{immediate:!0});var c=f.computed(function(){return l.value?Kc(l.value.abstract[0],{},r):null});return function(){return c.value}}});f.defineComponent({name:"FontAwesomeLayers",props:{fixedWidth:{type:Boolean,default:!1}},setup:function(e,t){var r=t.slots,i=Kp.familyPrefix,s=f.computed(function(){return["".concat(i,"-layers")].concat(Uc(e.fixedWidth?["".concat(i,"-fw")]:[]))});return function(){return f.h("div",{class:s.value},r.default?r.default():[])}}}),f.defineComponent({name:"FontAwesomeLayersText",props:{value:{type:[String,Number],default:""},transform:{type:[String,Object],default:null},counter:{type:Boolean,default:!1},position:{type:String,default:null,validator:function(e){return["bottom-left","bottom-right","top-left","top-right"].indexOf(e)>-1}}},setup:function(e,t){var r=t.attrs,i=Kp.familyPrefix,s=f.computed(function(){return Vs("classes",[].concat(Uc(e.counter?["".concat(i,"-layers-counter")]:[]),Uc(e.position?["".concat(i,"-layers-").concat(e.position)]:[])))}),o=f.computed(function(){return Vs("transform",typeof e.transform=="string"?ca.transform(e.transform):e.transform)}),a=f.computed(function(){var c=$_(e.value.toString(),Zt(Zt({},o.value),s.value)),u=c.abstract;return e.counter&&(u[0].attributes.class=u[0].attributes.class.replace("fa-layers-text","")),u[0]}),l=f.computed(function(){return Kc(a.value,{},r)});return function(){return l.value}}});const rE={prefix:"fas",iconName:"file-lines",icon:[384,512,[128441,128462,61686,"file-alt","file-text"],"f15c","M64 0C28.7 0 0 28.7 0 64L0 448c0 35.3 28.7 64 64 64l256 0c35.3 0 64-28.7 64-64l0-288-128 0c-17.7 0-32-14.3-32-32L224 0 64 0zM256 0l0 128 128 0L256 0zM112 256l160 0c8.8 0 16 7.2 16 16s-7.2 16-16 16l-160 0c-8.8 0-16-7.2-16-16s7.2-16 16-16zm0 64l160 0c8.8 0 16 7.2 16 16s-7.2 16-16 16l-160 0c-8.8 0-16-7.2-16-16s7.2-16 16-16zm0 64l160 0c8.8 0 16 7.2 16 16s-7.2 16-16 16l-160 0c-8.8 0-16-7.2-16-16s7.2-16 16-16z"]},iE={prefix:"fas",iconName:"bars",icon:[448,512,["navicon"],"f0c9","M0 96C0 78.3 14.3 64 32 64l384 0c17.7 0 32 14.3 32 32s-14.3 32-32 32L32 128C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32l384 0c17.7 0 32 14.3 32 32s-14.3 32-32 32L32 288c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32L32 448c-17.7 0-32-14.3-32-32s14.3-32 32-32l384 0c17.7 0 32 14.3 32 32z"]},sE={prefix:"fas",iconName:"square-plus",icon:[448,512,[61846,"plus-square"],"f0fe","M64 32C28.7 32 0 60.7 0 96L0 416c0 35.3 28.7 64 64 64l320 0c35.3 0 64-28.7 64-64l0-320c0-35.3-28.7-64-64-64L64 32zM200 344l0-64-64 0c-13.3 0-24-10.7-24-24s10.7-24 24-24l64 0 0-64c0-13.3 10.7-24 24-24s24 10.7 24 24l0 64 64 0c13.3 0 24 10.7 24 24s-10.7 24-24 24l-64 0 0 64c0 13.3-10.7 24-24 24s-24-10.7-24-24z"]},oE={prefix:"fas",iconName:"rotate-left",icon:[512,512,["rotate-back","rotate-backward","undo-alt"],"f2ea","M48.5 224L40 224c-13.3 0-24-10.7-24-24L16 72c0-9.7 5.8-18.5 14.8-22.2s19.3-1.7 26.2 5.2L98.6 96.6c87.6-86.5 228.7-86.2 315.8 1c87.5 87.5 87.5 229.3 0 316.8s-229.3 87.5-316.8 0c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0c62.5 62.5 163.8 62.5 226.3 0s62.5-163.8 0-226.3c-62.2-62.2-162.7-62.5-225.3-1L185 183c6.9 6.9 8.9 17.2 5.2 26.2s-12.5 14.8-22.2 14.8L48.5 224z"]},aE={prefix:"fas",iconName:"arrow-right",icon:[448,512,[8594],"f061","M438.6 278.6c12.5-12.5 12.5-32.8 0-45.3l-160-160c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L338.8 224 32 224c-17.7 0-32 14.3-32 32s14.3 32 32 32l306.7 0L233.4 393.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l160-160z"]},lE={prefix:"fas",iconName:"text-width",icon:[448,512,[],"f035","M64 128l0-32 128 0 0 128-16 0c-17.7 0-32 14.3-32 32s14.3 32 32 32l96 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-16 0 0-128 128 0 0 32c0 17.7 14.3 32 32 32s32-14.3 32-32l0-48c0-26.5-21.5-48-48-48L224 32 48 32C21.5 32 0 53.5 0 80l0 48c0 17.7 14.3 32 32 32s32-14.3 32-32zM9.4 361.4c-12.5 12.5-12.5 32.8 0 45.3l64 64c9.2 9.2 22.9 11.9 34.9 6.9s19.8-16.6 19.8-29.6l0-32 192 0 0 32c0 12.9 7.8 24.6 19.8 29.6s25.7 2.2 34.9-6.9l64-64c12.5-12.5 12.5-32.8 0-45.3l-64-64c-9.2-9.2-22.9-11.9-34.9-6.9s-19.8 16.6-19.8 29.6l0 32-192 0 0-32c0-12.9-7.8-24.6-19.8-29.6s-25.7-2.2-34.9 6.9l-64 64z"]},cE={prefix:"fas",iconName:"arrow-left",icon:[448,512,[8592],"f060","M9.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.2 288 416 288c17.7 0 32-14.3 32-32s-14.3-32-32-32l-306.7 0L214.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"]},uE={prefix:"fas",iconName:"gear",icon:[512,512,[9881,"cog"],"f013","M495.9 166.6c3.2 8.7 .5 18.4-6.4 24.6l-43.3 39.4c1.1 8.3 1.7 16.8 1.7 25.4s-.6 17.1-1.7 25.4l43.3 39.4c6.9 6.2 9.6 15.9 6.4 24.6c-4.4 11.9-9.7 23.3-15.8 34.3l-4.7 8.1c-6.6 11-14 21.4-22.1 31.2c-5.9 7.2-15.7 9.6-24.5 6.8l-55.7-17.7c-13.4 10.3-28.2 18.9-44 25.4l-12.5 57.1c-2 9.1-9 16.3-18.2 17.8c-13.8 2.3-28 3.5-42.5 3.5s-28.7-1.2-42.5-3.5c-9.2-1.5-16.2-8.7-18.2-17.8l-12.5-57.1c-15.8-6.5-30.6-15.1-44-25.4L83.1 425.9c-8.8 2.8-18.6 .3-24.5-6.8c-8.1-9.8-15.5-20.2-22.1-31.2l-4.7-8.1c-6.1-11-11.4-22.4-15.8-34.3c-3.2-8.7-.5-18.4 6.4-24.6l43.3-39.4C64.6 273.1 64 264.6 64 256s.6-17.1 1.7-25.4L22.4 191.2c-6.9-6.2-9.6-15.9-6.4-24.6c4.4-11.9 9.7-23.3 15.8-34.3l4.7-8.1c6.6-11 14-21.4 22.1-31.2c5.9-7.2 15.7-9.6 24.5-6.8l55.7 17.7c13.4-10.3 28.2-18.9 44-25.4l12.5-57.1c2-9.1 9-16.3 18.2-17.8C227.3 1.2 241.5 0 256 0s28.7 1.2 42.5 3.5c9.2 1.5 16.2 8.7 18.2 17.8l12.5 57.1c15.8 6.5 30.6 15.1 44 25.4l55.7-17.7c8.8-2.8 18.6-.3 24.5 6.8c8.1 9.8 15.5 20.2 22.1 31.2l4.7 8.1c6.1 11 11.4 22.4 15.8 34.3zM256 336a80 80 0 1 0 0-160 80 80 0 1 0 0 160z"]},fE={prefix:"fas",iconName:"rotate-right",icon:[512,512,["redo-alt","rotate-forward"],"f2f9","M463.5 224l8.5 0c13.3 0 24-10.7 24-24l0-128c0-9.7-5.8-18.5-14.8-22.2s-19.3-1.7-26.2 5.2L413.4 96.6c-87.6-86.5-228.7-86.2-315.8 1c-87.5 87.5-87.5 229.3 0 316.8s229.3 87.5 316.8 0c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0c-62.5 62.5-163.8 62.5-226.3 0s-62.5-163.8 0-226.3c62.2-62.2 162.7-62.5 225.3-1L327 183c-6.9 6.9-8.9 17.2-5.2 26.2s12.5 14.8 22.2 14.8l119.5 0z"]},dE={prefix:"fas",iconName:"arrow-down",icon:[384,512,[8595],"f063","M169.4 470.6c12.5 12.5 32.8 12.5 45.3 0l160-160c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L224 370.8 224 64c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 306.7L54.6 265.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l160 160z"]},hE={prefix:"fas",iconName:"magnifying-glass",icon:[512,512,[128269,"search"],"f002","M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352a144 144 0 1 0 0-288 144 144 0 1 0 0 288z"]},pE={prefix:"fas",iconName:"arrow-up",icon:[384,512,[8593],"f062","M214.6 41.4c-12.5-12.5-32.8-12.5-45.3 0l-160 160c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L160 141.2 160 448c0 17.7 14.3 32 32 32s32-14.3 32-32l0-306.7L329.4 246.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3l-160-160z"]},mE={prefix:"fas",iconName:"xmark",icon:[384,512,[128473,10005,10006,10060,215,"close","multiply","remove","times"],"f00d","M342.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 210.7 86.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L146.7 256 41.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 301.3 297.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L237.3 256 342.6 150.6z"]},gE={prefix:"fas",iconName:"map",icon:[576,512,[128506,62072],"f279","M384 476.1L192 421.2l0-385.3L384 90.8l0 385.3zm32-1.2l0-386.5L543.1 37.5c15.8-6.3 32.9 5.3 32.9 22.3l0 334.8c0 9.8-6 18.6-15.1 22.3L416 474.8zM15.1 95.1L160 37.2l0 386.5L32.9 474.5C17.1 480.8 0 469.2 0 452.2L0 117.4c0-9.8 6-18.6 15.1-22.3z"]},yE={prefix:"fas",iconName:"clock-rotate-left",icon:[512,512,["history"],"f1da","M75 75L41 41C25.9 25.9 0 36.6 0 57.9L0 168c0 13.3 10.7 24 24 24l110.1 0c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24l0 104c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65 0-94.1c0-13.3-10.7-24-24-24z"]},Tt=f.defineComponent({__name:"BaseIcon",props:{icon:{type:String}},setup(n){const e={"fa-bars":iE,"fa-text-width":lE,"fa-search":hE,"fa-history":yE,"fa-plus-square":sE,"fa-cog":uE,"fa-file-text":rE,"fa-rotate-left":oE,"fa-rotate-right":fE,"fa-map":gE,"fa-close":mE,"fa-arrow-left":cE,"fa-arrow-right":aE,"fa-arrow-down":dE,"fa-arrow-up":pE};return(t,r)=>(f.openBlock(),f.createBlock(f.unref(nE),{icon:e[n.icon]},null,8,["icon"]))}}),bE=["onClick"],vE=f.defineComponent({__name:"AppFileMaps",setup(n){const{mapFile:e,mapCurrentID:t,drawer:r,mapRemoved:i}=Fe(),s=e.mapFile(new ae).ref(),o=t.id(new ae).ref(),a=l=>{confirm("Вы уверены?")&&i.give(l)};return(l,c)=>(f.openBlock(),f.createBlock(pc,{direction:"rtl",name:"fileMaps"},{header:f.withCtx(()=>c[0]||(c[0]=[f.createElementVNode("h2",{class:"text-lg font-bold"}," Карты в файле ",-1)])),default:f.withCtx(()=>[f.createElementVNode("div",null,[(f.openBlock(!0),f.createElementBlock(f.Fragment,null,f.renderList(f.unref(s),(u,d)=>(f.openBlock(),f.createElementBlock("div",{key:d,class:"flex items-center gap-2"},[f.createElementVNode("a",{href:"#",class:f.normalizeClass({"font-bold":f.unref(o)===d}),onClick:f.withModifiers(h=>{f.unref(t).give(d),f.unref(r).give("")},["prevent"])},f.toDisplayString(u.settings.title),11,bE),f.createVNode(Tt,{onClick:h=>a(d),class:"text-danger-second cursor-pointer",title:"Удалить карту",icon:"fa-close"},null,8,["onClick"])]))),128))])]),_:1}))}}),wE={class:"AppMenuObject"},CE={key:0,class:"AppMenuObject-Empty"},kE={key:1,class:"flex flex-col gap-1"},SE=["onClick"],xE=["innerHTML"],_E=f.defineComponent({__name:"AppMenuObject",setup(n){const{controlCombo:e,drawer:t,menu:r,stagePosition:i}=Fe(),{guest:s,patron:o}=yt(),a=r.menuObjects(new ae).ref();return e.happened("KeyM",o.create(s.create(()=>{t.give("menu")}))),(l,c)=>(f.openBlock(),f.createBlock(pc,{direction:"rtl",name:"menu"},{default:f.withCtx(()=>[f.createElementVNode("div",wE,[f.unref(a).length?(f.openBlock(),f.createElementBlock("div",kE,[(f.openBlock(!0),f.createElementBlock(f.Fragment,null,f.renderList(f.unref(a),u=>(f.openBlock(),f.createElementBlock("a",{key:u.id,class:"AppMenuObject-Item",href:"#",onClick:f.withModifiers(d=>{f.unref(i).give(u),f.unref(t).give("")},["prevent"])},[f.createElementVNode("span",{innerHTML:u.additionalName?u.additionalName:u.name},null,8,xE)],8,SE))),128))])):(f.openBlock(),f.createElementBlock("div",CE,f.toDisplayString(l.$t("appMenuObject.noItems")),1))])]),_:1}))}}),ke=f.defineComponent({__name:"BaseButton",props:{size:{type:String,default:"md",validator:n=>["sm","md","lg"].includes(n)},type:{type:String,default:"standard"}},setup(n){const e=n,t=["rounded-main",`text-${e.size}`,`p-${e.size}`,`bg-${e.type} hover:bg-${e.type}-second`];return t.push(""),(r,i)=>(f.openBlock(),f.createElementBlock("button",{type:"button",class:f.normalizeClass(t)},[f.renderSlot(r.$slots,"default")]))}}),EE={key:0,title:"Назад",class:"absolute text-white left-0 top-0 -ml-5 flex justify-center items-center bg-primary/70 hover:bg-primary-second/70 cursor-pointer w-5"},TE={key:1,class:"BaseModal-Header"},OE={class:"overflow-y-auto flex-grow"},NE={key:2,class:"BaseModal-Footer"},Hr=f.defineComponent({__name:"BaseModal",props:{name:{type:String,required:!0}},setup(n){const{modal:e}=Fe(),t=n,r=e.isOpenedByName(t.name,new ae).ref(),i=[],s=()=>{e.give("")};return(o,a)=>(f.openBlock(),f.createBlock(f.Transition,{name:"fade"},{default:f.withCtx(()=>[f.unref(r)?(f.openBlock(),f.createElementBlock("div",{key:0,class:"absolute rounded-main overflow-y-auto flex justify-center items-center top-0 left-0 bg-black/10 z-20 h-full w-full",onClick:s},[f.createElementVNode("div",{class:"w-full relative flex flex-col max-w-[800px] max-h-[90%] bg-white p-3",onClick:a[0]||(a[0]=f.withModifiers(()=>{},["stop"]))},[i.length>1?(f.openBlock(),f.createElementBlock("div",EE," < ")):f.createCommentVNode("",!0),f.createElementVNode("div",{title:"Закрыть",class:"e2e-modal-close absolute text-white right-0 top-0 -mr-5 flex justify-center items-center bg-danger/70 hover:bg-danger-second/70 cursor-pointer w-5",onClick:s}," × "),o.$slots.header?(f.openBlock(),f.createElementBlock("div",TE,[f.renderSlot(o.$slots,"header")])):f.createCommentVNode("",!0),f.createElementVNode("div",OE,[f.renderSlot(o.$slots,"default")]),o.$slots.footer?(f.openBlock(),f.createElementBlock("div",NE,[f.renderSlot(o.$slots,"footer")])):f.createCommentVNode("",!0)])])):f.createCommentVNode("",!0)]),_:3}))}}),ME={class:"AppPresets"},AE={class:"flex flex-col gap-2"},PE={class:"text-md font-bold mb-1"},IE={class:"flex gap-2 flex-wrap items-end"},DE={class:"AppTypesParent-ItemTitle"},LE=["innerHTML"],RE=f.defineComponent({__name:"AppPresets",setup(n){const{svgMapTypeImage:e}=yt(),{mapType:t,settings:r}=Fe(),i=new ae;r.value(i);const s=f.computed(()=>Object.fromEntries(Object.entries(i.value.presets).map(([o,a])=>[o,a.map(l=>({preset:l,image:e.create(l).markup()}))])));return(o,a)=>(f.openBlock(),f.createBlock(Hr,{name:"presets"},{default:f.withCtx(()=>[f.createElementVNode("div",ME,[a[0]||(a[0]=f.createElementVNode("div",{class:"text-md font-bold mb-2"},"Общие",-1)),f.createElementVNode("div",AE,[(f.openBlock(!0),f.createElementBlock(f.Fragment,null,f.renderList(s.value,(l,c)=>(f.openBlock(),f.createElementBlock("div",{key:c},[f.createElementVNode("h3",PE,f.toDisplayString(c),1),f.createElementVNode("div",IE,[(f.openBlock(!0),f.createElementBlock(f.Fragment,null,f.renderList(l,u=>(f.openBlock(),f.createElementBlock("div",{key:u.preset.name,class:"flex flex-col gap-2"},[f.createElementVNode("div",DE,f.toDisplayString(u.preset.name),1),f.createElementVNode("div",{class:"AppTypesParent-ItemImage",innerHTML:u.image,style:f.normalizeStyle(`width:${u.preset.width}px;height:${u.preset.height}px`)},null,12,LE),f.createVNode(ke,{class:"AppTypesParent-ItemButton e2e-add-preset-type",type:"success",size:"sm",onClick:d=>f.unref(t).give({name:u.preset.name,type:u.preset})},{default:f.withCtx(()=>[f.createTextVNode(f.toDisplayString(o.$t("general.addToMap")),1)]),_:2},1032,["onClick"])]))),128))])]))),128))])])]),_:1}))}});/**
* @vue/runtime-core v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function Yc(n,e,t,r){try{return r?n(...r):n()}catch(i){Zp(i,e,t)}}function Qp(n,e,t,r){if(qn(n)){const i=Yc(n,e,t,r);return i&&xS(i)&&i.catch(s=>{Zp(s,e,t)}),i}if(Xt(n)){const i=[];for(let s=0;s<n.length;s++)i.push(Qp(n[s],e,t,r));return i}}function Zp(n,e,t,r=!0){const i=e?e.vnode:null,{errorHandler:s,throwUnhandledErrorInProduction:o}=e&&e.appContext.config||ql;if(e){let a=e.parent;const l=e.proxy,c=`https://vuejs.org/error-reference/#runtime-${t}`;for(;a;){const u=a.ec;if(u){for(let d=0;d<u.length;d++)if(u[d](n,l,c)===!1)return}a=a.parent}if(s){ic(),Yc(s,null,10,[n,l,c]),sc();return}}FE(n,t,i,r,o)}function FE(n,e,t,r=!0,i=!1){if(i)throw n;console.error(n)}const It=[];let Pn=-1;const xi=[];let ir=null,_i=0;const BE=Promise.resolve();let qc=null;function VE(n){let e=Pn+1,t=It.length;for(;e<t;){const r=e+t>>>1,i=It[r],s=$s(i);s<n||s===n&&i.flags&2?e=r+1:t=r}return e}function $E(n){if(!(n.flags&1)){const e=$s(n),t=It[It.length-1];!t||!(n.flags&2)&&e>=$s(t)?It.push(n):It.splice(VE(e),0,n),n.flags|=1,em()}}function em(){qc||(qc=BE.then(tm))}function jE(n){Xt(n)?xi.push(...n):ir&&n.id===-1?ir.splice(_i+1,0,n):n.flags&1||(xi.push(n),n.flags|=1),em()}function zE(n){if(xi.length){const e=[...new Set(xi)].sort((t,r)=>$s(t)-$s(r));if(xi.length=0,ir){ir.push(...e);return}for(ir=e,_i=0;_i<ir.length;_i++){const t=ir[_i];t.flags&4&&(t.flags&=-2),t.flags&8||t(),t.flags&=-2}ir=null,_i=0}}const $s=n=>n.id==null?n.flags&2?-1:1/0:n.id;function tm(n){try{for(Pn=0;Pn<It.length;Pn++){const e=It[Pn];e&&!(e.flags&8)&&(e.flags&4&&(e.flags&=-2),Yc(e,e.i,e.i?15:14),e.flags&4||(e.flags&=-2))}}finally{for(;Pn<It.length;Pn++){const e=It[Pn];e&&(e.flags&=-2)}Pn=-1,It.length=0,zE(),qc=null,(It.length||xi.length)&&tm()}}let HE=null;Ql().requestIdleCallback,Ql().cancelIdleCallback;let GE=null;function UE(n,e,t=!1){const r=Xc||HE;if(r||GE){const i=r?r.parent==null?r.vnode.appContext&&r.vnode.appContext.provides:r.parent.provides:void 0;if(i&&n in i)return i[n];if(arguments.length>1)return t&&qn(e)?e.call(r&&r.proxy):e}}const WE=JE,KE=Symbol.for("v-scx"),YE=()=>UE(KE);function qE(n,e,t){return XE(n,e,t)}function XE(n,e,t=ql){const{immediate:r,deep:i,flush:s,once:o}=t,a=Th({},t),l=e&&r||!e&&s!=="post";let c;if(Jc){if(s==="sync"){const m=YE();c=m.__watcherHandles||(m.__watcherHandles=[])}else if(!l){const m=()=>{};return m.stop=Wo,m.resume=Wo,m.pause=Wo,m}}const u=Xc;a.call=(m,p,g)=>Qp(m,u,p,g);let d=!1;s==="post"?a.scheduler=m=>{WE(m,u&&u.suspense)}:s!=="sync"&&(d=!0,a.scheduler=(m,p)=>{p?m():$E(m)}),a.augmentJob=m=>{e&&(m.flags|=4),d&&(m.flags|=2,u&&(m.id=u.uid,m.i=u))};const h=ZS(n,e,a);return Jc&&(c?c.push(h):l&&h()),h}function JE(n,e){e&&e.pendingBranch?Xt(n)?e.effects.push(...n):e.effects.push(n):jE(n)}let Xc=null;{const n=Ql(),e=(t,r)=>{let i;return(i=n[t])||(i=n[t]=[]),i.push(r),s=>{i.length>1?i.forEach(o=>o(s)):i[0](s)}};e("__VUE_INSTANCE_SETTERS__",t=>Xc=t),e("__VUE_SSR_SETTERS__",t=>Jc=t)}let Jc=!1;const hn=f.defineComponent({__name:"BaseInput",props:{modelValue:{type:[String,Number],default:""},autofocus:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(n,{emit:e}){const t=n,r=e,i=Jo(null);qE(i,di(()=>{t.autofocus&&i.value.focus()},500));const s=xo(t,"modelValue",r);return(o,a)=>f.withDirectives((f.openBlock(),f.createElementBlock("input",{ref_key:"input",ref:i,"onUpdate:modelValue":a[0]||(a[0]=l=>f.isRef(s)?s.value=l:null),class:"block rounded-main w-full p-2 border border-solid border-body-dark",type:"text"},null,512)),[[f.vModelText,f.unref(s)]])}});class Qc{constructor(e){X(this,"pool",new vo(this));this.refSource=e,f.watch(e,t=>{t!==void 0&&this.pool.give(t)},{deep:!0})}value(e){return this.refSource.value&&e.give(this.refSource.value),this.pool.add(e),this}}const QE={class:"AppSearch"},ZE={key:0,class:"AppSearch-Items"},eT=["onClick"],tT=["innerHTML"],nT=["innerHTML"],rT=["innerHTML"],iT={key:1},sT={key:2},oT=f.defineComponent({__name:"AppSearch",setup(n){const{objectsMatchedToQuery:e,controlCombo:t,modal:r,stagePosition:i}=Fe(),{guest:s,patron:o}=yt(),a=f.ref(),l=ie.debug("app:AppSearch");r.isOpenedByName("search",o.create(s.create(d=>{setTimeout(()=>{d&&a.value&&(l("search is opened",d),a.value.$el.focus())},500)})));const c=f.ref(""),u=e.objects(new Qc(c),new ae([])).ref();return t.happened("KeyF",o.create(s.create(()=>{r.give("search")}))),(d,h)=>(f.openBlock(),f.createBlock(Hr,{name:"search"},{default:f.withCtx(()=>[f.createElementVNode("div",QE,[f.createVNode(hn,{ref_key:"inputRef",ref:a,modelValue:c.value,"onUpdate:modelValue":h[0]||(h[0]=m=>c.value=m),class:"mb-2 e2e-query-input",placeholder:d.$t("general.specifyQuery")},null,8,["modelValue","placeholder"]),f.unref(u).length?(f.openBlock(),f.createElementBlock("div",ZE,[(f.openBlock(!0),f.createElementBlock(f.Fragment,null,f.renderList(f.unref(u),m=>(f.openBlock(),f.createElementBlock("div",{key:m.name,class:"cursor-pointer",onClick:f.withModifiers(p=>{f.unref(i).give(m),f.unref(r).give("")},["prevent"])},[f.createElementVNode("b",{class:"AppSearch-ItemName",innerHTML:m.name},null,8,tT),m.additionalName?(f.openBlock(),f.createElementBlock("b",{key:0,class:"AppSearch-ItemName",innerHTML:m.additionalName},null,8,nT)):f.createCommentVNode("",!0),m.additionalFields?(f.openBlock(),f.createElementBlock("div",{key:1,innerHTML:Object.values(m.additionalFields).join(" ")},null,8,rT)):f.createCommentVNode("",!0)],8,eT))),128))])):c.value?(f.openBlock(),f.createElementBlock("div",iT,f.toDisplayString(d.$t("general.noResults")),1)):(f.openBlock(),f.createElementBlock("div",sT,f.toDisplayString(d.$t("general.resultsWillBeHere")),1))])]),_:1}))}}),aT={class:"AppTypes"},lT={class:"flex gap-2 items-end"},cT={class:"AppTypesParent-ItemTitle"},uT=["innerHTML"],fT=f.defineComponent({__name:"AppTypesParent",setup(n){const{parentTypes:e,mapType:t}=Fe(),{svgMapTypeImage:r}=yt(),i=e.types(new ae).ref(),s=f.computed(()=>{var o;return(o=i.value)==null?void 0:o.map(a=>({type:a,image:r.create(a).markup()})).sort((a,l)=>+(a.type.name>=l.type.name))});return(o,a)=>(f.openBlock(),f.createBlock(Hr,{name:"parentTypes"},{default:f.withCtx(()=>[f.createElementVNode("div",aT,[a[0]||(a[0]=f.createElementVNode("div",{class:"text-md font-bold mb-2"},"Родительские типы",-1)),f.createElementVNode("div",lT,[(f.openBlock(!0),f.createElementBlock(f.Fragment,null,f.renderList(s.value,l=>(f.openBlock(),f.createElementBlock("div",{key:l.type.name,class:"flex flex-col gap-2"},[f.createElementVNode("div",cT,f.toDisplayString(l.type.name),1),f.createElementVNode("div",{class:"AppTypesParent-ItemImage",innerHTML:l.image,style:f.normalizeStyle(`width:${l.type.width}px;height:${l.type.height}px`)},null,12,uT),f.createVNode(ke,{class:"AppTypesParent-ItemButton e2e-add-preset-type",type:"success",size:"sm",onClick:c=>f.unref(t).give({name:l.type.name,type:l.type})},{default:f.withCtx(()=>[f.createTextVNode(f.toDisplayString(o.$t("general.addToMap")),1)]),_:2},1032,["onClick"])]))),128))])])]),_:1}))}});class nm{constructor(e,t=void 0){X(this,"innerRef");this.executor=e,this.innerRef=f.ref(t)}ref(){return this.executor(this.innerRef),this.innerRef}}const dT={class:"flex gap-2"},Zc=f.defineComponent({__name:"BaseCheckbox",props:{modelValue:{type:Boolean},label:{type:String,required:!0}},emits:["update:modelValue"],setup(n,{emit:e}){const i=xo(n,"modelValue",e);return(s,o)=>(f.openBlock(),f.createElementBlock("label",dT,[f.withDirectives(f.createElementVNode("input",{"onUpdate:modelValue":o[0]||(o[0]=a=>f.isRef(i)?i.value=a:null),type:"checkbox"},null,512),[[f.vModelCheckbox,f.unref(i)]]),s.$slots.default?f.renderSlot(s.$slots,"default",{key:0}):(f.openBlock(),f.createElementBlock(f.Fragment,{key:1},[f.createTextVNode(f.toDisplayString(n.label),1)],64))]))}}),fa=(n,e)=>{const t=n.__vccOpts||n;for(const[r,i]of e)t[r]=i;return t},hT={},pT={class:"text-sm font-bold"};function mT(n,e){return f.openBlock(),f.createElementBlock("div",pT,[f.renderSlot(n.$slots,"default")])}const Ot=fa(hT,[["render",mT]]),gT={},yT={class:"mb-2"};function bT(n,e){return f.openBlock(),f.createElementBlock("div",yT,[f.renderSlot(n.$slots,"default")])}const Dt=fa(gT,[["render",bT]]);function Je(n){this.content=n}Je.prototype={constructor:Je,find:function(n){for(var e=0;e<this.content.length;e+=2)if(this.content[e]===n)return e;return-1},get:function(n){var e=this.find(n);return e==-1?void 0:this.content[e+1]},update:function(n,e,t){var r=t&&t!=n?this.remove(t):this,i=r.find(n),s=r.content.slice();return i==-1?s.push(t||n,e):(s[i+1]=e,t&&(s[i]=t)),new Je(s)},remove:function(n){var e=this.find(n);if(e==-1)return this;var t=this.content.slice();return t.splice(e,2),new Je(t)},addToStart:function(n,e){return new Je([n,e].concat(this.remove(n).content))},addToEnd:function(n,e){var t=this.remove(n).content.slice();return t.push(n,e),new Je(t)},addBefore:function(n,e,t){var r=this.remove(e),i=r.content.slice(),s=r.find(n);return i.splice(s==-1?i.length:s,0,e,t),new Je(i)},forEach:function(n){for(var e=0;e<this.content.length;e+=2)n(this.content[e],this.content[e+1])},prepend:function(n){return n=Je.from(n),n.size?new Je(n.content.concat(this.subtract(n).content)):this},append:function(n){return n=Je.from(n),n.size?new Je(this.subtract(n).content.concat(n.content)):this},subtract:function(n){var e=this;n=Je.from(n);for(var t=0;t<n.content.length;t+=2)e=e.remove(n.content[t]);return e},toObject:function(){var n={};return this.forEach(function(e,t){n[e]=t}),n},get size(){return this.content.length>>1}},Je.from=function(n){if(n instanceof Je)return n;var e=[];if(n)for(var t in n)e.push(t,n[t]);return new Je(e)};function rm(n,e,t){for(let r=0;;r++){if(r==n.childCount||r==e.childCount)return n.childCount==e.childCount?null:t;let i=n.child(r),s=e.child(r);if(i==s){t+=i.nodeSize;continue}if(!i.sameMarkup(s))return t;if(i.isText&&i.text!=s.text){for(let o=0;i.text[o]==s.text[o];o++)t++;return t}if(i.content.size||s.content.size){let o=rm(i.content,s.content,t+1);if(o!=null)return o}t+=i.nodeSize}}function im(n,e,t,r){for(let i=n.childCount,s=e.childCount;;){if(i==0||s==0)return i==s?null:{a:t,b:r};let o=n.child(--i),a=e.child(--s),l=o.nodeSize;if(o==a){t-=l,r-=l;continue}if(!o.sameMarkup(a))return{a:t,b:r};if(o.isText&&o.text!=a.text){let c=0,u=Math.min(o.text.length,a.text.length);for(;c<u&&o.text[o.text.length-c-1]==a.text[a.text.length-c-1];)c++,t--,r--;return{a:t,b:r}}if(o.content.size||a.content.size){let c=im(o.content,a.content,t-1,r-1);if(c)return c}t-=l,r-=l}}class I{constructor(e,t){if(this.content=e,this.size=t||0,t==null)for(let r=0;r<e.length;r++)this.size+=e[r].nodeSize}nodesBetween(e,t,r,i=0,s){for(let o=0,a=0;a<t;o++){let l=this.content[o],c=a+l.nodeSize;if(c>e&&r(l,i+a,s||null,o)!==!1&&l.content.size){let u=a+1;l.nodesBetween(Math.max(0,e-u),Math.min(l.content.size,t-u),r,i+u)}a=c}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,t,r,i){let s="",o=!0;return this.nodesBetween(e,t,(a,l)=>{let c=a.isText?a.text.slice(Math.max(e,l)-l,t-l):a.isLeaf?i?typeof i=="function"?i(a):i:a.type.spec.leafText?a.type.spec.leafText(a):"":"";a.isBlock&&(a.isLeaf&&c||a.isTextblock)&&r&&(o?o=!1:s+=r),s+=c},0),s}append(e){if(!e.size)return this;if(!this.size)return e;let t=this.lastChild,r=e.firstChild,i=this.content.slice(),s=0;for(t.isText&&t.sameMarkup(r)&&(i[i.length-1]=t.withText(t.text+r.text),s=1);s<e.content.length;s++)i.push(e.content[s]);return new I(i,this.size+e.size)}cut(e,t=this.size){if(e==0&&t==this.size)return this;let r=[],i=0;if(t>e)for(let s=0,o=0;o<t;s++){let a=this.content[s],l=o+a.nodeSize;l>e&&((o<e||l>t)&&(a.isText?a=a.cut(Math.max(0,e-o),Math.min(a.text.length,t-o)):a=a.cut(Math.max(0,e-o-1),Math.min(a.content.size,t-o-1))),r.push(a),i+=a.nodeSize),o=l}return new I(r,i)}cutByIndex(e,t){return e==t?I.empty:e==0&&t==this.content.length?this:new I(this.content.slice(e,t))}replaceChild(e,t){let r=this.content[e];if(r==t)return this;let i=this.content.slice(),s=this.size+t.nodeSize-r.nodeSize;return i[e]=t,new I(i,s)}addToStart(e){return new I([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new I(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let t=0;t<this.content.length;t++)if(!this.content[t].eq(e.content[t]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let t=this.content[e];if(!t)throw new RangeError("Index "+e+" out of range for "+this);return t}maybeChild(e){return this.content[e]||null}forEach(e){for(let t=0,r=0;t<this.content.length;t++){let i=this.content[t];e(i,r,t),r+=i.nodeSize}}findDiffStart(e,t=0){return rm(this,e,t)}findDiffEnd(e,t=this.size,r=e.size){return im(this,e,t,r)}findIndex(e,t=-1){if(e==0)return da(0,e);if(e==this.size)return da(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let r=0,i=0;;r++){let s=this.child(r),o=i+s.nodeSize;if(o>=e)return o==e||t>0?da(r+1,o):da(r,i);i=o}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(e,t){if(!t)return I.empty;if(!Array.isArray(t))throw new RangeError("Invalid input for Fragment.fromJSON");return new I(t.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return I.empty;let t,r=0;for(let i=0;i<e.length;i++){let s=e[i];r+=s.nodeSize,i&&s.isText&&e[i-1].sameMarkup(s)?(t||(t=e.slice(0,i)),t[t.length-1]=s.withText(t[t.length-1].text+s.text)):t&&t.push(s)}return new I(t||e,r)}static from(e){if(!e)return I.empty;if(e instanceof I)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new I([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}I.empty=new I([],0);const eu={index:0,offset:0};function da(n,e){return eu.index=n,eu.offset=e,eu}function ha(n,e){if(n===e)return!0;if(!(n&&typeof n=="object")||!(e&&typeof e=="object"))return!1;let t=Array.isArray(n);if(Array.isArray(e)!=t)return!1;if(t){if(n.length!=e.length)return!1;for(let r=0;r<n.length;r++)if(!ha(n[r],e[r]))return!1}else{for(let r in n)if(!(r in e)||!ha(n[r],e[r]))return!1;for(let r in e)if(!(r in n))return!1}return!0}let Se=class Gf{constructor(e,t){this.type=e,this.attrs=t}addToSet(e){let t,r=!1;for(let i=0;i<e.length;i++){let s=e[i];if(this.eq(s))return e;if(this.type.excludes(s.type))t||(t=e.slice(0,i));else{if(s.type.excludes(this.type))return e;!r&&s.type.rank>this.type.rank&&(t||(t=e.slice(0,i)),t.push(this),r=!0),t&&t.push(s)}}return t||(t=e.slice()),r||t.push(this),t}removeFromSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return e.slice(0,t).concat(e.slice(t+1));return e}isInSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return!0;return!1}eq(e){return this==e||this.type==e.type&&ha(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Mark.fromJSON");let r=e.marks[t.type];if(!r)throw new RangeError(`There is no mark type ${t.type} in this schema`);let i=r.create(t.attrs);return r.checkAttrs(i.attrs),i}static sameSet(e,t){if(e==t)return!0;if(e.length!=t.length)return!1;for(let r=0;r<e.length;r++)if(!e[r].eq(t[r]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&e.length==0)return Gf.none;if(e instanceof Gf)return[e];let t=e.slice();return t.sort((r,i)=>r.type.rank-i.type.rank),t}};Se.none=[];class pa extends Error{}class V{constructor(e,t,r){this.content=e,this.openStart=t,this.openEnd=r}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,t){let r=om(this.content,e+this.openStart,t);return r&&new V(r,this.openStart,this.openEnd)}removeBetween(e,t){return new V(sm(this.content,e+this.openStart,t+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,t){if(!t)return V.empty;let r=t.openStart||0,i=t.openEnd||0;if(typeof r!="number"||typeof i!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new V(I.fromJSON(e,t.content),r,i)}static maxOpen(e,t=!0){let r=0,i=0;for(let s=e.firstChild;s&&!s.isLeaf&&(t||!s.type.spec.isolating);s=s.firstChild)r++;for(let s=e.lastChild;s&&!s.isLeaf&&(t||!s.type.spec.isolating);s=s.lastChild)i++;return new V(e,r,i)}}V.empty=new V(I.empty,0,0);function sm(n,e,t){let{index:r,offset:i}=n.findIndex(e),s=n.maybeChild(r),{index:o,offset:a}=n.findIndex(t);if(i==e||s.isText){if(a!=t&&!n.child(o).isText)throw new RangeError("Removing non-flat range");return n.cut(0,e).append(n.cut(t))}if(r!=o)throw new RangeError("Removing non-flat range");return n.replaceChild(r,s.copy(sm(s.content,e-i-1,t-i-1)))}function om(n,e,t,r){let{index:i,offset:s}=n.findIndex(e),o=n.maybeChild(i);if(s==e||o.isText)return n.cut(0,e).append(t).append(n.cut(e));let a=om(o.content,e-s-1,t);return a&&n.replaceChild(i,o.copy(a))}function vT(n,e,t){if(t.openStart>n.depth)throw new pa("Inserted content deeper than insertion position");if(n.depth-t.openStart!=e.depth-t.openEnd)throw new pa("Inconsistent open depths");return am(n,e,t,0)}function am(n,e,t,r){let i=n.index(r),s=n.node(r);if(i==e.index(r)&&r<n.depth-t.openStart){let o=am(n,e,t,r+1);return s.copy(s.content.replaceChild(i,o))}else if(t.content.size)if(!t.openStart&&!t.openEnd&&n.depth==r&&e.depth==r){let o=n.parent,a=o.content;return Ur(o,a.cut(0,n.parentOffset).append(t.content).append(a.cut(e.parentOffset)))}else{let{start:o,end:a}=wT(t,n);return Ur(s,cm(n,o,a,e,r))}else return Ur(s,ma(n,e,r))}function lm(n,e){if(!e.type.compatibleContent(n.type))throw new pa("Cannot join "+e.type.name+" onto "+n.type.name)}function tu(n,e,t){let r=n.node(t);return lm(r,e.node(t)),r}function Gr(n,e){let t=e.length-1;t>=0&&n.isText&&n.sameMarkup(e[t])?e[t]=n.withText(e[t].text+n.text):e.push(n)}function js(n,e,t,r){let i=(e||n).node(t),s=0,o=e?e.index(t):i.childCount;n&&(s=n.index(t),n.depth>t?s++:n.textOffset&&(Gr(n.nodeAfter,r),s++));for(let a=s;a<o;a++)Gr(i.child(a),r);e&&e.depth==t&&e.textOffset&&Gr(e.nodeBefore,r)}function Ur(n,e){return n.type.checkContent(e),n.copy(e)}function cm(n,e,t,r,i){let s=n.depth>i&&tu(n,e,i+1),o=r.depth>i&&tu(t,r,i+1),a=[];return js(null,n,i,a),s&&o&&e.index(i)==t.index(i)?(lm(s,o),Gr(Ur(s,cm(n,e,t,r,i+1)),a)):(s&&Gr(Ur(s,ma(n,e,i+1)),a),js(e,t,i,a),o&&Gr(Ur(o,ma(t,r,i+1)),a)),js(r,null,i,a),new I(a)}function ma(n,e,t){let r=[];if(js(null,n,t,r),n.depth>t){let i=tu(n,e,t+1);Gr(Ur(i,ma(n,e,t+1)),r)}return js(e,null,t,r),new I(r)}function wT(n,e){let t=e.depth-n.openStart,i=e.node(t).copy(n.content);for(let s=t-1;s>=0;s--)i=e.node(s).copy(I.from(i));return{start:i.resolveNoCache(n.openStart+t),end:i.resolveNoCache(i.content.size-n.openEnd-t)}}class zs{constructor(e,t,r){this.pos=e,this.path=t,this.parentOffset=r,this.depth=t.length/3-1}resolveDepth(e){return e==null?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[this.resolveDepth(e)*3]}index(e){return this.path[this.resolveDepth(e)*3+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)}start(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]}after(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,t=this.index(this.depth);if(t==e.childCount)return null;let r=this.pos-this.path[this.path.length-1],i=e.child(t);return r?e.child(t).cut(r):i}get nodeBefore(){let e=this.index(this.depth),t=this.pos-this.path[this.path.length-1];return t?this.parent.child(e).cut(0,t):e==0?null:this.parent.child(e-1)}posAtIndex(e,t){t=this.resolveDepth(t);let r=this.path[t*3],i=t==0?0:this.path[t*3-1]+1;for(let s=0;s<e;s++)i+=r.child(s).nodeSize;return i}marks(){let e=this.parent,t=this.index();if(e.content.size==0)return Se.none;if(this.textOffset)return e.child(t).marks;let r=e.maybeChild(t-1),i=e.maybeChild(t);if(!r){let a=r;r=i,i=a}let s=r.marks;for(var o=0;o<s.length;o++)s[o].type.spec.inclusive===!1&&(!i||!s[o].isInSet(i.marks))&&(s=s[o--].removeFromSet(s));return s}marksAcross(e){let t=this.parent.maybeChild(this.index());if(!t||!t.isInline)return null;let r=t.marks,i=e.parent.maybeChild(e.index());for(var s=0;s<r.length;s++)r[s].type.spec.inclusive===!1&&(!i||!r[s].isInSet(i.marks))&&(r=r[s--].removeFromSet(r));return r}sharedDepth(e){for(let t=this.depth;t>0;t--)if(this.start(t)<=e&&this.end(t)>=e)return t;return 0}blockRange(e=this,t){if(e.pos<this.pos)return e.blockRange(this);for(let r=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);r>=0;r--)if(e.pos<=this.end(r)&&(!t||t(this.node(r))))return new ga(this,e,r);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let t=1;t<=this.depth;t++)e+=(e?"/":"")+this.node(t).type.name+"_"+this.index(t-1);return e+":"+this.parentOffset}static resolve(e,t){if(!(t>=0&&t<=e.content.size))throw new RangeError("Position "+t+" out of range");let r=[],i=0,s=t;for(let o=e;;){let{index:a,offset:l}=o.content.findIndex(s),c=s-l;if(r.push(o,a,i+l),!c||(o=o.child(a),o.isText))break;s=c-1,i+=l+1}return new zs(t,r,s)}static resolveCached(e,t){let r=um.get(e);if(r)for(let s=0;s<r.elts.length;s++){let o=r.elts[s];if(o.pos==t)return o}else um.set(e,r=new CT);let i=r.elts[r.i]=zs.resolve(e,t);return r.i=(r.i+1)%kT,i}}class CT{constructor(){this.elts=[],this.i=0}}const kT=12,um=new WeakMap;class ga{constructor(e,t,r){this.$from=e,this.$to=t,this.depth=r}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const ST=Object.create(null);let sr=class Uf{constructor(e,t,r,i=Se.none){this.type=e,this.attrs=t,this.marks=i,this.content=r||I.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,t,r,i=0){this.content.nodesBetween(e,t,r,i,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,t,r,i){return this.content.textBetween(e,t,r,i)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,t,r){return this.type==e&&ha(this.attrs,t||e.defaultAttrs||ST)&&Se.sameSet(this.marks,r||Se.none)}copy(e=null){return e==this.content?this:new Uf(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new Uf(this.type,this.attrs,this.content,e)}cut(e,t=this.content.size){return e==0&&t==this.content.size?this:this.copy(this.content.cut(e,t))}slice(e,t=this.content.size,r=!1){if(e==t)return V.empty;let i=this.resolve(e),s=this.resolve(t),o=r?0:i.sharedDepth(t),a=i.start(o),c=i.node(o).content.cut(i.pos-a,s.pos-a);return new V(c,i.depth-o,s.depth-o)}replace(e,t,r){return vT(this.resolve(e),this.resolve(t),r)}nodeAt(e){for(let t=this;;){let{index:r,offset:i}=t.content.findIndex(e);if(t=t.maybeChild(r),!t)return null;if(i==e||t.isText)return t;e-=i+1}}childAfter(e){let{index:t,offset:r}=this.content.findIndex(e);return{node:this.content.maybeChild(t),index:t,offset:r}}childBefore(e){if(e==0)return{node:null,index:0,offset:0};let{index:t,offset:r}=this.content.findIndex(e);if(r<e)return{node:this.content.child(t),index:t,offset:r};let i=this.content.child(t-1);return{node:i,index:t-1,offset:r-i.nodeSize}}resolve(e){return zs.resolveCached(this,e)}resolveNoCache(e){return zs.resolve(this,e)}rangeHasMark(e,t,r){let i=!1;return t>e&&this.nodesBetween(e,t,s=>(r.isInSet(s.marks)&&(i=!0),!i)),i}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),fm(this.marks,e)}contentMatchAt(e){let t=this.type.contentMatch.matchFragment(this.content,0,e);if(!t)throw new Error("Called contentMatchAt on a node with invalid content");return t}canReplace(e,t,r=I.empty,i=0,s=r.childCount){let o=this.contentMatchAt(e).matchFragment(r,i,s),a=o&&o.matchFragment(this.content,t);if(!a||!a.validEnd)return!1;for(let l=i;l<s;l++)if(!this.type.allowsMarks(r.child(l).marks))return!1;return!0}canReplaceWith(e,t,r,i){if(i&&!this.type.allowsMarks(i))return!1;let s=this.contentMatchAt(e).matchType(r),o=s&&s.matchFragment(this.content,t);return o?o.validEnd:!1}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let e=Se.none;for(let t=0;t<this.marks.length;t++){let r=this.marks[t];r.type.checkAttrs(r.attrs),e=r.addToSet(e)}if(!Se.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(t=>t.type.name)}`);this.content.forEach(t=>t.check())}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(t=>t.toJSON())),e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Node.fromJSON");let r;if(t.marks){if(!Array.isArray(t.marks))throw new RangeError("Invalid mark data for Node.fromJSON");r=t.marks.map(e.markFromJSON)}if(t.type=="text"){if(typeof t.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(t.text,r)}let i=I.fromJSON(e,t.content),s=e.nodeType(t.type).create(t.attrs,i,r);return s.type.checkAttrs(s.attrs),s}};sr.prototype.text=void 0;class ya extends sr{constructor(e,t,r,i){if(super(e,t,null,i),!r)throw new RangeError("Empty text nodes are not allowed");this.text=r}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):fm(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,t){return this.text.slice(e,t)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new ya(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new ya(this.type,this.attrs,e,this.marks)}cut(e=0,t=this.text.length){return e==0&&t==this.text.length?this:this.withText(this.text.slice(e,t))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}}function fm(n,e){for(let t=n.length-1;t>=0;t--)e=n[t].type.name+"("+e+")";return e}class Wr{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,t){let r=new xT(e,t);if(r.next==null)return Wr.empty;let i=dm(r);r.next&&r.err("Unexpected trailing text");let s=AT(MT(i));return PT(s,r),s}matchType(e){for(let t=0;t<this.next.length;t++)if(this.next[t].type==e)return this.next[t].next;return null}matchFragment(e,t=0,r=e.childCount){let i=this;for(let s=t;i&&s<r;s++)i=i.matchType(e.child(s).type);return i}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:t}=this.next[e];if(!(t.isText||t.hasRequiredAttrs()))return t}return null}compatible(e){for(let t=0;t<this.next.length;t++)for(let r=0;r<e.next.length;r++)if(this.next[t].type==e.next[r].type)return!0;return!1}fillBefore(e,t=!1,r=0){let i=[this];function s(o,a){let l=o.matchFragment(e,r);if(l&&(!t||l.validEnd))return I.from(a.map(c=>c.createAndFill()));for(let c=0;c<o.next.length;c++){let{type:u,next:d}=o.next[c];if(!(u.isText||u.hasRequiredAttrs())&&i.indexOf(d)==-1){i.push(d);let h=s(d,a.concat(u));if(h)return h}}return null}return s(this,[])}findWrapping(e){for(let r=0;r<this.wrapCache.length;r+=2)if(this.wrapCache[r]==e)return this.wrapCache[r+1];let t=this.computeWrapping(e);return this.wrapCache.push(e,t),t}computeWrapping(e){let t=Object.create(null),r=[{match:this,type:null,via:null}];for(;r.length;){let i=r.shift(),s=i.match;if(s.matchType(e)){let o=[];for(let a=i;a.type;a=a.via)o.push(a.type);return o.reverse()}for(let o=0;o<s.next.length;o++){let{type:a,next:l}=s.next[o];!a.isLeaf&&!a.hasRequiredAttrs()&&!(a.name in t)&&(!i.type||l.validEnd)&&(r.push({match:a.contentMatch,type:a,via:i}),t[a.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];function t(r){e.push(r);for(let i=0;i<r.next.length;i++)e.indexOf(r.next[i].next)==-1&&t(r.next[i].next)}return t(this),e.map((r,i)=>{let s=i+(r.validEnd?"*":" ")+" ";for(let o=0;o<r.next.length;o++)s+=(o?", ":"")+r.next[o].type.name+"->"+e.indexOf(r.next[o].next);return s}).join(`
`)}}Wr.empty=new Wr(!0);class xT{constructor(e,t){this.string=e,this.nodeTypes=t,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}}function dm(n){let e=[];do e.push(_T(n));while(n.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function _T(n){let e=[];do e.push(ET(n));while(n.next&&n.next!=")"&&n.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function ET(n){let e=NT(n);for(;;)if(n.eat("+"))e={type:"plus",expr:e};else if(n.eat("*"))e={type:"star",expr:e};else if(n.eat("?"))e={type:"opt",expr:e};else if(n.eat("{"))e=TT(n,e);else break;return e}function hm(n){/\D/.test(n.next)&&n.err("Expected number, got '"+n.next+"'");let e=Number(n.next);return n.pos++,e}function TT(n,e){let t=hm(n),r=t;return n.eat(",")&&(n.next!="}"?r=hm(n):r=-1),n.eat("}")||n.err("Unclosed braced range"),{type:"range",min:t,max:r,expr:e}}function OT(n,e){let t=n.nodeTypes,r=t[e];if(r)return[r];let i=[];for(let s in t){let o=t[s];o.isInGroup(e)&&i.push(o)}return i.length==0&&n.err("No node type or group '"+e+"' found"),i}function NT(n){if(n.eat("(")){let e=dm(n);return n.eat(")")||n.err("Missing closing paren"),e}else if(/\W/.test(n.next))n.err("Unexpected token '"+n.next+"'");else{let e=OT(n,n.next).map(t=>(n.inline==null?n.inline=t.isInline:n.inline!=t.isInline&&n.err("Mixing inline and block content"),{type:"name",value:t}));return n.pos++,e.length==1?e[0]:{type:"choice",exprs:e}}}function MT(n){let e=[[]];return i(s(n,0),t()),e;function t(){return e.push([])-1}function r(o,a,l){let c={term:l,to:a};return e[o].push(c),c}function i(o,a){o.forEach(l=>l.to=a)}function s(o,a){if(o.type=="choice")return o.exprs.reduce((l,c)=>l.concat(s(c,a)),[]);if(o.type=="seq")for(let l=0;;l++){let c=s(o.exprs[l],a);if(l==o.exprs.length-1)return c;i(c,a=t())}else if(o.type=="star"){let l=t();return r(a,l),i(s(o.expr,l),l),[r(l)]}else if(o.type=="plus"){let l=t();return i(s(o.expr,a),l),i(s(o.expr,l),l),[r(l)]}else{if(o.type=="opt")return[r(a)].concat(s(o.expr,a));if(o.type=="range"){let l=a;for(let c=0;c<o.min;c++){let u=t();i(s(o.expr,l),u),l=u}if(o.max==-1)i(s(o.expr,l),l);else for(let c=o.min;c<o.max;c++){let u=t();r(l,u),i(s(o.expr,l),u),l=u}return[r(l)]}else{if(o.type=="name")return[r(a,void 0,o.value)];throw new Error("Unknown expr type")}}}}function pm(n,e){return e-n}function mm(n,e){let t=[];return r(e),t.sort(pm);function r(i){let s=n[i];if(s.length==1&&!s[0].term)return r(s[0].to);t.push(i);for(let o=0;o<s.length;o++){let{term:a,to:l}=s[o];!a&&t.indexOf(l)==-1&&r(l)}}}function AT(n){let e=Object.create(null);return t(mm(n,0));function t(r){let i=[];r.forEach(o=>{n[o].forEach(({term:a,to:l})=>{if(!a)return;let c;for(let u=0;u<i.length;u++)i[u][0]==a&&(c=i[u][1]);mm(n,l).forEach(u=>{c||i.push([a,c=[]]),c.indexOf(u)==-1&&c.push(u)})})});let s=e[r.join(",")]=new Wr(r.indexOf(n.length-1)>-1);for(let o=0;o<i.length;o++){let a=i[o][1].sort(pm);s.next.push({type:i[o][0],next:e[a.join(",")]||t(a)})}return s}}function PT(n,e){for(let t=0,r=[n];t<r.length;t++){let i=r[t],s=!i.validEnd,o=[];for(let a=0;a<i.next.length;a++){let{type:l,next:c}=i.next[a];o.push(l.name),s&&!(l.isText||l.hasRequiredAttrs())&&(s=!1),r.indexOf(c)==-1&&r.push(c)}s&&e.err("Only non-generatable nodes ("+o.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function gm(n){let e=Object.create(null);for(let t in n){let r=n[t];if(!r.hasDefault)return null;e[t]=r.default}return e}function ym(n,e){let t=Object.create(null);for(let r in n){let i=e&&e[r];if(i===void 0){let s=n[r];if(s.hasDefault)i=s.default;else throw new RangeError("No value supplied for attribute "+r)}t[r]=i}return t}function bm(n,e,t,r){for(let i in e)if(!(i in n))throw new RangeError(`Unsupported attribute ${i} for ${t} of type ${i}`);for(let i in n){let s=n[i];s.validate&&s.validate(e[i])}}function vm(n,e){let t=Object.create(null);if(e)for(let r in e)t[r]=new DT(n,r,e[r]);return t}let wm=class Vb{constructor(e,t,r){this.name=e,this.schema=t,this.spec=r,this.markSet=null,this.groups=r.group?r.group.split(" "):[],this.attrs=vm(e,r.attrs),this.defaultAttrs=gm(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(r.inline||e=="text"),this.isText=e=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==Wr.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(e){return this.groups.indexOf(e)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:ym(this.attrs,e)}create(e=null,t,r){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new sr(this,this.computeAttrs(e),I.from(t),Se.setFrom(r))}createChecked(e=null,t,r){return t=I.from(t),this.checkContent(t),new sr(this,this.computeAttrs(e),t,Se.setFrom(r))}createAndFill(e=null,t,r){if(e=this.computeAttrs(e),t=I.from(t),t.size){let o=this.contentMatch.fillBefore(t);if(!o)return null;t=o.append(t)}let i=this.contentMatch.matchFragment(t),s=i&&i.fillBefore(I.empty,!0);return s?new sr(this,e,t.append(s),Se.setFrom(r)):null}validContent(e){let t=this.contentMatch.matchFragment(e);if(!t||!t.validEnd)return!1;for(let r=0;r<e.childCount;r++)if(!this.allowsMarks(e.child(r).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw new RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}checkAttrs(e){bm(this.attrs,e,"node",this.name)}allowsMarkType(e){return this.markSet==null||this.markSet.indexOf(e)>-1}allowsMarks(e){if(this.markSet==null)return!0;for(let t=0;t<e.length;t++)if(!this.allowsMarkType(e[t].type))return!1;return!0}allowedMarks(e){if(this.markSet==null)return e;let t;for(let r=0;r<e.length;r++)this.allowsMarkType(e[r].type)?t&&t.push(e[r]):t||(t=e.slice(0,r));return t?t.length?t:Se.none:e}static compile(e,t){let r=Object.create(null);e.forEach((s,o)=>r[s]=new Vb(s,t,o));let i=t.spec.topNode||"doc";if(!r[i])throw new RangeError("Schema is missing its top node type ('"+i+"')");if(!r.text)throw new RangeError("Every schema needs a 'text' type");for(let s in r.text.attrs)throw new RangeError("The text node type should not have attributes");return r}};function IT(n,e,t){let r=t.split("|");return i=>{let s=i===null?"null":typeof i;if(r.indexOf(s)<0)throw new RangeError(`Expected value of type ${r} for attribute ${e} on type ${n}, got ${s}`)}}class DT{constructor(e,t,r){this.hasDefault=Object.prototype.hasOwnProperty.call(r,"default"),this.default=r.default,this.validate=typeof r.validate=="string"?IT(e,t,r.validate):r.validate}get isRequired(){return!this.hasDefault}}class ba{constructor(e,t,r,i){this.name=e,this.rank=t,this.schema=r,this.spec=i,this.attrs=vm(e,i.attrs),this.excluded=null;let s=gm(this.attrs);this.instance=s?new Se(this,s):null}create(e=null){return!e&&this.instance?this.instance:new Se(this,ym(this.attrs,e))}static compile(e,t){let r=Object.create(null),i=0;return e.forEach((s,o)=>r[s]=new ba(s,i++,t,o)),r}removeFromSet(e){for(var t=0;t<e.length;t++)e[t].type==this&&(e=e.slice(0,t).concat(e.slice(t+1)),t--);return e}isInSet(e){for(let t=0;t<e.length;t++)if(e[t].type==this)return e[t]}checkAttrs(e){bm(this.attrs,e,"mark",this.name)}excludes(e){return this.excluded.indexOf(e)>-1}}class Cm{constructor(e){this.linebreakReplacement=null,this.cached=Object.create(null);let t=this.spec={};for(let i in e)t[i]=e[i];t.nodes=Je.from(e.nodes),t.marks=Je.from(e.marks||{}),this.nodes=wm.compile(this.spec.nodes,this),this.marks=ba.compile(this.spec.marks,this);let r=Object.create(null);for(let i in this.nodes){if(i in this.marks)throw new RangeError(i+" can not be both a node and a mark");let s=this.nodes[i],o=s.spec.content||"",a=s.spec.marks;if(s.contentMatch=r[o]||(r[o]=Wr.parse(o,this.nodes)),s.inlineContent=s.contentMatch.inlineContent,s.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!s.isInline||!s.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=s}s.markSet=a=="_"?null:a?km(this,a.split(" ")):a==""||!s.inlineContent?[]:null}for(let i in this.marks){let s=this.marks[i],o=s.spec.excludes;s.excluded=o==null?[s]:o==""?[]:km(this,o.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this),this.markFromJSON=this.markFromJSON.bind(this),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,t=null,r,i){if(typeof e=="string")e=this.nodeType(e);else if(e instanceof wm){if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}else throw new RangeError("Invalid node type: "+e);return e.createChecked(t,r,i)}text(e,t){let r=this.nodes.text;return new ya(r,r.defaultAttrs,e,Se.setFrom(t))}mark(e,t){return typeof e=="string"&&(e=this.marks[e]),e.create(t)}nodeFromJSON(e){return sr.fromJSON(this,e)}markFromJSON(e){return Se.fromJSON(this,e)}nodeType(e){let t=this.nodes[e];if(!t)throw new RangeError("Unknown node type: "+e);return t}}function km(n,e){let t=[];for(let r=0;r<e.length;r++){let i=e[r],s=n.marks[i],o=s;if(s)t.push(s);else for(let a in n.marks){let l=n.marks[a];(i=="_"||l.spec.group&&l.spec.group.split(" ").indexOf(i)>-1)&&t.push(o=l)}if(!o)throw new SyntaxError("Unknown mark type: '"+e[r]+"'")}return t}function LT(n){return n.tag!=null}function RT(n){return n.style!=null}class or{constructor(e,t){this.schema=e,this.rules=t,this.tags=[],this.styles=[];let r=this.matchedStyles=[];t.forEach(i=>{if(LT(i))this.tags.push(i);else if(RT(i)){let s=/[^=]*/.exec(i.style)[0];r.indexOf(s)<0&&r.push(s),this.styles.push(i)}}),this.normalizeLists=!this.tags.some(i=>{if(!/^(ul|ol)\b/.test(i.tag)||!i.node)return!1;let s=e.nodes[i.node];return s.contentMatch.matchType(s)})}parse(e,t={}){let r=new Em(this,t,!1);return r.addAll(e,Se.none,t.from,t.to),r.finish()}parseSlice(e,t={}){let r=new Em(this,t,!0);return r.addAll(e,Se.none,t.from,t.to),V.maxOpen(r.finish())}matchTag(e,t,r){for(let i=r?this.tags.indexOf(r)+1:0;i<this.tags.length;i++){let s=this.tags[i];if(VT(e,s.tag)&&(s.namespace===void 0||e.namespaceURI==s.namespace)&&(!s.context||t.matchesContext(s.context))){if(s.getAttrs){let o=s.getAttrs(e);if(o===!1)continue;s.attrs=o||void 0}return s}}}matchStyle(e,t,r,i){for(let s=i?this.styles.indexOf(i)+1:0;s<this.styles.length;s++){let o=this.styles[s],a=o.style;if(!(a.indexOf(e)!=0||o.context&&!r.matchesContext(o.context)||a.length>e.length&&(a.charCodeAt(e.length)!=61||a.slice(e.length+1)!=t))){if(o.getAttrs){let l=o.getAttrs(t);if(l===!1)continue;o.attrs=l||void 0}return o}}}static schemaRules(e){let t=[];function r(i){let s=i.priority==null?50:i.priority,o=0;for(;o<t.length;o++){let a=t[o];if((a.priority==null?50:a.priority)<s)break}t.splice(o,0,i)}for(let i in e.marks){let s=e.marks[i].spec.parseDOM;s&&s.forEach(o=>{r(o=Tm(o)),o.mark||o.ignore||o.clearMark||(o.mark=i)})}for(let i in e.nodes){let s=e.nodes[i].spec.parseDOM;s&&s.forEach(o=>{r(o=Tm(o)),o.node||o.ignore||o.mark||(o.node=i)})}return t}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new or(e,or.schemaRules(e)))}}const Sm={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},FT={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},xm={ol:!0,ul:!0},va=1,wa=2,Hs=4;function _m(n,e,t){return e!=null?(e?va:0)|(e==="full"?wa:0):n&&n.whitespace=="pre"?va|wa:t&~Hs}class Ca{constructor(e,t,r,i,s,o){this.type=e,this.attrs=t,this.marks=r,this.solid=i,this.options=o,this.content=[],this.activeMarks=Se.none,this.match=s||(o&Hs?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let t=this.type.contentMatch.fillBefore(I.from(e));if(t)this.match=this.type.contentMatch.matchFragment(t);else{let r=this.type.contentMatch,i;return(i=r.findWrapping(e.type))?(this.match=r,i):null}}return this.match.findWrapping(e.type)}finish(e){if(!(this.options&va)){let r=this.content[this.content.length-1],i;if(r&&r.isText&&(i=/[ \t\r\n\u000c]+$/.exec(r.text))){let s=r;r.text.length==i[0].length?this.content.pop():this.content[this.content.length-1]=s.withText(s.text.slice(0,s.text.length-i[0].length))}}let t=I.from(this.content);return!e&&this.match&&(t=t.append(this.match.fillBefore(I.empty,!0))),this.type?this.type.create(this.attrs,t,this.marks):t}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!Sm.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}}class Em{constructor(e,t,r){this.parser=e,this.options=t,this.isOpen=r,this.open=0;let i=t.topNode,s,o=_m(null,t.preserveWhitespace,0)|(r?Hs:0);i?s=new Ca(i.type,i.attrs,Se.none,!0,t.topMatch||i.type.contentMatch,o):r?s=new Ca(null,null,Se.none,!0,null,o):s=new Ca(e.schema.topNodeType,null,Se.none,!0,null,o),this.nodes=[s],this.find=t.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e,t){e.nodeType==3?this.addTextNode(e,t):e.nodeType==1&&this.addElement(e,t)}addTextNode(e,t){let r=e.nodeValue,i=this.top;if(i.options&wa||i.inlineContext(e)||/[^ \t\r\n\u000c]/.test(r)){if(i.options&va)i.options&wa?r=r.replace(/\r\n?/g,`
`):r=r.replace(/\r?\n|\r/g," ");else if(r=r.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(r)&&this.open==this.nodes.length-1){let s=i.content[i.content.length-1],o=e.previousSibling;(!s||o&&o.nodeName=="BR"||s.isText&&/[ \t\r\n\u000c]$/.test(s.text))&&(r=r.slice(1))}r&&this.insertNode(this.parser.schema.text(r),t),this.findInText(e)}else this.findInside(e)}addElement(e,t,r){let i=e.nodeName.toLowerCase(),s;xm.hasOwnProperty(i)&&this.parser.normalizeLists&&BT(e);let o=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(s=this.parser.matchTag(e,this,r));if(o?o.ignore:FT.hasOwnProperty(i))this.findInside(e),this.ignoreFallback(e,t);else if(!o||o.skip||o.closeParent){o&&o.closeParent?this.open=Math.max(0,this.open-1):o&&o.skip.nodeType&&(e=o.skip);let a,l=this.top,c=this.needsBlock;if(Sm.hasOwnProperty(i))l.content.length&&l.content[0].isInline&&this.open&&(this.open--,l=this.top),a=!0,l.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e,t);return}let u=o&&o.skip?t:this.readStyles(e,t);u&&this.addAll(e,u),a&&this.sync(l),this.needsBlock=c}else{let a=this.readStyles(e,t);a&&this.addElementByRule(e,o,a,o.consuming===!1?s:void 0)}}leafFallback(e,t){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`),t)}ignoreFallback(e,t){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"),t)}readStyles(e,t){let r=e.style;if(r&&r.length)for(let i=0;i<this.parser.matchedStyles.length;i++){let s=this.parser.matchedStyles[i],o=r.getPropertyValue(s);if(o)for(let a=void 0;;){let l=this.parser.matchStyle(s,o,this,a);if(!l)break;if(l.ignore)return null;if(l.clearMark?t=t.filter(c=>!l.clearMark(c)):t=t.concat(this.parser.schema.marks[l.mark].create(l.attrs)),l.consuming===!1)a=l;else break}}return t}addElementByRule(e,t,r,i){let s,o;if(t.node)if(o=this.parser.schema.nodes[t.node],o.isLeaf)this.insertNode(o.create(t.attrs),r)||this.leafFallback(e,r);else{let l=this.enter(o,t.attrs||null,r,t.preserveWhitespace);l&&(s=!0,r=l)}else{let l=this.parser.schema.marks[t.mark];r=r.concat(l.create(t.attrs))}let a=this.top;if(o&&o.isLeaf)this.findInside(e);else if(i)this.addElement(e,r,i);else if(t.getContent)this.findInside(e),t.getContent(e,this.parser.schema).forEach(l=>this.insertNode(l,r));else{let l=e;typeof t.contentElement=="string"?l=e.querySelector(t.contentElement):typeof t.contentElement=="function"?l=t.contentElement(e):t.contentElement&&(l=t.contentElement),this.findAround(e,l,!0),this.addAll(l,r),this.findAround(e,l,!1)}s&&this.sync(a)&&this.open--}addAll(e,t,r,i){let s=r||0;for(let o=r?e.childNodes[r]:e.firstChild,a=i==null?null:e.childNodes[i];o!=a;o=o.nextSibling,++s)this.findAtPoint(e,s),this.addDOM(o,t);this.findAtPoint(e,s)}findPlace(e,t){let r,i;for(let s=this.open;s>=0;s--){let o=this.nodes[s],a=o.findWrapping(e);if(a&&(!r||r.length>a.length)&&(r=a,i=o,!a.length)||o.solid)break}if(!r)return null;this.sync(i);for(let s=0;s<r.length;s++)t=this.enterInner(r[s],null,t,!1);return t}insertNode(e,t){if(e.isInline&&this.needsBlock&&!this.top.type){let i=this.textblockFromContext();i&&(t=this.enterInner(i,null,t))}let r=this.findPlace(e,t);if(r){this.closeExtra();let i=this.top;i.match&&(i.match=i.match.matchType(e.type));let s=Se.none;for(let o of r.concat(e.marks))(i.type?i.type.allowsMarkType(o.type):Om(o.type,e.type))&&(s=o.addToSet(s));return i.content.push(e.mark(s)),!0}return!1}enter(e,t,r,i){let s=this.findPlace(e.create(t),r);return s&&(s=this.enterInner(e,t,r,!0,i)),s}enterInner(e,t,r,i=!1,s){this.closeExtra();let o=this.top;o.match=o.match&&o.match.matchType(e);let a=_m(e,s,o.options);o.options&Hs&&o.content.length==0&&(a|=Hs);let l=Se.none;return r=r.filter(c=>(o.type?o.type.allowsMarkType(c.type):Om(c.type,e))?(l=c.addToSet(l),!1):!0),this.nodes.push(new Ca(e,t,l,i,null,a)),this.open++,r}closeExtra(e=!1){let t=this.nodes.length-1;if(t>this.open){for(;t>this.open;t--)this.nodes[t-1].content.push(this.nodes[t].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(this.isOpen||this.options.topOpen)}sync(e){for(let t=this.open;t>=0;t--)if(this.nodes[t]==e)return this.open=t,!0;return!1}get currentPos(){this.closeExtra();let e=0;for(let t=this.open;t>=0;t--){let r=this.nodes[t].content;for(let i=r.length-1;i>=0;i--)e+=r[i].nodeSize;t&&e++}return e}findAtPoint(e,t){if(this.find)for(let r=0;r<this.find.length;r++)this.find[r].node==e&&this.find[r].offset==t&&(this.find[r].pos=this.currentPos)}findInside(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].pos==null&&e.nodeType==1&&e.contains(this.find[t].node)&&(this.find[t].pos=this.currentPos)}findAround(e,t,r){if(e!=t&&this.find)for(let i=0;i<this.find.length;i++)this.find[i].pos==null&&e.nodeType==1&&e.contains(this.find[i].node)&&t.compareDocumentPosition(this.find[i].node)&(r?2:4)&&(this.find[i].pos=this.currentPos)}findInText(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].node==e&&(this.find[t].pos=this.currentPos-(e.nodeValue.length-this.find[t].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let t=e.split("/"),r=this.options.context,i=!this.isOpen&&(!r||r.parent.type==this.nodes[0].type),s=-(r?r.depth+1:0)+(i?0:1),o=(a,l)=>{for(;a>=0;a--){let c=t[a];if(c==""){if(a==t.length-1||a==0)continue;for(;l>=s;l--)if(o(a-1,l))return!0;return!1}else{let u=l>0||l==0&&i?this.nodes[l].type:r&&l>=s?r.node(l-s).type:null;if(!u||u.name!=c&&!u.isInGroup(c))return!1;l--}}return!0};return o(t.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let t=e.depth;t>=0;t--){let r=e.node(t).contentMatchAt(e.indexAfter(t)).defaultType;if(r&&r.isTextblock&&r.defaultAttrs)return r}for(let t in this.parser.schema.nodes){let r=this.parser.schema.nodes[t];if(r.isTextblock&&r.defaultAttrs)return r}}}function BT(n){for(let e=n.firstChild,t=null;e;e=e.nextSibling){let r=e.nodeType==1?e.nodeName.toLowerCase():null;r&&xm.hasOwnProperty(r)&&t?(t.appendChild(e),e=t):r=="li"?t=e:r&&(t=null)}}function VT(n,e){return(n.matches||n.msMatchesSelector||n.webkitMatchesSelector||n.mozMatchesSelector).call(n,e)}function Tm(n){let e={};for(let t in n)e[t]=n[t];return e}function Om(n,e){let t=e.schema.nodes;for(let r in t){let i=t[r];if(!i.allowsMarkType(n))continue;let s=[],o=a=>{s.push(a);for(let l=0;l<a.edgeCount;l++){let{type:c,next:u}=a.edge(l);if(c==e||s.indexOf(u)<0&&o(u))return!0}};if(o(i.contentMatch))return!0}}class Kr{constructor(e,t){this.nodes=e,this.marks=t}serializeFragment(e,t={},r){r||(r=nu(t).createDocumentFragment());let i=r,s=[];return e.forEach(o=>{if(s.length||o.marks.length){let a=0,l=0;for(;a<s.length&&l<o.marks.length;){let c=o.marks[l];if(!this.marks[c.type.name]){l++;continue}if(!c.eq(s[a][0])||c.type.spec.spanning===!1)break;a++,l++}for(;a<s.length;)i=s.pop()[1];for(;l<o.marks.length;){let c=o.marks[l++],u=this.serializeMark(c,o.isInline,t);u&&(s.push([c,i]),i.appendChild(u.dom),i=u.contentDOM||u.dom)}}i.appendChild(this.serializeNodeInner(o,t))}),r}serializeNodeInner(e,t){let{dom:r,contentDOM:i}=ka(nu(t),this.nodes[e.type.name](e),null,e.attrs);if(i){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(e.content,t,i)}return r}serializeNode(e,t={}){let r=this.serializeNodeInner(e,t);for(let i=e.marks.length-1;i>=0;i--){let s=this.serializeMark(e.marks[i],e.isInline,t);s&&((s.contentDOM||s.dom).appendChild(r),r=s.dom)}return r}serializeMark(e,t,r={}){let i=this.marks[e.type.name];return i&&ka(nu(r),i(e,t),null,e.attrs)}static renderSpec(e,t,r=null,i){return ka(e,t,r,i)}static fromSchema(e){return e.cached.domSerializer||(e.cached.domSerializer=new Kr(this.nodesFromSchema(e),this.marksFromSchema(e)))}static nodesFromSchema(e){let t=Nm(e.nodes);return t.text||(t.text=r=>r.text),t}static marksFromSchema(e){return Nm(e.marks)}}function Nm(n){let e={};for(let t in n){let r=n[t].spec.toDOM;r&&(e[t]=r)}return e}function nu(n){return n.document||window.document}const Mm=new WeakMap;function $T(n){let e=Mm.get(n);return e===void 0&&Mm.set(n,e=jT(n)),e}function jT(n){let e=null;function t(r){if(r&&typeof r=="object")if(Array.isArray(r))if(typeof r[0]=="string")e||(e=[]),e.push(r);else for(let i=0;i<r.length;i++)t(r[i]);else for(let i in r)t(r[i])}return t(n),e}function ka(n,e,t,r){if(typeof e=="string")return{dom:n.createTextNode(e)};if(e.nodeType!=null)return{dom:e};if(e.dom&&e.dom.nodeType!=null)return e;let i=e[0],s;if(typeof i!="string")throw new RangeError("Invalid array passed to renderSpec");if(r&&(s=$T(r))&&s.indexOf(e)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let o=i.indexOf(" ");o>0&&(t=i.slice(0,o),i=i.slice(o+1));let a,l=t?n.createElementNS(t,i):n.createElement(i),c=e[1],u=1;if(c&&typeof c=="object"&&c.nodeType==null&&!Array.isArray(c)){u=2;for(let d in c)if(c[d]!=null){let h=d.indexOf(" ");h>0?l.setAttributeNS(d.slice(0,h),d.slice(h+1),c[d]):l.setAttribute(d,c[d])}}for(let d=u;d<e.length;d++){let h=e[d];if(h===0){if(d<e.length-1||d>u)throw new RangeError("Content hole must be the only child of its parent node");return{dom:l,contentDOM:l}}else{let{dom:m,contentDOM:p}=ka(n,h,t,r);if(l.appendChild(m),p){if(a)throw new RangeError("Multiple content holes");a=p}}}return{dom:l,contentDOM:a}}const Am=65535,Pm=Math.pow(2,16);function zT(n,e){return n+e*Pm}function Im(n){return n&Am}function HT(n){return(n-(n&Am))/Pm}const Dm=1,Lm=2,Sa=4,Rm=8;class ru{constructor(e,t,r){this.pos=e,this.delInfo=t,this.recover=r}get deleted(){return(this.delInfo&Rm)>0}get deletedBefore(){return(this.delInfo&(Dm|Sa))>0}get deletedAfter(){return(this.delInfo&(Lm|Sa))>0}get deletedAcross(){return(this.delInfo&Sa)>0}}class Nt{constructor(e,t=!1){if(this.ranges=e,this.inverted=t,!e.length&&Nt.empty)return Nt.empty}recover(e){let t=0,r=Im(e);if(!this.inverted)for(let i=0;i<r;i++)t+=this.ranges[i*3+2]-this.ranges[i*3+1];return this.ranges[r*3]+t+HT(e)}mapResult(e,t=1){return this._map(e,t,!1)}map(e,t=1){return this._map(e,t,!0)}_map(e,t,r){let i=0,s=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?i:0);if(l>e)break;let c=this.ranges[a+s],u=this.ranges[a+o],d=l+c;if(e<=d){let h=c?e==l?-1:e==d?1:t:t,m=l+i+(h<0?0:u);if(r)return m;let p=e==(t<0?l:d)?null:zT(a/3,e-l),g=e==l?Lm:e==d?Dm:Sa;return(t<0?e!=l:e!=d)&&(g|=Rm),new ru(m,g,p)}i+=u-c}return r?e+i:new ru(e+i,0,null)}touches(e,t){let r=0,i=Im(t),s=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?r:0);if(l>e)break;let c=this.ranges[a+s],u=l+c;if(e<=u&&a==i*3)return!0;r+=this.ranges[a+o]-c}return!1}forEach(e){let t=this.inverted?2:1,r=this.inverted?1:2;for(let i=0,s=0;i<this.ranges.length;i+=3){let o=this.ranges[i],a=o-(this.inverted?s:0),l=o+(this.inverted?0:s),c=this.ranges[i+t],u=this.ranges[i+r];e(a,a+c,l,l+u),s+=u-c}}invert(){return new Nt(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return e==0?Nt.empty:new Nt(e<0?[0,-e,0]:[0,0,e])}}Nt.empty=new Nt([]);class Ei{constructor(e=[],t,r=0,i=e.length){this.maps=e,this.mirror=t,this.from=r,this.to=i}slice(e=0,t=this.maps.length){return new Ei(this.maps,this.mirror,e,t)}copy(){return new Ei(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)}appendMap(e,t){this.to=this.maps.push(e),t!=null&&this.setMirror(this.maps.length-1,t)}appendMapping(e){for(let t=0,r=this.maps.length;t<e.maps.length;t++){let i=e.getMirror(t);this.appendMap(e.maps[t],i!=null&&i<t?r+i:void 0)}}getMirror(e){if(this.mirror){for(let t=0;t<this.mirror.length;t++)if(this.mirror[t]==e)return this.mirror[t+(t%2?-1:1)]}}setMirror(e,t){this.mirror||(this.mirror=[]),this.mirror.push(e,t)}appendMappingInverted(e){for(let t=e.maps.length-1,r=this.maps.length+e.maps.length;t>=0;t--){let i=e.getMirror(t);this.appendMap(e.maps[t].invert(),i!=null&&i>t?r-i-1:void 0)}}invert(){let e=new Ei;return e.appendMappingInverted(this),e}map(e,t=1){if(this.mirror)return this._map(e,t,!0);for(let r=this.from;r<this.to;r++)e=this.maps[r].map(e,t);return e}mapResult(e,t=1){return this._map(e,t,!1)}_map(e,t,r){let i=0;for(let s=this.from;s<this.to;s++){let o=this.maps[s],a=o.mapResult(e,t);if(a.recover!=null){let l=this.getMirror(s);if(l!=null&&l>s&&l<this.to){s=l,e=this.maps[l].recover(a.recover);continue}}i|=a.delInfo,e=a.pos}return r?e:new ru(e,i,null)}}const iu=Object.create(null);class tt{getMap(){return Nt.empty}merge(e){return null}static fromJSON(e,t){if(!t||!t.stepType)throw new RangeError("Invalid input for Step.fromJSON");let r=iu[t.stepType];if(!r)throw new RangeError(`No step type ${t.stepType} defined`);return r.fromJSON(e,t)}static jsonID(e,t){if(e in iu)throw new RangeError("Duplicate use of step JSON ID "+e);return iu[e]=t,t.prototype.jsonID=e,t}}class Ve{constructor(e,t){this.doc=e,this.failed=t}static ok(e){return new Ve(e,null)}static fail(e){return new Ve(null,e)}static fromReplace(e,t,r,i){try{return Ve.ok(e.replace(t,r,i))}catch(s){if(s instanceof pa)return Ve.fail(s.message);throw s}}}function su(n,e,t){let r=[];for(let i=0;i<n.childCount;i++){let s=n.child(i);s.content.size&&(s=s.copy(su(s.content,e,s))),s.isInline&&(s=e(s,t,i)),r.push(s)}return I.fromArray(r)}class ar extends tt{constructor(e,t,r){super(),this.from=e,this.to=t,this.mark=r}apply(e){let t=e.slice(this.from,this.to),r=e.resolve(this.from),i=r.node(r.sharedDepth(this.to)),s=new V(su(t.content,(o,a)=>!o.isAtom||!a.type.allowsMarkType(this.mark.type)?o:o.mark(this.mark.addToSet(o.marks)),i),t.openStart,t.openEnd);return Ve.fromReplace(e,this.from,this.to,s)}invert(){return new pn(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return t.deleted&&r.deleted||t.pos>=r.pos?null:new ar(t.pos,r.pos,this.mark)}merge(e){return e instanceof ar&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new ar(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new ar(t.from,t.to,e.markFromJSON(t.mark))}}tt.jsonID("addMark",ar);class pn extends tt{constructor(e,t,r){super(),this.from=e,this.to=t,this.mark=r}apply(e){let t=e.slice(this.from,this.to),r=new V(su(t.content,i=>i.mark(this.mark.removeFromSet(i.marks)),e),t.openStart,t.openEnd);return Ve.fromReplace(e,this.from,this.to,r)}invert(){return new ar(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return t.deleted&&r.deleted||t.pos>=r.pos?null:new pn(t.pos,r.pos,this.mark)}merge(e){return e instanceof pn&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new pn(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new pn(t.from,t.to,e.markFromJSON(t.mark))}}tt.jsonID("removeMark",pn);class lr extends tt{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return Ve.fail("No node at mark step's position");let r=t.type.create(t.attrs,null,this.mark.addToSet(t.marks));return Ve.fromReplace(e,this.pos,this.pos+1,new V(I.from(r),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);if(t){let r=this.mark.addToSet(t.marks);if(r.length==t.marks.length){for(let i=0;i<t.marks.length;i++)if(!t.marks[i].isInSet(r))return new lr(this.pos,t.marks[i]);return new lr(this.pos,this.mark)}}return new Ti(this.pos,this.mark)}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new lr(t.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new lr(t.pos,e.markFromJSON(t.mark))}}tt.jsonID("addNodeMark",lr);class Ti extends tt{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return Ve.fail("No node at mark step's position");let r=t.type.create(t.attrs,null,this.mark.removeFromSet(t.marks));return Ve.fromReplace(e,this.pos,this.pos+1,new V(I.from(r),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);return!t||!this.mark.isInSet(t.marks)?this:new lr(this.pos,this.mark)}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new Ti(t.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new Ti(t.pos,e.markFromJSON(t.mark))}}tt.jsonID("removeNodeMark",Ti);class We extends tt{constructor(e,t,r,i=!1){super(),this.from=e,this.to=t,this.slice=r,this.structure=i}apply(e){return this.structure&&ou(e,this.from,this.to)?Ve.fail("Structure replace would overwrite content"):Ve.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new Nt([this.from,this.to-this.from,this.slice.size])}invert(e){return new We(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let t=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return t.deletedAcross&&r.deletedAcross?null:new We(t.pos,Math.max(t.pos,r.pos),this.slice)}merge(e){if(!(e instanceof We)||e.structure||this.structure)return null;if(this.from+this.slice.size==e.from&&!this.slice.openEnd&&!e.slice.openStart){let t=this.slice.size+e.slice.size==0?V.empty:new V(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new We(this.from,this.to+(e.to-e.from),t,this.structure)}else if(e.to==this.from&&!this.slice.openStart&&!e.slice.openEnd){let t=this.slice.size+e.slice.size==0?V.empty:new V(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new We(e.from,this.to,t,this.structure)}else return null}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new We(t.from,t.to,V.fromJSON(e,t.slice),!!t.structure)}}tt.jsonID("replace",We);class Ke extends tt{constructor(e,t,r,i,s,o,a=!1){super(),this.from=e,this.to=t,this.gapFrom=r,this.gapTo=i,this.slice=s,this.insert=o,this.structure=a}apply(e){if(this.structure&&(ou(e,this.from,this.gapFrom)||ou(e,this.gapTo,this.to)))return Ve.fail("Structure gap-replace would overwrite content");let t=e.slice(this.gapFrom,this.gapTo);if(t.openStart||t.openEnd)return Ve.fail("Gap is not a flat range");let r=this.slice.insertAt(this.insert,t.content);return r?Ve.fromReplace(e,this.from,this.to,r):Ve.fail("Content does not fit in gap")}getMap(){return new Nt([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let t=this.gapTo-this.gapFrom;return new Ke(this.from,this.from+this.slice.size+t,this.from+this.insert,this.from+this.insert+t,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let t=e.mapResult(this.from,1),r=e.mapResult(this.to,-1),i=this.from==this.gapFrom?t.pos:e.map(this.gapFrom,-1),s=this.to==this.gapTo?r.pos:e.map(this.gapTo,1);return t.deletedAcross&&r.deletedAcross||i<t.pos||s>r.pos?null:new Ke(t.pos,r.pos,i,s,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number"||typeof t.gapFrom!="number"||typeof t.gapTo!="number"||typeof t.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new Ke(t.from,t.to,t.gapFrom,t.gapTo,V.fromJSON(e,t.slice),t.insert,!!t.structure)}}tt.jsonID("replaceAround",Ke);function ou(n,e,t){let r=n.resolve(e),i=t-e,s=r.depth;for(;i>0&&s>0&&r.indexAfter(s)==r.node(s).childCount;)s--,i--;if(i>0){let o=r.node(s).maybeChild(r.indexAfter(s));for(;i>0;){if(!o||o.isLeaf)return!0;o=o.firstChild,i--}}return!1}function GT(n,e,t,r){let i=[],s=[],o,a;n.doc.nodesBetween(e,t,(l,c,u)=>{if(!l.isInline)return;let d=l.marks;if(!r.isInSet(d)&&u.type.allowsMarkType(r.type)){let h=Math.max(c,e),m=Math.min(c+l.nodeSize,t),p=r.addToSet(d);for(let g=0;g<d.length;g++)d[g].isInSet(p)||(o&&o.to==h&&o.mark.eq(d[g])?o.to=m:i.push(o=new pn(h,m,d[g])));a&&a.to==h?a.to=m:s.push(a=new ar(h,m,r))}}),i.forEach(l=>n.step(l)),s.forEach(l=>n.step(l))}function UT(n,e,t,r){let i=[],s=0;n.doc.nodesBetween(e,t,(o,a)=>{if(!o.isInline)return;s++;let l=null;if(r instanceof ba){let c=o.marks,u;for(;u=r.isInSet(c);)(l||(l=[])).push(u),c=u.removeFromSet(c)}else r?r.isInSet(o.marks)&&(l=[r]):l=o.marks;if(l&&l.length){let c=Math.min(a+o.nodeSize,t);for(let u=0;u<l.length;u++){let d=l[u],h;for(let m=0;m<i.length;m++){let p=i[m];p.step==s-1&&d.eq(i[m].style)&&(h=p)}h?(h.to=c,h.step=s):i.push({style:d,from:Math.max(a,e),to:c,step:s})}}}),i.forEach(o=>n.step(new pn(o.from,o.to,o.style)))}function au(n,e,t,r=t.contentMatch,i=!0){let s=n.doc.nodeAt(e),o=[],a=e+1;for(let l=0;l<s.childCount;l++){let c=s.child(l),u=a+c.nodeSize,d=r.matchType(c.type);if(!d)o.push(new We(a,u,V.empty));else{r=d;for(let h=0;h<c.marks.length;h++)t.allowsMarkType(c.marks[h].type)||n.step(new pn(a,u,c.marks[h]));if(i&&c.isText&&t.whitespace!="pre"){let h,m=/\r?\n|\r/g,p;for(;h=m.exec(c.text);)p||(p=new V(I.from(t.schema.text(" ",t.allowedMarks(c.marks))),0,0)),o.push(new We(a+h.index,a+h.index+h[0].length,p))}}a=u}if(!r.validEnd){let l=r.fillBefore(I.empty,!0);n.replace(a,a,new V(l,0,0))}for(let l=o.length-1;l>=0;l--)n.step(o[l])}function WT(n,e,t){return(e==0||n.canReplace(e,n.childCount))&&(t==n.childCount||n.canReplace(0,t))}function Oi(n){let t=n.parent.content.cutByIndex(n.startIndex,n.endIndex);for(let r=n.depth;;--r){let i=n.$from.node(r),s=n.$from.index(r),o=n.$to.indexAfter(r);if(r<n.depth&&i.canReplace(s,o,t))return r;if(r==0||i.type.spec.isolating||!WT(i,s,o))break}return null}function KT(n,e,t){let{$from:r,$to:i,depth:s}=e,o=r.before(s+1),a=i.after(s+1),l=o,c=a,u=I.empty,d=0;for(let p=s,g=!1;p>t;p--)g||r.index(p)>0?(g=!0,u=I.from(r.node(p).copy(u)),d++):l--;let h=I.empty,m=0;for(let p=s,g=!1;p>t;p--)g||i.after(p+1)<i.end(p)?(g=!0,h=I.from(i.node(p).copy(h)),m++):c++;n.step(new Ke(l,c,o,a,new V(u.append(h),d,m),u.size-d,!0))}function lu(n,e,t=null,r=n){let i=YT(n,e),s=i&&qT(r,e);return s?i.map(Fm).concat({type:e,attrs:t}).concat(s.map(Fm)):null}function Fm(n){return{type:n,attrs:null}}function YT(n,e){let{parent:t,startIndex:r,endIndex:i}=n,s=t.contentMatchAt(r).findWrapping(e);if(!s)return null;let o=s.length?s[0]:e;return t.canReplaceWith(r,i,o)?s:null}function qT(n,e){let{parent:t,startIndex:r,endIndex:i}=n,s=t.child(r),o=e.contentMatch.findWrapping(s.type);if(!o)return null;let l=(o.length?o[o.length-1]:e).contentMatch;for(let c=r;l&&c<i;c++)l=l.matchType(t.child(c).type);return!l||!l.validEnd?null:o}function XT(n,e,t){let r=I.empty;for(let o=t.length-1;o>=0;o--){if(r.size){let a=t[o].type.contentMatch.matchFragment(r);if(!a||!a.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}r=I.from(t[o].type.create(t[o].attrs,r))}let i=e.start,s=e.end;n.step(new Ke(i,s,i,s,new V(r,0,0),t.length,!0))}function JT(n,e,t,r,i){if(!r.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let s=n.steps.length;n.doc.nodesBetween(e,t,(o,a)=>{let l=typeof i=="function"?i(o):i;if(o.isTextblock&&!o.hasMarkup(r,l)&&QT(n.doc,n.mapping.slice(s).map(a),r)){let c=null;if(r.schema.linebreakReplacement){let m=r.whitespace=="pre",p=!!r.contentMatch.matchType(r.schema.linebreakReplacement);m&&!p?c=!1:!m&&p&&(c=!0)}c===!1&&Vm(n,o,a,s),au(n,n.mapping.slice(s).map(a,1),r,void 0,c===null);let u=n.mapping.slice(s),d=u.map(a,1),h=u.map(a+o.nodeSize,1);return n.step(new Ke(d,h,d+1,h-1,new V(I.from(r.create(l,null,o.marks)),0,0),1,!0)),c===!0&&Bm(n,o,a,s),!1}})}function Bm(n,e,t,r){e.forEach((i,s)=>{if(i.isText){let o,a=/\r?\n|\r/g;for(;o=a.exec(i.text);){let l=n.mapping.slice(r).map(t+1+s+o.index);n.replaceWith(l,l+1,e.type.schema.linebreakReplacement.create())}}})}function Vm(n,e,t,r){e.forEach((i,s)=>{if(i.type==i.type.schema.linebreakReplacement){let o=n.mapping.slice(r).map(t+1+s);n.replaceWith(o,o+1,e.type.schema.text(`
`))}})}function QT(n,e,t){let r=n.resolve(e),i=r.index();return r.parent.canReplaceWith(i,i+1,t)}function ZT(n,e,t,r,i){let s=n.doc.nodeAt(e);if(!s)throw new RangeError("No node at given position");t||(t=s.type);let o=t.create(r,null,i||s.marks);if(s.isLeaf)return n.replaceWith(e,e+s.nodeSize,o);if(!t.validContent(s.content))throw new RangeError("Invalid content for node type "+t.name);n.step(new Ke(e,e+s.nodeSize,e+1,e+s.nodeSize-1,new V(I.from(o),0,0),1,!0))}function Ni(n,e,t=1,r){let i=n.resolve(e),s=i.depth-t,o=r&&r[r.length-1]||i.parent;if(s<0||i.parent.type.spec.isolating||!i.parent.canReplace(i.index(),i.parent.childCount)||!o.type.validContent(i.parent.content.cutByIndex(i.index(),i.parent.childCount)))return!1;for(let c=i.depth-1,u=t-2;c>s;c--,u--){let d=i.node(c),h=i.index(c);if(d.type.spec.isolating)return!1;let m=d.content.cutByIndex(h,d.childCount),p=r&&r[u+1];p&&(m=m.replaceChild(0,p.type.create(p.attrs)));let g=r&&r[u]||d;if(!d.canReplace(h+1,d.childCount)||!g.type.validContent(m))return!1}let a=i.indexAfter(s),l=r&&r[0];return i.node(s).canReplaceWith(a,a,l?l.type:i.node(s+1).type)}function eO(n,e,t=1,r){let i=n.doc.resolve(e),s=I.empty,o=I.empty;for(let a=i.depth,l=i.depth-t,c=t-1;a>l;a--,c--){s=I.from(i.node(a).copy(s));let u=r&&r[c];o=I.from(u?u.type.create(u.attrs,o):i.node(a).copy(o))}n.step(new We(e,e,new V(s.append(o),t,t),!0))}function cr(n,e){let t=n.resolve(e),r=t.index();return $m(t.nodeBefore,t.nodeAfter)&&t.parent.canReplace(r,r+1)}function tO(n,e){e.content.size||n.type.compatibleContent(e.type);let t=n.contentMatchAt(n.childCount),{linebreakReplacement:r}=n.type.schema;for(let i=0;i<e.childCount;i++){let s=e.child(i),o=s.type==r?n.type.schema.nodes.text:s.type;if(t=t.matchType(o),!t||!n.type.allowsMarks(s.marks))return!1}return t.validEnd}function $m(n,e){return!!(n&&e&&!n.isLeaf&&tO(n,e))}function xa(n,e,t=-1){let r=n.resolve(e);for(let i=r.depth;;i--){let s,o,a=r.index(i);if(i==r.depth?(s=r.nodeBefore,o=r.nodeAfter):t>0?(s=r.node(i+1),a++,o=r.node(i).maybeChild(a)):(s=r.node(i).maybeChild(a-1),o=r.node(i+1)),s&&!s.isTextblock&&$m(s,o)&&r.node(i).canReplace(a,a+1))return e;if(i==0)break;e=t<0?r.before(i):r.after(i)}}function nO(n,e,t){let r=null,{linebreakReplacement:i}=n.doc.type.schema,s=n.doc.resolve(e-t),o=s.node().type;if(i&&o.inlineContent){let u=o.whitespace=="pre",d=!!o.contentMatch.matchType(i);u&&!d?r=!1:!u&&d&&(r=!0)}let a=n.steps.length;if(r===!1){let u=n.doc.resolve(e+t);Vm(n,u.node(),u.before(),a)}o.inlineContent&&au(n,e+t-1,o,s.node().contentMatchAt(s.index()),r==null);let l=n.mapping.slice(a),c=l.map(e-t);if(n.step(new We(c,l.map(e+t,-1),V.empty,!0)),r===!0){let u=n.doc.resolve(c);Bm(n,u.node(),u.before(),n.steps.length)}return n}function rO(n,e,t){let r=n.resolve(e);if(r.parent.canReplaceWith(r.index(),r.index(),t))return e;if(r.parentOffset==0)for(let i=r.depth-1;i>=0;i--){let s=r.index(i);if(r.node(i).canReplaceWith(s,s,t))return r.before(i+1);if(s>0)return null}if(r.parentOffset==r.parent.content.size)for(let i=r.depth-1;i>=0;i--){let s=r.indexAfter(i);if(r.node(i).canReplaceWith(s,s,t))return r.after(i+1);if(s<r.node(i).childCount)return null}return null}function jm(n,e,t){let r=n.resolve(e);if(!t.content.size)return e;let i=t.content;for(let s=0;s<t.openStart;s++)i=i.firstChild.content;for(let s=1;s<=(t.openStart==0&&t.size?2:1);s++)for(let o=r.depth;o>=0;o--){let a=o==r.depth?0:r.pos<=(r.start(o+1)+r.end(o+1))/2?-1:1,l=r.index(o)+(a>0?1:0),c=r.node(o),u=!1;if(s==1)u=c.canReplace(l,l,i);else{let d=c.contentMatchAt(l).findWrapping(i.firstChild.type);u=d&&c.canReplaceWith(l,l,d[0])}if(u)return a==0?r.pos:a<0?r.before(o+1):r.after(o+1)}return null}function _a(n,e,t=e,r=V.empty){if(e==t&&!r.size)return null;let i=n.resolve(e),s=n.resolve(t);return zm(i,s,r)?new We(e,t,r):new iO(i,s,r).fit()}function zm(n,e,t){return!t.openStart&&!t.openEnd&&n.start()==e.start()&&n.parent.canReplace(n.index(),e.index(),t.content)}class iO{constructor(e,t,r){this.$from=e,this.$to=t,this.unplaced=r,this.frontier=[],this.placed=I.empty;for(let i=0;i<=e.depth;i++){let s=e.node(i);this.frontier.push({type:s.type,match:s.contentMatchAt(e.indexAfter(i))})}for(let i=e.depth;i>0;i--)this.placed=I.from(e.node(i).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let c=this.findFittable();c?this.placeNodes(c):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),t=this.placed.size-this.depth-this.$from.depth,r=this.$from,i=this.close(e<0?this.$to:r.doc.resolve(e));if(!i)return null;let s=this.placed,o=r.depth,a=i.depth;for(;o&&a&&s.childCount==1;)s=s.firstChild.content,o--,a--;let l=new V(s,o,a);return e>-1?new Ke(r.pos,e,this.$to.pos,this.$to.end(),l,t):l.size||r.pos!=this.$to.pos?new We(r.pos,i.pos,l):null}findFittable(){let e=this.unplaced.openStart;for(let t=this.unplaced.content,r=0,i=this.unplaced.openEnd;r<e;r++){let s=t.firstChild;if(t.childCount>1&&(i=0),s.type.spec.isolating&&i<=r){e=r;break}t=s.content}for(let t=1;t<=2;t++)for(let r=t==1?e:this.unplaced.openStart;r>=0;r--){let i,s=null;r?(s=cu(this.unplaced.content,r-1).firstChild,i=s.content):i=this.unplaced.content;let o=i.firstChild;for(let a=this.depth;a>=0;a--){let{type:l,match:c}=this.frontier[a],u,d=null;if(t==1&&(o?c.matchType(o.type)||(d=c.fillBefore(I.from(o),!1)):s&&l.compatibleContent(s.type)))return{sliceDepth:r,frontierDepth:a,parent:s,inject:d};if(t==2&&o&&(u=c.findWrapping(o.type)))return{sliceDepth:r,frontierDepth:a,parent:s,wrap:u};if(s&&c.matchType(s.type))break}}}openMore(){let{content:e,openStart:t,openEnd:r}=this.unplaced,i=cu(e,t);return!i.childCount||i.firstChild.isLeaf?!1:(this.unplaced=new V(e,t+1,Math.max(r,i.size+t>=e.size-r?t+1:0)),!0)}dropNode(){let{content:e,openStart:t,openEnd:r}=this.unplaced,i=cu(e,t);if(i.childCount<=1&&t>0){let s=e.size-t<=t+i.size;this.unplaced=new V(Gs(e,t-1,1),t-1,s?t-1:r)}else this.unplaced=new V(Gs(e,t,1),t,r)}placeNodes({sliceDepth:e,frontierDepth:t,parent:r,inject:i,wrap:s}){for(;this.depth>t;)this.closeFrontierNode();if(s)for(let g=0;g<s.length;g++)this.openFrontierNode(s[g]);let o=this.unplaced,a=r?r.content:o.content,l=o.openStart-e,c=0,u=[],{match:d,type:h}=this.frontier[t];if(i){for(let g=0;g<i.childCount;g++)u.push(i.child(g));d=d.matchFragment(i)}let m=a.size+e-(o.content.size-o.openEnd);for(;c<a.childCount;){let g=a.child(c),y=d.matchType(g.type);if(!y)break;c++,(c>1||l==0||g.content.size)&&(d=y,u.push(Hm(g.mark(h.allowedMarks(g.marks)),c==1?l:0,c==a.childCount?m:-1)))}let p=c==a.childCount;p||(m=-1),this.placed=Us(this.placed,t,I.from(u)),this.frontier[t].match=d,p&&m<0&&r&&r.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let g=0,y=a;g<m;g++){let v=y.lastChild;this.frontier.push({type:v.type,match:v.contentMatchAt(v.childCount)}),y=v.content}this.unplaced=p?e==0?V.empty:new V(Gs(o.content,e-1,1),e-1,m<0?o.openEnd:e-1):new V(Gs(o.content,e,c),o.openStart,o.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e=this.frontier[this.depth],t;if(!e.type.isTextblock||!uu(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(t=this.findCloseLevel(this.$to))&&t.depth==this.depth)return-1;let{depth:r}=this.$to,i=this.$to.after(r);for(;r>1&&i==this.$to.end(--r);)++i;return i}findCloseLevel(e){e:for(let t=Math.min(this.depth,e.depth);t>=0;t--){let{match:r,type:i}=this.frontier[t],s=t<e.depth&&e.end(t+1)==e.pos+(e.depth-(t+1)),o=uu(e,t,i,r,s);if(o){for(let a=t-1;a>=0;a--){let{match:l,type:c}=this.frontier[a],u=uu(e,a,c,l,!0);if(!u||u.childCount)continue e}return{depth:t,fit:o,move:s?e.doc.resolve(e.after(t+1)):e}}}}close(e){let t=this.findCloseLevel(e);if(!t)return null;for(;this.depth>t.depth;)this.closeFrontierNode();t.fit.childCount&&(this.placed=Us(this.placed,t.depth,t.fit)),e=t.move;for(let r=t.depth+1;r<=e.depth;r++){let i=e.node(r),s=i.type.contentMatch.fillBefore(i.content,!0,e.index(r));this.openFrontierNode(i.type,i.attrs,s)}return e}openFrontierNode(e,t=null,r){let i=this.frontier[this.depth];i.match=i.match.matchType(e),this.placed=Us(this.placed,this.depth,I.from(e.create(t,r))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let t=this.frontier.pop().match.fillBefore(I.empty,!0);t.childCount&&(this.placed=Us(this.placed,this.frontier.length,t))}}function Gs(n,e,t){return e==0?n.cutByIndex(t,n.childCount):n.replaceChild(0,n.firstChild.copy(Gs(n.firstChild.content,e-1,t)))}function Us(n,e,t){return e==0?n.append(t):n.replaceChild(n.childCount-1,n.lastChild.copy(Us(n.lastChild.content,e-1,t)))}function cu(n,e){for(let t=0;t<e;t++)n=n.firstChild.content;return n}function Hm(n,e,t){if(e<=0)return n;let r=n.content;return e>1&&(r=r.replaceChild(0,Hm(r.firstChild,e-1,r.childCount==1?t-1:0))),e>0&&(r=n.type.contentMatch.fillBefore(r).append(r),t<=0&&(r=r.append(n.type.contentMatch.matchFragment(r).fillBefore(I.empty,!0)))),n.copy(r)}function uu(n,e,t,r,i){let s=n.node(e),o=i?n.indexAfter(e):n.index(e);if(o==s.childCount&&!t.compatibleContent(s.type))return null;let a=r.fillBefore(s.content,!0,o);return a&&!sO(t,s.content,o)?a:null}function sO(n,e,t){for(let r=t;r<e.childCount;r++)if(!n.allowsMarks(e.child(r).marks))return!0;return!1}function oO(n){return n.spec.defining||n.spec.definingForContent}function aO(n,e,t,r){if(!r.size)return n.deleteRange(e,t);let i=n.doc.resolve(e),s=n.doc.resolve(t);if(zm(i,s,r))return n.step(new We(e,t,r));let o=Um(i,n.doc.resolve(t));o[o.length-1]==0&&o.pop();let a=-(i.depth+1);o.unshift(a);for(let h=i.depth,m=i.pos-1;h>0;h--,m--){let p=i.node(h).type.spec;if(p.defining||p.definingAsContext||p.isolating)break;o.indexOf(h)>-1?a=h:i.before(h)==m&&o.splice(1,0,-h)}let l=o.indexOf(a),c=[],u=r.openStart;for(let h=r.content,m=0;;m++){let p=h.firstChild;if(c.push(p),m==r.openStart)break;h=p.content}for(let h=u-1;h>=0;h--){let m=c[h],p=oO(m.type);if(p&&!m.sameMarkup(i.node(Math.abs(a)-1)))u=h;else if(p||!m.type.isTextblock)break}for(let h=r.openStart;h>=0;h--){let m=(h+u+1)%(r.openStart+1),p=c[m];if(p)for(let g=0;g<o.length;g++){let y=o[(g+l)%o.length],v=!0;y<0&&(v=!1,y=-y);let C=i.node(y-1),w=i.index(y-1);if(C.canReplaceWith(w,w,p.type,p.marks))return n.replace(i.before(y),v?s.after(y):t,new V(Gm(r.content,0,r.openStart,m),m,r.openEnd))}}let d=n.steps.length;for(let h=o.length-1;h>=0&&(n.replace(e,t,r),!(n.steps.length>d));h--){let m=o[h];m<0||(e=i.before(m),t=s.after(m))}}function Gm(n,e,t,r,i){if(e<t){let s=n.firstChild;n=n.replaceChild(0,s.copy(Gm(s.content,e+1,t,r,s)))}if(e>r){let s=i.contentMatchAt(0),o=s.fillBefore(n).append(n);n=o.append(s.matchFragment(o).fillBefore(I.empty,!0))}return n}function lO(n,e,t,r){if(!r.isInline&&e==t&&n.doc.resolve(e).parent.content.size){let i=rO(n.doc,e,r.type);i!=null&&(e=t=i)}n.replaceRange(e,t,new V(I.from(r),0,0))}function cO(n,e,t){let r=n.doc.resolve(e),i=n.doc.resolve(t),s=Um(r,i);for(let o=0;o<s.length;o++){let a=s[o],l=o==s.length-1;if(l&&a==0||r.node(a).type.contentMatch.validEnd)return n.delete(r.start(a),i.end(a));if(a>0&&(l||r.node(a-1).canReplace(r.index(a-1),i.indexAfter(a-1))))return n.delete(r.before(a),i.after(a))}for(let o=1;o<=r.depth&&o<=i.depth;o++)if(e-r.start(o)==r.depth-o&&t>r.end(o)&&i.end(o)-t!=i.depth-o&&r.start(o-1)==i.start(o-1)&&r.node(o-1).canReplace(r.index(o-1),i.index(o-1)))return n.delete(r.before(o),t);n.delete(e,t)}function Um(n,e){let t=[],r=Math.min(n.depth,e.depth);for(let i=r;i>=0;i--){let s=n.start(i);if(s<n.pos-(n.depth-i)||e.end(i)>e.pos+(e.depth-i)||n.node(i).type.spec.isolating||e.node(i).type.spec.isolating)break;(s==e.start(i)||i==n.depth&&i==e.depth&&n.parent.inlineContent&&e.parent.inlineContent&&i&&e.start(i-1)==s-1)&&t.push(i)}return t}class Mi extends tt{constructor(e,t,r){super(),this.pos=e,this.attr=t,this.value=r}apply(e){let t=e.nodeAt(this.pos);if(!t)return Ve.fail("No node at attribute step's position");let r=Object.create(null);for(let s in t.attrs)r[s]=t.attrs[s];r[this.attr]=this.value;let i=t.type.create(r,null,t.marks);return Ve.fromReplace(e,this.pos,this.pos+1,new V(I.from(i),0,t.isLeaf?0:1))}getMap(){return Nt.empty}invert(e){return new Mi(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new Mi(t.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,t){if(typeof t.pos!="number"||typeof t.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new Mi(t.pos,t.attr,t.value)}}tt.jsonID("attr",Mi);class Ws extends tt{constructor(e,t){super(),this.attr=e,this.value=t}apply(e){let t=Object.create(null);for(let i in e.attrs)t[i]=e.attrs[i];t[this.attr]=this.value;let r=e.type.create(t,e.content,e.marks);return Ve.ok(r)}getMap(){return Nt.empty}invert(e){return new Ws(this.attr,e.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(e,t){if(typeof t.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new Ws(t.attr,t.value)}}tt.jsonID("docAttr",Ws);let Ai=class extends Error{};Ai=function n(e){let t=Error.call(this,e);return t.__proto__=n.prototype,t},Ai.prototype=Object.create(Error.prototype),Ai.prototype.constructor=Ai,Ai.prototype.name="TransformError";class uO{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new Ei}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let t=this.maybeStep(e);if(t.failed)throw new Ai(t.failed);return this}maybeStep(e){let t=e.apply(this.doc);return t.failed||this.addStep(e,t.doc),t}get docChanged(){return this.steps.length>0}addStep(e,t){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=t}replace(e,t=e,r=V.empty){let i=_a(this.doc,e,t,r);return i&&this.step(i),this}replaceWith(e,t,r){return this.replace(e,t,new V(I.from(r),0,0))}delete(e,t){return this.replace(e,t,V.empty)}insert(e,t){return this.replaceWith(e,e,t)}replaceRange(e,t,r){return aO(this,e,t,r),this}replaceRangeWith(e,t,r){return lO(this,e,t,r),this}deleteRange(e,t){return cO(this,e,t),this}lift(e,t){return KT(this,e,t),this}join(e,t=1){return nO(this,e,t),this}wrap(e,t){return XT(this,e,t),this}setBlockType(e,t=e,r,i=null){return JT(this,e,t,r,i),this}setNodeMarkup(e,t,r=null,i){return ZT(this,e,t,r,i),this}setNodeAttribute(e,t,r){return this.step(new Mi(e,t,r)),this}setDocAttribute(e,t){return this.step(new Ws(e,t)),this}addNodeMark(e,t){return this.step(new lr(e,t)),this}removeNodeMark(e,t){if(!(t instanceof Se)){let r=this.doc.nodeAt(e);if(!r)throw new RangeError("No node at position "+e);if(t=t.isInSet(r.marks),!t)return this}return this.step(new Ti(e,t)),this}split(e,t=1,r){return eO(this,e,t,r),this}addMark(e,t,r){return GT(this,e,t,r),this}removeMark(e,t,r){return UT(this,e,t,r),this}clearIncompatible(e,t,r){return au(this,e,t,r),this}}const fu=Object.create(null);class re{constructor(e,t,r){this.$anchor=e,this.$head=t,this.ranges=r||[new fO(e.min(t),e.max(t))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let t=0;t<e.length;t++)if(e[t].$from.pos!=e[t].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,t=V.empty){let r=t.content.lastChild,i=null;for(let a=0;a<t.openEnd;a++)i=r,r=r.lastChild;let s=e.steps.length,o=this.ranges;for(let a=0;a<o.length;a++){let{$from:l,$to:c}=o[a],u=e.mapping.slice(s);e.replaceRange(u.map(l.pos),u.map(c.pos),a?V.empty:t),a==0&&Ym(e,s,(r?r.isInline:i&&i.isTextblock)?-1:1)}}replaceWith(e,t){let r=e.steps.length,i=this.ranges;for(let s=0;s<i.length;s++){let{$from:o,$to:a}=i[s],l=e.mapping.slice(r),c=l.map(o.pos),u=l.map(a.pos);s?e.deleteRange(c,u):(e.replaceRangeWith(c,u,t),Ym(e,r,t.isInline?-1:1))}}static findFrom(e,t,r=!1){let i=e.parent.inlineContent?new ne(e):Pi(e.node(0),e.parent,e.pos,e.index(),t,r);if(i)return i;for(let s=e.depth-1;s>=0;s--){let o=t<0?Pi(e.node(0),e.node(s),e.before(s+1),e.index(s),t,r):Pi(e.node(0),e.node(s),e.after(s+1),e.index(s)+1,t,r);if(o)return o}return null}static near(e,t=1){return this.findFrom(e,t)||this.findFrom(e,-t)||new en(e.node(0))}static atStart(e){return Pi(e,e,0,0,1)||new en(e)}static atEnd(e){return Pi(e,e,e.content.size,e.childCount,-1)||new en(e)}static fromJSON(e,t){if(!t||!t.type)throw new RangeError("Invalid input for Selection.fromJSON");let r=fu[t.type];if(!r)throw new RangeError(`No selection type ${t.type} defined`);return r.fromJSON(e,t)}static jsonID(e,t){if(e in fu)throw new RangeError("Duplicate use of selection JSON ID "+e);return fu[e]=t,t.prototype.jsonID=e,t}getBookmark(){return ne.between(this.$anchor,this.$head).getBookmark()}}re.prototype.visible=!0;class fO{constructor(e,t){this.$from=e,this.$to=t}}let Wm=!1;function Km(n){!Wm&&!n.parent.inlineContent&&(Wm=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+n.parent.type.name+")"))}class ne extends re{constructor(e,t=e){Km(e),Km(t),super(e,t)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,t){let r=e.resolve(t.map(this.head));if(!r.parent.inlineContent)return re.near(r);let i=e.resolve(t.map(this.anchor));return new ne(i.parent.inlineContent?i:r,r)}replace(e,t=V.empty){if(super.replace(e,t),t==V.empty){let r=this.$from.marksAcross(this.$to);r&&e.ensureMarks(r)}}eq(e){return e instanceof ne&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new Ea(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,t){if(typeof t.anchor!="number"||typeof t.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new ne(e.resolve(t.anchor),e.resolve(t.head))}static create(e,t,r=t){let i=e.resolve(t);return new this(i,r==t?i:e.resolve(r))}static between(e,t,r){let i=e.pos-t.pos;if((!r||i)&&(r=i>=0?1:-1),!t.parent.inlineContent){let s=re.findFrom(t,r,!0)||re.findFrom(t,-r,!0);if(s)t=s.$head;else return re.near(t,r)}return e.parent.inlineContent||(i==0?e=t:(e=(re.findFrom(e,-r,!0)||re.findFrom(e,r,!0)).$anchor,e.pos<t.pos!=i<0&&(e=t))),new ne(e,t)}}re.jsonID("text",ne);class Ea{constructor(e,t){this.anchor=e,this.head=t}map(e){return new Ea(e.map(this.anchor),e.map(this.head))}resolve(e){return ne.between(e.resolve(this.anchor),e.resolve(this.head))}}class q extends re{constructor(e){let t=e.nodeAfter,r=e.node(0).resolve(e.pos+t.nodeSize);super(e,r),this.node=t}map(e,t){let{deleted:r,pos:i}=t.mapResult(this.anchor),s=e.resolve(i);return r?re.near(s):new q(s)}content(){return new V(I.from(this.node),0,0)}eq(e){return e instanceof q&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new du(this.anchor)}static fromJSON(e,t){if(typeof t.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new q(e.resolve(t.anchor))}static create(e,t){return new q(e.resolve(t))}static isSelectable(e){return!e.isText&&e.type.spec.selectable!==!1}}q.prototype.visible=!1,re.jsonID("node",q);class du{constructor(e){this.anchor=e}map(e){let{deleted:t,pos:r}=e.mapResult(this.anchor);return t?new Ea(r,r):new du(r)}resolve(e){let t=e.resolve(this.anchor),r=t.nodeAfter;return r&&q.isSelectable(r)?new q(t):re.near(t)}}class en extends re{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,t=V.empty){if(t==V.empty){e.delete(0,e.doc.content.size);let r=re.atStart(e.doc);r.eq(e.selection)||e.setSelection(r)}else super.replace(e,t)}toJSON(){return{type:"all"}}static fromJSON(e){return new en(e)}map(e){return new en(e)}eq(e){return e instanceof en}getBookmark(){return dO}}re.jsonID("all",en);const dO={map(){return this},resolve(n){return new en(n)}};function Pi(n,e,t,r,i,s=!1){if(e.inlineContent)return ne.create(n,t);for(let o=r-(i>0?0:1);i>0?o<e.childCount:o>=0;o+=i){let a=e.child(o);if(a.isAtom){if(!s&&q.isSelectable(a))return q.create(n,t-(i<0?a.nodeSize:0))}else{let l=Pi(n,a,t+i,i<0?a.childCount:0,i,s);if(l)return l}t+=a.nodeSize*i}return null}function Ym(n,e,t){let r=n.steps.length-1;if(r<e)return;let i=n.steps[r];if(!(i instanceof We||i instanceof Ke))return;let s=n.mapping.maps[r],o;s.forEach((a,l,c,u)=>{o==null&&(o=u)}),n.setSelection(re.near(n.doc.resolve(o),t))}const qm=1,Ta=2,Xm=4;class hO extends uO{constructor(e){super(e.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=e.selection,this.storedMarks=e.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(e){if(e.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=e,this.curSelectionFor=this.steps.length,this.updated=(this.updated|qm)&~Ta,this.storedMarks=null,this}get selectionSet(){return(this.updated&qm)>0}setStoredMarks(e){return this.storedMarks=e,this.updated|=Ta,this}ensureMarks(e){return Se.sameSet(this.storedMarks||this.selection.$from.marks(),e)||this.setStoredMarks(e),this}addStoredMark(e){return this.ensureMarks(e.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(e){return this.ensureMarks(e.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(this.updated&Ta)>0}addStep(e,t){super.addStep(e,t),this.updated=this.updated&~Ta,this.storedMarks=null}setTime(e){return this.time=e,this}replaceSelection(e){return this.selection.replace(this,e),this}replaceSelectionWith(e,t=!0){let r=this.selection;return t&&(e=e.mark(this.storedMarks||(r.empty?r.$from.marks():r.$from.marksAcross(r.$to)||Se.none))),r.replaceWith(this,e),this}deleteSelection(){return this.selection.replace(this),this}insertText(e,t,r){let i=this.doc.type.schema;if(t==null)return e?this.replaceSelectionWith(i.text(e),!0):this.deleteSelection();{if(r==null&&(r=t),r=r??t,!e)return this.deleteRange(t,r);let s=this.storedMarks;if(!s){let o=this.doc.resolve(t);s=r==t?o.marks():o.marksAcross(this.doc.resolve(r))}return this.replaceRangeWith(t,r,i.text(e,s)),this.selection.empty||this.setSelection(re.near(this.selection.$to)),this}}setMeta(e,t){return this.meta[typeof e=="string"?e:e.key]=t,this}getMeta(e){return this.meta[typeof e=="string"?e:e.key]}get isGeneric(){for(let e in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=Xm,this}get scrolledIntoView(){return(this.updated&Xm)>0}}function Jm(n,e){return!e||!n?n:n.bind(e)}class Ks{constructor(e,t,r){this.name=e,this.init=Jm(t.init,r),this.apply=Jm(t.apply,r)}}const pO=[new Ks("doc",{init(n){return n.doc||n.schema.topNodeType.createAndFill()},apply(n){return n.doc}}),new Ks("selection",{init(n,e){return n.selection||re.atStart(e.doc)},apply(n){return n.selection}}),new Ks("storedMarks",{init(n){return n.storedMarks||null},apply(n,e,t,r){return r.selection.$cursor?n.storedMarks:null}}),new Ks("scrollToSelection",{init(){return 0},apply(n,e){return n.scrolledIntoView?e+1:e}})];class hu{constructor(e,t){this.schema=e,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=pO.slice(),t&&t.forEach(r=>{if(this.pluginsByKey[r.key])throw new RangeError("Adding different instances of a keyed plugin ("+r.key+")");this.plugins.push(r),this.pluginsByKey[r.key]=r,r.spec.state&&this.fields.push(new Ks(r.key,r.spec.state,r))})}}class Ii{constructor(e){this.config=e}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(e){return this.applyTransaction(e).state}filterTransaction(e,t=-1){for(let r=0;r<this.config.plugins.length;r++)if(r!=t){let i=this.config.plugins[r];if(i.spec.filterTransaction&&!i.spec.filterTransaction.call(i,e,this))return!1}return!0}applyTransaction(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};let t=[e],r=this.applyInner(e),i=null;for(;;){let s=!1;for(let o=0;o<this.config.plugins.length;o++){let a=this.config.plugins[o];if(a.spec.appendTransaction){let l=i?i[o].n:0,c=i?i[o].state:this,u=l<t.length&&a.spec.appendTransaction.call(a,l?t.slice(l):t,c,r);if(u&&r.filterTransaction(u,o)){if(u.setMeta("appendedTransaction",e),!i){i=[];for(let d=0;d<this.config.plugins.length;d++)i.push(d<o?{state:r,n:t.length}:{state:this,n:0})}t.push(u),r=r.applyInner(u),s=!0}i&&(i[o]={state:r,n:t.length})}}if(!s)return{state:r,transactions:t}}}applyInner(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let t=new Ii(this.config),r=this.config.fields;for(let i=0;i<r.length;i++){let s=r[i];t[s.name]=s.apply(e,this[s.name],this,t)}return t}get tr(){return new hO(this)}static create(e){let t=new hu(e.doc?e.doc.type.schema:e.schema,e.plugins),r=new Ii(t);for(let i=0;i<t.fields.length;i++)r[t.fields[i].name]=t.fields[i].init(e,r);return r}reconfigure(e){let t=new hu(this.schema,e.plugins),r=t.fields,i=new Ii(t);for(let s=0;s<r.length;s++){let o=r[s].name;i[o]=this.hasOwnProperty(o)?this[o]:r[s].init(e,i)}return i}toJSON(e){let t={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(t.storedMarks=this.storedMarks.map(r=>r.toJSON())),e&&typeof e=="object")for(let r in e){if(r=="doc"||r=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");let i=e[r],s=i.spec.state;s&&s.toJSON&&(t[r]=s.toJSON.call(i,this[i.key]))}return t}static fromJSON(e,t,r){if(!t)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");let i=new hu(e.schema,e.plugins),s=new Ii(i);return i.fields.forEach(o=>{if(o.name=="doc")s.doc=sr.fromJSON(e.schema,t.doc);else if(o.name=="selection")s.selection=re.fromJSON(s.doc,t.selection);else if(o.name=="storedMarks")t.storedMarks&&(s.storedMarks=t.storedMarks.map(e.schema.markFromJSON));else{if(r)for(let a in r){let l=r[a],c=l.spec.state;if(l.key==o.name&&c&&c.fromJSON&&Object.prototype.hasOwnProperty.call(t,a)){s[o.name]=c.fromJSON.call(l,e,t[a],s);return}}s[o.name]=o.init(e,s)}}),s}}function Qm(n,e,t){for(let r in n){let i=n[r];i instanceof Function?i=i.bind(e):r=="handleDOMEvents"&&(i=Qm(i,e,{})),t[r]=i}return t}class nt{constructor(e){this.spec=e,this.props={},e.props&&Qm(e.props,this,this.props),this.key=e.key?e.key.key:Zm("plugin")}getState(e){return e[this.key]}}const pu=Object.create(null);function Zm(n){return n in pu?n+"$"+ ++pu[n]:(pu[n]=0,n+"$")}class Lt{constructor(e="key"){this.key=Zm(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}}const Qe=function(n){for(var e=0;;e++)if(n=n.previousSibling,!n)return e},Ys=function(n){let e=n.assignedSlot||n.parentNode;return e&&e.nodeType==11?e.host:e};let mu=null;const In=function(n,e,t){let r=mu||(mu=document.createRange());return r.setEnd(n,t??n.nodeValue.length),r.setStart(n,e||0),r},mO=function(){mu=null},Yr=function(n,e,t,r){return t&&(eg(n,e,t,r,-1)||eg(n,e,t,r,1))},gO=/^(img|br|input|textarea|hr)$/i;function eg(n,e,t,r,i){for(;;){if(n==t&&e==r)return!0;if(e==(i<0?0:Rt(n))){let s=n.parentNode;if(!s||s.nodeType!=1||qs(n)||gO.test(n.nodeName)||n.contentEditable=="false")return!1;e=Qe(n)+(i<0?0:1),n=s}else if(n.nodeType==1){if(n=n.childNodes[e+(i<0?-1:0)],n.contentEditable=="false")return!1;e=i<0?Rt(n):0}else return!1}}function Rt(n){return n.nodeType==3?n.nodeValue.length:n.childNodes.length}function yO(n,e){for(;;){if(n.nodeType==3&&e)return n;if(n.nodeType==1&&e>0){if(n.contentEditable=="false")return null;n=n.childNodes[e-1],e=Rt(n)}else if(n.parentNode&&!qs(n))e=Qe(n),n=n.parentNode;else return null}}function bO(n,e){for(;;){if(n.nodeType==3&&e<n.nodeValue.length)return n;if(n.nodeType==1&&e<n.childNodes.length){if(n.contentEditable=="false")return null;n=n.childNodes[e],e=0}else if(n.parentNode&&!qs(n))e=Qe(n)+1,n=n.parentNode;else return null}}function vO(n,e,t){for(let r=e==0,i=e==Rt(n);r||i;){if(n==t)return!0;let s=Qe(n);if(n=n.parentNode,!n)return!1;r=r&&s==0,i=i&&s==Rt(n)}}function qs(n){let e;for(let t=n;t&&!(e=t.pmViewDesc);t=t.parentNode);return e&&e.node&&e.node.isBlock&&(e.dom==n||e.contentDOM==n)}const Oa=function(n){return n.focusNode&&Yr(n.focusNode,n.focusOffset,n.anchorNode,n.anchorOffset)};function qr(n,e){let t=document.createEvent("Event");return t.initEvent("keydown",!0,!0),t.keyCode=n,t.key=t.code=e,t}function wO(n){let e=n.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}function CO(n,e,t){if(n.caretPositionFromPoint)try{let r=n.caretPositionFromPoint(e,t);if(r)return{node:r.offsetNode,offset:Math.min(Rt(r.offsetNode),r.offset)}}catch{}if(n.caretRangeFromPoint){let r=n.caretRangeFromPoint(e,t);if(r)return{node:r.startContainer,offset:Math.min(Rt(r.startContainer),r.startOffset)}}}const mn=typeof navigator<"u"?navigator:null,tg=typeof document<"u"?document:null,ur=mn&&mn.userAgent||"",gu=/Edge\/(\d+)/.exec(ur),ng=/MSIE \d/.exec(ur),yu=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(ur),wt=!!(ng||yu||gu),fr=ng?document.documentMode:yu?+yu[1]:gu?+gu[1]:0,tn=!wt&&/gecko\/(\d+)/i.test(ur);tn&&+(/Firefox\/(\d+)/.exec(ur)||[0,0])[1];const bu=!wt&&/Chrome\/(\d+)/.exec(ur),rt=!!bu,rg=bu?+bu[1]:0,ct=!wt&&!!mn&&/Apple Computer/.test(mn.vendor),Di=ct&&(/Mobile\/\w+/.test(ur)||!!mn&&mn.maxTouchPoints>2),Ft=Di||(mn?/Mac/.test(mn.platform):!1),kO=mn?/Win/.test(mn.platform):!1,nn=/Android \d/.test(ur),Xs=!!tg&&"webkitFontSmoothing"in tg.documentElement.style,SO=Xs?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function xO(n){let e=n.defaultView&&n.defaultView.visualViewport;return e?{left:0,right:e.width,top:0,bottom:e.height}:{left:0,right:n.documentElement.clientWidth,top:0,bottom:n.documentElement.clientHeight}}function Dn(n,e){return typeof n=="number"?n:n[e]}function _O(n){let e=n.getBoundingClientRect(),t=e.width/n.offsetWidth||1,r=e.height/n.offsetHeight||1;return{left:e.left,right:e.left+n.clientWidth*t,top:e.top,bottom:e.top+n.clientHeight*r}}function ig(n,e,t){let r=n.someProp("scrollThreshold")||0,i=n.someProp("scrollMargin")||5,s=n.dom.ownerDocument;for(let o=t||n.dom;o;o=Ys(o)){if(o.nodeType!=1)continue;let a=o,l=a==s.body,c=l?xO(s):_O(a),u=0,d=0;if(e.top<c.top+Dn(r,"top")?d=-(c.top-e.top+Dn(i,"top")):e.bottom>c.bottom-Dn(r,"bottom")&&(d=e.bottom-e.top>c.bottom-c.top?e.top+Dn(i,"top")-c.top:e.bottom-c.bottom+Dn(i,"bottom")),e.left<c.left+Dn(r,"left")?u=-(c.left-e.left+Dn(i,"left")):e.right>c.right-Dn(r,"right")&&(u=e.right-c.right+Dn(i,"right")),u||d)if(l)s.defaultView.scrollBy(u,d);else{let h=a.scrollLeft,m=a.scrollTop;d&&(a.scrollTop+=d),u&&(a.scrollLeft+=u);let p=a.scrollLeft-h,g=a.scrollTop-m;e={left:e.left-p,top:e.top-g,right:e.right-p,bottom:e.bottom-g}}if(l||/^(fixed|sticky)$/.test(getComputedStyle(o).position))break}}function EO(n){let e=n.dom.getBoundingClientRect(),t=Math.max(0,e.top),r,i;for(let s=(e.left+e.right)/2,o=t+1;o<Math.min(innerHeight,e.bottom);o+=5){let a=n.root.elementFromPoint(s,o);if(!a||a==n.dom||!n.dom.contains(a))continue;let l=a.getBoundingClientRect();if(l.top>=t-20){r=a,i=l.top;break}}return{refDOM:r,refTop:i,stack:sg(n.dom)}}function sg(n){let e=[],t=n.ownerDocument;for(let r=n;r&&(e.push({dom:r,top:r.scrollTop,left:r.scrollLeft}),n!=t);r=Ys(r));return e}function TO({refDOM:n,refTop:e,stack:t}){let r=n?n.getBoundingClientRect().top:0;og(t,r==0?0:r-e)}function og(n,e){for(let t=0;t<n.length;t++){let{dom:r,top:i,left:s}=n[t];r.scrollTop!=i+e&&(r.scrollTop=i+e),r.scrollLeft!=s&&(r.scrollLeft=s)}}let Li=null;function OO(n){if(n.setActive)return n.setActive();if(Li)return n.focus(Li);let e=sg(n);n.focus(Li==null?{get preventScroll(){return Li={preventScroll:!0},!0}}:void 0),Li||(Li=!1,og(e,0))}function ag(n,e){let t,r=2e8,i,s=0,o=e.top,a=e.top,l,c;for(let u=n.firstChild,d=0;u;u=u.nextSibling,d++){let h;if(u.nodeType==1)h=u.getClientRects();else if(u.nodeType==3)h=In(u).getClientRects();else continue;for(let m=0;m<h.length;m++){let p=h[m];if(p.top<=o&&p.bottom>=a){o=Math.max(p.bottom,o),a=Math.min(p.top,a);let g=p.left>e.left?p.left-e.left:p.right<e.left?e.left-p.right:0;if(g<r){t=u,r=g,i=g&&t.nodeType==3?{left:p.right<e.left?p.right:p.left,top:e.top}:e,u.nodeType==1&&g&&(s=d+(e.left>=(p.left+p.right)/2?1:0));continue}}else p.top>e.top&&!l&&p.left<=e.left&&p.right>=e.left&&(l=u,c={left:Math.max(p.left,Math.min(p.right,e.left)),top:p.top});!t&&(e.left>=p.right&&e.top>=p.top||e.left>=p.left&&e.top>=p.bottom)&&(s=d+1)}}return!t&&l&&(t=l,i=c,r=0),t&&t.nodeType==3?NO(t,i):!t||r&&t.nodeType==1?{node:n,offset:s}:ag(t,i)}function NO(n,e){let t=n.nodeValue.length,r=document.createRange();for(let i=0;i<t;i++){r.setEnd(n,i+1),r.setStart(n,i);let s=dr(r,1);if(s.top!=s.bottom&&vu(e,s))return{node:n,offset:i+(e.left>=(s.left+s.right)/2?1:0)}}return{node:n,offset:0}}function vu(n,e){return n.left>=e.left-1&&n.left<=e.right+1&&n.top>=e.top-1&&n.top<=e.bottom+1}function MO(n,e){let t=n.parentNode;return t&&/^li$/i.test(t.nodeName)&&e.left<n.getBoundingClientRect().left?t:n}function AO(n,e,t){let{node:r,offset:i}=ag(e,t),s=-1;if(r.nodeType==1&&!r.firstChild){let o=r.getBoundingClientRect();s=o.left!=o.right&&t.left>(o.left+o.right)/2?1:-1}return n.docView.posFromDOM(r,i,s)}function PO(n,e,t,r){let i=-1;for(let s=e,o=!1;s!=n.dom;){let a=n.docView.nearestDesc(s,!0);if(!a)return null;if(a.dom.nodeType==1&&(a.node.isBlock&&a.parent||!a.contentDOM)){let l=a.dom.getBoundingClientRect();if(a.node.isBlock&&a.parent&&(!o&&l.left>r.left||l.top>r.top?i=a.posBefore:(!o&&l.right<r.left||l.bottom<r.top)&&(i=a.posAfter),o=!0),!a.contentDOM&&i<0&&!a.node.isText)return(a.node.isBlock?r.top<(l.top+l.bottom)/2:r.left<(l.left+l.right)/2)?a.posBefore:a.posAfter}s=a.dom.parentNode}return i>-1?i:n.docView.posFromDOM(e,t,-1)}function lg(n,e,t){let r=n.childNodes.length;if(r&&t.top<t.bottom)for(let i=Math.max(0,Math.min(r-1,Math.floor(r*(e.top-t.top)/(t.bottom-t.top))-2)),s=i;;){let o=n.childNodes[s];if(o.nodeType==1){let a=o.getClientRects();for(let l=0;l<a.length;l++){let c=a[l];if(vu(e,c))return lg(o,e,c)}}if((s=(s+1)%r)==i)break}return n}function IO(n,e){let t=n.dom.ownerDocument,r,i=0,s=CO(t,e.left,e.top);s&&({node:r,offset:i}=s);let o=(n.root.elementFromPoint?n.root:t).elementFromPoint(e.left,e.top),a;if(!o||!n.dom.contains(o.nodeType!=1?o.parentNode:o)){let c=n.dom.getBoundingClientRect();if(!vu(e,c)||(o=lg(n.dom,e,c),!o))return null}if(ct)for(let c=o;r&&c;c=Ys(c))c.draggable&&(r=void 0);if(o=MO(o,e),r){if(tn&&r.nodeType==1&&(i=Math.min(i,r.childNodes.length),i<r.childNodes.length)){let u=r.childNodes[i],d;u.nodeName=="IMG"&&(d=u.getBoundingClientRect()).right<=e.left&&d.bottom>e.top&&i++}let c;Xs&&i&&r.nodeType==1&&(c=r.childNodes[i-1]).nodeType==1&&c.contentEditable=="false"&&c.getBoundingClientRect().top>=e.top&&i--,r==n.dom&&i==r.childNodes.length-1&&r.lastChild.nodeType==1&&e.top>r.lastChild.getBoundingClientRect().bottom?a=n.state.doc.content.size:(i==0||r.nodeType!=1||r.childNodes[i-1].nodeName!="BR")&&(a=PO(n,r,i,e))}a==null&&(a=AO(n,o,e));let l=n.docView.nearestDesc(o,!0);return{pos:a,inside:l?l.posAtStart-l.border:-1}}function cg(n){return n.top<n.bottom||n.left<n.right}function dr(n,e){let t=n.getClientRects();if(t.length){let r=t[e<0?0:t.length-1];if(cg(r))return r}return Array.prototype.find.call(t,cg)||n.getBoundingClientRect()}const DO=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function ug(n,e,t){let{node:r,offset:i,atom:s}=n.docView.domFromPos(e,t<0?-1:1),o=Xs||tn;if(r.nodeType==3)if(o&&(DO.test(r.nodeValue)||(t<0?!i:i==r.nodeValue.length))){let l=dr(In(r,i,i),t);if(tn&&i&&/\s/.test(r.nodeValue[i-1])&&i<r.nodeValue.length){let c=dr(In(r,i-1,i-1),-1);if(c.top==l.top){let u=dr(In(r,i,i+1),-1);if(u.top!=l.top)return Js(u,u.left<c.left)}}return l}else{let l=i,c=i,u=t<0?1:-1;return t<0&&!i?(c++,u=-1):t>=0&&i==r.nodeValue.length?(l--,u=1):t<0?l--:c++,Js(dr(In(r,l,c),u),u<0)}if(!n.state.doc.resolve(e-(s||0)).parent.inlineContent){if(s==null&&i&&(t<0||i==Rt(r))){let l=r.childNodes[i-1];if(l.nodeType==1)return wu(l.getBoundingClientRect(),!1)}if(s==null&&i<Rt(r)){let l=r.childNodes[i];if(l.nodeType==1)return wu(l.getBoundingClientRect(),!0)}return wu(r.getBoundingClientRect(),t>=0)}if(s==null&&i&&(t<0||i==Rt(r))){let l=r.childNodes[i-1],c=l.nodeType==3?In(l,Rt(l)-(o?0:1)):l.nodeType==1&&(l.nodeName!="BR"||!l.nextSibling)?l:null;if(c)return Js(dr(c,1),!1)}if(s==null&&i<Rt(r)){let l=r.childNodes[i];for(;l.pmViewDesc&&l.pmViewDesc.ignoreForCoords;)l=l.nextSibling;let c=l?l.nodeType==3?In(l,0,o?0:1):l.nodeType==1?l:null:null;if(c)return Js(dr(c,-1),!0)}return Js(dr(r.nodeType==3?In(r):r,-t),t>=0)}function Js(n,e){if(n.width==0)return n;let t=e?n.left:n.right;return{top:n.top,bottom:n.bottom,left:t,right:t}}function wu(n,e){if(n.height==0)return n;let t=e?n.top:n.bottom;return{top:t,bottom:t,left:n.left,right:n.right}}function fg(n,e,t){let r=n.state,i=n.root.activeElement;r!=e&&n.updateState(e),i!=n.dom&&n.focus();try{return t()}finally{r!=e&&n.updateState(r),i!=n.dom&&i&&i.focus()}}function LO(n,e,t){let r=e.selection,i=t=="up"?r.$from:r.$to;return fg(n,e,()=>{let{node:s}=n.docView.domFromPos(i.pos,t=="up"?-1:1);for(;;){let a=n.docView.nearestDesc(s,!0);if(!a)break;if(a.node.isBlock){s=a.contentDOM||a.dom;break}s=a.dom.parentNode}let o=ug(n,i.pos,1);for(let a=s.firstChild;a;a=a.nextSibling){let l;if(a.nodeType==1)l=a.getClientRects();else if(a.nodeType==3)l=In(a,0,a.nodeValue.length).getClientRects();else continue;for(let c=0;c<l.length;c++){let u=l[c];if(u.bottom>u.top+1&&(t=="up"?o.top-u.top>(u.bottom-o.top)*2:u.bottom-o.bottom>(o.bottom-u.top)*2))return!1}}return!0})}const RO=/[\u0590-\u08ac]/;function FO(n,e,t){let{$head:r}=e.selection;if(!r.parent.isTextblock)return!1;let i=r.parentOffset,s=!i,o=i==r.parent.content.size,a=n.domSelection();return a?!RO.test(r.parent.textContent)||!a.modify?t=="left"||t=="backward"?s:o:fg(n,e,()=>{let{focusNode:l,focusOffset:c,anchorNode:u,anchorOffset:d}=n.domSelectionRange(),h=a.caretBidiLevel;a.modify("move",t,"character");let m=r.depth?n.docView.domAfterPos(r.before()):n.dom,{focusNode:p,focusOffset:g}=n.domSelectionRange(),y=p&&!m.contains(p.nodeType==1?p:p.parentNode)||l==p&&c==g;try{a.collapse(u,d),l&&(l!=u||c!=d)&&a.extend&&a.extend(l,c)}catch{}return h!=null&&(a.caretBidiLevel=h),y}):r.pos==r.start()||r.pos==r.end()}let dg=null,hg=null,pg=!1;function BO(n,e,t){return dg==e&&hg==t?pg:(dg=e,hg=t,pg=t=="up"||t=="down"?LO(n,e,t):FO(n,e,t))}const Bt=0,mg=1,Xr=2,gn=3;class Qs{constructor(e,t,r,i){this.parent=e,this.children=t,this.dom=r,this.contentDOM=i,this.dirty=Bt,r.pmViewDesc=this}matchesWidget(e){return!1}matchesMark(e){return!1}matchesNode(e,t,r){return!1}matchesHack(e){return!1}parseRule(){return null}stopEvent(e){return!1}get size(){let e=0;for(let t=0;t<this.children.length;t++)e+=this.children[t].size;return e}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let e=0;e<this.children.length;e++)this.children[e].destroy()}posBeforeChild(e){for(let t=0,r=this.posAtStart;;t++){let i=this.children[t];if(i==e)return r;r+=i.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(e,t,r){if(this.contentDOM&&this.contentDOM.contains(e.nodeType==1?e:e.parentNode))if(r<0){let s,o;if(e==this.contentDOM)s=e.childNodes[t-1];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;s=e.previousSibling}for(;s&&!((o=s.pmViewDesc)&&o.parent==this);)s=s.previousSibling;return s?this.posBeforeChild(o)+o.size:this.posAtStart}else{let s,o;if(e==this.contentDOM)s=e.childNodes[t];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;s=e.nextSibling}for(;s&&!((o=s.pmViewDesc)&&o.parent==this);)s=s.nextSibling;return s?this.posBeforeChild(o):this.posAtEnd}let i;if(e==this.dom&&this.contentDOM)i=t>Qe(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))i=e.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(t==0)for(let s=e;;s=s.parentNode){if(s==this.dom){i=!1;break}if(s.previousSibling)break}if(i==null&&t==e.childNodes.length)for(let s=e;;s=s.parentNode){if(s==this.dom){i=!0;break}if(s.nextSibling)break}}return i??r>0?this.posAtEnd:this.posAtStart}nearestDesc(e,t=!1){for(let r=!0,i=e;i;i=i.parentNode){let s=this.getDesc(i),o;if(s&&(!t||s.node))if(r&&(o=s.nodeDOM)&&!(o.nodeType==1?o.contains(e.nodeType==1?e:e.parentNode):o==e))r=!1;else return s}}getDesc(e){let t=e.pmViewDesc;for(let r=t;r;r=r.parent)if(r==this)return t}posFromDOM(e,t,r){for(let i=e;i;i=i.parentNode){let s=this.getDesc(i);if(s)return s.localPosFromDOM(e,t,r)}return-1}descAt(e){for(let t=0,r=0;t<this.children.length;t++){let i=this.children[t],s=r+i.size;if(r==e&&s!=r){for(;!i.border&&i.children.length;)i=i.children[0];return i}if(e<s)return i.descAt(e-r-i.border);r=s}}domFromPos(e,t){if(!this.contentDOM)return{node:this.dom,offset:0,atom:e+1};let r=0,i=0;for(let s=0;r<this.children.length;r++){let o=this.children[r],a=s+o.size;if(a>e||o instanceof bg){i=e-s;break}s=a}if(i)return this.children[r].domFromPos(i-this.children[r].border,t);for(let s;r&&!(s=this.children[r-1]).size&&s instanceof gg&&s.side>=0;r--);if(t<=0){let s,o=!0;for(;s=r?this.children[r-1]:null,!(!s||s.dom.parentNode==this.contentDOM);r--,o=!1);return s&&t&&o&&!s.border&&!s.domAtom?s.domFromPos(s.size,t):{node:this.contentDOM,offset:s?Qe(s.dom)+1:0}}else{let s,o=!0;for(;s=r<this.children.length?this.children[r]:null,!(!s||s.dom.parentNode==this.contentDOM);r++,o=!1);return s&&o&&!s.border&&!s.domAtom?s.domFromPos(0,t):{node:this.contentDOM,offset:s?Qe(s.dom):this.contentDOM.childNodes.length}}}parseRange(e,t,r=0){if(this.children.length==0)return{node:this.contentDOM,from:e,to:t,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let i=-1,s=-1;for(let o=r,a=0;;a++){let l=this.children[a],c=o+l.size;if(i==-1&&e<=c){let u=o+l.border;if(e>=u&&t<=c-l.border&&l.node&&l.contentDOM&&this.contentDOM.contains(l.contentDOM))return l.parseRange(e,t,u);e=o;for(let d=a;d>0;d--){let h=this.children[d-1];if(h.size&&h.dom.parentNode==this.contentDOM&&!h.emptyChildAt(1)){i=Qe(h.dom)+1;break}e-=h.size}i==-1&&(i=0)}if(i>-1&&(c>t||a==this.children.length-1)){t=c;for(let u=a+1;u<this.children.length;u++){let d=this.children[u];if(d.size&&d.dom.parentNode==this.contentDOM&&!d.emptyChildAt(-1)){s=Qe(d.dom);break}t+=d.size}s==-1&&(s=this.contentDOM.childNodes.length);break}o=c}return{node:this.contentDOM,from:e,to:t,fromOffset:i,toOffset:s}}emptyChildAt(e){if(this.border||!this.contentDOM||!this.children.length)return!1;let t=this.children[e<0?0:this.children.length-1];return t.size==0||t.emptyChildAt(e)}domAfterPos(e){let{node:t,offset:r}=this.domFromPos(e,0);if(t.nodeType!=1||r==t.childNodes.length)throw new RangeError("No node after pos "+e);return t.childNodes[r]}setSelection(e,t,r,i=!1){let s=Math.min(e,t),o=Math.max(e,t);for(let m=0,p=0;m<this.children.length;m++){let g=this.children[m],y=p+g.size;if(s>p&&o<y)return g.setSelection(e-p-g.border,t-p-g.border,r,i);p=y}let a=this.domFromPos(e,e?-1:1),l=t==e?a:this.domFromPos(t,t?-1:1),c=r.root.getSelection(),u=r.domSelectionRange(),d=!1;if((tn||ct)&&e==t){let{node:m,offset:p}=a;if(m.nodeType==3){if(d=!!(p&&m.nodeValue[p-1]==`
`),d&&p==m.nodeValue.length)for(let g=m,y;g;g=g.parentNode){if(y=g.nextSibling){y.nodeName=="BR"&&(a=l={node:y.parentNode,offset:Qe(y)+1});break}let v=g.pmViewDesc;if(v&&v.node&&v.node.isBlock)break}}else{let g=m.childNodes[p-1];d=g&&(g.nodeName=="BR"||g.contentEditable=="false")}}if(tn&&u.focusNode&&u.focusNode!=l.node&&u.focusNode.nodeType==1){let m=u.focusNode.childNodes[u.focusOffset];m&&m.contentEditable=="false"&&(i=!0)}if(!(i||d&&ct)&&Yr(a.node,a.offset,u.anchorNode,u.anchorOffset)&&Yr(l.node,l.offset,u.focusNode,u.focusOffset))return;let h=!1;if((c.extend||e==t)&&!d){c.collapse(a.node,a.offset);try{e!=t&&c.extend(l.node,l.offset),h=!0}catch{}}if(!h){if(e>t){let p=a;a=l,l=p}let m=document.createRange();m.setEnd(l.node,l.offset),m.setStart(a.node,a.offset),c.removeAllRanges(),c.addRange(m)}}ignoreMutation(e){return!this.contentDOM&&e.type!="selection"}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(e,t){for(let r=0,i=0;i<this.children.length;i++){let s=this.children[i],o=r+s.size;if(r==o?e<=o&&t>=r:e<o&&t>r){let a=r+s.border,l=o-s.border;if(e>=a&&t<=l){this.dirty=e==r||t==o?Xr:mg,e==a&&t==l&&(s.contentLost||s.dom.parentNode!=this.contentDOM)?s.dirty=gn:s.markDirty(e-a,t-a);return}else s.dirty=s.dom==s.contentDOM&&s.dom.parentNode==this.contentDOM&&!s.children.length?Xr:gn}r=o}this.dirty=Xr}markParentsDirty(){let e=1;for(let t=this.parent;t;t=t.parent,e++){let r=e==1?Xr:mg;t.dirty<r&&(t.dirty=r)}}get domAtom(){return!1}get ignoreForCoords(){return!1}isText(e){return!1}}class gg extends Qs{constructor(e,t,r,i){let s,o=t.type.toDOM;if(typeof o=="function"&&(o=o(r,()=>{if(!s)return i;if(s.parent)return s.parent.posBeforeChild(s)})),!t.type.spec.raw){if(o.nodeType!=1){let a=document.createElement("span");a.appendChild(o),o=a}o.contentEditable="false",o.classList.add("ProseMirror-widget")}super(e,[],o,null),this.widget=t,this.widget=t,s=this}matchesWidget(e){return this.dirty==Bt&&e.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(e){let t=this.widget.spec.stopEvent;return t?t(e):!1}ignoreMutation(e){return e.type!="selection"||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get side(){return this.widget.type.side}}class VO extends Qs{constructor(e,t,r,i){super(e,[],t,null),this.textDOM=r,this.text=i}get size(){return this.text.length}localPosFromDOM(e,t){return e!=this.textDOM?this.posAtStart+(t?this.size:0):this.posAtStart+t}domFromPos(e){return{node:this.textDOM,offset:e}}ignoreMutation(e){return e.type==="characterData"&&e.target.nodeValue==e.oldValue}}class Jr extends Qs{constructor(e,t,r,i,s){super(e,[],r,i),this.mark=t,this.spec=s}static create(e,t,r,i){let s=i.nodeViews[t.type.name],o=s&&s(t,i,r);return(!o||!o.dom)&&(o=Kr.renderSpec(document,t.type.spec.toDOM(t,r),null,t.attrs)),new Jr(e,t,o.dom,o.contentDOM||o.dom,o)}parseRule(){return this.dirty&gn||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(e){return this.dirty!=gn&&this.mark.eq(e)}markDirty(e,t){if(super.markDirty(e,t),this.dirty!=Bt){let r=this.parent;for(;!r.node;)r=r.parent;r.dirty<this.dirty&&(r.dirty=this.dirty),this.dirty=Bt}}slice(e,t,r){let i=Jr.create(this.parent,this.mark,!0,r),s=this.children,o=this.size;t<o&&(s=ku(s,t,o,r)),e>0&&(s=ku(s,0,e,r));for(let a=0;a<s.length;a++)s[a].parent=i;return i.children=s,i}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}}class hr extends Qs{constructor(e,t,r,i,s,o,a,l,c){super(e,[],s,o),this.node=t,this.outerDeco=r,this.innerDeco=i,this.nodeDOM=a}static create(e,t,r,i,s,o){let a=s.nodeViews[t.type.name],l,c=a&&a(t,s,()=>{if(!l)return o;if(l.parent)return l.parent.posBeforeChild(l)},r,i),u=c&&c.dom,d=c&&c.contentDOM;if(t.isText){if(!u)u=document.createTextNode(t.text);else if(u.nodeType!=3)throw new RangeError("Text must be rendered as a DOM text node")}else u||({dom:u,contentDOM:d}=Kr.renderSpec(document,t.type.spec.toDOM(t),null,t.attrs));!d&&!t.isText&&u.nodeName!="BR"&&(u.hasAttribute("contenteditable")||(u.contentEditable="false"),t.type.spec.draggable&&(u.draggable=!0));let h=u;return u=Cg(u,r,t),c?l=new $O(e,t,r,i,u,d||null,h,c,s,o+1):t.isText?new Na(e,t,r,i,u,h,s):new hr(e,t,r,i,u,d||null,h,s,o+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let e={node:this.node.type.name,attrs:this.node.attrs};if(this.node.type.whitespace=="pre"&&(e.preserveWhitespace="full"),!this.contentDOM)e.getContent=()=>this.node.content;else if(!this.contentLost)e.contentElement=this.contentDOM;else{for(let t=this.children.length-1;t>=0;t--){let r=this.children[t];if(this.dom.contains(r.dom.parentNode)){e.contentElement=r.dom.parentNode;break}}e.contentElement||(e.getContent=()=>I.empty)}return e}matchesNode(e,t,r){return this.dirty==Bt&&e.eq(this.node)&&Ma(t,this.outerDeco)&&r.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(e,t){let r=this.node.inlineContent,i=t,s=e.composing?this.localCompositionInfo(e,t):null,o=s&&s.pos>-1?s:null,a=s&&s.pos<0,l=new zO(this,o&&o.node,e);UO(this.node,this.innerDeco,(c,u,d)=>{c.spec.marks?l.syncToMarks(c.spec.marks,r,e):c.type.side>=0&&!d&&l.syncToMarks(u==this.node.childCount?Se.none:this.node.child(u).marks,r,e),l.placeWidget(c,e,i)},(c,u,d,h)=>{l.syncToMarks(c.marks,r,e);let m;l.findNodeMatch(c,u,d,h)||a&&e.state.selection.from>i&&e.state.selection.to<i+c.nodeSize&&(m=l.findIndexWithChild(s.node))>-1&&l.updateNodeAt(c,u,d,m,e)||l.updateNextNode(c,u,d,e,h,i)||l.addNode(c,u,d,e,i),i+=c.nodeSize}),l.syncToMarks([],r,e),this.node.isTextblock&&l.addTextblockHacks(),l.destroyRest(),(l.changed||this.dirty==Xr)&&(o&&this.protectLocalComposition(e,o),vg(this.contentDOM,this.children,e),Di&&WO(this.dom))}localCompositionInfo(e,t){let{from:r,to:i}=e.state.selection;if(!(e.state.selection instanceof ne)||r<t||i>t+this.node.content.size)return null;let s=e.input.compositionNode;if(!s||!this.dom.contains(s.parentNode))return null;if(this.node.inlineContent){let o=s.nodeValue,a=KO(this.node.content,o,r-t,i-t);return a<0?null:{node:s,pos:a,text:o}}else return{node:s,pos:-1,text:""}}protectLocalComposition(e,{node:t,pos:r,text:i}){if(this.getDesc(t))return;let s=t;for(;s.parentNode!=this.contentDOM;s=s.parentNode){for(;s.previousSibling;)s.parentNode.removeChild(s.previousSibling);for(;s.nextSibling;)s.parentNode.removeChild(s.nextSibling);s.pmViewDesc&&(s.pmViewDesc=void 0)}let o=new VO(this,s,t,i);e.input.compositionNodes.push(o),this.children=ku(this.children,r,r+i.length,e,o)}update(e,t,r,i){return this.dirty==gn||!e.sameMarkup(this.node)?!1:(this.updateInner(e,t,r,i),!0)}updateInner(e,t,r,i){this.updateOuterDeco(t),this.node=e,this.innerDeco=r,this.contentDOM&&this.updateChildren(i,this.posAtStart),this.dirty=Bt}updateOuterDeco(e){if(Ma(e,this.outerDeco))return;let t=this.nodeDOM.nodeType!=1,r=this.dom;this.dom=wg(this.dom,this.nodeDOM,Cu(this.outerDeco,this.node,t),Cu(e,this.node,t)),this.dom!=r&&(r.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=e}selectNode(){this.nodeDOM.nodeType==1&&this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.dom.draggable=!0)}deselectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.dom.removeAttribute("draggable"))}get domAtom(){return this.node.isAtom}}function yg(n,e,t,r,i){Cg(r,e,n);let s=new hr(void 0,n,e,t,r,r,r,i,0);return s.contentDOM&&s.updateChildren(i,0),s}class Na extends hr{constructor(e,t,r,i,s,o,a){super(e,t,r,i,s,null,o,a,0)}parseRule(){let e=this.nodeDOM.parentNode;for(;e&&e!=this.dom&&!e.pmIsDeco;)e=e.parentNode;return{skip:e||!0}}update(e,t,r,i){return this.dirty==gn||this.dirty!=Bt&&!this.inParent()||!e.sameMarkup(this.node)?!1:(this.updateOuterDeco(t),(this.dirty!=Bt||e.text!=this.node.text)&&e.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=e.text,i.trackWrites==this.nodeDOM&&(i.trackWrites=null)),this.node=e,this.dirty=Bt,!0)}inParent(){let e=this.parent.contentDOM;for(let t=this.nodeDOM;t;t=t.parentNode)if(t==e)return!0;return!1}domFromPos(e){return{node:this.nodeDOM,offset:e}}localPosFromDOM(e,t,r){return e==this.nodeDOM?this.posAtStart+Math.min(t,this.node.text.length):super.localPosFromDOM(e,t,r)}ignoreMutation(e){return e.type!="characterData"&&e.type!="selection"}slice(e,t,r){let i=this.node.cut(e,t),s=document.createTextNode(i.text);return new Na(this.parent,i,this.outerDeco,this.innerDeco,s,s,r)}markDirty(e,t){super.markDirty(e,t),this.dom!=this.nodeDOM&&(e==0||t==this.nodeDOM.nodeValue.length)&&(this.dirty=gn)}get domAtom(){return!1}isText(e){return this.node.text==e}}class bg extends Qs{parseRule(){return{ignore:!0}}matchesHack(e){return this.dirty==Bt&&this.dom.nodeName==e}get domAtom(){return!0}get ignoreForCoords(){return this.dom.nodeName=="IMG"}}class $O extends hr{constructor(e,t,r,i,s,o,a,l,c,u){super(e,t,r,i,s,o,a,c,u),this.spec=l}update(e,t,r,i){if(this.dirty==gn)return!1;if(this.spec.update&&(this.node.type==e.type||this.spec.multiType)){let s=this.spec.update(e,t,r);return s&&this.updateInner(e,t,r,i),s}else return!this.contentDOM&&!e.isLeaf?!1:super.update(e,t,r,i)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(e,t,r,i){this.spec.setSelection?this.spec.setSelection(e,t,r.root):super.setSelection(e,t,r,i)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(e){return this.spec.stopEvent?this.spec.stopEvent(e):!1}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}}function vg(n,e,t){let r=n.firstChild,i=!1;for(let s=0;s<e.length;s++){let o=e[s],a=o.dom;if(a.parentNode==n){for(;a!=r;)r=kg(r),i=!0;r=r.nextSibling}else i=!0,n.insertBefore(a,r);if(o instanceof Jr){let l=r?r.previousSibling:n.lastChild;vg(o.contentDOM,o.children,t),r=l?l.nextSibling:n.firstChild}}for(;r;)r=kg(r),i=!0;i&&t.trackWrites==n&&(t.trackWrites=null)}const Zs=function(n){n&&(this.nodeName=n)};Zs.prototype=Object.create(null);const Qr=[new Zs];function Cu(n,e,t){if(n.length==0)return Qr;let r=t?Qr[0]:new Zs,i=[r];for(let s=0;s<n.length;s++){let o=n[s].type.attrs;if(o){o.nodeName&&i.push(r=new Zs(o.nodeName));for(let a in o){let l=o[a];l!=null&&(t&&i.length==1&&i.push(r=new Zs(e.isInline?"span":"div")),a=="class"?r.class=(r.class?r.class+" ":"")+l:a=="style"?r.style=(r.style?r.style+";":"")+l:a!="nodeName"&&(r[a]=l))}}}return i}function wg(n,e,t,r){if(t==Qr&&r==Qr)return e;let i=e;for(let s=0;s<r.length;s++){let o=r[s],a=t[s];if(s){let l;a&&a.nodeName==o.nodeName&&i!=n&&(l=i.parentNode)&&l.nodeName.toLowerCase()==o.nodeName||(l=document.createElement(o.nodeName),l.pmIsDeco=!0,l.appendChild(i),a=Qr[0]),i=l}jO(i,a||Qr[0],o)}return i}function jO(n,e,t){for(let r in e)r!="class"&&r!="style"&&r!="nodeName"&&!(r in t)&&n.removeAttribute(r);for(let r in t)r!="class"&&r!="style"&&r!="nodeName"&&t[r]!=e[r]&&n.setAttribute(r,t[r]);if(e.class!=t.class){let r=e.class?e.class.split(" ").filter(Boolean):[],i=t.class?t.class.split(" ").filter(Boolean):[];for(let s=0;s<r.length;s++)i.indexOf(r[s])==-1&&n.classList.remove(r[s]);for(let s=0;s<i.length;s++)r.indexOf(i[s])==-1&&n.classList.add(i[s]);n.classList.length==0&&n.removeAttribute("class")}if(e.style!=t.style){if(e.style){let r=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,i;for(;i=r.exec(e.style);)n.style.removeProperty(i[1])}t.style&&(n.style.cssText+=t.style)}}function Cg(n,e,t){return wg(n,n,Qr,Cu(e,t,n.nodeType!=1))}function Ma(n,e){if(n.length!=e.length)return!1;for(let t=0;t<n.length;t++)if(!n[t].type.eq(e[t].type))return!1;return!0}function kg(n){let e=n.nextSibling;return n.parentNode.removeChild(n),e}class zO{constructor(e,t,r){this.lock=t,this.view=r,this.index=0,this.stack=[],this.changed=!1,this.top=e,this.preMatch=HO(e.node.content,e)}destroyBetween(e,t){if(e!=t){for(let r=e;r<t;r++)this.top.children[r].destroy();this.top.children.splice(e,t-e),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(e,t,r){let i=0,s=this.stack.length>>1,o=Math.min(s,e.length);for(;i<o&&(i==s-1?this.top:this.stack[i+1<<1]).matchesMark(e[i])&&e[i].type.spec.spanning!==!1;)i++;for(;i<s;)this.destroyRest(),this.top.dirty=Bt,this.index=this.stack.pop(),this.top=this.stack.pop(),s--;for(;s<e.length;){this.stack.push(this.top,this.index+1);let a=-1;for(let l=this.index;l<Math.min(this.index+3,this.top.children.length);l++){let c=this.top.children[l];if(c.matchesMark(e[s])&&!this.isLocked(c.dom)){a=l;break}}if(a>-1)a>this.index&&(this.changed=!0,this.destroyBetween(this.index,a)),this.top=this.top.children[this.index];else{let l=Jr.create(this.top,e[s],t,r);this.top.children.splice(this.index,0,l),this.top=l,this.changed=!0}this.index=0,s++}}findNodeMatch(e,t,r,i){let s=-1,o;if(i>=this.preMatch.index&&(o=this.preMatch.matches[i-this.preMatch.index]).parent==this.top&&o.matchesNode(e,t,r))s=this.top.children.indexOf(o,this.index);else for(let a=this.index,l=Math.min(this.top.children.length,a+5);a<l;a++){let c=this.top.children[a];if(c.matchesNode(e,t,r)&&!this.preMatch.matched.has(c)){s=a;break}}return s<0?!1:(this.destroyBetween(this.index,s),this.index++,!0)}updateNodeAt(e,t,r,i,s){let o=this.top.children[i];return o.dirty==gn&&o.dom==o.contentDOM&&(o.dirty=Xr),o.update(e,t,r,s)?(this.destroyBetween(this.index,i),this.index++,!0):!1}findIndexWithChild(e){for(;;){let t=e.parentNode;if(!t)return-1;if(t==this.top.contentDOM){let r=e.pmViewDesc;if(r){for(let i=this.index;i<this.top.children.length;i++)if(this.top.children[i]==r)return i}return-1}e=t}}updateNextNode(e,t,r,i,s,o){for(let a=this.index;a<this.top.children.length;a++){let l=this.top.children[a];if(l instanceof hr){let c=this.preMatch.matched.get(l);if(c!=null&&c!=s)return!1;let u=l.dom,d,h=this.isLocked(u)&&!(e.isText&&l.node&&l.node.isText&&l.nodeDOM.nodeValue==e.text&&l.dirty!=gn&&Ma(t,l.outerDeco));if(!h&&l.update(e,t,r,i))return this.destroyBetween(this.index,a),l.dom!=u&&(this.changed=!0),this.index++,!0;if(!h&&(d=this.recreateWrapper(l,e,t,r,i,o)))return this.destroyBetween(this.index,a),this.top.children[this.index]=d,d.contentDOM&&(d.dirty=Xr,d.updateChildren(i,o+1),d.dirty=Bt),this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(e,t,r,i,s,o){if(e.dirty||t.isAtom||!e.children.length||!e.node.content.eq(t.content)||!Ma(r,e.outerDeco)||!i.eq(e.innerDeco))return null;let a=hr.create(this.top,t,r,i,s,o);if(a.contentDOM){a.children=e.children,e.children=[];for(let l of a.children)l.parent=a}return e.destroy(),a}addNode(e,t,r,i,s){let o=hr.create(this.top,e,t,r,i,s);o.contentDOM&&o.updateChildren(i,s+1),this.top.children.splice(this.index++,0,o),this.changed=!0}placeWidget(e,t,r){let i=this.index<this.top.children.length?this.top.children[this.index]:null;if(i&&i.matchesWidget(e)&&(e==i.widget||!i.widget.type.toDOM.parentNode))this.index++;else{let s=new gg(this.top,e,t,r);this.top.children.splice(this.index++,0,s),this.changed=!0}}addTextblockHacks(){let e=this.top.children[this.index-1],t=this.top;for(;e instanceof Jr;)t=e,e=t.children[t.children.length-1];(!e||!(e instanceof Na)||/\n$/.test(e.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(e.node.text))&&((ct||rt)&&e&&e.dom.contentEditable=="false"&&this.addHackNode("IMG",t),this.addHackNode("BR",this.top))}addHackNode(e,t){if(t==this.top&&this.index<t.children.length&&t.children[this.index].matchesHack(e))this.index++;else{let r=document.createElement(e);e=="IMG"&&(r.className="ProseMirror-separator",r.alt=""),e=="BR"&&(r.className="ProseMirror-trailingBreak");let i=new bg(this.top,[],r,null);t!=this.top?t.children.push(i):t.children.splice(this.index++,0,i),this.changed=!0}}isLocked(e){return this.lock&&(e==this.lock||e.nodeType==1&&e.contains(this.lock.parentNode))}}function HO(n,e){let t=e,r=t.children.length,i=n.childCount,s=new Map,o=[];e:for(;i>0;){let a;for(;;)if(r){let c=t.children[r-1];if(c instanceof Jr)t=c,r=c.children.length;else{a=c,r--;break}}else{if(t==e)break e;r=t.parent.children.indexOf(t),t=t.parent}let l=a.node;if(l){if(l!=n.child(i-1))break;--i,s.set(a,i),o.push(a)}}return{index:i,matched:s,matches:o.reverse()}}function GO(n,e){return n.type.side-e.type.side}function UO(n,e,t,r){let i=e.locals(n),s=0;if(i.length==0){for(let c=0;c<n.childCount;c++){let u=n.child(c);r(u,i,e.forChild(s,u),c),s+=u.nodeSize}return}let o=0,a=[],l=null;for(let c=0;;){let u,d;for(;o<i.length&&i[o].to==s;){let y=i[o++];y.widget&&(u?(d||(d=[u])).push(y):u=y)}if(u)if(d){d.sort(GO);for(let y=0;y<d.length;y++)t(d[y],c,!!l)}else t(u,c,!!l);let h,m;if(l)m=-1,h=l,l=null;else if(c<n.childCount)m=c,h=n.child(c++);else break;for(let y=0;y<a.length;y++)a[y].to<=s&&a.splice(y--,1);for(;o<i.length&&i[o].from<=s&&i[o].to>s;)a.push(i[o++]);let p=s+h.nodeSize;if(h.isText){let y=p;o<i.length&&i[o].from<y&&(y=i[o].from);for(let v=0;v<a.length;v++)a[v].to<y&&(y=a[v].to);y<p&&(l=h.cut(y-s),h=h.cut(0,y-s),p=y,m=-1)}else for(;o<i.length&&i[o].to<p;)o++;let g=h.isInline&&!h.isLeaf?a.filter(y=>!y.inline):a.slice();r(h,g,e.forChild(s,h),m),s=p}}function WO(n){if(n.nodeName=="UL"||n.nodeName=="OL"){let e=n.style.cssText;n.style.cssText=e+"; list-style: square !important",window.getComputedStyle(n).listStyle,n.style.cssText=e}}function KO(n,e,t,r){for(let i=0,s=0;i<n.childCount&&s<=r;){let o=n.child(i++),a=s;if(s+=o.nodeSize,!o.isText)continue;let l=o.text;for(;i<n.childCount;){let c=n.child(i++);if(s+=c.nodeSize,!c.isText)break;l+=c.text}if(s>=t){if(s>=r&&l.slice(r-e.length-a,r-a)==e)return r-e.length;let c=a<r?l.lastIndexOf(e,r-a-1):-1;if(c>=0&&c+e.length+a>=t)return a+c;if(t==r&&l.length>=r+e.length-a&&l.slice(r-a,r-a+e.length)==e)return r}}return-1}function ku(n,e,t,r,i){let s=[];for(let o=0,a=0;o<n.length;o++){let l=n[o],c=a,u=a+=l.size;c>=t||u<=e?s.push(l):(c<e&&s.push(l.slice(0,e-c,r)),i&&(s.push(i),i=void 0),u>t&&s.push(l.slice(t-c,l.size,r)))}return s}function Su(n,e=null){let t=n.domSelectionRange(),r=n.state.doc;if(!t.focusNode)return null;let i=n.docView.nearestDesc(t.focusNode),s=i&&i.size==0,o=n.docView.posFromDOM(t.focusNode,t.focusOffset,1);if(o<0)return null;let a=r.resolve(o),l,c;if(Oa(t)){for(l=o;i&&!i.node;)i=i.parent;let d=i.node;if(i&&d.isAtom&&q.isSelectable(d)&&i.parent&&!(d.isInline&&vO(t.focusNode,t.focusOffset,i.dom))){let h=i.posBefore;c=new q(o==h?a:r.resolve(h))}}else{if(t instanceof n.dom.ownerDocument.defaultView.Selection&&t.rangeCount>1){let d=o,h=o;for(let m=0;m<t.rangeCount;m++){let p=t.getRangeAt(m);d=Math.min(d,n.docView.posFromDOM(p.startContainer,p.startOffset,1)),h=Math.max(h,n.docView.posFromDOM(p.endContainer,p.endOffset,-1))}if(d<0)return null;[l,o]=h==n.state.selection.anchor?[h,d]:[d,h],a=r.resolve(o)}else l=n.docView.posFromDOM(t.anchorNode,t.anchorOffset,1);if(l<0)return null}let u=r.resolve(l);if(!c){let d=e=="pointer"||n.state.selection.head<a.pos&&!s?1:-1;c=_u(n,u,a,d)}return c}function Sg(n){return n.editable?n.hasFocus():Mg(n)&&document.activeElement&&document.activeElement.contains(n.dom)}function Ln(n,e=!1){let t=n.state.selection;if(Tg(n,t),!!Sg(n)){if(!e&&n.input.mouseDown&&n.input.mouseDown.allowDefault&&rt){let r=n.domSelectionRange(),i=n.domObserver.currentSelection;if(r.anchorNode&&i.anchorNode&&Yr(r.anchorNode,r.anchorOffset,i.anchorNode,i.anchorOffset)){n.input.mouseDown.delayedSelectionSync=!0,n.domObserver.setCurSelection();return}}if(n.domObserver.disconnectSelection(),n.cursorWrapper)qO(n);else{let{anchor:r,head:i}=t,s,o;xg&&!(t instanceof ne)&&(t.$from.parent.inlineContent||(s=_g(n,t.from)),!t.empty&&!t.$from.parent.inlineContent&&(o=_g(n,t.to))),n.docView.setSelection(r,i,n,e),xg&&(s&&Eg(s),o&&Eg(o)),t.visible?n.dom.classList.remove("ProseMirror-hideselection"):(n.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&YO(n))}n.domObserver.setCurSelection(),n.domObserver.connectSelection()}}const xg=ct||rt&&rg<63;function _g(n,e){let{node:t,offset:r}=n.docView.domFromPos(e,0),i=r<t.childNodes.length?t.childNodes[r]:null,s=r?t.childNodes[r-1]:null;if(ct&&i&&i.contentEditable=="false")return xu(i);if((!i||i.contentEditable=="false")&&(!s||s.contentEditable=="false")){if(i)return xu(i);if(s)return xu(s)}}function xu(n){return n.contentEditable="true",ct&&n.draggable&&(n.draggable=!1,n.wasDraggable=!0),n}function Eg(n){n.contentEditable="false",n.wasDraggable&&(n.draggable=!0,n.wasDraggable=null)}function YO(n){let e=n.dom.ownerDocument;e.removeEventListener("selectionchange",n.input.hideSelectionGuard);let t=n.domSelectionRange(),r=t.anchorNode,i=t.anchorOffset;e.addEventListener("selectionchange",n.input.hideSelectionGuard=()=>{(t.anchorNode!=r||t.anchorOffset!=i)&&(e.removeEventListener("selectionchange",n.input.hideSelectionGuard),setTimeout(()=>{(!Sg(n)||n.state.selection.visible)&&n.dom.classList.remove("ProseMirror-hideselection")},20))})}function qO(n){let e=n.domSelection(),t=document.createRange();if(!e)return;let r=n.cursorWrapper.dom,i=r.nodeName=="IMG";i?t.setStart(r.parentNode,Qe(r)+1):t.setStart(r,0),t.collapse(!0),e.removeAllRanges(),e.addRange(t),!i&&!n.state.selection.visible&&wt&&fr<=11&&(r.disabled=!0,r.disabled=!1)}function Tg(n,e){if(e instanceof q){let t=n.docView.descAt(e.from);t!=n.lastSelectedViewDesc&&(Og(n),t&&t.selectNode(),n.lastSelectedViewDesc=t)}else Og(n)}function Og(n){n.lastSelectedViewDesc&&(n.lastSelectedViewDesc.parent&&n.lastSelectedViewDesc.deselectNode(),n.lastSelectedViewDesc=void 0)}function _u(n,e,t,r){return n.someProp("createSelectionBetween",i=>i(n,e,t))||ne.between(e,t,r)}function Ng(n){return n.editable&&!n.hasFocus()?!1:Mg(n)}function Mg(n){let e=n.domSelectionRange();if(!e.anchorNode)return!1;try{return n.dom.contains(e.anchorNode.nodeType==3?e.anchorNode.parentNode:e.anchorNode)&&(n.editable||n.dom.contains(e.focusNode.nodeType==3?e.focusNode.parentNode:e.focusNode))}catch{return!1}}function XO(n){let e=n.docView.domFromPos(n.state.selection.anchor,0),t=n.domSelectionRange();return Yr(e.node,e.offset,t.anchorNode,t.anchorOffset)}function Eu(n,e){let{$anchor:t,$head:r}=n.selection,i=e>0?t.max(r):t.min(r),s=i.parent.inlineContent?i.depth?n.doc.resolve(e>0?i.after():i.before()):null:i;return s&&re.findFrom(s,e)}function pr(n,e){return n.dispatch(n.state.tr.setSelection(e).scrollIntoView()),!0}function Ag(n,e,t){let r=n.state.selection;if(r instanceof ne)if(t.indexOf("s")>-1){let{$head:i}=r,s=i.textOffset?null:e<0?i.nodeBefore:i.nodeAfter;if(!s||s.isText||!s.isLeaf)return!1;let o=n.state.doc.resolve(i.pos+s.nodeSize*(e<0?-1:1));return pr(n,new ne(r.$anchor,o))}else if(r.empty){if(n.endOfTextblock(e>0?"forward":"backward")){let i=Eu(n.state,e);return i&&i instanceof q?pr(n,i):!1}else if(!(Ft&&t.indexOf("m")>-1)){let i=r.$head,s=i.textOffset?null:e<0?i.nodeBefore:i.nodeAfter,o;if(!s||s.isText)return!1;let a=e<0?i.pos-s.nodeSize:i.pos;return s.isAtom||(o=n.docView.descAt(a))&&!o.contentDOM?q.isSelectable(s)?pr(n,new q(e<0?n.state.doc.resolve(i.pos-s.nodeSize):i)):Xs?pr(n,new ne(n.state.doc.resolve(e<0?a:a+s.nodeSize))):!1:!1}}else return!1;else{if(r instanceof q&&r.node.isInline)return pr(n,new ne(e>0?r.$to:r.$from));{let i=Eu(n.state,e);return i?pr(n,i):!1}}}function Aa(n){return n.nodeType==3?n.nodeValue.length:n.childNodes.length}function eo(n,e){let t=n.pmViewDesc;return t&&t.size==0&&(e<0||n.nextSibling||n.nodeName!="BR")}function Ri(n,e){return e<0?JO(n):QO(n)}function JO(n){let e=n.domSelectionRange(),t=e.focusNode,r=e.focusOffset;if(!t)return;let i,s,o=!1;for(tn&&t.nodeType==1&&r<Aa(t)&&eo(t.childNodes[r],-1)&&(o=!0);;)if(r>0){if(t.nodeType!=1)break;{let a=t.childNodes[r-1];if(eo(a,-1))i=t,s=--r;else if(a.nodeType==3)t=a,r=t.nodeValue.length;else break}}else{if(Pg(t))break;{let a=t.previousSibling;for(;a&&eo(a,-1);)i=t.parentNode,s=Qe(a),a=a.previousSibling;if(a)t=a,r=Aa(t);else{if(t=t.parentNode,t==n.dom)break;r=0}}}o?Tu(n,t,r):i&&Tu(n,i,s)}function QO(n){let e=n.domSelectionRange(),t=e.focusNode,r=e.focusOffset;if(!t)return;let i=Aa(t),s,o;for(;;)if(r<i){if(t.nodeType!=1)break;let a=t.childNodes[r];if(eo(a,1))s=t,o=++r;else break}else{if(Pg(t))break;{let a=t.nextSibling;for(;a&&eo(a,1);)s=a.parentNode,o=Qe(a)+1,a=a.nextSibling;if(a)t=a,r=0,i=Aa(t);else{if(t=t.parentNode,t==n.dom)break;r=i=0}}}s&&Tu(n,s,o)}function Pg(n){let e=n.pmViewDesc;return e&&e.node&&e.node.isBlock}function ZO(n,e){for(;n&&e==n.childNodes.length&&!qs(n);)e=Qe(n)+1,n=n.parentNode;for(;n&&e<n.childNodes.length;){let t=n.childNodes[e];if(t.nodeType==3)return t;if(t.nodeType==1&&t.contentEditable=="false")break;n=t,e=0}}function eN(n,e){for(;n&&!e&&!qs(n);)e=Qe(n),n=n.parentNode;for(;n&&e;){let t=n.childNodes[e-1];if(t.nodeType==3)return t;if(t.nodeType==1&&t.contentEditable=="false")break;n=t,e=n.childNodes.length}}function Tu(n,e,t){if(e.nodeType!=3){let s,o;(o=ZO(e,t))?(e=o,t=0):(s=eN(e,t))&&(e=s,t=s.nodeValue.length)}let r=n.domSelection();if(!r)return;if(Oa(r)){let s=document.createRange();s.setEnd(e,t),s.setStart(e,t),r.removeAllRanges(),r.addRange(s)}else r.extend&&r.extend(e,t);n.domObserver.setCurSelection();let{state:i}=n;setTimeout(()=>{n.state==i&&Ln(n)},50)}function Ig(n,e){let t=n.state.doc.resolve(e);if(!(rt||kO)&&t.parent.inlineContent){let i=n.coordsAtPos(e);if(e>t.start()){let s=n.coordsAtPos(e-1),o=(s.top+s.bottom)/2;if(o>i.top&&o<i.bottom&&Math.abs(s.left-i.left)>1)return s.left<i.left?"ltr":"rtl"}if(e<t.end()){let s=n.coordsAtPos(e+1),o=(s.top+s.bottom)/2;if(o>i.top&&o<i.bottom&&Math.abs(s.left-i.left)>1)return s.left>i.left?"ltr":"rtl"}}return getComputedStyle(n.dom).direction=="rtl"?"rtl":"ltr"}function Dg(n,e,t){let r=n.state.selection;if(r instanceof ne&&!r.empty||t.indexOf("s")>-1||Ft&&t.indexOf("m")>-1)return!1;let{$from:i,$to:s}=r;if(!i.parent.inlineContent||n.endOfTextblock(e<0?"up":"down")){let o=Eu(n.state,e);if(o&&o instanceof q)return pr(n,o)}if(!i.parent.inlineContent){let o=e<0?i:s,a=r instanceof en?re.near(o,e):re.findFrom(o,e);return a?pr(n,a):!1}return!1}function Lg(n,e){if(!(n.state.selection instanceof ne))return!0;let{$head:t,$anchor:r,empty:i}=n.state.selection;if(!t.sameParent(r))return!0;if(!i)return!1;if(n.endOfTextblock(e>0?"forward":"backward"))return!0;let s=!t.textOffset&&(e<0?t.nodeBefore:t.nodeAfter);if(s&&!s.isText){let o=n.state.tr;return e<0?o.delete(t.pos-s.nodeSize,t.pos):o.delete(t.pos,t.pos+s.nodeSize),n.dispatch(o),!0}return!1}function Rg(n,e,t){n.domObserver.stop(),e.contentEditable=t,n.domObserver.start()}function tN(n){if(!ct||n.state.selection.$head.parentOffset>0)return!1;let{focusNode:e,focusOffset:t}=n.domSelectionRange();if(e&&e.nodeType==1&&t==0&&e.firstChild&&e.firstChild.contentEditable=="false"){let r=e.firstChild;Rg(n,r,"true"),setTimeout(()=>Rg(n,r,"false"),20)}return!1}function nN(n){let e="";return n.ctrlKey&&(e+="c"),n.metaKey&&(e+="m"),n.altKey&&(e+="a"),n.shiftKey&&(e+="s"),e}function rN(n,e){let t=e.keyCode,r=nN(e);if(t==8||Ft&&t==72&&r=="c")return Lg(n,-1)||Ri(n,-1);if(t==46&&!e.shiftKey||Ft&&t==68&&r=="c")return Lg(n,1)||Ri(n,1);if(t==13||t==27)return!0;if(t==37||Ft&&t==66&&r=="c"){let i=t==37?Ig(n,n.state.selection.from)=="ltr"?-1:1:-1;return Ag(n,i,r)||Ri(n,i)}else if(t==39||Ft&&t==70&&r=="c"){let i=t==39?Ig(n,n.state.selection.from)=="ltr"?1:-1:1;return Ag(n,i,r)||Ri(n,i)}else{if(t==38||Ft&&t==80&&r=="c")return Dg(n,-1,r)||Ri(n,-1);if(t==40||Ft&&t==78&&r=="c")return tN(n)||Dg(n,1,r)||Ri(n,1);if(r==(Ft?"m":"c")&&(t==66||t==73||t==89||t==90))return!0}return!1}function Fg(n,e){n.someProp("transformCopied",m=>{e=m(e,n)});let t=[],{content:r,openStart:i,openEnd:s}=e;for(;i>1&&s>1&&r.childCount==1&&r.firstChild.childCount==1;){i--,s--;let m=r.firstChild;t.push(m.type.name,m.attrs!=m.type.defaultAttrs?m.attrs:null),r=m.content}let o=n.someProp("clipboardSerializer")||Kr.fromSchema(n.state.schema),a=Ug(),l=a.createElement("div");l.appendChild(o.serializeFragment(r,{document:a}));let c=l.firstChild,u,d=0;for(;c&&c.nodeType==1&&(u=Hg[c.nodeName.toLowerCase()]);){for(let m=u.length-1;m>=0;m--){let p=a.createElement(u[m]);for(;l.firstChild;)p.appendChild(l.firstChild);l.appendChild(p),d++}c=l.firstChild}c&&c.nodeType==1&&c.setAttribute("data-pm-slice",`${i} ${s}${d?` -${d}`:""} ${JSON.stringify(t)}`);let h=n.someProp("clipboardTextSerializer",m=>m(e,n))||e.content.textBetween(0,e.content.size,`

`);return{dom:l,text:h,slice:e}}function Bg(n,e,t,r,i){let s=i.parent.type.spec.code,o,a;if(!t&&!e)return null;let l=e&&(r||s||!t);if(l){if(n.someProp("transformPastedText",h=>{e=h(e,s||r,n)}),s)return e?new V(I.from(n.state.schema.text(e.replace(/\r\n?/g,`
`))),0,0):V.empty;let d=n.someProp("clipboardTextParser",h=>h(e,i,r,n));if(d)a=d;else{let h=i.marks(),{schema:m}=n.state,p=Kr.fromSchema(m);o=document.createElement("div"),e.split(/(?:\r\n?|\n)+/).forEach(g=>{let y=o.appendChild(document.createElement("p"));g&&y.appendChild(p.serializeNode(m.text(g,h)))})}}else n.someProp("transformPastedHTML",d=>{t=d(t,n)}),o=aN(t),Xs&&lN(o);let c=o&&o.querySelector("[data-pm-slice]"),u=c&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(c.getAttribute("data-pm-slice")||"");if(u&&u[3])for(let d=+u[3];d>0;d--){let h=o.firstChild;for(;h&&h.nodeType!=1;)h=h.nextSibling;if(!h)break;o=h}if(a||(a=(n.someProp("clipboardParser")||n.someProp("domParser")||or.fromSchema(n.state.schema)).parseSlice(o,{preserveWhitespace:!!(l||u),context:i,ruleFromNode(h){return h.nodeName=="BR"&&!h.nextSibling&&h.parentNode&&!iN.test(h.parentNode.nodeName)?{ignore:!0}:null}})),u)a=cN(zg(a,+u[1],+u[2]),u[4]);else if(a=V.maxOpen(sN(a.content,i),!0),a.openStart||a.openEnd){let d=0,h=0;for(let m=a.content.firstChild;d<a.openStart&&!m.type.spec.isolating;d++,m=m.firstChild);for(let m=a.content.lastChild;h<a.openEnd&&!m.type.spec.isolating;h++,m=m.lastChild);a=zg(a,d,h)}return n.someProp("transformPasted",d=>{a=d(a,n)}),a}const iN=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function sN(n,e){if(n.childCount<2)return n;for(let t=e.depth;t>=0;t--){let i=e.node(t).contentMatchAt(e.index(t)),s,o=[];if(n.forEach(a=>{if(!o)return;let l=i.findWrapping(a.type),c;if(!l)return o=null;if(c=o.length&&s.length&&$g(l,s,a,o[o.length-1],0))o[o.length-1]=c;else{o.length&&(o[o.length-1]=jg(o[o.length-1],s.length));let u=Vg(a,l);o.push(u),i=i.matchType(u.type),s=l}}),o)return I.from(o)}return n}function Vg(n,e,t=0){for(let r=e.length-1;r>=t;r--)n=e[r].create(null,I.from(n));return n}function $g(n,e,t,r,i){if(i<n.length&&i<e.length&&n[i]==e[i]){let s=$g(n,e,t,r.lastChild,i+1);if(s)return r.copy(r.content.replaceChild(r.childCount-1,s));if(r.contentMatchAt(r.childCount).matchType(i==n.length-1?t.type:n[i+1]))return r.copy(r.content.append(I.from(Vg(t,n,i+1))))}}function jg(n,e){if(e==0)return n;let t=n.content.replaceChild(n.childCount-1,jg(n.lastChild,e-1)),r=n.contentMatchAt(n.childCount).fillBefore(I.empty,!0);return n.copy(t.append(r))}function Ou(n,e,t,r,i,s){let o=e<0?n.firstChild:n.lastChild,a=o.content;return n.childCount>1&&(s=0),i<r-1&&(a=Ou(a,e,t,r,i+1,s)),i>=t&&(a=e<0?o.contentMatchAt(0).fillBefore(a,s<=i).append(a):a.append(o.contentMatchAt(o.childCount).fillBefore(I.empty,!0))),n.replaceChild(e<0?0:n.childCount-1,o.copy(a))}function zg(n,e,t){return e<n.openStart&&(n=new V(Ou(n.content,-1,e,n.openStart,0,n.openEnd),e,n.openEnd)),t<n.openEnd&&(n=new V(Ou(n.content,1,t,n.openEnd,0,0),n.openStart,t)),n}const Hg={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let Gg=null;function Ug(){return Gg||(Gg=document.implementation.createHTMLDocument("title"))}let Nu=null;function oN(n){let e=window.trustedTypes;return e?(Nu||(Nu=e.createPolicy("ProseMirrorClipboard",{createHTML:t=>t})),Nu.createHTML(n)):n}function aN(n){let e=/^(\s*<meta [^>]*>)*/.exec(n);e&&(n=n.slice(e[0].length));let t=Ug().createElement("div"),r=/<([a-z][^>\s]+)/i.exec(n),i;if((i=r&&Hg[r[1].toLowerCase()])&&(n=i.map(s=>"<"+s+">").join("")+n+i.map(s=>"</"+s+">").reverse().join("")),t.innerHTML=oN(n),i)for(let s=0;s<i.length;s++)t=t.querySelector(i[s])||t;return t}function lN(n){let e=n.querySelectorAll(rt?"span:not([class]):not([style])":"span.Apple-converted-space");for(let t=0;t<e.length;t++){let r=e[t];r.childNodes.length==1&&r.textContent==" "&&r.parentNode&&r.parentNode.replaceChild(n.ownerDocument.createTextNode(" "),r)}}function cN(n,e){if(!n.size)return n;let t=n.content.firstChild.type.schema,r;try{r=JSON.parse(e)}catch{return n}let{content:i,openStart:s,openEnd:o}=n;for(let a=r.length-2;a>=0;a-=2){let l=t.nodes[r[a]];if(!l||l.hasRequiredAttrs())break;i=I.from(l.create(r[a+1],i)),s++,o++}return new V(i,s,o)}const ut={},ft={},uN={touchstart:!0,touchmove:!0};class fN{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:""},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastAndroidDelete=0,this.composing=!1,this.compositionNode=null,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function dN(n){for(let e in ut){let t=ut[e];n.dom.addEventListener(e,n.input.eventHandlers[e]=r=>{pN(n,r)&&!Au(n,r)&&(n.editable||!(r.type in ft))&&t(n,r)},uN[e]?{passive:!0}:void 0)}ct&&n.dom.addEventListener("input",()=>null),Mu(n)}function mr(n,e){n.input.lastSelectionOrigin=e,n.input.lastSelectionTime=Date.now()}function hN(n){n.domObserver.stop();for(let e in n.input.eventHandlers)n.dom.removeEventListener(e,n.input.eventHandlers[e]);clearTimeout(n.input.composingTimeout),clearTimeout(n.input.lastIOSEnterFallbackTimeout)}function Mu(n){n.someProp("handleDOMEvents",e=>{for(let t in e)n.input.eventHandlers[t]||n.dom.addEventListener(t,n.input.eventHandlers[t]=r=>Au(n,r))})}function Au(n,e){return n.someProp("handleDOMEvents",t=>{let r=t[e.type];return r?r(n,e)||e.defaultPrevented:!1})}function pN(n,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let t=e.target;t!=n.dom;t=t.parentNode)if(!t||t.nodeType==11||t.pmViewDesc&&t.pmViewDesc.stopEvent(e))return!1;return!0}function mN(n,e){!Au(n,e)&&ut[e.type]&&(n.editable||!(e.type in ft))&&ut[e.type](n,e)}ft.keydown=(n,e)=>{let t=e;if(n.input.shiftKey=t.keyCode==16||t.shiftKey,!Kg(n,t)&&(n.input.lastKeyCode=t.keyCode,n.input.lastKeyCodeTime=Date.now(),!(nn&&rt&&t.keyCode==13)))if(t.keyCode!=229&&n.domObserver.forceFlush(),Di&&t.keyCode==13&&!t.ctrlKey&&!t.altKey&&!t.metaKey){let r=Date.now();n.input.lastIOSEnter=r,n.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{n.input.lastIOSEnter==r&&(n.someProp("handleKeyDown",i=>i(n,qr(13,"Enter"))),n.input.lastIOSEnter=0)},200)}else n.someProp("handleKeyDown",r=>r(n,t))||rN(n,t)?t.preventDefault():mr(n,"key")},ft.keyup=(n,e)=>{e.keyCode==16&&(n.input.shiftKey=!1)},ft.keypress=(n,e)=>{let t=e;if(Kg(n,t)||!t.charCode||t.ctrlKey&&!t.altKey||Ft&&t.metaKey)return;if(n.someProp("handleKeyPress",i=>i(n,t))){t.preventDefault();return}let r=n.state.selection;if(!(r instanceof ne)||!r.$from.sameParent(r.$to)){let i=String.fromCharCode(t.charCode);!/[\r\n]/.test(i)&&!n.someProp("handleTextInput",s=>s(n,r.$from.pos,r.$to.pos,i))&&n.dispatch(n.state.tr.insertText(i).scrollIntoView()),t.preventDefault()}};function Pa(n){return{left:n.clientX,top:n.clientY}}function gN(n,e){let t=e.x-n.clientX,r=e.y-n.clientY;return t*t+r*r<100}function Pu(n,e,t,r,i){if(r==-1)return!1;let s=n.state.doc.resolve(r);for(let o=s.depth+1;o>0;o--)if(n.someProp(e,a=>o>s.depth?a(n,t,s.nodeAfter,s.before(o),i,!0):a(n,t,s.node(o),s.before(o),i,!1)))return!0;return!1}function Fi(n,e,t){if(n.focused||n.focus(),n.state.selection.eq(e))return;let r=n.state.tr.setSelection(e);r.setMeta("pointer",!0),n.dispatch(r)}function yN(n,e){if(e==-1)return!1;let t=n.state.doc.resolve(e),r=t.nodeAfter;return r&&r.isAtom&&q.isSelectable(r)?(Fi(n,new q(t)),!0):!1}function bN(n,e){if(e==-1)return!1;let t=n.state.selection,r,i;t instanceof q&&(r=t.node);let s=n.state.doc.resolve(e);for(let o=s.depth+1;o>0;o--){let a=o>s.depth?s.nodeAfter:s.node(o);if(q.isSelectable(a)){r&&t.$from.depth>0&&o>=t.$from.depth&&s.before(t.$from.depth+1)==t.$from.pos?i=s.before(t.$from.depth):i=s.before(o);break}}return i!=null?(Fi(n,q.create(n.state.doc,i)),!0):!1}function vN(n,e,t,r,i){return Pu(n,"handleClickOn",e,t,r)||n.someProp("handleClick",s=>s(n,e,r))||(i?bN(n,t):yN(n,t))}function wN(n,e,t,r){return Pu(n,"handleDoubleClickOn",e,t,r)||n.someProp("handleDoubleClick",i=>i(n,e,r))}function CN(n,e,t,r){return Pu(n,"handleTripleClickOn",e,t,r)||n.someProp("handleTripleClick",i=>i(n,e,r))||kN(n,t,r)}function kN(n,e,t){if(t.button!=0)return!1;let r=n.state.doc;if(e==-1)return r.inlineContent?(Fi(n,ne.create(r,0,r.content.size)),!0):!1;let i=r.resolve(e);for(let s=i.depth+1;s>0;s--){let o=s>i.depth?i.nodeAfter:i.node(s),a=i.before(s);if(o.inlineContent)Fi(n,ne.create(r,a+1,a+1+o.content.size));else if(q.isSelectable(o))Fi(n,q.create(r,a));else continue;return!0}}function Iu(n){return Ia(n)}const Wg=Ft?"metaKey":"ctrlKey";ut.mousedown=(n,e)=>{let t=e;n.input.shiftKey=t.shiftKey;let r=Iu(n),i=Date.now(),s="singleClick";i-n.input.lastClick.time<500&&gN(t,n.input.lastClick)&&!t[Wg]&&(n.input.lastClick.type=="singleClick"?s="doubleClick":n.input.lastClick.type=="doubleClick"&&(s="tripleClick")),n.input.lastClick={time:i,x:t.clientX,y:t.clientY,type:s};let o=n.posAtCoords(Pa(t));o&&(s=="singleClick"?(n.input.mouseDown&&n.input.mouseDown.done(),n.input.mouseDown=new SN(n,o,t,!!r)):(s=="doubleClick"?wN:CN)(n,o.pos,o.inside,t)?t.preventDefault():mr(n,"pointer"))};class SN{constructor(e,t,r,i){this.view=e,this.pos=t,this.event=r,this.flushed=i,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!r[Wg],this.allowDefault=r.shiftKey;let s,o;if(t.inside>-1)s=e.state.doc.nodeAt(t.inside),o=t.inside;else{let u=e.state.doc.resolve(t.pos);s=u.parent,o=u.depth?u.before():0}const a=i?null:r.target,l=a?e.docView.nearestDesc(a,!0):null;this.target=l&&l.dom.nodeType==1?l.dom:null;let{selection:c}=e.state;(r.button==0&&s.type.spec.draggable&&s.type.spec.selectable!==!1||c instanceof q&&c.from<=o&&c.to>o)&&(this.mightDrag={node:s,pos:o,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&tn&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),mr(e,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>Ln(this.view)),this.view.input.mouseDown=null}up(e){if(this.done(),!this.view.dom.contains(e.target))return;let t=this.pos;this.view.state.doc!=this.startDoc&&(t=this.view.posAtCoords(Pa(e))),this.updateAllowDefault(e),this.allowDefault||!t?mr(this.view,"pointer"):vN(this.view,t.pos,t.inside,e,this.selectNode)?e.preventDefault():e.button==0&&(this.flushed||ct&&this.mightDrag&&!this.mightDrag.node.isAtom||rt&&!this.view.state.selection.visible&&Math.min(Math.abs(t.pos-this.view.state.selection.from),Math.abs(t.pos-this.view.state.selection.to))<=2)?(Fi(this.view,re.near(this.view.state.doc.resolve(t.pos))),e.preventDefault()):mr(this.view,"pointer")}move(e){this.updateAllowDefault(e),mr(this.view,"pointer"),e.buttons==0&&this.done()}updateAllowDefault(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0)}}ut.touchstart=n=>{n.input.lastTouch=Date.now(),Iu(n),mr(n,"pointer")},ut.touchmove=n=>{n.input.lastTouch=Date.now(),mr(n,"pointer")},ut.contextmenu=n=>Iu(n);function Kg(n,e){return n.composing?!0:ct&&Math.abs(e.timeStamp-n.input.compositionEndedAt)<500?(n.input.compositionEndedAt=-2e8,!0):!1}const xN=nn?5e3:-1;ft.compositionstart=ft.compositionupdate=n=>{if(!n.composing){n.domObserver.flush();let{state:e}=n,t=e.selection.$to;if(e.selection instanceof ne&&(e.storedMarks||!t.textOffset&&t.parentOffset&&t.nodeBefore.marks.some(r=>r.type.spec.inclusive===!1)))n.markCursor=n.state.storedMarks||t.marks(),Ia(n,!0),n.markCursor=null;else if(Ia(n,!e.selection.empty),tn&&e.selection.empty&&t.parentOffset&&!t.textOffset&&t.nodeBefore.marks.length){let r=n.domSelectionRange();for(let i=r.focusNode,s=r.focusOffset;i&&i.nodeType==1&&s!=0;){let o=s<0?i.lastChild:i.childNodes[s-1];if(!o)break;if(o.nodeType==3){let a=n.domSelection();a&&a.collapse(o,o.nodeValue.length);break}else i=o,s=-1}}n.input.composing=!0}Yg(n,xN)},ft.compositionend=(n,e)=>{n.composing&&(n.input.composing=!1,n.input.compositionEndedAt=e.timeStamp,n.input.compositionPendingChanges=n.domObserver.pendingRecords().length?n.input.compositionID:0,n.input.compositionNode=null,n.input.compositionPendingChanges&&Promise.resolve().then(()=>n.domObserver.flush()),n.input.compositionID++,Yg(n,20))};function Yg(n,e){clearTimeout(n.input.composingTimeout),e>-1&&(n.input.composingTimeout=setTimeout(()=>Ia(n),e))}function qg(n){for(n.composing&&(n.input.composing=!1,n.input.compositionEndedAt=EN());n.input.compositionNodes.length>0;)n.input.compositionNodes.pop().markParentsDirty()}function _N(n){let e=n.domSelectionRange();if(!e.focusNode)return null;let t=yO(e.focusNode,e.focusOffset),r=bO(e.focusNode,e.focusOffset);if(t&&r&&t!=r){let i=r.pmViewDesc,s=n.domObserver.lastChangedTextNode;if(t==s||r==s)return s;if(!i||!i.isText(r.nodeValue))return r;if(n.input.compositionNode==r){let o=t.pmViewDesc;if(!(!o||!o.isText(t.nodeValue)))return r}}return t||r}function EN(){let n=document.createEvent("Event");return n.initEvent("event",!0,!0),n.timeStamp}function Ia(n,e=!1){if(!(nn&&n.domObserver.flushingSoon>=0)){if(n.domObserver.forceFlush(),qg(n),e||n.docView&&n.docView.dirty){let t=Su(n);return t&&!t.eq(n.state.selection)?n.dispatch(n.state.tr.setSelection(t)):(n.markCursor||e)&&!n.state.selection.empty?n.dispatch(n.state.tr.deleteSelection()):n.updateState(n.state),!0}return!1}}function TN(n,e){if(!n.dom.parentNode)return;let t=n.dom.parentNode.appendChild(document.createElement("div"));t.appendChild(e),t.style.cssText="position: fixed; left: -10000px; top: 10px";let r=getSelection(),i=document.createRange();i.selectNodeContents(e),n.dom.blur(),r.removeAllRanges(),r.addRange(i),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t),n.focus()},50)}const to=wt&&fr<15||Di&&SO<604;ut.copy=ft.cut=(n,e)=>{let t=e,r=n.state.selection,i=t.type=="cut";if(r.empty)return;let s=to?null:t.clipboardData,o=r.content(),{dom:a,text:l}=Fg(n,o);s?(t.preventDefault(),s.clearData(),s.setData("text/html",a.innerHTML),s.setData("text/plain",l)):TN(n,a),i&&n.dispatch(n.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))};function ON(n){return n.openStart==0&&n.openEnd==0&&n.content.childCount==1?n.content.firstChild:null}function NN(n,e){if(!n.dom.parentNode)return;let t=n.input.shiftKey||n.state.selection.$from.parent.type.spec.code,r=n.dom.parentNode.appendChild(document.createElement(t?"textarea":"div"));t||(r.contentEditable="true"),r.style.cssText="position: fixed; left: -10000px; top: 10px",r.focus();let i=n.input.shiftKey&&n.input.lastKeyCode!=45;setTimeout(()=>{n.focus(),r.parentNode&&r.parentNode.removeChild(r),t?no(n,r.value,null,i,e):no(n,r.textContent,r.innerHTML,i,e)},50)}function no(n,e,t,r,i){let s=Bg(n,e,t,r,n.state.selection.$from);if(n.someProp("handlePaste",l=>l(n,i,s||V.empty)))return!0;if(!s)return!1;let o=ON(s),a=o?n.state.tr.replaceSelectionWith(o,r):n.state.tr.replaceSelection(s);return n.dispatch(a.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function Xg(n){let e=n.getData("text/plain")||n.getData("Text");if(e)return e;let t=n.getData("text/uri-list");return t?t.replace(/\r?\n/g," "):""}ft.paste=(n,e)=>{let t=e;if(n.composing&&!nn)return;let r=to?null:t.clipboardData,i=n.input.shiftKey&&n.input.lastKeyCode!=45;r&&no(n,Xg(r),r.getData("text/html"),i,t)?t.preventDefault():NN(n,t)};class Jg{constructor(e,t,r){this.slice=e,this.move=t,this.node=r}}const Qg=Ft?"altKey":"ctrlKey";ut.dragstart=(n,e)=>{let t=e,r=n.input.mouseDown;if(r&&r.done(),!t.dataTransfer)return;let i=n.state.selection,s=i.empty?null:n.posAtCoords(Pa(t)),o;if(!(s&&s.pos>=i.from&&s.pos<=(i instanceof q?i.to-1:i.to))){if(r&&r.mightDrag)o=q.create(n.state.doc,r.mightDrag.pos);else if(t.target&&t.target.nodeType==1){let d=n.docView.nearestDesc(t.target,!0);d&&d.node.type.spec.draggable&&d!=n.docView&&(o=q.create(n.state.doc,d.posBefore))}}let a=(o||n.state.selection).content(),{dom:l,text:c,slice:u}=Fg(n,a);(!t.dataTransfer.files.length||!rt||rg>120)&&t.dataTransfer.clearData(),t.dataTransfer.setData(to?"Text":"text/html",l.innerHTML),t.dataTransfer.effectAllowed="copyMove",to||t.dataTransfer.setData("text/plain",c),n.dragging=new Jg(u,!t[Qg],o)},ut.dragend=n=>{let e=n.dragging;window.setTimeout(()=>{n.dragging==e&&(n.dragging=null)},50)},ft.dragover=ft.dragenter=(n,e)=>e.preventDefault(),ft.drop=(n,e)=>{let t=e,r=n.dragging;if(n.dragging=null,!t.dataTransfer)return;let i=n.posAtCoords(Pa(t));if(!i)return;let s=n.state.doc.resolve(i.pos),o=r&&r.slice;o?n.someProp("transformPasted",p=>{o=p(o,n)}):o=Bg(n,Xg(t.dataTransfer),to?null:t.dataTransfer.getData("text/html"),!1,s);let a=!!(r&&!t[Qg]);if(n.someProp("handleDrop",p=>p(n,t,o||V.empty,a))){t.preventDefault();return}if(!o)return;t.preventDefault();let l=o?jm(n.state.doc,s.pos,o):s.pos;l==null&&(l=s.pos);let c=n.state.tr;if(a){let{node:p}=r;p?p.replace(c):c.deleteSelection()}let u=c.mapping.map(l),d=o.openStart==0&&o.openEnd==0&&o.content.childCount==1,h=c.doc;if(d?c.replaceRangeWith(u,u,o.content.firstChild):c.replaceRange(u,u,o),c.doc.eq(h))return;let m=c.doc.resolve(u);if(d&&q.isSelectable(o.content.firstChild)&&m.nodeAfter&&m.nodeAfter.sameMarkup(o.content.firstChild))c.setSelection(new q(m));else{let p=c.mapping.map(l);c.mapping.maps[c.mapping.maps.length-1].forEach((g,y,v,C)=>p=C),c.setSelection(_u(n,m,c.doc.resolve(p)))}n.focus(),n.dispatch(c.setMeta("uiEvent","drop"))},ut.focus=n=>{n.input.lastFocus=Date.now(),n.focused||(n.domObserver.stop(),n.dom.classList.add("ProseMirror-focused"),n.domObserver.start(),n.focused=!0,setTimeout(()=>{n.docView&&n.hasFocus()&&!n.domObserver.currentSelection.eq(n.domSelectionRange())&&Ln(n)},20))},ut.blur=(n,e)=>{let t=e;n.focused&&(n.domObserver.stop(),n.dom.classList.remove("ProseMirror-focused"),n.domObserver.start(),t.relatedTarget&&n.dom.contains(t.relatedTarget)&&n.domObserver.currentSelection.clear(),n.focused=!1)},ut.beforeinput=(n,e)=>{if(rt&&nn&&e.inputType=="deleteContentBackward"){n.domObserver.flushSoon();let{domChangeCount:r}=n.input;setTimeout(()=>{if(n.input.domChangeCount!=r||(n.dom.blur(),n.focus(),n.someProp("handleKeyDown",s=>s(n,qr(8,"Backspace")))))return;let{$cursor:i}=n.state.selection;i&&i.pos>0&&n.dispatch(n.state.tr.delete(i.pos-1,i.pos).scrollIntoView())},50)}};for(let n in ft)ut[n]=ft[n];function ro(n,e){if(n==e)return!0;for(let t in n)if(n[t]!==e[t])return!1;for(let t in e)if(!(t in n))return!1;return!0}class Da{constructor(e,t){this.toDOM=e,this.spec=t||Zr,this.side=this.spec.side||0}map(e,t,r,i){let{pos:s,deleted:o}=e.mapResult(t.from+i,this.side<0?-1:1);return o?null:new Vt(s-r,s-r,this)}valid(){return!0}eq(e){return this==e||e instanceof Da&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&ro(this.spec,e.spec))}destroy(e){this.spec.destroy&&this.spec.destroy(e)}}class gr{constructor(e,t){this.attrs=e,this.spec=t||Zr}map(e,t,r,i){let s=e.map(t.from+i,this.spec.inclusiveStart?-1:1)-r,o=e.map(t.to+i,this.spec.inclusiveEnd?1:-1)-r;return s>=o?null:new Vt(s,o,this)}valid(e,t){return t.from<t.to}eq(e){return this==e||e instanceof gr&&ro(this.attrs,e.attrs)&&ro(this.spec,e.spec)}static is(e){return e.type instanceof gr}destroy(){}}class Du{constructor(e,t){this.attrs=e,this.spec=t||Zr}map(e,t,r,i){let s=e.mapResult(t.from+i,1);if(s.deleted)return null;let o=e.mapResult(t.to+i,-1);return o.deleted||o.pos<=s.pos?null:new Vt(s.pos-r,o.pos-r,this)}valid(e,t){let{index:r,offset:i}=e.content.findIndex(t.from),s;return i==t.from&&!(s=e.child(r)).isText&&i+s.nodeSize==t.to}eq(e){return this==e||e instanceof Du&&ro(this.attrs,e.attrs)&&ro(this.spec,e.spec)}destroy(){}}class Vt{constructor(e,t,r){this.from=e,this.to=t,this.type=r}copy(e,t){return new Vt(e,t,this.type)}eq(e,t=0){return this.type.eq(e.type)&&this.from+t==e.from&&this.to+t==e.to}map(e,t,r){return this.type.map(e,this,t,r)}static widget(e,t,r){return new Vt(e,e,new Da(t,r))}static inline(e,t,r,i){return new Vt(e,t,new gr(r,i))}static node(e,t,r,i){return new Vt(e,t,new Du(r,i))}get spec(){return this.type.spec}get inline(){return this.type instanceof gr}get widget(){return this.type instanceof Da}}const Bi=[],Zr={};class ze{constructor(e,t){this.local=e.length?e:Bi,this.children=t.length?t:Bi}static create(e,t){return t.length?La(t,e,0,Zr):it}find(e,t,r){let i=[];return this.findInner(e??0,t??1e9,i,0,r),i}findInner(e,t,r,i,s){for(let o=0;o<this.local.length;o++){let a=this.local[o];a.from<=t&&a.to>=e&&(!s||s(a.spec))&&r.push(a.copy(a.from+i,a.to+i))}for(let o=0;o<this.children.length;o+=3)if(this.children[o]<t&&this.children[o+1]>e){let a=this.children[o]+1;this.children[o+2].findInner(e-a,t-a,r,i+a,s)}}map(e,t,r){return this==it||e.maps.length==0?this:this.mapInner(e,t,0,0,r||Zr)}mapInner(e,t,r,i,s){let o;for(let a=0;a<this.local.length;a++){let l=this.local[a].map(e,r,i);l&&l.type.valid(t,l)?(o||(o=[])).push(l):s.onRemove&&s.onRemove(this.local[a].spec)}return this.children.length?MN(this.children,o||[],e,t,r,i,s):o?new ze(o.sort(ei),Bi):it}add(e,t){return t.length?this==it?ze.create(e,t):this.addInner(e,t,0):this}addInner(e,t,r){let i,s=0;e.forEach((a,l)=>{let c=l+r,u;if(u=ey(t,a,c)){for(i||(i=this.children.slice());s<i.length&&i[s]<l;)s+=3;i[s]==l?i[s+2]=i[s+2].addInner(a,u,c+1):i.splice(s,0,l,l+a.nodeSize,La(u,a,c+1,Zr)),s+=3}});let o=Zg(s?ty(t):t,-r);for(let a=0;a<o.length;a++)o[a].type.valid(e,o[a])||o.splice(a--,1);return new ze(o.length?this.local.concat(o).sort(ei):this.local,i||this.children)}remove(e){return e.length==0||this==it?this:this.removeInner(e,0)}removeInner(e,t){let r=this.children,i=this.local;for(let s=0;s<r.length;s+=3){let o,a=r[s]+t,l=r[s+1]+t;for(let u=0,d;u<e.length;u++)(d=e[u])&&d.from>a&&d.to<l&&(e[u]=null,(o||(o=[])).push(d));if(!o)continue;r==this.children&&(r=this.children.slice());let c=r[s+2].removeInner(o,a+1);c!=it?r[s+2]=c:(r.splice(s,3),s-=3)}if(i.length){for(let s=0,o;s<e.length;s++)if(o=e[s])for(let a=0;a<i.length;a++)i[a].eq(o,t)&&(i==this.local&&(i=this.local.slice()),i.splice(a--,1))}return r==this.children&&i==this.local?this:i.length||r.length?new ze(i,r):it}forChild(e,t){if(this==it)return this;if(t.isLeaf)return ze.empty;let r,i;for(let a=0;a<this.children.length;a+=3)if(this.children[a]>=e){this.children[a]==e&&(r=this.children[a+2]);break}let s=e+1,o=s+t.content.size;for(let a=0;a<this.local.length;a++){let l=this.local[a];if(l.from<o&&l.to>s&&l.type instanceof gr){let c=Math.max(s,l.from)-s,u=Math.min(o,l.to)-s;c<u&&(i||(i=[])).push(l.copy(c,u))}}if(i){let a=new ze(i.sort(ei),Bi);return r?new yr([a,r]):a}return r||it}eq(e){if(this==e)return!0;if(!(e instanceof ze)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(let t=0;t<this.local.length;t++)if(!this.local[t].eq(e.local[t]))return!1;for(let t=0;t<this.children.length;t+=3)if(this.children[t]!=e.children[t]||this.children[t+1]!=e.children[t+1]||!this.children[t+2].eq(e.children[t+2]))return!1;return!0}locals(e){return Lu(this.localsInner(e))}localsInner(e){if(this==it)return Bi;if(e.inlineContent||!this.local.some(gr.is))return this.local;let t=[];for(let r=0;r<this.local.length;r++)this.local[r].type instanceof gr||t.push(this.local[r]);return t}forEachSet(e){e(this)}}ze.empty=new ze([],[]),ze.removeOverlap=Lu;const it=ze.empty;class yr{constructor(e){this.members=e}map(e,t){const r=this.members.map(i=>i.map(e,t,Zr));return yr.from(r)}forChild(e,t){if(t.isLeaf)return ze.empty;let r=[];for(let i=0;i<this.members.length;i++){let s=this.members[i].forChild(e,t);s!=it&&(s instanceof yr?r=r.concat(s.members):r.push(s))}return yr.from(r)}eq(e){if(!(e instanceof yr)||e.members.length!=this.members.length)return!1;for(let t=0;t<this.members.length;t++)if(!this.members[t].eq(e.members[t]))return!1;return!0}locals(e){let t,r=!0;for(let i=0;i<this.members.length;i++){let s=this.members[i].localsInner(e);if(s.length)if(!t)t=s;else{r&&(t=t.slice(),r=!1);for(let o=0;o<s.length;o++)t.push(s[o])}}return t?Lu(r?t:t.sort(ei)):Bi}static from(e){switch(e.length){case 0:return it;case 1:return e[0];default:return new yr(e.every(t=>t instanceof ze)?e:e.reduce((t,r)=>t.concat(r instanceof ze?r:r.members),[]))}}forEachSet(e){for(let t=0;t<this.members.length;t++)this.members[t].forEachSet(e)}}function MN(n,e,t,r,i,s,o){let a=n.slice();for(let c=0,u=s;c<t.maps.length;c++){let d=0;t.maps[c].forEach((h,m,p,g)=>{let y=g-p-(m-h);for(let v=0;v<a.length;v+=3){let C=a[v+1];if(C<0||h>C+u-d)continue;let w=a[v]+u-d;m>=w?a[v+1]=h<=w?-2:-1:h>=u&&y&&(a[v]+=y,a[v+1]+=y)}d+=y}),u=t.maps[c].map(u,-1)}let l=!1;for(let c=0;c<a.length;c+=3)if(a[c+1]<0){if(a[c+1]==-2){l=!0,a[c+1]=-1;continue}let u=t.map(n[c]+s),d=u-i;if(d<0||d>=r.content.size){l=!0;continue}let h=t.map(n[c+1]+s,-1),m=h-i,{index:p,offset:g}=r.content.findIndex(d),y=r.maybeChild(p);if(y&&g==d&&g+y.nodeSize==m){let v=a[c+2].mapInner(t,y,u+1,n[c]+s+1,o);v!=it?(a[c]=d,a[c+1]=m,a[c+2]=v):(a[c+1]=-2,l=!0)}else l=!0}if(l){let c=AN(a,n,e,t,i,s,o),u=La(c,r,0,o);e=u.local;for(let d=0;d<a.length;d+=3)a[d+1]<0&&(a.splice(d,3),d-=3);for(let d=0,h=0;d<u.children.length;d+=3){let m=u.children[d];for(;h<a.length&&a[h]<m;)h+=3;a.splice(h,0,u.children[d],u.children[d+1],u.children[d+2])}}return new ze(e.sort(ei),a)}function Zg(n,e){if(!e||!n.length)return n;let t=[];for(let r=0;r<n.length;r++){let i=n[r];t.push(new Vt(i.from+e,i.to+e,i.type))}return t}function AN(n,e,t,r,i,s,o){function a(l,c){for(let u=0;u<l.local.length;u++){let d=l.local[u].map(r,i,c);d?t.push(d):o.onRemove&&o.onRemove(l.local[u].spec)}for(let u=0;u<l.children.length;u+=3)a(l.children[u+2],l.children[u]+c+1)}for(let l=0;l<n.length;l+=3)n[l+1]==-1&&a(n[l+2],e[l]+s+1);return t}function ey(n,e,t){if(e.isLeaf)return null;let r=t+e.nodeSize,i=null;for(let s=0,o;s<n.length;s++)(o=n[s])&&o.from>t&&o.to<r&&((i||(i=[])).push(o),n[s]=null);return i}function ty(n){let e=[];for(let t=0;t<n.length;t++)n[t]!=null&&e.push(n[t]);return e}function La(n,e,t,r){let i=[],s=!1;e.forEach((a,l)=>{let c=ey(n,a,l+t);if(c){s=!0;let u=La(c,a,t+l+1,r);u!=it&&i.push(l,l+a.nodeSize,u)}});let o=Zg(s?ty(n):n,-t).sort(ei);for(let a=0;a<o.length;a++)o[a].type.valid(e,o[a])||(r.onRemove&&r.onRemove(o[a].spec),o.splice(a--,1));return o.length||i.length?new ze(o,i):it}function ei(n,e){return n.from-e.from||n.to-e.to}function Lu(n){let e=n;for(let t=0;t<e.length-1;t++){let r=e[t];if(r.from!=r.to)for(let i=t+1;i<e.length;i++){let s=e[i];if(s.from==r.from){s.to!=r.to&&(e==n&&(e=n.slice()),e[i]=s.copy(s.from,r.to),ny(e,i+1,s.copy(r.to,s.to)));continue}else{s.from<r.to&&(e==n&&(e=n.slice()),e[t]=r.copy(r.from,s.from),ny(e,i,r.copy(s.from,r.to)));break}}}return e}function ny(n,e,t){for(;e<n.length&&ei(t,n[e])>0;)e++;n.splice(e,0,t)}function Ru(n){let e=[];return n.someProp("decorations",t=>{let r=t(n.state);r&&r!=it&&e.push(r)}),n.cursorWrapper&&e.push(ze.create(n.state.doc,[n.cursorWrapper.deco])),yr.from(e)}const PN={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},IN=wt&&fr<=11;class DN{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(e){this.anchorNode=e.anchorNode,this.anchorOffset=e.anchorOffset,this.focusNode=e.focusNode,this.focusOffset=e.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(e){return e.anchorNode==this.anchorNode&&e.anchorOffset==this.anchorOffset&&e.focusNode==this.focusNode&&e.focusOffset==this.focusOffset}}class LN{constructor(e,t){this.view=e,this.handleDOMChange=t,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new DN,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.lastChangedTextNode=null,this.observer=window.MutationObserver&&new window.MutationObserver(r=>{for(let i=0;i<r.length;i++)this.queue.push(r[i]);wt&&fr<=11&&r.some(i=>i.type=="childList"&&i.removedNodes.length||i.type=="characterData"&&i.oldValue.length>i.target.nodeValue.length)?this.flushSoon():this.flush()}),IN&&(this.onCharData=r=>{this.queue.push({target:r.target,type:"characterData",oldValue:r.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(()=>{this.flushingSoon=-1,this.flush()},20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,PN)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let e=this.observer.takeRecords();if(e.length){for(let t=0;t<e.length;t++)this.queue.push(e[t]);window.setTimeout(()=>this.flush(),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout(()=>this.suppressingSelectionUpdates=!1,50)}onSelectionChange(){if(Ng(this.view)){if(this.suppressingSelectionUpdates)return Ln(this.view);if(wt&&fr<=11&&!this.view.state.selection.empty){let e=this.view.domSelectionRange();if(e.focusNode&&Yr(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(e){if(!e.focusNode)return!0;let t=new Set,r;for(let s=e.focusNode;s;s=Ys(s))t.add(s);for(let s=e.anchorNode;s;s=Ys(s))if(t.has(s)){r=s;break}let i=r&&this.view.docView.nearestDesc(r);if(i&&i.ignoreMutation({type:"selection",target:r.nodeType==3?r.parentNode:r}))return this.setCurSelection(),!0}pendingRecords(){if(this.observer)for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}flush(){let{view:e}=this;if(!e.docView||this.flushingSoon>-1)return;let t=this.pendingRecords();t.length&&(this.queue=[]);let r=e.domSelectionRange(),i=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(r)&&Ng(e)&&!this.ignoreSelectionChange(r),s=-1,o=-1,a=!1,l=[];if(e.editable)for(let u=0;u<t.length;u++){let d=this.registerMutation(t[u],l);d&&(s=s<0?d.from:Math.min(d.from,s),o=o<0?d.to:Math.max(d.to,o),d.typeOver&&(a=!0))}if(tn&&l.length){let u=l.filter(d=>d.nodeName=="BR");if(u.length==2){let[d,h]=u;d.parentNode&&d.parentNode.parentNode==h.parentNode?h.remove():d.remove()}else{let{focusNode:d}=this.currentSelection;for(let h of u){let m=h.parentNode;m&&m.nodeName=="LI"&&(!d||BN(e,d)!=m)&&h.remove()}}}let c=null;s<0&&i&&e.input.lastFocus>Date.now()-200&&Math.max(e.input.lastTouch,e.input.lastClick.time)<Date.now()-300&&Oa(r)&&(c=Su(e))&&c.eq(re.near(e.state.doc.resolve(0),1))?(e.input.lastFocus=0,Ln(e),this.currentSelection.set(r),e.scrollToSelection()):(s>-1||i)&&(s>-1&&(e.docView.markDirty(s,o),RN(e)),this.handleDOMChange(s,o,a,l),e.docView&&e.docView.dirty?e.updateState(e.state):this.currentSelection.eq(r)||Ln(e),this.currentSelection.set(r))}registerMutation(e,t){if(t.indexOf(e.target)>-1)return null;let r=this.view.docView.nearestDesc(e.target);if(e.type=="attributes"&&(r==this.view.docView||e.attributeName=="contenteditable"||e.attributeName=="style"&&!e.oldValue&&!e.target.getAttribute("style"))||!r||r.ignoreMutation(e))return null;if(e.type=="childList"){for(let u=0;u<e.addedNodes.length;u++){let d=e.addedNodes[u];t.push(d),d.nodeType==3&&(this.lastChangedTextNode=d)}if(r.contentDOM&&r.contentDOM!=r.dom&&!r.contentDOM.contains(e.target))return{from:r.posBefore,to:r.posAfter};let i=e.previousSibling,s=e.nextSibling;if(wt&&fr<=11&&e.addedNodes.length)for(let u=0;u<e.addedNodes.length;u++){let{previousSibling:d,nextSibling:h}=e.addedNodes[u];(!d||Array.prototype.indexOf.call(e.addedNodes,d)<0)&&(i=d),(!h||Array.prototype.indexOf.call(e.addedNodes,h)<0)&&(s=h)}let o=i&&i.parentNode==e.target?Qe(i)+1:0,a=r.localPosFromDOM(e.target,o,-1),l=s&&s.parentNode==e.target?Qe(s):e.target.childNodes.length,c=r.localPosFromDOM(e.target,l,1);return{from:a,to:c}}else return e.type=="attributes"?{from:r.posAtStart-r.border,to:r.posAtEnd+r.border}:(this.lastChangedTextNode=e.target,{from:r.posAtStart,to:r.posAtEnd,typeOver:e.target.nodeValue==e.oldValue})}}let ry=new WeakMap,iy=!1;function RN(n){if(!ry.has(n)&&(ry.set(n,null),["normal","nowrap","pre-line"].indexOf(getComputedStyle(n.dom).whiteSpace)!==-1)){if(n.requiresGeckoHackNode=tn,iy)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),iy=!0}}function sy(n,e){let t=e.startContainer,r=e.startOffset,i=e.endContainer,s=e.endOffset,o=n.domAtPos(n.state.selection.anchor);return Yr(o.node,o.offset,i,s)&&([t,r,i,s]=[i,s,t,r]),{anchorNode:t,anchorOffset:r,focusNode:i,focusOffset:s}}function FN(n,e){if(e.getComposedRanges){let i=e.getComposedRanges(n.root)[0];if(i)return sy(n,i)}let t;function r(i){i.preventDefault(),i.stopImmediatePropagation(),t=i.getTargetRanges()[0]}return n.dom.addEventListener("beforeinput",r,!0),document.execCommand("indent"),n.dom.removeEventListener("beforeinput",r,!0),t?sy(n,t):null}function BN(n,e){for(let t=e.parentNode;t&&t!=n.dom;t=t.parentNode){let r=n.docView.nearestDesc(t,!0);if(r&&r.node.isBlock)return t}return null}function VN(n,e,t){let{node:r,fromOffset:i,toOffset:s,from:o,to:a}=n.docView.parseRange(e,t),l=n.domSelectionRange(),c,u=l.anchorNode;if(u&&n.dom.contains(u.nodeType==1?u:u.parentNode)&&(c=[{node:u,offset:l.anchorOffset}],Oa(l)||c.push({node:l.focusNode,offset:l.focusOffset})),rt&&n.input.lastKeyCode===8)for(let y=s;y>i;y--){let v=r.childNodes[y-1],C=v.pmViewDesc;if(v.nodeName=="BR"&&!C){s=y;break}if(!C||C.size)break}let d=n.state.doc,h=n.someProp("domParser")||or.fromSchema(n.state.schema),m=d.resolve(o),p=null,g=h.parse(r,{topNode:m.parent,topMatch:m.parent.contentMatchAt(m.index()),topOpen:!0,from:i,to:s,preserveWhitespace:m.parent.type.whitespace=="pre"?"full":!0,findPositions:c,ruleFromNode:$N,context:m});if(c&&c[0].pos!=null){let y=c[0].pos,v=c[1]&&c[1].pos;v==null&&(v=y),p={anchor:y+o,head:v+o}}return{doc:g,sel:p,from:o,to:a}}function $N(n){let e=n.pmViewDesc;if(e)return e.parseRule();if(n.nodeName=="BR"&&n.parentNode){if(ct&&/^(ul|ol)$/i.test(n.parentNode.nodeName)){let t=document.createElement("div");return t.appendChild(document.createElement("li")),{skip:t}}else if(n.parentNode.lastChild==n||ct&&/^(tr|table)$/i.test(n.parentNode.nodeName))return{ignore:!0}}else if(n.nodeName=="IMG"&&n.getAttribute("mark-placeholder"))return{ignore:!0};return null}const jN=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function zN(n,e,t,r,i){let s=n.input.compositionPendingChanges||(n.composing?n.input.compositionID:0);if(n.input.compositionPendingChanges=0,e<0){let T=n.input.lastSelectionTime>Date.now()-50?n.input.lastSelectionOrigin:null,B=Su(n,T);if(B&&!n.state.selection.eq(B)){if(rt&&nn&&n.input.lastKeyCode===13&&Date.now()-100<n.input.lastKeyCodeTime&&n.someProp("handleKeyDown",$=>$(n,qr(13,"Enter"))))return;let U=n.state.tr.setSelection(B);T=="pointer"?U.setMeta("pointer",!0):T=="key"&&U.scrollIntoView(),s&&U.setMeta("composition",s),n.dispatch(U)}return}let o=n.state.doc.resolve(e),a=o.sharedDepth(t);e=o.before(a+1),t=n.state.doc.resolve(t).after(a+1);let l=n.state.selection,c=VN(n,e,t),u=n.state.doc,d=u.slice(c.from,c.to),h,m;n.input.lastKeyCode===8&&Date.now()-100<n.input.lastKeyCodeTime?(h=n.state.selection.to,m="end"):(h=n.state.selection.from,m="start"),n.input.lastKeyCode=null;let p=UN(d.content,c.doc.content,c.from,h,m);if(p&&n.input.domChangeCount++,(Di&&n.input.lastIOSEnter>Date.now()-225||nn)&&i.some(T=>T.nodeType==1&&!jN.test(T.nodeName))&&(!p||p.endA>=p.endB)&&n.someProp("handleKeyDown",T=>T(n,qr(13,"Enter")))){n.input.lastIOSEnter=0;return}if(!p)if(r&&l instanceof ne&&!l.empty&&l.$head.sameParent(l.$anchor)&&!n.composing&&!(c.sel&&c.sel.anchor!=c.sel.head))p={start:l.from,endA:l.to,endB:l.to};else{if(c.sel){let T=oy(n,n.state.doc,c.sel);if(T&&!T.eq(n.state.selection)){let B=n.state.tr.setSelection(T);s&&B.setMeta("composition",s),n.dispatch(B)}}return}n.state.selection.from<n.state.selection.to&&p.start==p.endB&&n.state.selection instanceof ne&&(p.start>n.state.selection.from&&p.start<=n.state.selection.from+2&&n.state.selection.from>=c.from?p.start=n.state.selection.from:p.endA<n.state.selection.to&&p.endA>=n.state.selection.to-2&&n.state.selection.to<=c.to&&(p.endB+=n.state.selection.to-p.endA,p.endA=n.state.selection.to)),wt&&fr<=11&&p.endB==p.start+1&&p.endA==p.start&&p.start>c.from&&c.doc.textBetween(p.start-c.from-1,p.start-c.from+1)=="  "&&(p.start--,p.endA--,p.endB--);let g=c.doc.resolveNoCache(p.start-c.from),y=c.doc.resolveNoCache(p.endB-c.from),v=u.resolve(p.start),C=g.sameParent(y)&&g.parent.inlineContent&&v.end()>=p.endA,w;if((Di&&n.input.lastIOSEnter>Date.now()-225&&(!C||i.some(T=>T.nodeName=="DIV"||T.nodeName=="P"))||!C&&g.pos<c.doc.content.size&&!g.sameParent(y)&&(w=re.findFrom(c.doc.resolve(g.pos+1),1,!0))&&w.head==y.pos)&&n.someProp("handleKeyDown",T=>T(n,qr(13,"Enter")))){n.input.lastIOSEnter=0;return}if(n.state.selection.anchor>p.start&&GN(u,p.start,p.endA,g,y)&&n.someProp("handleKeyDown",T=>T(n,qr(8,"Backspace")))){nn&&rt&&n.domObserver.suppressSelectionUpdates();return}rt&&nn&&p.endB==p.start&&(n.input.lastAndroidDelete=Date.now()),nn&&!C&&g.start()!=y.start()&&y.parentOffset==0&&g.depth==y.depth&&c.sel&&c.sel.anchor==c.sel.head&&c.sel.head==p.endA&&(p.endB-=2,y=c.doc.resolveNoCache(p.endB-c.from),setTimeout(()=>{n.someProp("handleKeyDown",function(T){return T(n,qr(13,"Enter"))})},20));let b=p.start,E=p.endA,k,x,O;if(C){if(g.pos==y.pos)wt&&fr<=11&&g.parentOffset==0&&(n.domObserver.suppressSelectionUpdates(),setTimeout(()=>Ln(n),20)),k=n.state.tr.delete(b,E),x=u.resolve(p.start).marksAcross(u.resolve(p.endA));else if(p.endA==p.endB&&(O=HN(g.parent.content.cut(g.parentOffset,y.parentOffset),v.parent.content.cut(v.parentOffset,p.endA-v.start()))))k=n.state.tr,O.type=="add"?k.addMark(b,E,O.mark):k.removeMark(b,E,O.mark);else if(g.parent.child(g.index()).isText&&g.index()==y.index()-(y.textOffset?0:1)){let T=g.parent.textBetween(g.parentOffset,y.parentOffset);if(n.someProp("handleTextInput",B=>B(n,b,E,T)))return;k=n.state.tr.insertText(T,b,E)}}if(k||(k=n.state.tr.replace(b,E,c.doc.slice(p.start-c.from,p.endB-c.from))),c.sel){let T=oy(n,k.doc,c.sel);T&&!(rt&&nn&&n.composing&&T.empty&&(p.start!=p.endB||n.input.lastAndroidDelete<Date.now()-100)&&(T.head==b||T.head==k.mapping.map(E)-1)||wt&&T.empty&&T.head==b)&&k.setSelection(T)}x&&k.ensureMarks(x),s&&k.setMeta("composition",s),n.dispatch(k.scrollIntoView())}function oy(n,e,t){return Math.max(t.anchor,t.head)>e.content.size?null:_u(n,e.resolve(t.anchor),e.resolve(t.head))}function HN(n,e){let t=n.firstChild.marks,r=e.firstChild.marks,i=t,s=r,o,a,l;for(let u=0;u<r.length;u++)i=r[u].removeFromSet(i);for(let u=0;u<t.length;u++)s=t[u].removeFromSet(s);if(i.length==1&&s.length==0)a=i[0],o="add",l=u=>u.mark(a.addToSet(u.marks));else if(i.length==0&&s.length==1)a=s[0],o="remove",l=u=>u.mark(a.removeFromSet(u.marks));else return null;let c=[];for(let u=0;u<e.childCount;u++)c.push(l(e.child(u)));if(I.from(c).eq(n))return{mark:a,type:o}}function GN(n,e,t,r,i){if(t-e<=i.pos-r.pos||Fu(r,!0,!1)<i.pos)return!1;let s=n.resolve(e);if(!r.parent.isTextblock){let a=s.nodeAfter;return a!=null&&t==e+a.nodeSize}if(s.parentOffset<s.parent.content.size||!s.parent.isTextblock)return!1;let o=n.resolve(Fu(s,!0,!0));return!o.parent.isTextblock||o.pos>t||Fu(o,!0,!1)<t?!1:r.parent.content.cut(r.parentOffset).eq(o.parent.content)}function Fu(n,e,t){let r=n.depth,i=e?n.end():n.pos;for(;r>0&&(e||n.indexAfter(r)==n.node(r).childCount);)r--,i++,e=!1;if(t){let s=n.node(r).maybeChild(n.indexAfter(r));for(;s&&!s.isLeaf;)s=s.firstChild,i++}return i}function UN(n,e,t,r,i){let s=n.findDiffStart(e,t);if(s==null)return null;let{a:o,b:a}=n.findDiffEnd(e,t+n.size,t+e.size);if(i=="end"){let l=Math.max(0,s-Math.min(o,a));r-=o+l-s}if(o<s&&n.size<e.size){let l=r<=s&&r>=o?s-r:0;s-=l,s&&s<e.size&&ay(e.textBetween(s-1,s+1))&&(s+=l?1:-1),a=s+(a-o),o=s}else if(a<s){let l=r<=s&&r>=a?s-r:0;s-=l,s&&s<n.size&&ay(n.textBetween(s-1,s+1))&&(s+=l?1:-1),o=s+(o-a),a=s}return{start:s,endA:o,endB:a}}function ay(n){if(n.length!=2)return!1;let e=n.charCodeAt(0),t=n.charCodeAt(1);return e>=56320&&e<=57343&&t>=55296&&t<=56319}class WN{constructor(e,t){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new fN,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=t,this.state=t.state,this.directPlugins=t.plugins||[],this.directPlugins.forEach(dy),this.dispatch=this.dispatch.bind(this),this.dom=e&&e.mount||document.createElement("div"),e&&(e.appendChild?e.appendChild(this.dom):typeof e=="function"?e(this.dom):e.mount&&(this.mounted=!0)),this.editable=uy(this),cy(this),this.nodeViews=fy(this),this.docView=yg(this.state.doc,ly(this),Ru(this),this.dom,this),this.domObserver=new LN(this,(r,i,s,o)=>zN(this,r,i,s,o)),this.domObserver.start(),dN(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let e=this._props;this._props={};for(let t in e)this._props[t]=e[t];this._props.state=this.state}return this._props}update(e){e.handleDOMEvents!=this._props.handleDOMEvents&&Mu(this);let t=this._props;this._props=e,e.plugins&&(e.plugins.forEach(dy),this.directPlugins=e.plugins),this.updateStateInner(e.state,t)}setProps(e){let t={};for(let r in this._props)t[r]=this._props[r];t.state=this.state;for(let r in e)t[r]=e[r];this.update(t)}updateState(e){this.updateStateInner(e,this._props)}updateStateInner(e,t){var r;let i=this.state,s=!1,o=!1;e.storedMarks&&this.composing&&(qg(this),o=!0),this.state=e;let a=i.plugins!=e.plugins||this._props.plugins!=t.plugins;if(a||this._props.plugins!=t.plugins||this._props.nodeViews!=t.nodeViews){let m=fy(this);YN(m,this.nodeViews)&&(this.nodeViews=m,s=!0)}(a||t.handleDOMEvents!=this._props.handleDOMEvents)&&Mu(this),this.editable=uy(this),cy(this);let l=Ru(this),c=ly(this),u=i.plugins!=e.plugins&&!i.doc.eq(e.doc)?"reset":e.scrollToSelection>i.scrollToSelection?"to selection":"preserve",d=s||!this.docView.matchesNode(e.doc,c,l);(d||!e.selection.eq(i.selection))&&(o=!0);let h=u=="preserve"&&o&&this.dom.style.overflowAnchor==null&&EO(this);if(o){this.domObserver.stop();let m=d&&(wt||rt)&&!this.composing&&!i.selection.empty&&!e.selection.empty&&KN(i.selection,e.selection);if(d){let p=rt?this.trackWrites=this.domSelectionRange().focusNode:null;this.composing&&(this.input.compositionNode=_N(this)),(s||!this.docView.update(e.doc,c,l,this))&&(this.docView.updateOuterDeco(c),this.docView.destroy(),this.docView=yg(e.doc,c,l,this.dom,this)),p&&!this.trackWrites&&(m=!0)}m||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&XO(this))?Ln(this,m):(Tg(this,e.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(i),!((r=this.dragging)===null||r===void 0)&&r.node&&!i.doc.eq(e.doc)&&this.updateDraggedNode(this.dragging,i),u=="reset"?this.dom.scrollTop=0:u=="to selection"?this.scrollToSelection():h&&TO(h)}scrollToSelection(){let e=this.domSelectionRange().focusNode;if(!this.someProp("handleScrollToSelection",t=>t(this)))if(this.state.selection instanceof q){let t=this.docView.domAfterPos(this.state.selection.from);t.nodeType==1&&ig(this,t.getBoundingClientRect(),e)}else ig(this,this.coordsAtPos(this.state.selection.head,1),e)}destroyPluginViews(){let e;for(;e=this.pluginViews.pop();)e.destroy&&e.destroy()}updatePluginViews(e){if(!e||e.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let t=0;t<this.directPlugins.length;t++){let r=this.directPlugins[t];r.spec.view&&this.pluginViews.push(r.spec.view(this))}for(let t=0;t<this.state.plugins.length;t++){let r=this.state.plugins[t];r.spec.view&&this.pluginViews.push(r.spec.view(this))}}else for(let t=0;t<this.pluginViews.length;t++){let r=this.pluginViews[t];r.update&&r.update(this,e)}}updateDraggedNode(e,t){let r=e.node,i=-1;if(this.state.doc.nodeAt(r.from)==r.node)i=r.from;else{let s=r.from+(this.state.doc.content.size-t.doc.content.size);(s>0&&this.state.doc.nodeAt(s))==r.node&&(i=s)}this.dragging=new Jg(e.slice,e.move,i<0?void 0:q.create(this.state.doc,i))}someProp(e,t){let r=this._props&&this._props[e],i;if(r!=null&&(i=t?t(r):r))return i;for(let o=0;o<this.directPlugins.length;o++){let a=this.directPlugins[o].props[e];if(a!=null&&(i=t?t(a):a))return i}let s=this.state.plugins;if(s)for(let o=0;o<s.length;o++){let a=s[o].props[e];if(a!=null&&(i=t?t(a):a))return i}}hasFocus(){if(wt){let e=this.root.activeElement;if(e==this.dom)return!0;if(!e||!this.dom.contains(e))return!1;for(;e&&this.dom!=e&&this.dom.contains(e);){if(e.contentEditable=="false")return!1;e=e.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&OO(this.dom),Ln(this),this.domObserver.start()}get root(){let e=this._root;if(e==null){for(let t=this.dom.parentNode;t;t=t.parentNode)if(t.nodeType==9||t.nodeType==11&&t.host)return t.getSelection||(Object.getPrototypeOf(t).getSelection=()=>t.ownerDocument.getSelection()),this._root=t}return e||document}updateRoot(){this._root=null}posAtCoords(e){return IO(this,e)}coordsAtPos(e,t=1){return ug(this,e,t)}domAtPos(e,t=0){return this.docView.domFromPos(e,t)}nodeDOM(e){let t=this.docView.descAt(e);return t?t.nodeDOM:null}posAtDOM(e,t,r=-1){let i=this.docView.posFromDOM(e,t,r);if(i==null)throw new RangeError("DOM position not inside the editor");return i}endOfTextblock(e,t){return BO(this,t||this.state,e)}pasteHTML(e,t){return no(this,"",e,!1,t||new ClipboardEvent("paste"))}pasteText(e,t){return no(this,e,null,!0,t||new ClipboardEvent("paste"))}destroy(){this.docView&&(hN(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],Ru(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,mO())}get isDestroyed(){return this.docView==null}dispatchEvent(e){return mN(this,e)}dispatch(e){let t=this._props.dispatchTransaction;t?t.call(this,e):this.updateState(this.state.apply(e))}domSelectionRange(){let e=this.domSelection();return e?ct&&this.root.nodeType===11&&wO(this.dom.ownerDocument)==this.dom&&FN(this,e)||e:{focusNode:null,focusOffset:0,anchorNode:null,anchorOffset:0}}domSelection(){return this.root.getSelection()}}function ly(n){let e=Object.create(null);return e.class="ProseMirror",e.contenteditable=String(n.editable),n.someProp("attributes",t=>{if(typeof t=="function"&&(t=t(n.state)),t)for(let r in t)r=="class"?e.class+=" "+t[r]:r=="style"?e.style=(e.style?e.style+";":"")+t[r]:!e[r]&&r!="contenteditable"&&r!="nodeName"&&(e[r]=String(t[r]))}),e.translate||(e.translate="no"),[Vt.node(0,n.state.doc.content.size,e)]}function cy(n){if(n.markCursor){let e=document.createElement("img");e.className="ProseMirror-separator",e.setAttribute("mark-placeholder","true"),e.setAttribute("alt",""),n.cursorWrapper={dom:e,deco:Vt.widget(n.state.selection.from,e,{raw:!0,marks:n.markCursor})}}else n.cursorWrapper=null}function uy(n){return!n.someProp("editable",e=>e(n.state)===!1)}function KN(n,e){let t=Math.min(n.$anchor.sharedDepth(n.head),e.$anchor.sharedDepth(e.head));return n.$anchor.start(t)!=e.$anchor.start(t)}function fy(n){let e=Object.create(null);function t(r){for(let i in r)Object.prototype.hasOwnProperty.call(e,i)||(e[i]=r[i])}return n.someProp("nodeViews",t),n.someProp("markViews",t),e}function YN(n,e){let t=0,r=0;for(let i in n){if(n[i]!=e[i])return!0;t++}for(let i in e)r++;return t!=r}function dy(n){if(n.spec.state||n.spec.filterTransaction||n.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}for(var br={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},Ra={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},qN=typeof navigator<"u"&&/Mac/.test(navigator.platform),XN=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),Ze=0;Ze<10;Ze++)br[48+Ze]=br[96+Ze]=String(Ze);for(var Ze=1;Ze<=24;Ze++)br[Ze+111]="F"+Ze;for(var Ze=65;Ze<=90;Ze++)br[Ze]=String.fromCharCode(Ze+32),Ra[Ze]=String.fromCharCode(Ze);for(var Bu in br)Ra.hasOwnProperty(Bu)||(Ra[Bu]=br[Bu]);function JN(n){var e=qN&&n.metaKey&&n.shiftKey&&!n.ctrlKey&&!n.altKey||XN&&n.shiftKey&&n.key&&n.key.length==1||n.key=="Unidentified",t=!e&&n.key||(n.shiftKey?Ra:br)[n.keyCode]||n.key||"Unidentified";return t=="Esc"&&(t="Escape"),t=="Del"&&(t="Delete"),t=="Left"&&(t="ArrowLeft"),t=="Up"&&(t="ArrowUp"),t=="Right"&&(t="ArrowRight"),t=="Down"&&(t="ArrowDown"),t}const QN=typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):!1;function ZN(n){let e=n.split(/-(?!$)/),t=e[e.length-1];t=="Space"&&(t=" ");let r,i,s,o;for(let a=0;a<e.length-1;a++){let l=e[a];if(/^(cmd|meta|m)$/i.test(l))o=!0;else if(/^a(lt)?$/i.test(l))r=!0;else if(/^(c|ctrl|control)$/i.test(l))i=!0;else if(/^s(hift)?$/i.test(l))s=!0;else if(/^mod$/i.test(l))QN?o=!0:i=!0;else throw new Error("Unrecognized modifier name: "+l)}return r&&(t="Alt-"+t),i&&(t="Ctrl-"+t),o&&(t="Meta-"+t),s&&(t="Shift-"+t),t}function e2(n){let e=Object.create(null);for(let t in n)e[ZN(t)]=n[t];return e}function Vu(n,e,t=!0){return e.altKey&&(n="Alt-"+n),e.ctrlKey&&(n="Ctrl-"+n),e.metaKey&&(n="Meta-"+n),t&&e.shiftKey&&(n="Shift-"+n),n}function t2(n){return new nt({props:{handleKeyDown:hy(n)}})}function hy(n){let e=e2(n);return function(t,r){let i=JN(r),s,o=e[Vu(i,r)];if(o&&o(t.state,t.dispatch,t))return!0;if(i.length==1&&i!=" "){if(r.shiftKey){let a=e[Vu(i,r,!1)];if(a&&a(t.state,t.dispatch,t))return!0}if((r.shiftKey||r.altKey||r.metaKey||i.charCodeAt(0)>127)&&(s=br[r.keyCode])&&s!=i){let a=e[Vu(s,r)];if(a&&a(t.state,t.dispatch,t))return!0}}return!1}}const n2=(n,e)=>n.selection.empty?!1:(e&&e(n.tr.deleteSelection().scrollIntoView()),!0);function py(n,e){let{$cursor:t}=n.selection;return!t||(e?!e.endOfTextblock("backward",n):t.parentOffset>0)?null:t}const r2=(n,e,t)=>{let r=py(n,t);if(!r)return!1;let i=$u(r);if(!i){let o=r.blockRange(),a=o&&Oi(o);return a==null?!1:(e&&e(n.tr.lift(o,a).scrollIntoView()),!0)}let s=i.nodeBefore;if(by(n,i,e,-1))return!0;if(r.parent.content.size==0&&(Vi(s,"end")||q.isSelectable(s)))for(let o=r.depth;;o--){let a=_a(n.doc,r.before(o),r.after(o),V.empty);if(a&&a.slice.size<a.to-a.from){if(e){let l=n.tr.step(a);l.setSelection(Vi(s,"end")?re.findFrom(l.doc.resolve(l.mapping.map(i.pos,-1)),-1):q.create(l.doc,i.pos-s.nodeSize)),e(l.scrollIntoView())}return!0}if(o==1||r.node(o-1).childCount>1)break}return s.isAtom&&i.depth==r.depth-1?(e&&e(n.tr.delete(i.pos-s.nodeSize,i.pos).scrollIntoView()),!0):!1},i2=(n,e,t)=>{let r=py(n,t);if(!r)return!1;let i=$u(r);return i?my(n,i,e):!1},s2=(n,e,t)=>{let r=gy(n,t);if(!r)return!1;let i=ju(r);return i?my(n,i,e):!1};function my(n,e,t){let r=e.nodeBefore,i=r,s=e.pos-1;for(;!i.isTextblock;s--){if(i.type.spec.isolating)return!1;let u=i.lastChild;if(!u)return!1;i=u}let o=e.nodeAfter,a=o,l=e.pos+1;for(;!a.isTextblock;l++){if(a.type.spec.isolating)return!1;let u=a.firstChild;if(!u)return!1;a=u}let c=_a(n.doc,s,l,V.empty);if(!c||c.from!=s||c instanceof We&&c.slice.size>=l-s)return!1;if(t){let u=n.tr.step(c);u.setSelection(ne.create(u.doc,s)),t(u.scrollIntoView())}return!0}function Vi(n,e,t=!1){for(let r=n;r;r=e=="start"?r.firstChild:r.lastChild){if(r.isTextblock)return!0;if(t&&r.childCount!=1)return!1}return!1}const o2=(n,e,t)=>{let{$head:r,empty:i}=n.selection,s=r;if(!i)return!1;if(r.parent.isTextblock){if(t?!t.endOfTextblock("backward",n):r.parentOffset>0)return!1;s=$u(r)}let o=s&&s.nodeBefore;return!o||!q.isSelectable(o)?!1:(e&&e(n.tr.setSelection(q.create(n.doc,s.pos-o.nodeSize)).scrollIntoView()),!0)};function $u(n){if(!n.parent.type.spec.isolating)for(let e=n.depth-1;e>=0;e--){if(n.index(e)>0)return n.doc.resolve(n.before(e+1));if(n.node(e).type.spec.isolating)break}return null}function gy(n,e){let{$cursor:t}=n.selection;return!t||(e?!e.endOfTextblock("forward",n):t.parentOffset<t.parent.content.size)?null:t}const a2=(n,e,t)=>{let r=gy(n,t);if(!r)return!1;let i=ju(r);if(!i)return!1;let s=i.nodeAfter;if(by(n,i,e,1))return!0;if(r.parent.content.size==0&&(Vi(s,"start")||q.isSelectable(s))){let o=_a(n.doc,r.before(),r.after(),V.empty);if(o&&o.slice.size<o.to-o.from){if(e){let a=n.tr.step(o);a.setSelection(Vi(s,"start")?re.findFrom(a.doc.resolve(a.mapping.map(i.pos)),1):q.create(a.doc,a.mapping.map(i.pos))),e(a.scrollIntoView())}return!0}}return s.isAtom&&i.depth==r.depth-1?(e&&e(n.tr.delete(i.pos,i.pos+s.nodeSize).scrollIntoView()),!0):!1},l2=(n,e,t)=>{let{$head:r,empty:i}=n.selection,s=r;if(!i)return!1;if(r.parent.isTextblock){if(t?!t.endOfTextblock("forward",n):r.parentOffset<r.parent.content.size)return!1;s=ju(r)}let o=s&&s.nodeAfter;return!o||!q.isSelectable(o)?!1:(e&&e(n.tr.setSelection(q.create(n.doc,s.pos)).scrollIntoView()),!0)};function ju(n){if(!n.parent.type.spec.isolating)for(let e=n.depth-1;e>=0;e--){let t=n.node(e);if(n.index(e)+1<t.childCount)return n.doc.resolve(n.after(e+1));if(t.type.spec.isolating)break}return null}const c2=(n,e)=>{let t=n.selection,r=t instanceof q,i;if(r){if(t.node.isTextblock||!cr(n.doc,t.from))return!1;i=t.from}else if(i=xa(n.doc,t.from,-1),i==null)return!1;if(e){let s=n.tr.join(i);r&&s.setSelection(q.create(s.doc,i-n.doc.resolve(i).nodeBefore.nodeSize)),e(s.scrollIntoView())}return!0},u2=(n,e)=>{let t=n.selection,r;if(t instanceof q){if(t.node.isTextblock||!cr(n.doc,t.to))return!1;r=t.to}else if(r=xa(n.doc,t.to,1),r==null)return!1;return e&&e(n.tr.join(r).scrollIntoView()),!0},f2=(n,e)=>{let{$from:t,$to:r}=n.selection,i=t.blockRange(r),s=i&&Oi(i);return s==null?!1:(e&&e(n.tr.lift(i,s).scrollIntoView()),!0)},d2=(n,e)=>{let{$head:t,$anchor:r}=n.selection;return!t.parent.type.spec.code||!t.sameParent(r)?!1:(e&&e(n.tr.insertText(`
`).scrollIntoView()),!0)};function yy(n){for(let e=0;e<n.edgeCount;e++){let{type:t}=n.edge(e);if(t.isTextblock&&!t.hasRequiredAttrs())return t}return null}const h2=(n,e)=>{let{$head:t,$anchor:r}=n.selection;if(!t.parent.type.spec.code||!t.sameParent(r))return!1;let i=t.node(-1),s=t.indexAfter(-1),o=yy(i.contentMatchAt(s));if(!o||!i.canReplaceWith(s,s,o))return!1;if(e){let a=t.after(),l=n.tr.replaceWith(a,a,o.createAndFill());l.setSelection(re.near(l.doc.resolve(a),1)),e(l.scrollIntoView())}return!0},p2=(n,e)=>{let t=n.selection,{$from:r,$to:i}=t;if(t instanceof en||r.parent.inlineContent||i.parent.inlineContent)return!1;let s=yy(i.parent.contentMatchAt(i.indexAfter()));if(!s||!s.isTextblock)return!1;if(e){let o=(!r.parentOffset&&i.index()<i.parent.childCount?r:i).pos,a=n.tr.insert(o,s.createAndFill());a.setSelection(ne.create(a.doc,o+1)),e(a.scrollIntoView())}return!0},m2=(n,e)=>{let{$cursor:t}=n.selection;if(!t||t.parent.content.size)return!1;if(t.depth>1&&t.after()!=t.end(-1)){let s=t.before();if(Ni(n.doc,s))return e&&e(n.tr.split(s).scrollIntoView()),!0}let r=t.blockRange(),i=r&&Oi(r);return i==null?!1:(e&&e(n.tr.lift(r,i).scrollIntoView()),!0)},g2=(n,e)=>{let{$from:t,to:r}=n.selection,i,s=t.sharedDepth(r);return s==0?!1:(i=t.before(s),e&&e(n.tr.setSelection(q.create(n.doc,i))),!0)};function y2(n,e,t){let r=e.nodeBefore,i=e.nodeAfter,s=e.index();return!r||!i||!r.type.compatibleContent(i.type)?!1:!r.content.size&&e.parent.canReplace(s-1,s)?(t&&t(n.tr.delete(e.pos-r.nodeSize,e.pos).scrollIntoView()),!0):!e.parent.canReplace(s,s+1)||!(i.isTextblock||cr(n.doc,e.pos))?!1:(t&&t(n.tr.join(e.pos).scrollIntoView()),!0)}function by(n,e,t,r){let i=e.nodeBefore,s=e.nodeAfter,o,a,l=i.type.spec.isolating||s.type.spec.isolating;if(!l&&y2(n,e,t))return!0;let c=!l&&e.parent.canReplace(e.index(),e.index()+1);if(c&&(o=(a=i.contentMatchAt(i.childCount)).findWrapping(s.type))&&a.matchType(o[0]||s.type).validEnd){if(t){let m=e.pos+s.nodeSize,p=I.empty;for(let v=o.length-1;v>=0;v--)p=I.from(o[v].create(null,p));p=I.from(i.copy(p));let g=n.tr.step(new Ke(e.pos-1,m,e.pos,m,new V(p,1,0),o.length,!0)),y=g.doc.resolve(m+2*o.length);y.nodeAfter&&y.nodeAfter.type==i.type&&cr(g.doc,y.pos)&&g.join(y.pos),t(g.scrollIntoView())}return!0}let u=s.type.spec.isolating||r>0&&l?null:re.findFrom(e,1),d=u&&u.$from.blockRange(u.$to),h=d&&Oi(d);if(h!=null&&h>=e.depth)return t&&t(n.tr.lift(d,h).scrollIntoView()),!0;if(c&&Vi(s,"start",!0)&&Vi(i,"end")){let m=i,p=[];for(;p.push(m),!m.isTextblock;)m=m.lastChild;let g=s,y=1;for(;!g.isTextblock;g=g.firstChild)y++;if(m.canReplace(m.childCount,m.childCount,g.content)){if(t){let v=I.empty;for(let w=p.length-1;w>=0;w--)v=I.from(p[w].copy(v));let C=n.tr.step(new Ke(e.pos-p.length,e.pos+s.nodeSize,e.pos+y,e.pos+s.nodeSize-y,new V(v,p.length,0),0,!0));t(C.scrollIntoView())}return!0}}return!1}function vy(n){return function(e,t){let r=e.selection,i=n<0?r.$from:r.$to,s=i.depth;for(;i.node(s).isInline;){if(!s)return!1;s--}return i.node(s).isTextblock?(t&&t(e.tr.setSelection(ne.create(e.doc,n<0?i.start(s):i.end(s)))),!0):!1}}const b2=vy(-1),v2=vy(1);function w2(n,e=null){return function(t,r){let{$from:i,$to:s}=t.selection,o=i.blockRange(s),a=o&&lu(o,n,e);return a?(r&&r(t.tr.wrap(o,a).scrollIntoView()),!0):!1}}function wy(n,e=null){return function(t,r){let i=!1;for(let s=0;s<t.selection.ranges.length&&!i;s++){let{$from:{pos:o},$to:{pos:a}}=t.selection.ranges[s];t.doc.nodesBetween(o,a,(l,c)=>{if(i)return!1;if(!(!l.isTextblock||l.hasMarkup(n,e)))if(l.type==n)i=!0;else{let u=t.doc.resolve(c),d=u.index();i=u.parent.canReplaceWith(d,d+1,n)}})}if(!i)return!1;if(r){let s=t.tr;for(let o=0;o<t.selection.ranges.length;o++){let{$from:{pos:a},$to:{pos:l}}=t.selection.ranges[o];s.setBlockType(a,l,n,e)}r(s.scrollIntoView())}return!0}}typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os<"u"&&os.platform&&os.platform()=="darwin";function C2(n,e=null){return function(t,r){let{$from:i,$to:s}=t.selection,o=i.blockRange(s),a=!1,l=o;if(!o)return!1;if(o.depth>=2&&i.node(o.depth-1).type.compatibleContent(n)&&o.startIndex==0){if(i.index(o.depth-1)==0)return!1;let u=t.doc.resolve(o.start-2);l=new ga(u,u,o.depth),o.endIndex<o.parent.childCount&&(o=new ga(i,t.doc.resolve(s.end(o.depth)),o.depth)),a=!0}let c=lu(l,n,e,o);return c?(r&&r(k2(t.tr,o,c,a,n).scrollIntoView()),!0):!1}}function k2(n,e,t,r,i){let s=I.empty;for(let u=t.length-1;u>=0;u--)s=I.from(t[u].type.create(t[u].attrs,s));n.step(new Ke(e.start-(r?2:0),e.end,e.start,e.end,new V(s,0,0),t.length,!0));let o=0;for(let u=0;u<t.length;u++)t[u].type==i&&(o=u+1);let a=t.length-o,l=e.start+t.length-(r?2:0),c=e.parent;for(let u=e.startIndex,d=e.endIndex,h=!0;u<d;u++,h=!1)!h&&Ni(n.doc,l,a)&&(n.split(l,a),l+=2*a),l+=c.child(u).nodeSize;return n}function S2(n){return function(e,t){let{$from:r,$to:i}=e.selection,s=r.blockRange(i,o=>o.childCount>0&&o.firstChild.type==n);return s?t?r.node(s.depth-1).type==n?x2(e,t,n,s):_2(e,t,s):!0:!1}}function x2(n,e,t,r){let i=n.tr,s=r.end,o=r.$to.end(r.depth);s<o&&(i.step(new Ke(s-1,o,s,o,new V(I.from(t.create(null,r.parent.copy())),1,0),1,!0)),r=new ga(i.doc.resolve(r.$from.pos),i.doc.resolve(o),r.depth));const a=Oi(r);if(a==null)return!1;i.lift(r,a);let l=i.mapping.map(s,-1)-1;return cr(i.doc,l)&&i.join(l),e(i.scrollIntoView()),!0}function _2(n,e,t){let r=n.tr,i=t.parent;for(let m=t.end,p=t.endIndex-1,g=t.startIndex;p>g;p--)m-=i.child(p).nodeSize,r.delete(m-1,m+1);let s=r.doc.resolve(t.start),o=s.nodeAfter;if(r.mapping.map(t.end)!=t.start+s.nodeAfter.nodeSize)return!1;let a=t.startIndex==0,l=t.endIndex==i.childCount,c=s.node(-1),u=s.index(-1);if(!c.canReplace(u+(a?0:1),u+1,o.content.append(l?I.empty:I.from(i))))return!1;let d=s.pos,h=d+o.nodeSize;return r.step(new Ke(d-(a?1:0),h+(l?1:0),d+1,h-1,new V((a?I.empty:I.from(i.copy(I.empty))).append(l?I.empty:I.from(i.copy(I.empty))),a?0:1,l?0:1),a?0:1)),e(r.scrollIntoView()),!0}function E2(n){return function(e,t){let{$from:r,$to:i}=e.selection,s=r.blockRange(i,c=>c.childCount>0&&c.firstChild.type==n);if(!s)return!1;let o=s.startIndex;if(o==0)return!1;let a=s.parent,l=a.child(o-1);if(l.type!=n)return!1;if(t){let c=l.lastChild&&l.lastChild.type==a.type,u=I.from(c?n.create():null),d=new V(I.from(n.create(null,I.from(a.type.create(null,u)))),c?3:1,0),h=s.start,m=s.end;t(e.tr.step(new Ke(h-(c?3:1),m,h,m,d,1,!0)).scrollIntoView())}return!0}}function Fa(n){const{state:e,transaction:t}=n;let{selection:r}=t,{doc:i}=t,{storedMarks:s}=t;return{...e,apply:e.apply.bind(e),applyTransaction:e.applyTransaction.bind(e),plugins:e.plugins,schema:e.schema,reconfigure:e.reconfigure.bind(e),toJSON:e.toJSON.bind(e),get storedMarks(){return s},get selection(){return r},get doc(){return i},get tr(){return r=t.selection,i=t.doc,s=t.storedMarks,t}}}class Ba{constructor(e){this.editor=e.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=e.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:e,editor:t,state:r}=this,{view:i}=t,{tr:s}=r,o=this.buildProps(s);return Object.fromEntries(Object.entries(e).map(([a,l])=>[a,(...u)=>{const d=l(...u)(o);return!s.getMeta("preventDispatch")&&!this.hasCustomState&&i.dispatch(s),d}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(e,t=!0){const{rawCommands:r,editor:i,state:s}=this,{view:o}=i,a=[],l=!!e,c=e||s.tr,u=()=>(!l&&t&&!c.getMeta("preventDispatch")&&!this.hasCustomState&&o.dispatch(c),a.every(h=>h===!0)),d={...Object.fromEntries(Object.entries(r).map(([h,m])=>[h,(...g)=>{const y=this.buildProps(c,t),v=m(...g)(y);return a.push(v),d}])),run:u};return d}createCan(e){const{rawCommands:t,state:r}=this,i=!1,s=e||r.tr,o=this.buildProps(s,i);return{...Object.fromEntries(Object.entries(t).map(([l,c])=>[l,(...u)=>c(...u)({...o,dispatch:void 0})])),chain:()=>this.createChain(s,i)}}buildProps(e,t=!0){const{rawCommands:r,editor:i,state:s}=this,{view:o}=i,a={tr:e,editor:i,view:o,state:Fa({state:s,transaction:e}),dispatch:t?()=>{}:void 0,chain:()=>this.createChain(e,t),can:()=>this.createCan(e),get commands(){return Object.fromEntries(Object.entries(r).map(([l,c])=>[l,(...u)=>c(...u)(a)]))}};return a}}class T2{constructor(){this.callbacks={}}on(e,t){return this.callbacks[e]||(this.callbacks[e]=[]),this.callbacks[e].push(t),this}emit(e,...t){const r=this.callbacks[e];return r&&r.forEach(i=>i.apply(this,t)),this}off(e,t){const r=this.callbacks[e];return r&&(t?this.callbacks[e]=r.filter(i=>i!==t):delete this.callbacks[e]),this}once(e,t){const r=(...i)=>{this.off(e,r),t.apply(this,i)};return this.on(e,r)}removeAllListeners(){this.callbacks={}}}function j(n,e,t){return n.config[e]===void 0&&n.parent?j(n.parent,e,t):typeof n.config[e]=="function"?n.config[e].bind({...t,parent:n.parent?j(n.parent,e,t):null}):n.config[e]}function Va(n){const e=n.filter(i=>i.type==="extension"),t=n.filter(i=>i.type==="node"),r=n.filter(i=>i.type==="mark");return{baseExtensions:e,nodeExtensions:t,markExtensions:r}}function Cy(n){const e=[],{nodeExtensions:t,markExtensions:r}=Va(n),i=[...t,...r],s={default:null,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return n.forEach(o=>{const a={name:o.name,options:o.options,storage:o.storage,extensions:i},l=j(o,"addGlobalAttributes",a);if(!l)return;l().forEach(u=>{u.types.forEach(d=>{Object.entries(u.attributes).forEach(([h,m])=>{e.push({type:d,name:h,attribute:{...s,...m}})})})})}),i.forEach(o=>{const a={name:o.name,options:o.options,storage:o.storage},l=j(o,"addAttributes",a);if(!l)return;const c=l();Object.entries(c).forEach(([u,d])=>{const h={...s,...d};typeof(h==null?void 0:h.default)=="function"&&(h.default=h.default()),h!=null&&h.isRequired&&(h==null?void 0:h.default)===void 0&&delete h.default,e.push({type:o.name,name:u,attribute:h})})}),e}function Ye(n,e){if(typeof n=="string"){if(!e.nodes[n])throw Error(`There is no node type named '${n}'. Maybe you forgot to add the extension?`);return e.nodes[n]}return n}function dt(...n){return n.filter(e=>!!e).reduce((e,t)=>{const r={...e};return Object.entries(t).forEach(([i,s])=>{if(!r[i]){r[i]=s;return}if(i==="class"){const a=s?s.split(" "):[],l=r[i]?r[i].split(" "):[],c=a.filter(u=>!l.includes(u));r[i]=[...l,...c].join(" ")}else if(i==="style"){const a=s?s.split(";").map(u=>u.trim()).filter(Boolean):[],l=r[i]?r[i].split(";").map(u=>u.trim()).filter(Boolean):[],c=new Map;l.forEach(u=>{const[d,h]=u.split(":").map(m=>m.trim());c.set(d,h)}),a.forEach(u=>{const[d,h]=u.split(":").map(m=>m.trim());c.set(d,h)}),r[i]=Array.from(c.entries()).map(([u,d])=>`${u}: ${d}`).join("; ")}else r[i]=s}),r},{})}function zu(n,e){return e.filter(t=>t.type===n.type.name).filter(t=>t.attribute.rendered).map(t=>t.attribute.renderHTML?t.attribute.renderHTML(n.attrs)||{}:{[t.name]:n.attrs[t.name]}).reduce((t,r)=>dt(t,r),{})}function ky(n){return typeof n=="function"}function se(n,e=void 0,...t){return ky(n)?e?n.bind(e)(...t):n(...t):n}function O2(n={}){return Object.keys(n).length===0&&n.constructor===Object}function N2(n){return typeof n!="string"?n:n.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(n):n==="true"?!0:n==="false"?!1:n}function Sy(n,e){return"style"in n?n:{...n,getAttrs:t=>{const r=n.getAttrs?n.getAttrs(t):n.attrs;if(r===!1)return!1;const i=e.reduce((s,o)=>{const a=o.attribute.parseHTML?o.attribute.parseHTML(t):N2(t.getAttribute(o.name));return a==null?s:{...s,[o.name]:a}},{});return{...r,...i}}}}function xy(n){return Object.fromEntries(Object.entries(n).filter(([e,t])=>e==="attrs"&&O2(t)?!1:t!=null))}function M2(n,e){var t;const r=Cy(n),{nodeExtensions:i,markExtensions:s}=Va(n),o=(t=i.find(c=>j(c,"topNode")))===null||t===void 0?void 0:t.name,a=Object.fromEntries(i.map(c=>{const u=r.filter(v=>v.type===c.name),d={name:c.name,options:c.options,storage:c.storage,editor:e},h=n.reduce((v,C)=>{const w=j(C,"extendNodeSchema",d);return{...v,...w?w(c):{}}},{}),m=xy({...h,content:se(j(c,"content",d)),marks:se(j(c,"marks",d)),group:se(j(c,"group",d)),inline:se(j(c,"inline",d)),atom:se(j(c,"atom",d)),selectable:se(j(c,"selectable",d)),draggable:se(j(c,"draggable",d)),code:se(j(c,"code",d)),whitespace:se(j(c,"whitespace",d)),linebreakReplacement:se(j(c,"linebreakReplacement",d)),defining:se(j(c,"defining",d)),isolating:se(j(c,"isolating",d)),attrs:Object.fromEntries(u.map(v=>{var C;return[v.name,{default:(C=v==null?void 0:v.attribute)===null||C===void 0?void 0:C.default}]}))}),p=se(j(c,"parseHTML",d));p&&(m.parseDOM=p.map(v=>Sy(v,u)));const g=j(c,"renderHTML",d);g&&(m.toDOM=v=>g({node:v,HTMLAttributes:zu(v,u)}));const y=j(c,"renderText",d);return y&&(m.toText=y),[c.name,m]})),l=Object.fromEntries(s.map(c=>{const u=r.filter(y=>y.type===c.name),d={name:c.name,options:c.options,storage:c.storage,editor:e},h=n.reduce((y,v)=>{const C=j(v,"extendMarkSchema",d);return{...y,...C?C(c):{}}},{}),m=xy({...h,inclusive:se(j(c,"inclusive",d)),excludes:se(j(c,"excludes",d)),group:se(j(c,"group",d)),spanning:se(j(c,"spanning",d)),code:se(j(c,"code",d)),attrs:Object.fromEntries(u.map(y=>{var v;return[y.name,{default:(v=y==null?void 0:y.attribute)===null||v===void 0?void 0:v.default}]}))}),p=se(j(c,"parseHTML",d));p&&(m.parseDOM=p.map(y=>Sy(y,u)));const g=j(c,"renderHTML",d);return g&&(m.toDOM=y=>g({mark:y,HTMLAttributes:zu(y,u)})),[c.name,m]}));return new Cm({topNode:o,nodes:a,marks:l})}function Hu(n,e){return e.nodes[n]||e.marks[n]||null}function _y(n,e){return Array.isArray(e)?e.some(t=>(typeof t=="string"?t:t.name)===n.name):e}function Gu(n,e){const t=Kr.fromSchema(e).serializeFragment(n),i=document.implementation.createHTMLDocument().createElement("div");return i.appendChild(t),i.innerHTML}const A2=(n,e=500)=>{let t="";const r=n.parentOffset;return n.parent.nodesBetween(Math.max(0,r-e),r,(i,s,o,a)=>{var l,c;const u=((c=(l=i.type.spec).toText)===null||c===void 0?void 0:c.call(l,{node:i,pos:s,parent:o,index:a}))||i.textContent||"%leaf%";t+=i.isAtom&&!i.isText?u:u.slice(0,Math.max(0,r-s))}),t};function Uu(n){return Object.prototype.toString.call(n)==="[object RegExp]"}class $a{constructor(e){this.find=e.find,this.handler=e.handler}}const P2=(n,e)=>{if(Uu(e))return e.exec(n);const t=e(n);if(!t)return null;const r=[t.text];return r.index=t.index,r.input=n,r.data=t.data,t.replaceWith&&(t.text.includes(t.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),r.push(t.replaceWith)),r};function ja(n){var e;const{editor:t,from:r,to:i,text:s,rules:o,plugin:a}=n,{view:l}=t;if(l.composing)return!1;const c=l.state.doc.resolve(r);if(c.parent.type.spec.code||!((e=c.nodeBefore||c.nodeAfter)===null||e===void 0)&&e.marks.find(h=>h.type.spec.code))return!1;let u=!1;const d=A2(c)+s;return o.forEach(h=>{if(u)return;const m=P2(d,h.find);if(!m)return;const p=l.state.tr,g=Fa({state:l.state,transaction:p}),y={from:r-(m[0].length-s.length),to:i},{commands:v,chain:C,can:w}=new Ba({editor:t,state:g});h.handler({state:g,range:y,match:m,commands:v,chain:C,can:w})===null||!p.steps.length||(p.setMeta(a,{transform:p,from:r,to:i,text:s}),l.dispatch(p),u=!0)}),u}function I2(n){const{editor:e,rules:t}=n,r=new nt({state:{init(){return null},apply(i,s,o){const a=i.getMeta(r);if(a)return a;const l=i.getMeta("applyInputRules");return!!l&&setTimeout(()=>{let{text:u}=l;typeof u=="string"?u=u:u=Gu(I.from(u),o.schema);const{from:d}=l,h=d+u.length;ja({editor:e,from:d,to:h,text:u,rules:t,plugin:r})}),i.selectionSet||i.docChanged?null:s}},props:{handleTextInput(i,s,o,a){return ja({editor:e,from:s,to:o,text:a,rules:t,plugin:r})},handleDOMEvents:{compositionend:i=>(setTimeout(()=>{const{$cursor:s}=i.state.selection;s&&ja({editor:e,from:s.pos,to:s.pos,text:"",rules:t,plugin:r})}),!1)},handleKeyDown(i,s){if(s.key!=="Enter")return!1;const{$cursor:o}=i.state.selection;return o?ja({editor:e,from:o.pos,to:o.pos,text:`
`,rules:t,plugin:r}):!1}},isInputRules:!0});return r}function D2(n){return Object.prototype.toString.call(n).slice(8,-1)}function za(n){return D2(n)!=="Object"?!1:n.constructor===Object&&Object.getPrototypeOf(n)===Object.prototype}function Ha(n,e){const t={...n};return za(n)&&za(e)&&Object.keys(e).forEach(r=>{za(e[r])&&za(n[r])?t[r]=Ha(n[r],e[r]):t[r]=e[r]}),t}class vr{constructor(e={}){this.type="mark",this.name="mark",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=se(j(this,"addOptions",{name:this.name}))),this.storage=se(j(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new vr(e)}configure(e={}){const t=this.extend({...this.config,addOptions:()=>Ha(this.options,e)});return t.name=this.name,t.parent=this.parent,t}extend(e={}){const t=new vr(e);return t.parent=this,this.child=t,t.name=e.name?e.name:t.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${t.name}".`),t.options=se(j(t,"addOptions",{name:t.name})),t.storage=se(j(t,"addStorage",{name:t.name,options:t.options})),t}static handleExit({editor:e,mark:t}){const{tr:r}=e.state,i=e.state.selection.$from;if(i.pos===i.end()){const o=i.marks();if(!!!o.find(c=>(c==null?void 0:c.type.name)===t.name))return!1;const l=o.find(c=>(c==null?void 0:c.type.name)===t.name);return l&&r.removeStoredMark(l),r.insertText(" ",i.pos),e.view.dispatch(r),!0}return!1}}function L2(n){return typeof n=="number"}class R2{constructor(e){this.find=e.find,this.handler=e.handler}}const F2=(n,e,t)=>{if(Uu(e))return[...n.matchAll(e)];const r=e(n,t);return r?r.map(i=>{const s=[i.text];return s.index=i.index,s.input=n,s.data=i.data,i.replaceWith&&(i.text.includes(i.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),s.push(i.replaceWith)),s}):[]};function B2(n){const{editor:e,state:t,from:r,to:i,rule:s,pasteEvent:o,dropEvent:a}=n,{commands:l,chain:c,can:u}=new Ba({editor:e,state:t}),d=[];return t.doc.nodesBetween(r,i,(m,p)=>{if(!m.isTextblock||m.type.spec.code)return;const g=Math.max(r,p),y=Math.min(i,p+m.content.size),v=m.textBetween(g-p,y-p,void 0,"￼");F2(v,s.find,o).forEach(w=>{if(w.index===void 0)return;const b=g+w.index+1,E=b+w[0].length,k={from:t.tr.mapping.map(b),to:t.tr.mapping.map(E)},x=s.handler({state:t,range:k,match:w,commands:l,chain:c,can:u,pasteEvent:o,dropEvent:a});d.push(x)})}),d.every(m=>m!==null)}const V2=n=>{var e;const t=new ClipboardEvent("paste",{clipboardData:new DataTransfer});return(e=t.clipboardData)===null||e===void 0||e.setData("text/html",n),t};function $2(n){const{editor:e,rules:t}=n;let r=null,i=!1,s=!1,o=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,a;try{a=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{a=null}const l=({state:u,from:d,to:h,rule:m,pasteEvt:p})=>{const g=u.tr,y=Fa({state:u,transaction:g});if(!(!B2({editor:e,state:y,from:Math.max(d-1,0),to:h.b-1,rule:m,pasteEvent:p,dropEvent:a})||!g.steps.length)){try{a=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{a=null}return o=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,g}};return t.map(u=>new nt({view(d){const h=m=>{var p;r=!((p=d.dom.parentElement)===null||p===void 0)&&p.contains(m.target)?d.dom.parentElement:null};return window.addEventListener("dragstart",h),{destroy(){window.removeEventListener("dragstart",h)}}},props:{handleDOMEvents:{drop:(d,h)=>(s=r===d.dom.parentElement,a=h,!1),paste:(d,h)=>{var m;const p=(m=h.clipboardData)===null||m===void 0?void 0:m.getData("text/html");return o=h,i=!!(p!=null&&p.includes("data-pm-slice")),!1}}},appendTransaction:(d,h,m)=>{const p=d[0],g=p.getMeta("uiEvent")==="paste"&&!i,y=p.getMeta("uiEvent")==="drop"&&!s,v=p.getMeta("applyPasteRules"),C=!!v;if(!g&&!y&&!C)return;if(C){let{text:E}=v;typeof E=="string"?E=E:E=Gu(I.from(E),m.schema);const{from:k}=v,x=k+E.length,O=V2(E);return l({rule:u,state:m,from:k,to:{b:x},pasteEvt:O})}const w=h.doc.content.findDiffStart(m.doc.content),b=h.doc.content.findDiffEnd(m.doc.content);if(!(!L2(w)||!b||w===b.b))return l({rule:u,state:m,from:w,to:b,pasteEvt:o})}}))}function j2(n){const e=n.filter((t,r)=>n.indexOf(t)!==r);return Array.from(new Set(e))}class $i{constructor(e,t){this.splittableMarks=[],this.editor=t,this.extensions=$i.resolve(e),this.schema=M2(this.extensions,t),this.setupExtensions()}static resolve(e){const t=$i.sort($i.flatten(e)),r=j2(t.map(i=>i.name));return r.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${r.map(i=>`'${i}'`).join(", ")}]. This can lead to issues.`),t}static flatten(e){return e.map(t=>{const r={name:t.name,options:t.options,storage:t.storage},i=j(t,"addExtensions",r);return i?[t,...this.flatten(i())]:t}).flat(10)}static sort(e){return e.sort((r,i)=>{const s=j(r,"priority")||100,o=j(i,"priority")||100;return s>o?-1:s<o?1:0})}get commands(){return this.extensions.reduce((e,t)=>{const r={name:t.name,options:t.options,storage:t.storage,editor:this.editor,type:Hu(t.name,this.schema)},i=j(t,"addCommands",r);return i?{...e,...i()}:e},{})}get plugins(){const{editor:e}=this,t=$i.sort([...this.extensions].reverse()),r=[],i=[],s=t.map(o=>{const a={name:o.name,options:o.options,storage:o.storage,editor:e,type:Hu(o.name,this.schema)},l=[],c=j(o,"addKeyboardShortcuts",a);let u={};if(o.type==="mark"&&j(o,"exitable",a)&&(u.ArrowRight=()=>vr.handleExit({editor:e,mark:o})),c){const g=Object.fromEntries(Object.entries(c()).map(([y,v])=>[y,()=>v({editor:e})]));u={...u,...g}}const d=t2(u);l.push(d);const h=j(o,"addInputRules",a);_y(o,e.options.enableInputRules)&&h&&r.push(...h());const m=j(o,"addPasteRules",a);_y(o,e.options.enablePasteRules)&&m&&i.push(...m());const p=j(o,"addProseMirrorPlugins",a);if(p){const g=p();l.push(...g)}return l}).flat();return[I2({editor:e,rules:r}),...$2({editor:e,rules:i}),...s]}get attributes(){return Cy(this.extensions)}get nodeViews(){const{editor:e}=this,{nodeExtensions:t}=Va(this.extensions);return Object.fromEntries(t.filter(r=>!!j(r,"addNodeView")).map(r=>{const i=this.attributes.filter(l=>l.type===r.name),s={name:r.name,options:r.options,storage:r.storage,editor:e,type:Ye(r.name,this.schema)},o=j(r,"addNodeView",s);if(!o)return[];const a=(l,c,u,d,h)=>{const m=zu(l,i);return o()({node:l,view:c,getPos:u,decorations:d,innerDecorations:h,editor:e,extension:r,HTMLAttributes:m})};return[r.name,a]}))}setupExtensions(){this.extensions.forEach(e=>{var t;this.editor.extensionStorage[e.name]=e.storage;const r={name:e.name,options:e.options,storage:e.storage,editor:this.editor,type:Hu(e.name,this.schema)};e.type==="mark"&&(!((t=se(j(e,"keepOnSplit",r)))!==null&&t!==void 0)||t)&&this.splittableMarks.push(e.name);const i=j(e,"onBeforeCreate",r),s=j(e,"onCreate",r),o=j(e,"onUpdate",r),a=j(e,"onSelectionUpdate",r),l=j(e,"onTransaction",r),c=j(e,"onFocus",r),u=j(e,"onBlur",r),d=j(e,"onDestroy",r);i&&this.editor.on("beforeCreate",i),s&&this.editor.on("create",s),o&&this.editor.on("update",o),a&&this.editor.on("selectionUpdate",a),l&&this.editor.on("transaction",l),c&&this.editor.on("focus",c),u&&this.editor.on("blur",u),d&&this.editor.on("destroy",d)})}}class et{constructor(e={}){this.type="extension",this.name="extension",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=se(j(this,"addOptions",{name:this.name}))),this.storage=se(j(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new et(e)}configure(e={}){const t=this.extend({...this.config,addOptions:()=>Ha(this.options,e)});return t.name=this.name,t.parent=this.parent,t}extend(e={}){const t=new et({...this.config,...e});return t.parent=this,this.child=t,t.name=e.name?e.name:t.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${t.name}".`),t.options=se(j(t,"addOptions",{name:t.name})),t.storage=se(j(t,"addStorage",{name:t.name,options:t.options})),t}}function Ey(n,e,t){const{from:r,to:i}=e,{blockSeparator:s=`

`,textSerializers:o={}}=t||{};let a="";return n.nodesBetween(r,i,(l,c,u,d)=>{var h;l.isBlock&&c>r&&(a+=s);const m=o==null?void 0:o[l.type.name];if(m)return u&&(a+=m({node:l,pos:c,parent:u,index:d,range:e})),!1;l.isText&&(a+=(h=l==null?void 0:l.text)===null||h===void 0?void 0:h.slice(Math.max(r,c)-c,i-c))}),a}function Ty(n){return Object.fromEntries(Object.entries(n.nodes).filter(([,e])=>e.spec.toText).map(([e,t])=>[e,t.spec.toText]))}const z2=et.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new nt({key:new Lt("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:n}=this,{state:e,schema:t}=n,{doc:r,selection:i}=e,{ranges:s}=i,o=Math.min(...s.map(u=>u.$from.pos)),a=Math.max(...s.map(u=>u.$to.pos)),l=Ty(t);return Ey(r,{from:o,to:a},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:l})}}})]}}),H2=()=>({editor:n,view:e})=>(requestAnimationFrame(()=>{var t;n.isDestroyed||(e.dom.blur(),(t=window==null?void 0:window.getSelection())===null||t===void 0||t.removeAllRanges())}),!0),G2=(n=!1)=>({commands:e})=>e.setContent("",n),U2=()=>({state:n,tr:e,dispatch:t})=>{const{selection:r}=e,{ranges:i}=r;return t&&i.forEach(({$from:s,$to:o})=>{n.doc.nodesBetween(s.pos,o.pos,(a,l)=>{if(a.type.isText)return;const{doc:c,mapping:u}=e,d=c.resolve(u.map(l)),h=c.resolve(u.map(l+a.nodeSize)),m=d.blockRange(h);if(!m)return;const p=Oi(m);if(a.type.isTextblock){const{defaultType:g}=d.parent.contentMatchAt(d.index());e.setNodeMarkup(m.start,g)}(p||p===0)&&e.lift(m,p)})}),!0},W2=n=>e=>n(e),K2=()=>({state:n,dispatch:e})=>p2(n,e),Y2=(n,e)=>({editor:t,tr:r})=>{const{state:i}=t,s=i.doc.slice(n.from,n.to);r.deleteRange(n.from,n.to);const o=r.mapping.map(e);return r.insert(o,s.content),r.setSelection(new ne(r.doc.resolve(o-1))),!0},q2=()=>({tr:n,dispatch:e})=>{const{selection:t}=n,r=t.$anchor.node();if(r.content.size>0)return!1;const i=n.selection.$anchor;for(let s=i.depth;s>0;s-=1)if(i.node(s).type===r.type){if(e){const a=i.before(s),l=i.after(s);n.delete(a,l).scrollIntoView()}return!0}return!1},X2=n=>({tr:e,state:t,dispatch:r})=>{const i=Ye(n,t.schema),s=e.selection.$anchor;for(let o=s.depth;o>0;o-=1)if(s.node(o).type===i){if(r){const l=s.before(o),c=s.after(o);e.delete(l,c).scrollIntoView()}return!0}return!1},J2=n=>({tr:e,dispatch:t})=>{const{from:r,to:i}=n;return t&&e.delete(r,i),!0},Q2=()=>({state:n,dispatch:e})=>n2(n,e),Z2=()=>({commands:n})=>n.keyboardShortcut("Enter"),eM=()=>({state:n,dispatch:e})=>h2(n,e);function Ga(n,e,t={strict:!0}){const r=Object.keys(e);return r.length?r.every(i=>t.strict?e[i]===n[i]:Uu(e[i])?e[i].test(n[i]):e[i]===n[i]):!0}function Oy(n,e,t={}){return n.find(r=>r.type===e&&Ga(Object.fromEntries(Object.keys(t).map(i=>[i,r.attrs[i]])),t))}function Ny(n,e,t={}){return!!Oy(n,e,t)}function Wu(n,e,t){var r;if(!n||!e)return;let i=n.parent.childAfter(n.parentOffset);if((!i.node||!i.node.marks.some(u=>u.type===e))&&(i=n.parent.childBefore(n.parentOffset)),!i.node||!i.node.marks.some(u=>u.type===e)||(t=t||((r=i.node.marks[0])===null||r===void 0?void 0:r.attrs),!Oy([...i.node.marks],e,t)))return;let o=i.index,a=n.start()+i.offset,l=o+1,c=a+i.node.nodeSize;for(;o>0&&Ny([...n.parent.child(o-1).marks],e,t);)o-=1,a-=n.parent.child(o).nodeSize;for(;l<n.parent.childCount&&Ny([...n.parent.child(l).marks],e,t);)c+=n.parent.child(l).nodeSize,l+=1;return{from:a,to:c}}function wr(n,e){if(typeof n=="string"){if(!e.marks[n])throw Error(`There is no mark type named '${n}'. Maybe you forgot to add the extension?`);return e.marks[n]}return n}const tM=(n,e={})=>({tr:t,state:r,dispatch:i})=>{const s=wr(n,r.schema),{doc:o,selection:a}=t,{$from:l,from:c,to:u}=a;if(i){const d=Wu(l,s,e);if(d&&d.from<=c&&d.to>=u){const h=ne.create(o,d.from,d.to);t.setSelection(h)}}return!0},nM=n=>e=>{const t=typeof n=="function"?n(e):n;for(let r=0;r<t.length;r+=1)if(t[r](e))return!0;return!1};function Ku(n){return n instanceof ne}function Rn(n=0,e=0,t=0){return Math.min(Math.max(n,e),t)}function My(n,e=null){if(!e)return null;const t=re.atStart(n),r=re.atEnd(n);if(e==="start"||e===!0)return t;if(e==="end")return r;const i=t.from,s=r.to;return e==="all"?ne.create(n,Rn(0,i,s),Rn(n.content.size,i,s)):ne.create(n,Rn(e,i,s),Rn(e,i,s))}function Yu(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}const rM=(n=null,e={})=>({editor:t,view:r,tr:i,dispatch:s})=>{e={scrollIntoView:!0,...e};const o=()=>{Yu()&&r.dom.focus(),requestAnimationFrame(()=>{t.isDestroyed||(r.focus(),e!=null&&e.scrollIntoView&&t.commands.scrollIntoView())})};if(r.hasFocus()&&n===null||n===!1)return!0;if(s&&n===null&&!Ku(t.state.selection))return o(),!0;const a=My(i.doc,n)||t.state.selection,l=t.state.selection.eq(a);return s&&(l||i.setSelection(a),l&&i.storedMarks&&i.setStoredMarks(i.storedMarks),o()),!0},iM=(n,e)=>t=>n.every((r,i)=>e(r,{...t,index:i})),sM=(n,e)=>({tr:t,commands:r})=>r.insertContentAt({from:t.selection.from,to:t.selection.to},n,e),Ay=n=>{const e=n.childNodes;for(let t=e.length-1;t>=0;t-=1){const r=e[t];r.nodeType===3&&r.nodeValue&&/^(\n\s\s|\n)$/.test(r.nodeValue)?n.removeChild(r):r.nodeType===1&&Ay(r)}return n};function Ua(n){const e=`<body>${n}</body>`,t=new window.DOMParser().parseFromString(e,"text/html").body;return Ay(t)}function Wa(n,e,t){if(n instanceof sr||n instanceof I)return n;t={slice:!0,parseOptions:{},...t};const r=typeof n=="object"&&n!==null,i=typeof n=="string";if(r)try{if(Array.isArray(n)&&n.length>0)return I.fromArray(n.map(a=>e.nodeFromJSON(a)));const o=e.nodeFromJSON(n);return t.errorOnInvalidContent&&o.check(),o}catch(s){if(t.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:s});return console.warn("[tiptap warn]: Invalid content.","Passed value:",n,"Error:",s),Wa("",e,t)}if(i){if(t.errorOnInvalidContent){let o=!1,a="";const l=new Cm({topNode:e.spec.topNode,marks:e.spec.marks,nodes:e.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:c=>(o=!0,a=typeof c=="string"?c:c.outerHTML,null)}]}})});if(t.slice?or.fromSchema(l).parseSlice(Ua(n),t.parseOptions):or.fromSchema(l).parse(Ua(n),t.parseOptions),t.errorOnInvalidContent&&o)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${a}`)})}const s=or.fromSchema(e);return t.slice?s.parseSlice(Ua(n),t.parseOptions).content:s.parse(Ua(n),t.parseOptions)}return Wa("",e,t)}function oM(n,e,t){const r=n.steps.length-1;if(r<e)return;const i=n.steps[r];if(!(i instanceof We||i instanceof Ke))return;const s=n.mapping.maps[r];let o=0;s.forEach((a,l,c,u)=>{o===0&&(o=u)}),n.setSelection(re.near(n.doc.resolve(o),t))}const aM=n=>!("type"in n),lM=(n,e,t)=>({tr:r,dispatch:i,editor:s})=>{var o;if(i){t={parseOptions:s.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...t};let a;try{a=Wa(e,s.schema,{parseOptions:{preserveWhitespace:"full",...t.parseOptions},errorOnInvalidContent:(o=t.errorOnInvalidContent)!==null&&o!==void 0?o:s.options.enableContentCheck})}catch(p){return s.emit("contentError",{editor:s,error:p,disableCollaboration:()=>{s.storage.collaboration&&(s.storage.collaboration.isDisabled=!0)}}),!1}let{from:l,to:c}=typeof n=="number"?{from:n,to:n}:{from:n.from,to:n.to},u=!0,d=!0;if((aM(a)?a:[a]).forEach(p=>{p.check(),u=u?p.isText&&p.marks.length===0:!1,d=d?p.isBlock:!1}),l===c&&d){const{parent:p}=r.doc.resolve(l);p.isTextblock&&!p.type.spec.code&&!p.childCount&&(l-=1,c+=1)}let m;if(u){if(Array.isArray(e))m=e.map(p=>p.text||"").join("");else if(e instanceof I){let p="";e.forEach(g=>{g.text&&(p+=g.text)}),m=p}else typeof e=="object"&&e&&e.text?m=e.text:m=e;r.insertText(m,l,c)}else m=a,r.replaceWith(l,c,m);t.updateSelection&&oM(r,r.steps.length-1,-1),t.applyInputRules&&r.setMeta("applyInputRules",{from:l,text:m}),t.applyPasteRules&&r.setMeta("applyPasteRules",{from:l,text:m})}return!0},cM=()=>({state:n,dispatch:e})=>c2(n,e),uM=()=>({state:n,dispatch:e})=>u2(n,e),fM=()=>({state:n,dispatch:e})=>r2(n,e),dM=()=>({state:n,dispatch:e})=>a2(n,e),hM=()=>({state:n,dispatch:e,tr:t})=>{try{const r=xa(n.doc,n.selection.$from.pos,-1);return r==null?!1:(t.join(r,2),e&&e(t),!0)}catch{return!1}},pM=()=>({state:n,dispatch:e,tr:t})=>{try{const r=xa(n.doc,n.selection.$from.pos,1);return r==null?!1:(t.join(r,2),e&&e(t),!0)}catch{return!1}},mM=()=>({state:n,dispatch:e})=>i2(n,e),gM=()=>({state:n,dispatch:e})=>s2(n,e);function Py(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function yM(n){const e=n.split(/-(?!$)/);let t=e[e.length-1];t==="Space"&&(t=" ");let r,i,s,o;for(let a=0;a<e.length-1;a+=1){const l=e[a];if(/^(cmd|meta|m)$/i.test(l))o=!0;else if(/^a(lt)?$/i.test(l))r=!0;else if(/^(c|ctrl|control)$/i.test(l))i=!0;else if(/^s(hift)?$/i.test(l))s=!0;else if(/^mod$/i.test(l))Yu()||Py()?o=!0:i=!0;else throw new Error(`Unrecognized modifier name: ${l}`)}return r&&(t=`Alt-${t}`),i&&(t=`Ctrl-${t}`),o&&(t=`Meta-${t}`),s&&(t=`Shift-${t}`),t}const bM=n=>({editor:e,view:t,tr:r,dispatch:i})=>{const s=yM(n).split(/-(?!$)/),o=s.find(c=>!["Alt","Ctrl","Meta","Shift"].includes(c)),a=new KeyboardEvent("keydown",{key:o==="Space"?" ":o,altKey:s.includes("Alt"),ctrlKey:s.includes("Ctrl"),metaKey:s.includes("Meta"),shiftKey:s.includes("Shift"),bubbles:!0,cancelable:!0}),l=e.captureTransaction(()=>{t.someProp("handleKeyDown",c=>c(t,a))});return l==null||l.steps.forEach(c=>{const u=c.map(r.mapping);u&&i&&r.maybeStep(u)}),!0};function io(n,e,t={}){const{from:r,to:i,empty:s}=n.selection,o=e?Ye(e,n.schema):null,a=[];n.doc.nodesBetween(r,i,(d,h)=>{if(d.isText)return;const m=Math.max(r,h),p=Math.min(i,h+d.nodeSize);a.push({node:d,from:m,to:p})});const l=i-r,c=a.filter(d=>o?o.name===d.node.type.name:!0).filter(d=>Ga(d.node.attrs,t,{strict:!1}));return s?!!c.length:c.reduce((d,h)=>d+h.to-h.from,0)>=l}const vM=(n,e={})=>({state:t,dispatch:r})=>{const i=Ye(n,t.schema);return io(t,i,e)?f2(t,r):!1},wM=()=>({state:n,dispatch:e})=>m2(n,e),CM=n=>({state:e,dispatch:t})=>{const r=Ye(n,e.schema);return S2(r)(e,t)},kM=()=>({state:n,dispatch:e})=>d2(n,e);function Ka(n,e){return e.nodes[n]?"node":e.marks[n]?"mark":null}function Iy(n,e){const t=typeof e=="string"?[e]:e;return Object.keys(n).reduce((r,i)=>(t.includes(i)||(r[i]=n[i]),r),{})}const SM=(n,e)=>({tr:t,state:r,dispatch:i})=>{let s=null,o=null;const a=Ka(typeof n=="string"?n:n.name,r.schema);return a?(a==="node"&&(s=Ye(n,r.schema)),a==="mark"&&(o=wr(n,r.schema)),i&&t.selection.ranges.forEach(l=>{r.doc.nodesBetween(l.$from.pos,l.$to.pos,(c,u)=>{s&&s===c.type&&t.setNodeMarkup(u,void 0,Iy(c.attrs,e)),o&&c.marks.length&&c.marks.forEach(d=>{o===d.type&&t.addMark(u,u+c.nodeSize,o.create(Iy(d.attrs,e)))})})}),!0):!1},xM=()=>({tr:n,dispatch:e})=>(e&&n.scrollIntoView(),!0),_M=()=>({tr:n,commands:e})=>e.setTextSelection({from:0,to:n.doc.content.size}),EM=()=>({state:n,dispatch:e})=>o2(n,e),TM=()=>({state:n,dispatch:e})=>l2(n,e),OM=()=>({state:n,dispatch:e})=>g2(n,e),NM=()=>({state:n,dispatch:e})=>v2(n,e),MM=()=>({state:n,dispatch:e})=>b2(n,e);function qu(n,e,t={},r={}){return Wa(n,e,{slice:!1,parseOptions:t,errorOnInvalidContent:r.errorOnInvalidContent})}const AM=(n,e=!1,t={},r={})=>({editor:i,tr:s,dispatch:o,commands:a})=>{var l,c;const{doc:u}=s;if(t.preserveWhitespace!=="full"){const d=qu(n,i.schema,t,{errorOnInvalidContent:(l=r.errorOnInvalidContent)!==null&&l!==void 0?l:i.options.enableContentCheck});return o&&s.replaceWith(0,u.content.size,d).setMeta("preventUpdate",!e),!0}return o&&s.setMeta("preventUpdate",!e),a.insertContentAt({from:0,to:u.content.size},n,{parseOptions:t,errorOnInvalidContent:(c=r.errorOnInvalidContent)!==null&&c!==void 0?c:i.options.enableContentCheck})};function Dy(n,e){const t=wr(e,n.schema),{from:r,to:i,empty:s}=n.selection,o=[];s?(n.storedMarks&&o.push(...n.storedMarks),o.push(...n.selection.$head.marks())):n.doc.nodesBetween(r,i,l=>{o.push(...l.marks)});const a=o.find(l=>l.type.name===t.name);return a?{...a.attrs}:{}}function PM(n){for(let e=0;e<n.edgeCount;e+=1){const{type:t}=n.edge(e);if(t.isTextblock&&!t.hasRequiredAttrs())return t}return null}function IM(n,e){for(let t=n.depth;t>0;t-=1){const r=n.node(t);if(e(r))return{pos:t>0?n.before(t):0,start:n.start(t),depth:t,node:r}}}function Xu(n){return e=>IM(e.$from,n)}function DM(n,e){const t={from:0,to:n.content.size};return Ey(n,t,e)}function LM(n,e){const t=Ye(e,n.schema),{from:r,to:i}=n.selection,s=[];n.doc.nodesBetween(r,i,a=>{s.push(a)});const o=s.reverse().find(a=>a.type.name===t.name);return o?{...o.attrs}:{}}function RM(n,e){const t=Ka(typeof e=="string"?e:e.name,n.schema);return t==="node"?LM(n,e):t==="mark"?Dy(n,e):{}}function Ly(n,e,t){const r=[];return n===e?t.resolve(n).marks().forEach(i=>{const s=t.resolve(n),o=Wu(s,i.type);o&&r.push({mark:i,...o})}):t.nodesBetween(n,e,(i,s)=>{!i||(i==null?void 0:i.nodeSize)===void 0||r.push(...i.marks.map(o=>({from:s,to:s+i.nodeSize,mark:o})))}),r}function Ya(n,e,t){return Object.fromEntries(Object.entries(t).filter(([r])=>{const i=n.find(s=>s.type===e&&s.name===r);return i?i.attribute.keepOnSplit:!1}))}function Ju(n,e,t={}){const{empty:r,ranges:i}=n.selection,s=e?wr(e,n.schema):null;if(r)return!!(n.storedMarks||n.selection.$from.marks()).filter(d=>s?s.name===d.type.name:!0).find(d=>Ga(d.attrs,t,{strict:!1}));let o=0;const a=[];if(i.forEach(({$from:d,$to:h})=>{const m=d.pos,p=h.pos;n.doc.nodesBetween(m,p,(g,y)=>{if(!g.isText&&!g.marks.length)return;const v=Math.max(m,y),C=Math.min(p,y+g.nodeSize),w=C-v;o+=w,a.push(...g.marks.map(b=>({mark:b,from:v,to:C})))})}),o===0)return!1;const l=a.filter(d=>s?s.name===d.mark.type.name:!0).filter(d=>Ga(d.mark.attrs,t,{strict:!1})).reduce((d,h)=>d+h.to-h.from,0),c=a.filter(d=>s?d.mark.type!==s&&d.mark.type.excludes(s):!0).reduce((d,h)=>d+h.to-h.from,0);return(l>0?l+c:l)>=o}function FM(n,e,t={}){if(!e)return io(n,null,t)||Ju(n,null,t);const r=Ka(e,n.schema);return r==="node"?io(n,e,t):r==="mark"?Ju(n,e,t):!1}function Ry(n,e){const{nodeExtensions:t}=Va(e),r=t.find(o=>o.name===n);if(!r)return!1;const i={name:r.name,options:r.options,storage:r.storage},s=se(j(r,"group",i));return typeof s!="string"?!1:s.split(" ").includes("list")}function Qu(n,{checkChildren:e=!0,ignoreWhitespace:t=!1}={}){var r;if(t){if(n.type.name==="hardBreak")return!0;if(n.isText)return/^\s*$/m.test((r=n.text)!==null&&r!==void 0?r:"")}if(n.isText)return!n.text;if(n.isAtom||n.isLeaf)return!1;if(n.content.childCount===0)return!0;if(e){let i=!0;return n.content.forEach(s=>{i!==!1&&(Qu(s,{ignoreWhitespace:t,checkChildren:e})||(i=!1))}),i}return!1}function Fy(n){return n instanceof q}function By(n,e,t){const i=n.state.doc.content.size,s=Rn(e,0,i),o=Rn(t,0,i),a=n.coordsAtPos(s),l=n.coordsAtPos(o,-1),c=Math.min(a.top,l.top),u=Math.max(a.bottom,l.bottom),d=Math.min(a.left,l.left),h=Math.max(a.right,l.right),m=h-d,p=u-c,v={top:c,bottom:u,left:d,right:h,width:m,height:p,x:d,y:c};return{...v,toJSON:()=>v}}function BM(n,e,t){var r;const{selection:i}=e;let s=null;if(Ku(i)&&(s=i.$cursor),s){const a=(r=n.storedMarks)!==null&&r!==void 0?r:s.marks();return!!t.isInSet(a)||!a.some(l=>l.type.excludes(t))}const{ranges:o}=i;return o.some(({$from:a,$to:l})=>{let c=a.depth===0?n.doc.inlineContent&&n.doc.type.allowsMarkType(t):!1;return n.doc.nodesBetween(a.pos,l.pos,(u,d,h)=>{if(c)return!1;if(u.isInline){const m=!h||h.type.allowsMarkType(t),p=!!t.isInSet(u.marks)||!u.marks.some(g=>g.type.excludes(t));c=m&&p}return!c}),c})}const VM=(n,e={})=>({tr:t,state:r,dispatch:i})=>{const{selection:s}=t,{empty:o,ranges:a}=s,l=wr(n,r.schema);if(i)if(o){const c=Dy(r,l);t.addStoredMark(l.create({...c,...e}))}else a.forEach(c=>{const u=c.$from.pos,d=c.$to.pos;r.doc.nodesBetween(u,d,(h,m)=>{const p=Math.max(m,u),g=Math.min(m+h.nodeSize,d);h.marks.find(v=>v.type===l)?h.marks.forEach(v=>{l===v.type&&t.addMark(p,g,l.create({...v.attrs,...e}))}):t.addMark(p,g,l.create(e))})});return BM(r,t,l)},$M=(n,e)=>({tr:t})=>(t.setMeta(n,e),!0),jM=(n,e={})=>({state:t,dispatch:r,chain:i})=>{const s=Ye(n,t.schema);let o;return t.selection.$anchor.sameParent(t.selection.$head)&&(o=t.selection.$anchor.parent.attrs),s.isTextblock?i().command(({commands:a})=>wy(s,{...o,...e})(t)?!0:a.clearNodes()).command(({state:a})=>wy(s,{...o,...e})(a,r)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},zM=n=>({tr:e,dispatch:t})=>{if(t){const{doc:r}=e,i=Rn(n,0,r.content.size),s=q.create(r,i);e.setSelection(s)}return!0},HM=n=>({tr:e,dispatch:t})=>{if(t){const{doc:r}=e,{from:i,to:s}=typeof n=="number"?{from:n,to:n}:n,o=ne.atStart(r).from,a=ne.atEnd(r).to,l=Rn(i,o,a),c=Rn(s,o,a),u=ne.create(r,l,c);e.setSelection(u)}return!0},GM=n=>({state:e,dispatch:t})=>{const r=Ye(n,e.schema);return E2(r)(e,t)};function Vy(n,e){const t=n.storedMarks||n.selection.$to.parentOffset&&n.selection.$from.marks();if(t){const r=t.filter(i=>e==null?void 0:e.includes(i.type.name));n.tr.ensureMarks(r)}}const UM=({keepMarks:n=!0}={})=>({tr:e,state:t,dispatch:r,editor:i})=>{const{selection:s,doc:o}=e,{$from:a,$to:l}=s,c=i.extensionManager.attributes,u=Ya(c,a.node().type.name,a.node().attrs);if(s instanceof q&&s.node.isBlock)return!a.parentOffset||!Ni(o,a.pos)?!1:(r&&(n&&Vy(t,i.extensionManager.splittableMarks),e.split(a.pos).scrollIntoView()),!0);if(!a.parent.isBlock)return!1;const d=l.parentOffset===l.parent.content.size,h=a.depth===0?void 0:PM(a.node(-1).contentMatchAt(a.indexAfter(-1)));let m=d&&h?[{type:h,attrs:u}]:void 0,p=Ni(e.doc,e.mapping.map(a.pos),1,m);if(!m&&!p&&Ni(e.doc,e.mapping.map(a.pos),1,h?[{type:h}]:void 0)&&(p=!0,m=h?[{type:h,attrs:u}]:void 0),r){if(p&&(s instanceof ne&&e.deleteSelection(),e.split(e.mapping.map(a.pos),1,m),h&&!d&&!a.parentOffset&&a.parent.type!==h)){const g=e.mapping.map(a.before()),y=e.doc.resolve(g);a.node(-1).canReplaceWith(y.index(),y.index()+1,h)&&e.setNodeMarkup(e.mapping.map(a.before()),h)}n&&Vy(t,i.extensionManager.splittableMarks),e.scrollIntoView()}return p},WM=(n,e={})=>({tr:t,state:r,dispatch:i,editor:s})=>{var o;const a=Ye(n,r.schema),{$from:l,$to:c}=r.selection,u=r.selection.node;if(u&&u.isBlock||l.depth<2||!l.sameParent(c))return!1;const d=l.node(-1);if(d.type!==a)return!1;const h=s.extensionManager.attributes;if(l.parent.content.size===0&&l.node(-1).childCount===l.indexAfter(-1)){if(l.depth===2||l.node(-3).type!==a||l.index(-2)!==l.node(-2).childCount-1)return!1;if(i){let v=I.empty;const C=l.index(-1)?1:l.index(-2)?2:3;for(let O=l.depth-C;O>=l.depth-3;O-=1)v=I.from(l.node(O).copy(v));const w=l.indexAfter(-1)<l.node(-2).childCount?1:l.indexAfter(-2)<l.node(-3).childCount?2:3,b={...Ya(h,l.node().type.name,l.node().attrs),...e},E=((o=a.contentMatch.defaultType)===null||o===void 0?void 0:o.createAndFill(b))||void 0;v=v.append(I.from(a.createAndFill(null,E)||void 0));const k=l.before(l.depth-(C-1));t.replace(k,l.after(-w),new V(v,4-C,0));let x=-1;t.doc.nodesBetween(k,t.doc.content.size,(O,T)=>{if(x>-1)return!1;O.isTextblock&&O.content.size===0&&(x=T+1)}),x>-1&&t.setSelection(ne.near(t.doc.resolve(x))),t.scrollIntoView()}return!0}const m=c.pos===l.end()?d.contentMatchAt(0).defaultType:null,p={...Ya(h,d.type.name,d.attrs),...e},g={...Ya(h,l.node().type.name,l.node().attrs),...e};t.delete(l.pos,c.pos);const y=m?[{type:a,attrs:p},{type:m,attrs:g}]:[{type:a,attrs:p}];if(!Ni(t.doc,l.pos,2))return!1;if(i){const{selection:v,storedMarks:C}=r,{splittableMarks:w}=s.extensionManager,b=C||v.$to.parentOffset&&v.$from.marks();if(t.split(l.pos,2,y).scrollIntoView(),!b||!i)return!0;const E=b.filter(k=>w.includes(k.type.name));t.ensureMarks(E)}return!0},Zu=(n,e)=>{const t=Xu(o=>o.type===e)(n.selection);if(!t)return!0;const r=n.doc.resolve(Math.max(0,t.pos-1)).before(t.depth);if(r===void 0)return!0;const i=n.doc.nodeAt(r);return t.node.type===(i==null?void 0:i.type)&&cr(n.doc,t.pos)&&n.join(t.pos),!0},ef=(n,e)=>{const t=Xu(o=>o.type===e)(n.selection);if(!t)return!0;const r=n.doc.resolve(t.start).after(t.depth);if(r===void 0)return!0;const i=n.doc.nodeAt(r);return t.node.type===(i==null?void 0:i.type)&&cr(n.doc,r)&&n.join(r),!0};var KM=Object.freeze({__proto__:null,blur:H2,clearContent:G2,clearNodes:U2,command:W2,createParagraphNear:K2,cut:Y2,deleteCurrentNode:q2,deleteNode:X2,deleteRange:J2,deleteSelection:Q2,enter:Z2,exitCode:eM,extendMarkRange:tM,first:nM,focus:rM,forEach:iM,insertContent:sM,insertContentAt:lM,joinBackward:fM,joinDown:uM,joinForward:dM,joinItemBackward:hM,joinItemForward:pM,joinTextblockBackward:mM,joinTextblockForward:gM,joinUp:cM,keyboardShortcut:bM,lift:vM,liftEmptyBlock:wM,liftListItem:CM,newlineInCode:kM,resetAttributes:SM,scrollIntoView:xM,selectAll:_M,selectNodeBackward:EM,selectNodeForward:TM,selectParentNode:OM,selectTextblockEnd:NM,selectTextblockStart:MM,setContent:AM,setMark:VM,setMeta:$M,setNode:jM,setNodeSelection:zM,setTextSelection:HM,sinkListItem:GM,splitBlock:UM,splitListItem:WM,toggleList:(n,e,t,r={})=>({editor:i,tr:s,state:o,dispatch:a,chain:l,commands:c,can:u})=>{const{extensions:d,splittableMarks:h}=i.extensionManager,m=Ye(n,o.schema),p=Ye(e,o.schema),{selection:g,storedMarks:y}=o,{$from:v,$to:C}=g,w=v.blockRange(C),b=y||g.$to.parentOffset&&g.$from.marks();if(!w)return!1;const E=Xu(k=>Ry(k.type.name,d))(g);if(w.depth>=1&&E&&w.depth-E.depth<=1){if(E.node.type===m)return c.liftListItem(p);if(Ry(E.node.type.name,d)&&m.validContent(E.node.content)&&a)return l().command(()=>(s.setNodeMarkup(E.pos,m),!0)).command(()=>Zu(s,m)).command(()=>ef(s,m)).run()}return!t||!b||!a?l().command(()=>u().wrapInList(m,r)?!0:c.clearNodes()).wrapInList(m,r).command(()=>Zu(s,m)).command(()=>ef(s,m)).run():l().command(()=>{const k=u().wrapInList(m,r),x=b.filter(O=>h.includes(O.type.name));return s.ensureMarks(x),k?!0:c.clearNodes()}).wrapInList(m,r).command(()=>Zu(s,m)).command(()=>ef(s,m)).run()},toggleMark:(n,e={},t={})=>({state:r,commands:i})=>{const{extendEmptyMarkRange:s=!1}=t,o=wr(n,r.schema);return Ju(r,o,e)?i.unsetMark(o,{extendEmptyMarkRange:s}):i.setMark(o,e)},toggleNode:(n,e,t={})=>({state:r,commands:i})=>{const s=Ye(n,r.schema),o=Ye(e,r.schema),a=io(r,s,t);let l;return r.selection.$anchor.sameParent(r.selection.$head)&&(l=r.selection.$anchor.parent.attrs),a?i.setNode(o,l):i.setNode(s,{...l,...t})},toggleWrap:(n,e={})=>({state:t,commands:r})=>{const i=Ye(n,t.schema);return io(t,i,e)?r.lift(i):r.wrapIn(i,e)},undoInputRule:()=>({state:n,dispatch:e})=>{const t=n.plugins;for(let r=0;r<t.length;r+=1){const i=t[r];let s;if(i.spec.isInputRules&&(s=i.getState(n))){if(e){const o=n.tr,a=s.transform;for(let l=a.steps.length-1;l>=0;l-=1)o.step(a.steps[l].invert(a.docs[l]));if(s.text){const l=o.doc.resolve(s.from).marks();o.replaceWith(s.from,s.to,n.schema.text(s.text,l))}else o.delete(s.from,s.to)}return!0}}return!1},unsetAllMarks:()=>({tr:n,dispatch:e})=>{const{selection:t}=n,{empty:r,ranges:i}=t;return r||e&&i.forEach(s=>{n.removeMark(s.$from.pos,s.$to.pos)}),!0},unsetMark:(n,e={})=>({tr:t,state:r,dispatch:i})=>{var s;const{extendEmptyMarkRange:o=!1}=e,{selection:a}=t,l=wr(n,r.schema),{$from:c,empty:u,ranges:d}=a;if(!i)return!0;if(u&&o){let{from:h,to:m}=a;const p=(s=c.marks().find(y=>y.type===l))===null||s===void 0?void 0:s.attrs,g=Wu(c,l,p);g&&(h=g.from,m=g.to),t.removeMark(h,m,l)}else d.forEach(h=>{t.removeMark(h.$from.pos,h.$to.pos,l)});return t.removeStoredMark(l),!0},updateAttributes:(n,e={})=>({tr:t,state:r,dispatch:i})=>{let s=null,o=null;const a=Ka(typeof n=="string"?n:n.name,r.schema);return a?(a==="node"&&(s=Ye(n,r.schema)),a==="mark"&&(o=wr(n,r.schema)),i&&t.selection.ranges.forEach(l=>{const c=l.$from.pos,u=l.$to.pos;let d,h,m,p;t.selection.empty?r.doc.nodesBetween(c,u,(g,y)=>{s&&s===g.type&&(m=Math.max(y,c),p=Math.min(y+g.nodeSize,u),d=y,h=g)}):r.doc.nodesBetween(c,u,(g,y)=>{y<c&&s&&s===g.type&&(m=Math.max(y,c),p=Math.min(y+g.nodeSize,u),d=y,h=g),y>=c&&y<=u&&(s&&s===g.type&&t.setNodeMarkup(y,void 0,{...g.attrs,...e}),o&&g.marks.length&&g.marks.forEach(v=>{if(o===v.type){const C=Math.max(y,c),w=Math.min(y+g.nodeSize,u);t.addMark(C,w,o.create({...v.attrs,...e}))}}))}),h&&(d!==void 0&&t.setNodeMarkup(d,void 0,{...h.attrs,...e}),o&&h.marks.length&&h.marks.forEach(g=>{o===g.type&&t.addMark(m,p,o.create({...g.attrs,...e}))}))}),!0):!1},wrapIn:(n,e={})=>({state:t,dispatch:r})=>{const i=Ye(n,t.schema);return w2(i,e)(t,r)},wrapInList:(n,e={})=>({state:t,dispatch:r})=>{const i=Ye(n,t.schema);return C2(i,e)(t,r)}});const YM=et.create({name:"commands",addCommands(){return{...KM}}}),qM=et.create({name:"drop",addProseMirrorPlugins(){return[new nt({key:new Lt("tiptapDrop"),props:{handleDrop:(n,e,t,r)=>{this.editor.emit("drop",{editor:this.editor,event:e,slice:t,moved:r})}}})]}}),XM=et.create({name:"editable",addProseMirrorPlugins(){return[new nt({key:new Lt("editable"),props:{editable:()=>this.editor.options.editable}})]}}),JM=et.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:n}=this;return[new nt({key:new Lt("focusEvents"),props:{handleDOMEvents:{focus:(e,t)=>{n.isFocused=!0;const r=n.state.tr.setMeta("focus",{event:t}).setMeta("addToHistory",!1);return e.dispatch(r),!1},blur:(e,t)=>{n.isFocused=!1;const r=n.state.tr.setMeta("blur",{event:t}).setMeta("addToHistory",!1);return e.dispatch(r),!1}}}})]}}),QM=et.create({name:"keymap",addKeyboardShortcuts(){const n=()=>this.editor.commands.first(({commands:o})=>[()=>o.undoInputRule(),()=>o.command(({tr:a})=>{const{selection:l,doc:c}=a,{empty:u,$anchor:d}=l,{pos:h,parent:m}=d,p=d.parent.isTextblock&&h>0?a.doc.resolve(h-1):d,g=p.parent.type.spec.isolating,y=d.pos-d.parentOffset,v=g&&p.parent.childCount===1?y===d.pos:re.atStart(c).from===h;return!u||!m.type.isTextblock||m.textContent.length||!v||v&&d.parent.type.name==="paragraph"?!1:o.clearNodes()}),()=>o.deleteSelection(),()=>o.joinBackward(),()=>o.selectNodeBackward()]),e=()=>this.editor.commands.first(({commands:o})=>[()=>o.deleteSelection(),()=>o.deleteCurrentNode(),()=>o.joinForward(),()=>o.selectNodeForward()]),r={Enter:()=>this.editor.commands.first(({commands:o})=>[()=>o.newlineInCode(),()=>o.createParagraphNear(),()=>o.liftEmptyBlock(),()=>o.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:n,"Mod-Backspace":n,"Shift-Backspace":n,Delete:e,"Mod-Delete":e,"Mod-a":()=>this.editor.commands.selectAll()},i={...r},s={...r,"Ctrl-h":n,"Alt-Backspace":n,"Ctrl-d":e,"Ctrl-Alt-Backspace":e,"Alt-Delete":e,"Alt-d":e,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return Yu()||Py()?s:i},addProseMirrorPlugins(){return[new nt({key:new Lt("clearDocument"),appendTransaction:(n,e,t)=>{const r=n.some(g=>g.docChanged)&&!e.doc.eq(t.doc),i=n.some(g=>g.getMeta("preventClearDocument"));if(!r||i)return;const{empty:s,from:o,to:a}=e.selection,l=re.atStart(e.doc).from,c=re.atEnd(e.doc).to;if(s||!(o===l&&a===c)||!Qu(t.doc))return;const h=t.tr,m=Fa({state:t,transaction:h}),{commands:p}=new Ba({editor:this.editor,state:m});if(p.clearNodes(),!!h.steps.length)return h}})]}}),ZM=et.create({name:"paste",addProseMirrorPlugins(){return[new nt({key:new Lt("tiptapPaste"),props:{handlePaste:(n,e,t)=>{this.editor.emit("paste",{editor:this.editor,event:e,slice:t})}}})]}}),eA=et.create({name:"tabindex",addProseMirrorPlugins(){return[new nt({key:new Lt("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}});class ti{get name(){return this.node.type.name}constructor(e,t,r=!1,i=null){this.currentNode=null,this.actualDepth=null,this.isBlock=r,this.resolvedPos=e,this.editor=t,this.currentNode=i}get node(){return this.currentNode||this.resolvedPos.node()}get element(){return this.editor.view.domAtPos(this.pos).node}get depth(){var e;return(e=this.actualDepth)!==null&&e!==void 0?e:this.resolvedPos.depth}get pos(){return this.resolvedPos.pos}get content(){return this.node.content}set content(e){let t=this.from,r=this.to;if(this.isBlock){if(this.content.size===0){console.error(`You can’t set content on a block node. Tried to set content on ${this.name} at ${this.pos}`);return}t=this.from+1,r=this.to-1}this.editor.commands.insertContentAt({from:t,to:r},e)}get attributes(){return this.node.attrs}get textContent(){return this.node.textContent}get size(){return this.node.nodeSize}get from(){return this.isBlock?this.pos:this.resolvedPos.start(this.resolvedPos.depth)}get range(){return{from:this.from,to:this.to}}get to(){return this.isBlock?this.pos+this.size:this.resolvedPos.end(this.resolvedPos.depth)+(this.node.isText?0:1)}get parent(){if(this.depth===0)return null;const e=this.resolvedPos.start(this.resolvedPos.depth-1),t=this.resolvedPos.doc.resolve(e);return new ti(t,this.editor)}get before(){let e=this.resolvedPos.doc.resolve(this.from-(this.isBlock?1:2));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.from-3)),new ti(e,this.editor)}get after(){let e=this.resolvedPos.doc.resolve(this.to+(this.isBlock?2:1));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.to+3)),new ti(e,this.editor)}get children(){const e=[];return this.node.content.forEach((t,r)=>{const i=t.isBlock&&!t.isTextblock,s=t.isAtom&&!t.isText,o=this.pos+r+(s?0:1),a=this.resolvedPos.doc.resolve(o);if(!i&&a.depth<=this.depth)return;const l=new ti(a,this.editor,i,i?t:null);i&&(l.actualDepth=this.depth+1),e.push(new ti(a,this.editor,i,i?t:null))}),e}get firstChild(){return this.children[0]||null}get lastChild(){const e=this.children;return e[e.length-1]||null}closest(e,t={}){let r=null,i=this.parent;for(;i&&!r;){if(i.node.type.name===e)if(Object.keys(t).length>0){const s=i.node.attrs,o=Object.keys(t);for(let a=0;a<o.length;a+=1){const l=o[a];if(s[l]!==t[l])break}}else r=i;i=i.parent}return r}querySelector(e,t={}){return this.querySelectorAll(e,t,!0)[0]||null}querySelectorAll(e,t={},r=!1){let i=[];if(!this.children||this.children.length===0)return i;const s=Object.keys(t);return this.children.forEach(o=>{r&&i.length>0||(o.node.type.name===e&&s.every(l=>t[l]===o.node.attrs[l])&&i.push(o),!(r&&i.length>0)&&(i=i.concat(o.querySelectorAll(e,t,r))))}),i}setAttribute(e){const{tr:t}=this.editor.state;t.setNodeMarkup(this.from,void 0,{...this.node.attrs,...e}),this.editor.view.dispatch(t)}}const tA=`.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
}

.ProseMirror [contenteditable="false"] {
  white-space: normal;
}

.ProseMirror [contenteditable="false"] [contenteditable="true"] {
  white-space: pre-wrap;
}

.ProseMirror pre {
  white-space: pre-wrap;
}

img.ProseMirror-separator {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
  width: 0 !important;
  height: 0 !important;
}

.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
  margin: 0;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-hideselection *::selection {
  background: transparent;
}

.ProseMirror-hideselection *::-moz-selection {
  background: transparent;
}

.ProseMirror-hideselection * {
  caret-color: transparent;
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}

.tippy-box[data-animation=fade][data-state=hidden] {
  opacity: 0
}`;function nA(n,e,t){const r=document.querySelector("style[data-tiptap-style]");if(r!==null)return r;const i=document.createElement("style");return e&&i.setAttribute("nonce",e),i.setAttribute("data-tiptap-style",""),i.innerHTML=n,document.getElementsByTagName("head")[0].appendChild(i),i}let rA=class extends T2{constructor(e={}){super(),this.isFocused=!1,this.isInitialized=!1,this.extensionStorage={},this.options={element:document.createElement("div"),content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,editorProps:{},parseOptions:{},coreExtensionOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,enableContentCheck:!1,onBeforeCreate:()=>null,onCreate:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null,onContentError:({error:t})=>{throw t},onPaste:()=>null,onDrop:()=>null},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.setOptions(e),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.on("contentError",this.options.onContentError),this.createView(),this.injectCSS(),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),this.on("drop",({event:t,slice:r,moved:i})=>this.options.onDrop(t,r,i)),this.on("paste",({event:t,slice:r})=>this.options.onPaste(t,r)),window.setTimeout(()=>{this.isDestroyed||(this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}),this.isInitialized=!0)},0)}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&document&&(this.css=nA(tA,this.options.injectNonce))}setOptions(e={}){this.options={...this.options,...e},!(!this.view||!this.state||this.isDestroyed)&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(e,t=!0){this.setOptions({editable:e}),t&&this.emit("update",{editor:this,transaction:this.state.tr})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get state(){return this.view.state}registerPlugin(e,t){const r=ky(t)?t(e,[...this.state.plugins]):[...this.state.plugins,e],i=this.state.reconfigure({plugins:r});return this.view.updateState(i),i}unregisterPlugin(e){if(this.isDestroyed)return;const t=this.state.plugins;let r=t;if([].concat(e).forEach(s=>{const o=typeof s=="string"?`${s}$`:s.key;r=t.filter(a=>!a.key.startsWith(o))}),t.length===r.length)return;const i=this.state.reconfigure({plugins:r});return this.view.updateState(i),i}createExtensionManager(){var e,t;const i=[...this.options.enableCoreExtensions?[XM,z2.configure({blockSeparator:(t=(e=this.options.coreExtensionOptions)===null||e===void 0?void 0:e.clipboardTextSerializer)===null||t===void 0?void 0:t.blockSeparator}),YM,JM,QM,eA,qM,ZM].filter(s=>typeof this.options.enableCoreExtensions=="object"?this.options.enableCoreExtensions[s.name]!==!1:!0):[],...this.options.extensions].filter(s=>["extension","node","mark"].includes(s==null?void 0:s.type));this.extensionManager=new $i(i,this)}createCommandManager(){this.commandManager=new Ba({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createView(){var e;let t;try{t=qu(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:this.options.enableContentCheck})}catch(o){if(!(o instanceof Error)||!["[tiptap error]: Invalid JSON content","[tiptap error]: Invalid HTML content"].includes(o.message))throw o;this.emit("contentError",{editor:this,error:o,disableCollaboration:()=>{this.storage.collaboration&&(this.storage.collaboration.isDisabled=!0),this.options.extensions=this.options.extensions.filter(a=>a.name!=="collaboration"),this.createExtensionManager()}}),t=qu(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:!1})}const r=My(t,this.options.autofocus);this.view=new WN(this.options.element,{...this.options.editorProps,attributes:{role:"textbox",...(e=this.options.editorProps)===null||e===void 0?void 0:e.attributes},dispatchTransaction:this.dispatchTransaction.bind(this),state:Ii.create({doc:t,selection:r||void 0})});const i=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(i),this.createNodeViews(),this.prependClass();const s=this.view.dom;s.editor=this}createNodeViews(){this.view.isDestroyed||this.view.setProps({nodeViews:this.extensionManager.nodeViews})}prependClass(){this.view.dom.className=`tiptap ${this.view.dom.className}`}captureTransaction(e){this.isCapturingTransaction=!0,e(),this.isCapturingTransaction=!1;const t=this.capturedTransaction;return this.capturedTransaction=null,t}dispatchTransaction(e){if(this.view.isDestroyed)return;if(this.isCapturingTransaction){if(!this.capturedTransaction){this.capturedTransaction=e;return}e.steps.forEach(o=>{var a;return(a=this.capturedTransaction)===null||a===void 0?void 0:a.step(o)});return}const t=this.state.apply(e),r=!this.state.selection.eq(t.selection);this.emit("beforeTransaction",{editor:this,transaction:e,nextState:t}),this.view.updateState(t),this.emit("transaction",{editor:this,transaction:e}),r&&this.emit("selectionUpdate",{editor:this,transaction:e});const i=e.getMeta("focus"),s=e.getMeta("blur");i&&this.emit("focus",{editor:this,event:i.event,transaction:e}),s&&this.emit("blur",{editor:this,event:s.event,transaction:e}),!(!e.docChanged||e.getMeta("preventUpdate"))&&this.emit("update",{editor:this,transaction:e})}getAttributes(e){return RM(this.state,e)}isActive(e,t){const r=typeof e=="string"?e:null,i=typeof e=="string"?t:e;return FM(this.state,r,i)}getJSON(){return this.state.doc.toJSON()}getHTML(){return Gu(this.state.doc.content,this.schema)}getText(e){const{blockSeparator:t=`

`,textSerializers:r={}}=e||{};return DM(this.state.doc,{blockSeparator:t,textSerializers:{...Ty(this.schema),...r}})}get isEmpty(){return Qu(this.state.doc)}getCharacterCount(){return console.warn('[tiptap warn]: "editor.getCharacterCount()" is deprecated. Please use "editor.storage.characterCount.characters()" instead.'),this.state.doc.content.size-2}destroy(){if(this.emit("destroy"),this.view){const e=this.view.dom;e&&e.editor&&delete e.editor,this.view.destroy()}this.removeAllListeners()}get isDestroyed(){var e;return!(!((e=this.view)===null||e===void 0)&&e.docView)}$node(e,t){var r;return((r=this.$doc)===null||r===void 0?void 0:r.querySelector(e,t))||null}$nodes(e,t){var r;return((r=this.$doc)===null||r===void 0?void 0:r.querySelectorAll(e,t))||null}$pos(e){const t=this.state.doc.resolve(e);return new ti(t,this)}get $doc(){return this.$pos(0)}};function ji(n){return new $a({find:n.find,handler:({state:e,range:t,match:r})=>{const i=se(n.getAttributes,void 0,r);if(i===!1||i===null)return null;const{tr:s}=e,o=r[r.length-1],a=r[0];if(o){const l=a.search(/\S/),c=t.from+a.indexOf(o),u=c+o.length;if(Ly(t.from,t.to,e.doc).filter(m=>m.mark.type.excluded.find(g=>g===n.type&&g!==m.mark.type)).filter(m=>m.to>c).length)return null;u<t.to&&s.delete(u,t.to),c>t.from&&s.delete(t.from+l,c);const h=t.from+l+o.length;s.addMark(t.from+l,h,n.type.create(i||{})),s.removeStoredMark(n.type)}}})}function iA(n){return new $a({find:n.find,handler:({state:e,range:t,match:r})=>{const i=se(n.getAttributes,void 0,r)||{},{tr:s}=e,o=t.from;let a=t.to;const l=n.type.create(i);if(r[1]){const c=r[0].lastIndexOf(r[1]);let u=o+c;u>a?u=a:a=u+r[1].length;const d=r[0][r[0].length-1];s.insertText(d,o+r[0].length-1),s.replaceWith(u,a,l)}else if(r[0]){const c=n.type.isInline?o:o-1;s.insert(c,n.type.create(i)).delete(s.mapping.map(o),s.mapping.map(a))}s.scrollIntoView()}})}function tf(n){return new $a({find:n.find,handler:({state:e,range:t,match:r})=>{const i=e.doc.resolve(t.from),s=se(n.getAttributes,void 0,r)||{};if(!i.node(-1).canReplaceWith(i.index(-1),i.indexAfter(-1),n.type))return null;e.tr.delete(t.from,t.to).setBlockType(t.from,t.from,n.type,s)}})}function so(n){return new $a({find:n.find,handler:({state:e,range:t,match:r,chain:i})=>{const s=se(n.getAttributes,void 0,r)||{},o=e.tr.delete(t.from,t.to),l=o.doc.resolve(t.from).blockRange(),c=l&&lu(l,n.type,s);if(!c)return null;if(o.wrap(l,c),n.keepMarks&&n.editor){const{selection:d,storedMarks:h}=e,{splittableMarks:m}=n.editor.extensionManager,p=h||d.$to.parentOffset&&d.$from.marks();if(p){const g=p.filter(y=>m.includes(y.type.name));o.ensureMarks(g)}}if(n.keepAttributes){const d=n.type.name==="bulletList"||n.type.name==="orderedList"?"listItem":"taskList";i().updateAttributes(d,s).run()}const u=o.doc.resolve(t.from-1).nodeBefore;u&&u.type===n.type&&cr(o.doc,t.from-1)&&(!n.joinPredicate||n.joinPredicate(r,u))&&o.join(t.from-1)}})}let rn=class Wf{constructor(e={}){this.type="node",this.name="node",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=se(j(this,"addOptions",{name:this.name}))),this.storage=se(j(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new Wf(e)}configure(e={}){const t=this.extend({...this.config,addOptions:()=>Ha(this.options,e)});return t.name=this.name,t.parent=this.parent,t}extend(e={}){const t=new Wf(e);return t.parent=this,this.child=t,t.name=e.name?e.name:t.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${t.name}".`),t.options=se(j(t,"addOptions",{name:t.name})),t.storage=se(j(t,"addStorage",{name:t.name,options:t.options})),t}};function zi(n){return new R2({find:n.find,handler:({state:e,range:t,match:r,pasteEvent:i})=>{const s=se(n.getAttributes,void 0,r,i);if(s===!1||s===null)return null;const{tr:o}=e,a=r[r.length-1],l=r[0];let c=t.to;if(a){const u=l.search(/\S/),d=t.from+l.indexOf(a),h=d+a.length;if(Ly(t.from,t.to,e.doc).filter(p=>p.mark.type.excluded.find(y=>y===n.type&&y!==p.mark.type)).filter(p=>p.to>d).length)return null;h<t.to&&o.delete(h,t.to),d>t.from&&o.delete(t.from+u,d),c=t.from+u+a.length,o.addMark(t.from+u,c,n.type.create(s||{})),o.removeStoredMark(n.type)}}})}var Ct="top",$t="bottom",jt="right",kt="left",nf="auto",oo=[Ct,$t,jt,kt],Hi="start",ao="end",sA="clippingParents",$y="viewport",lo="popper",oA="reference",jy=oo.reduce(function(n,e){return n.concat([e+"-"+Hi,e+"-"+ao])},[]),zy=[].concat(oo,[nf]).reduce(function(n,e){return n.concat([e,e+"-"+Hi,e+"-"+ao])},[]),aA="beforeRead",lA="read",cA="afterRead",uA="beforeMain",fA="main",dA="afterMain",hA="beforeWrite",pA="write",mA="afterWrite",gA=[aA,lA,cA,uA,fA,dA,hA,pA,mA];function yn(n){return n?(n.nodeName||"").toLowerCase():null}function Mt(n){if(n==null)return window;if(n.toString()!=="[object Window]"){var e=n.ownerDocument;return e&&e.defaultView||window}return n}function ni(n){var e=Mt(n).Element;return n instanceof e||n instanceof Element}function zt(n){var e=Mt(n).HTMLElement;return n instanceof e||n instanceof HTMLElement}function rf(n){if(typeof ShadowRoot>"u")return!1;var e=Mt(n).ShadowRoot;return n instanceof e||n instanceof ShadowRoot}function yA(n){var e=n.state;Object.keys(e.elements).forEach(function(t){var r=e.styles[t]||{},i=e.attributes[t]||{},s=e.elements[t];!zt(s)||!yn(s)||(Object.assign(s.style,r),Object.keys(i).forEach(function(o){var a=i[o];a===!1?s.removeAttribute(o):s.setAttribute(o,a===!0?"":a)}))})}function bA(n){var e=n.state,t={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,t.popper),e.styles=t,e.elements.arrow&&Object.assign(e.elements.arrow.style,t.arrow),function(){Object.keys(e.elements).forEach(function(r){var i=e.elements[r],s=e.attributes[r]||{},o=Object.keys(e.styles.hasOwnProperty(r)?e.styles[r]:t[r]),a=o.reduce(function(l,c){return l[c]="",l},{});!zt(i)||!yn(i)||(Object.assign(i.style,a),Object.keys(s).forEach(function(l){i.removeAttribute(l)}))})}}const Hy={name:"applyStyles",enabled:!0,phase:"write",fn:yA,effect:bA,requires:["computeStyles"]};function bn(n){return n.split("-")[0]}var ri=Math.max,qa=Math.min,Gi=Math.round;function sf(){var n=navigator.userAgentData;return n!=null&&n.brands&&Array.isArray(n.brands)?n.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function Gy(){return!/^((?!chrome|android).)*safari/i.test(sf())}function Ui(n,e,t){e===void 0&&(e=!1),t===void 0&&(t=!1);var r=n.getBoundingClientRect(),i=1,s=1;e&&zt(n)&&(i=n.offsetWidth>0&&Gi(r.width)/n.offsetWidth||1,s=n.offsetHeight>0&&Gi(r.height)/n.offsetHeight||1);var o=ni(n)?Mt(n):window,a=o.visualViewport,l=!Gy()&&t,c=(r.left+(l&&a?a.offsetLeft:0))/i,u=(r.top+(l&&a?a.offsetTop:0))/s,d=r.width/i,h=r.height/s;return{width:d,height:h,top:u,right:c+d,bottom:u+h,left:c,x:c,y:u}}function of(n){var e=Ui(n),t=n.offsetWidth,r=n.offsetHeight;return Math.abs(e.width-t)<=1&&(t=e.width),Math.abs(e.height-r)<=1&&(r=e.height),{x:n.offsetLeft,y:n.offsetTop,width:t,height:r}}function Uy(n,e){var t=e.getRootNode&&e.getRootNode();if(n.contains(e))return!0;if(t&&rf(t)){var r=e;do{if(r&&n.isSameNode(r))return!0;r=r.parentNode||r.host}while(r)}return!1}function Fn(n){return Mt(n).getComputedStyle(n)}function vA(n){return["table","td","th"].indexOf(yn(n))>=0}function Cr(n){return((ni(n)?n.ownerDocument:n.document)||window.document).documentElement}function Xa(n){return yn(n)==="html"?n:n.assignedSlot||n.parentNode||(rf(n)?n.host:null)||Cr(n)}function Wy(n){return!zt(n)||Fn(n).position==="fixed"?null:n.offsetParent}function wA(n){var e=/firefox/i.test(sf()),t=/Trident/i.test(sf());if(t&&zt(n)){var r=Fn(n);if(r.position==="fixed")return null}var i=Xa(n);for(rf(i)&&(i=i.host);zt(i)&&["html","body"].indexOf(yn(i))<0;){var s=Fn(i);if(s.transform!=="none"||s.perspective!=="none"||s.contain==="paint"||["transform","perspective"].indexOf(s.willChange)!==-1||e&&s.willChange==="filter"||e&&s.filter&&s.filter!=="none")return i;i=i.parentNode}return null}function co(n){for(var e=Mt(n),t=Wy(n);t&&vA(t)&&Fn(t).position==="static";)t=Wy(t);return t&&(yn(t)==="html"||yn(t)==="body"&&Fn(t).position==="static")?e:t||wA(n)||e}function af(n){return["top","bottom"].indexOf(n)>=0?"x":"y"}function uo(n,e,t){return ri(n,qa(e,t))}function CA(n,e,t){var r=uo(n,e,t);return r>t?t:r}function Ky(){return{top:0,right:0,bottom:0,left:0}}function Yy(n){return Object.assign({},Ky(),n)}function qy(n,e){return e.reduce(function(t,r){return t[r]=n,t},{})}var kA=function(e,t){return e=typeof e=="function"?e(Object.assign({},t.rects,{placement:t.placement})):e,Yy(typeof e!="number"?e:qy(e,oo))};function SA(n){var e,t=n.state,r=n.name,i=n.options,s=t.elements.arrow,o=t.modifiersData.popperOffsets,a=bn(t.placement),l=af(a),c=[kt,jt].indexOf(a)>=0,u=c?"height":"width";if(!(!s||!o)){var d=kA(i.padding,t),h=of(s),m=l==="y"?Ct:kt,p=l==="y"?$t:jt,g=t.rects.reference[u]+t.rects.reference[l]-o[l]-t.rects.popper[u],y=o[l]-t.rects.reference[l],v=co(s),C=v?l==="y"?v.clientHeight||0:v.clientWidth||0:0,w=g/2-y/2,b=d[m],E=C-h[u]-d[p],k=C/2-h[u]/2+w,x=uo(b,k,E),O=l;t.modifiersData[r]=(e={},e[O]=x,e.centerOffset=x-k,e)}}function xA(n){var e=n.state,t=n.options,r=t.element,i=r===void 0?"[data-popper-arrow]":r;i!=null&&(typeof i=="string"&&(i=e.elements.popper.querySelector(i),!i)||Uy(e.elements.popper,i)&&(e.elements.arrow=i))}const _A={name:"arrow",enabled:!0,phase:"main",fn:SA,effect:xA,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function Wi(n){return n.split("-")[1]}var EA={top:"auto",right:"auto",bottom:"auto",left:"auto"};function TA(n,e){var t=n.x,r=n.y,i=e.devicePixelRatio||1;return{x:Gi(t*i)/i||0,y:Gi(r*i)/i||0}}function Xy(n){var e,t=n.popper,r=n.popperRect,i=n.placement,s=n.variation,o=n.offsets,a=n.position,l=n.gpuAcceleration,c=n.adaptive,u=n.roundOffsets,d=n.isFixed,h=o.x,m=h===void 0?0:h,p=o.y,g=p===void 0?0:p,y=typeof u=="function"?u({x:m,y:g}):{x:m,y:g};m=y.x,g=y.y;var v=o.hasOwnProperty("x"),C=o.hasOwnProperty("y"),w=kt,b=Ct,E=window;if(c){var k=co(t),x="clientHeight",O="clientWidth";if(k===Mt(t)&&(k=Cr(t),Fn(k).position!=="static"&&a==="absolute"&&(x="scrollHeight",O="scrollWidth")),k=k,i===Ct||(i===kt||i===jt)&&s===ao){b=$t;var T=d&&k===E&&E.visualViewport?E.visualViewport.height:k[x];g-=T-r.height,g*=l?1:-1}if(i===kt||(i===Ct||i===$t)&&s===ao){w=jt;var B=d&&k===E&&E.visualViewport?E.visualViewport.width:k[O];m-=B-r.width,m*=l?1:-1}}var U=Object.assign({position:a},c&&EA),$=u===!0?TA({x:m,y:g},Mt(t)):{x:m,y:g};if(m=$.x,g=$.y,l){var K;return Object.assign({},U,(K={},K[b]=C?"0":"",K[w]=v?"0":"",K.transform=(E.devicePixelRatio||1)<=1?"translate("+m+"px, "+g+"px)":"translate3d("+m+"px, "+g+"px, 0)",K))}return Object.assign({},U,(e={},e[b]=C?g+"px":"",e[w]=v?m+"px":"",e.transform="",e))}function OA(n){var e=n.state,t=n.options,r=t.gpuAcceleration,i=r===void 0?!0:r,s=t.adaptive,o=s===void 0?!0:s,a=t.roundOffsets,l=a===void 0?!0:a,c={placement:bn(e.placement),variation:Wi(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:i,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,Xy(Object.assign({},c,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:o,roundOffsets:l})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,Xy(Object.assign({},c,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const NA={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:OA,data:{}};var Ja={passive:!0};function MA(n){var e=n.state,t=n.instance,r=n.options,i=r.scroll,s=i===void 0?!0:i,o=r.resize,a=o===void 0?!0:o,l=Mt(e.elements.popper),c=[].concat(e.scrollParents.reference,e.scrollParents.popper);return s&&c.forEach(function(u){u.addEventListener("scroll",t.update,Ja)}),a&&l.addEventListener("resize",t.update,Ja),function(){s&&c.forEach(function(u){u.removeEventListener("scroll",t.update,Ja)}),a&&l.removeEventListener("resize",t.update,Ja)}}const AA={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:MA,data:{}};var PA={left:"right",right:"left",bottom:"top",top:"bottom"};function Qa(n){return n.replace(/left|right|bottom|top/g,function(e){return PA[e]})}var IA={start:"end",end:"start"};function Jy(n){return n.replace(/start|end/g,function(e){return IA[e]})}function lf(n){var e=Mt(n),t=e.pageXOffset,r=e.pageYOffset;return{scrollLeft:t,scrollTop:r}}function cf(n){return Ui(Cr(n)).left+lf(n).scrollLeft}function DA(n,e){var t=Mt(n),r=Cr(n),i=t.visualViewport,s=r.clientWidth,o=r.clientHeight,a=0,l=0;if(i){s=i.width,o=i.height;var c=Gy();(c||!c&&e==="fixed")&&(a=i.offsetLeft,l=i.offsetTop)}return{width:s,height:o,x:a+cf(n),y:l}}function LA(n){var e,t=Cr(n),r=lf(n),i=(e=n.ownerDocument)==null?void 0:e.body,s=ri(t.scrollWidth,t.clientWidth,i?i.scrollWidth:0,i?i.clientWidth:0),o=ri(t.scrollHeight,t.clientHeight,i?i.scrollHeight:0,i?i.clientHeight:0),a=-r.scrollLeft+cf(n),l=-r.scrollTop;return Fn(i||t).direction==="rtl"&&(a+=ri(t.clientWidth,i?i.clientWidth:0)-s),{width:s,height:o,x:a,y:l}}function uf(n){var e=Fn(n),t=e.overflow,r=e.overflowX,i=e.overflowY;return/auto|scroll|overlay|hidden/.test(t+i+r)}function Qy(n){return["html","body","#document"].indexOf(yn(n))>=0?n.ownerDocument.body:zt(n)&&uf(n)?n:Qy(Xa(n))}function fo(n,e){var t;e===void 0&&(e=[]);var r=Qy(n),i=r===((t=n.ownerDocument)==null?void 0:t.body),s=Mt(r),o=i?[s].concat(s.visualViewport||[],uf(r)?r:[]):r,a=e.concat(o);return i?a:a.concat(fo(Xa(o)))}function ff(n){return Object.assign({},n,{left:n.x,top:n.y,right:n.x+n.width,bottom:n.y+n.height})}function RA(n,e){var t=Ui(n,!1,e==="fixed");return t.top=t.top+n.clientTop,t.left=t.left+n.clientLeft,t.bottom=t.top+n.clientHeight,t.right=t.left+n.clientWidth,t.width=n.clientWidth,t.height=n.clientHeight,t.x=t.left,t.y=t.top,t}function Zy(n,e,t){return e===$y?ff(DA(n,t)):ni(e)?RA(e,t):ff(LA(Cr(n)))}function FA(n){var e=fo(Xa(n)),t=["absolute","fixed"].indexOf(Fn(n).position)>=0,r=t&&zt(n)?co(n):n;return ni(r)?e.filter(function(i){return ni(i)&&Uy(i,r)&&yn(i)!=="body"}):[]}function BA(n,e,t,r){var i=e==="clippingParents"?FA(n):[].concat(e),s=[].concat(i,[t]),o=s[0],a=s.reduce(function(l,c){var u=Zy(n,c,r);return l.top=ri(u.top,l.top),l.right=qa(u.right,l.right),l.bottom=qa(u.bottom,l.bottom),l.left=ri(u.left,l.left),l},Zy(n,o,r));return a.width=a.right-a.left,a.height=a.bottom-a.top,a.x=a.left,a.y=a.top,a}function e0(n){var e=n.reference,t=n.element,r=n.placement,i=r?bn(r):null,s=r?Wi(r):null,o=e.x+e.width/2-t.width/2,a=e.y+e.height/2-t.height/2,l;switch(i){case Ct:l={x:o,y:e.y-t.height};break;case $t:l={x:o,y:e.y+e.height};break;case jt:l={x:e.x+e.width,y:a};break;case kt:l={x:e.x-t.width,y:a};break;default:l={x:e.x,y:e.y}}var c=i?af(i):null;if(c!=null){var u=c==="y"?"height":"width";switch(s){case Hi:l[c]=l[c]-(e[u]/2-t[u]/2);break;case ao:l[c]=l[c]+(e[u]/2-t[u]/2);break}}return l}function ho(n,e){e===void 0&&(e={});var t=e,r=t.placement,i=r===void 0?n.placement:r,s=t.strategy,o=s===void 0?n.strategy:s,a=t.boundary,l=a===void 0?sA:a,c=t.rootBoundary,u=c===void 0?$y:c,d=t.elementContext,h=d===void 0?lo:d,m=t.altBoundary,p=m===void 0?!1:m,g=t.padding,y=g===void 0?0:g,v=Yy(typeof y!="number"?y:qy(y,oo)),C=h===lo?oA:lo,w=n.rects.popper,b=n.elements[p?C:h],E=BA(ni(b)?b:b.contextElement||Cr(n.elements.popper),l,u,o),k=Ui(n.elements.reference),x=e0({reference:k,element:w,strategy:"absolute",placement:i}),O=ff(Object.assign({},w,x)),T=h===lo?O:k,B={top:E.top-T.top+v.top,bottom:T.bottom-E.bottom+v.bottom,left:E.left-T.left+v.left,right:T.right-E.right+v.right},U=n.modifiersData.offset;if(h===lo&&U){var $=U[i];Object.keys(B).forEach(function(K){var _e=[jt,$t].indexOf(K)>=0?1:-1,Ee=[Ct,$t].indexOf(K)>=0?"y":"x";B[K]+=$[Ee]*_e})}return B}function VA(n,e){e===void 0&&(e={});var t=e,r=t.placement,i=t.boundary,s=t.rootBoundary,o=t.padding,a=t.flipVariations,l=t.allowedAutoPlacements,c=l===void 0?zy:l,u=Wi(r),d=u?a?jy:jy.filter(function(p){return Wi(p)===u}):oo,h=d.filter(function(p){return c.indexOf(p)>=0});h.length===0&&(h=d);var m=h.reduce(function(p,g){return p[g]=ho(n,{placement:g,boundary:i,rootBoundary:s,padding:o})[bn(g)],p},{});return Object.keys(m).sort(function(p,g){return m[p]-m[g]})}function $A(n){if(bn(n)===nf)return[];var e=Qa(n);return[Jy(n),e,Jy(e)]}function jA(n){var e=n.state,t=n.options,r=n.name;if(!e.modifiersData[r]._skip){for(var i=t.mainAxis,s=i===void 0?!0:i,o=t.altAxis,a=o===void 0?!0:o,l=t.fallbackPlacements,c=t.padding,u=t.boundary,d=t.rootBoundary,h=t.altBoundary,m=t.flipVariations,p=m===void 0?!0:m,g=t.allowedAutoPlacements,y=e.options.placement,v=bn(y),C=v===y,w=l||(C||!p?[Qa(y)]:$A(y)),b=[y].concat(w).reduce(function(Ue,je){return Ue.concat(bn(je)===nf?VA(e,{placement:je,boundary:u,rootBoundary:d,padding:c,flipVariations:p,allowedAutoPlacements:g}):je)},[]),E=e.rects.reference,k=e.rects.popper,x=new Map,O=!0,T=b[0],B=0;B<b.length;B++){var U=b[B],$=bn(U),K=Wi(U)===Hi,_e=[Ct,$t].indexOf($)>=0,Ee=_e?"width":"height",fe=ho(e,{placement:U,boundary:u,rootBoundary:d,altBoundary:h,padding:c}),ve=_e?K?jt:kt:K?$t:Ct;E[Ee]>k[Ee]&&(ve=Qa(ve));var he=Qa(ve),He=[];if(s&&He.push(fe[$]<=0),a&&He.push(fe[ve]<=0,fe[he]<=0),He.every(function(Ue){return Ue})){T=U,O=!1;break}x.set(U,He)}if(O)for(var Ge=p?3:1,Le=function(je){var oe=b.find(function(Gt){var pt=x.get(Gt);if(pt)return pt.slice(0,je).every(function(Ut){return Ut})});if(oe)return T=oe,"break"},Be=Ge;Be>0;Be--){var at=Le(Be);if(at==="break")break}e.placement!==T&&(e.modifiersData[r]._skip=!0,e.placement=T,e.reset=!0)}}const zA={name:"flip",enabled:!0,phase:"main",fn:jA,requiresIfExists:["offset"],data:{_skip:!1}};function t0(n,e,t){return t===void 0&&(t={x:0,y:0}),{top:n.top-e.height-t.y,right:n.right-e.width+t.x,bottom:n.bottom-e.height+t.y,left:n.left-e.width-t.x}}function n0(n){return[Ct,jt,$t,kt].some(function(e){return n[e]>=0})}function HA(n){var e=n.state,t=n.name,r=e.rects.reference,i=e.rects.popper,s=e.modifiersData.preventOverflow,o=ho(e,{elementContext:"reference"}),a=ho(e,{altBoundary:!0}),l=t0(o,r),c=t0(a,i,s),u=n0(l),d=n0(c);e.modifiersData[t]={referenceClippingOffsets:l,popperEscapeOffsets:c,isReferenceHidden:u,hasPopperEscaped:d},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":u,"data-popper-escaped":d})}const GA={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:HA};function UA(n,e,t){var r=bn(n),i=[kt,Ct].indexOf(r)>=0?-1:1,s=typeof t=="function"?t(Object.assign({},e,{placement:n})):t,o=s[0],a=s[1];return o=o||0,a=(a||0)*i,[kt,jt].indexOf(r)>=0?{x:a,y:o}:{x:o,y:a}}function WA(n){var e=n.state,t=n.options,r=n.name,i=t.offset,s=i===void 0?[0,0]:i,o=zy.reduce(function(u,d){return u[d]=UA(d,e.rects,s),u},{}),a=o[e.placement],l=a.x,c=a.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=l,e.modifiersData.popperOffsets.y+=c),e.modifiersData[r]=o}const KA={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:WA};function YA(n){var e=n.state,t=n.name;e.modifiersData[t]=e0({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})}const qA={name:"popperOffsets",enabled:!0,phase:"read",fn:YA,data:{}};function XA(n){return n==="x"?"y":"x"}function JA(n){var e=n.state,t=n.options,r=n.name,i=t.mainAxis,s=i===void 0?!0:i,o=t.altAxis,a=o===void 0?!1:o,l=t.boundary,c=t.rootBoundary,u=t.altBoundary,d=t.padding,h=t.tether,m=h===void 0?!0:h,p=t.tetherOffset,g=p===void 0?0:p,y=ho(e,{boundary:l,rootBoundary:c,padding:d,altBoundary:u}),v=bn(e.placement),C=Wi(e.placement),w=!C,b=af(v),E=XA(b),k=e.modifiersData.popperOffsets,x=e.rects.reference,O=e.rects.popper,T=typeof g=="function"?g(Object.assign({},e.rects,{placement:e.placement})):g,B=typeof T=="number"?{mainAxis:T,altAxis:T}:Object.assign({mainAxis:0,altAxis:0},T),U=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,$={x:0,y:0};if(k){if(s){var K,_e=b==="y"?Ct:kt,Ee=b==="y"?$t:jt,fe=b==="y"?"height":"width",ve=k[b],he=ve+y[_e],He=ve-y[Ee],Ge=m?-O[fe]/2:0,Le=C===Hi?x[fe]:O[fe],Be=C===Hi?-O[fe]:-x[fe],at=e.elements.arrow,Ue=m&&at?of(at):{width:0,height:0},je=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:Ky(),oe=je[_e],Gt=je[Ee],pt=uo(0,x[fe],Ue[fe]),Ut=w?x[fe]/2-Ge-pt-oe-B.mainAxis:Le-pt-oe-B.mainAxis,mt=w?-x[fe]/2+Ge+pt+Gt+B.mainAxis:Be+pt+Gt+B.mainAxis,Wt=e.elements.arrow&&co(e.elements.arrow),kn=Wt?b==="y"?Wt.clientTop||0:Wt.clientLeft||0:0,cn=(K=U==null?void 0:U[b])!=null?K:0,R=ve+Ut-cn-kn,le=ve+mt-cn,Kt=uo(m?qa(he,R):he,ve,m?ri(He,le):He);k[b]=Kt,$[b]=Kt-ve}if(a){var Yt,Sn=b==="x"?Ct:kt,Er=b==="x"?$t:jt,S=k[E],_=E==="y"?"height":"width",P=S+y[Sn],H=S-y[Er],ye=[Ct,kt].indexOf(v)!==-1,Z=(Yt=U==null?void 0:U[E])!=null?Yt:0,N=ye?P:S-x[_]-O[_]-Z+B.altAxis,D=ye?S+x[_]+O[_]-Z-B.altAxis:H,pe=m&&ye?CA(N,S,D):uo(m?N:P,S,m?D:H);k[E]=pe,$[E]=pe-S}e.modifiersData[r]=$}}const QA={name:"preventOverflow",enabled:!0,phase:"main",fn:JA,requiresIfExists:["offset"]};function ZA(n){return{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop}}function eP(n){return n===Mt(n)||!zt(n)?lf(n):ZA(n)}function tP(n){var e=n.getBoundingClientRect(),t=Gi(e.width)/n.offsetWidth||1,r=Gi(e.height)/n.offsetHeight||1;return t!==1||r!==1}function nP(n,e,t){t===void 0&&(t=!1);var r=zt(e),i=zt(e)&&tP(e),s=Cr(e),o=Ui(n,i,t),a={scrollLeft:0,scrollTop:0},l={x:0,y:0};return(r||!r&&!t)&&((yn(e)!=="body"||uf(s))&&(a=eP(e)),zt(e)?(l=Ui(e,!0),l.x+=e.clientLeft,l.y+=e.clientTop):s&&(l.x=cf(s))),{x:o.left+a.scrollLeft-l.x,y:o.top+a.scrollTop-l.y,width:o.width,height:o.height}}function rP(n){var e=new Map,t=new Set,r=[];n.forEach(function(s){e.set(s.name,s)});function i(s){t.add(s.name);var o=[].concat(s.requires||[],s.requiresIfExists||[]);o.forEach(function(a){if(!t.has(a)){var l=e.get(a);l&&i(l)}}),r.push(s)}return n.forEach(function(s){t.has(s.name)||i(s)}),r}function iP(n){var e=rP(n);return gA.reduce(function(t,r){return t.concat(e.filter(function(i){return i.phase===r}))},[])}function sP(n){var e;return function(){return e||(e=new Promise(function(t){Promise.resolve().then(function(){e=void 0,t(n())})})),e}}function oP(n){var e=n.reduce(function(t,r){var i=t[r.name];return t[r.name]=i?Object.assign({},i,r,{options:Object.assign({},i.options,r.options),data:Object.assign({},i.data,r.data)}):r,t},{});return Object.keys(e).map(function(t){return e[t]})}var r0={placement:"bottom",modifiers:[],strategy:"absolute"};function i0(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];return!e.some(function(r){return!(r&&typeof r.getBoundingClientRect=="function")})}function aP(n){n===void 0&&(n={});var e=n,t=e.defaultModifiers,r=t===void 0?[]:t,i=e.defaultOptions,s=i===void 0?r0:i;return function(a,l,c){c===void 0&&(c=s);var u={placement:"bottom",orderedModifiers:[],options:Object.assign({},r0,s),modifiersData:{},elements:{reference:a,popper:l},attributes:{},styles:{}},d=[],h=!1,m={state:u,setOptions:function(v){var C=typeof v=="function"?v(u.options):v;g(),u.options=Object.assign({},s,u.options,C),u.scrollParents={reference:ni(a)?fo(a):a.contextElement?fo(a.contextElement):[],popper:fo(l)};var w=iP(oP([].concat(r,u.options.modifiers)));return u.orderedModifiers=w.filter(function(b){return b.enabled}),p(),m.update()},forceUpdate:function(){if(!h){var v=u.elements,C=v.reference,w=v.popper;if(i0(C,w)){u.rects={reference:nP(C,co(w),u.options.strategy==="fixed"),popper:of(w)},u.reset=!1,u.placement=u.options.placement,u.orderedModifiers.forEach(function(B){return u.modifiersData[B.name]=Object.assign({},B.data)});for(var b=0;b<u.orderedModifiers.length;b++){if(u.reset===!0){u.reset=!1,b=-1;continue}var E=u.orderedModifiers[b],k=E.fn,x=E.options,O=x===void 0?{}:x,T=E.name;typeof k=="function"&&(u=k({state:u,options:O,name:T,instance:m})||u)}}}},update:sP(function(){return new Promise(function(y){m.forceUpdate(),y(u)})}),destroy:function(){g(),h=!0}};if(!i0(a,l))return m;m.setOptions(c).then(function(y){!h&&c.onFirstUpdate&&c.onFirstUpdate(y)});function p(){u.orderedModifiers.forEach(function(y){var v=y.name,C=y.options,w=C===void 0?{}:C,b=y.effect;if(typeof b=="function"){var E=b({state:u,name:v,instance:m,options:w}),k=function(){};d.push(E||k)}})}function g(){d.forEach(function(y){return y()}),d=[]}return m}}var lP=[AA,qA,NA,Hy,KA,zA,QA,_A,GA],cP=aP({defaultModifiers:lP}),uP="tippy-box",s0="tippy-content",fP="tippy-backdrop",o0="tippy-arrow",a0="tippy-svg-arrow",ii={passive:!0,capture:!0},l0=function(){return document.body};function df(n,e,t){if(Array.isArray(n)){var r=n[e];return r??(Array.isArray(t)?t[e]:t)}return n}function hf(n,e){var t={}.toString.call(n);return t.indexOf("[object")===0&&t.indexOf(e+"]")>-1}function c0(n,e){return typeof n=="function"?n.apply(void 0,e):n}function u0(n,e){if(e===0)return n;var t;return function(r){clearTimeout(t),t=setTimeout(function(){n(r)},e)}}function dP(n){return n.split(/\s+/).filter(Boolean)}function Ki(n){return[].concat(n)}function f0(n,e){n.indexOf(e)===-1&&n.push(e)}function hP(n){return n.filter(function(e,t){return n.indexOf(e)===t})}function pP(n){return n.split("-")[0]}function Za(n){return[].slice.call(n)}function d0(n){return Object.keys(n).reduce(function(e,t){return n[t]!==void 0&&(e[t]=n[t]),e},{})}function po(){return document.createElement("div")}function el(n){return["Element","Fragment"].some(function(e){return hf(n,e)})}function mP(n){return hf(n,"NodeList")}function gP(n){return hf(n,"MouseEvent")}function yP(n){return!!(n&&n._tippy&&n._tippy.reference===n)}function bP(n){return el(n)?[n]:mP(n)?Za(n):Array.isArray(n)?n:Za(document.querySelectorAll(n))}function pf(n,e){n.forEach(function(t){t&&(t.style.transitionDuration=e+"ms")})}function h0(n,e){n.forEach(function(t){t&&t.setAttribute("data-state",e)})}function vP(n){var e,t=Ki(n),r=t[0];return r!=null&&(e=r.ownerDocument)!=null&&e.body?r.ownerDocument:document}function wP(n,e){var t=e.clientX,r=e.clientY;return n.every(function(i){var s=i.popperRect,o=i.popperState,a=i.props,l=a.interactiveBorder,c=pP(o.placement),u=o.modifiersData.offset;if(!u)return!0;var d=c==="bottom"?u.top.y:0,h=c==="top"?u.bottom.y:0,m=c==="right"?u.left.x:0,p=c==="left"?u.right.x:0,g=s.top-r+d>l,y=r-s.bottom-h>l,v=s.left-t+m>l,C=t-s.right-p>l;return g||y||v||C})}function mf(n,e,t){var r=e+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(i){n[r](i,t)})}function p0(n,e){for(var t=e;t;){var r;if(n.contains(t))return!0;t=t.getRootNode==null||(r=t.getRootNode())==null?void 0:r.host}return!1}var vn={isTouch:!1},m0=0;function CP(){vn.isTouch||(vn.isTouch=!0,window.performance&&document.addEventListener("mousemove",g0))}function g0(){var n=performance.now();n-m0<20&&(vn.isTouch=!1,document.removeEventListener("mousemove",g0)),m0=n}function kP(){var n=document.activeElement;if(yP(n)){var e=n._tippy;n.blur&&!e.state.isVisible&&n.blur()}}function SP(){document.addEventListener("touchstart",CP,ii),window.addEventListener("blur",kP)}var xP=typeof window<"u"&&typeof document<"u",_P=xP?!!window.msCrypto:!1,EP={animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},TP={allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999},sn=Object.assign({appendTo:l0,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},EP,TP),OP=Object.keys(sn),NP=function(e){var t=Object.keys(e);t.forEach(function(r){sn[r]=e[r]})};function y0(n){var e=n.plugins||[],t=e.reduce(function(r,i){var s=i.name,o=i.defaultValue;if(s){var a;r[s]=n[s]!==void 0?n[s]:(a=sn[s])!=null?a:o}return r},{});return Object.assign({},n,t)}function MP(n,e){var t=e?Object.keys(y0(Object.assign({},sn,{plugins:e}))):OP,r=t.reduce(function(i,s){var o=(n.getAttribute("data-tippy-"+s)||"").trim();if(!o)return i;if(s==="content")i[s]=o;else try{i[s]=JSON.parse(o)}catch{i[s]=o}return i},{});return r}function b0(n,e){var t=Object.assign({},e,{content:c0(e.content,[n])},e.ignoreAttributes?{}:MP(n,e.plugins));return t.aria=Object.assign({},sn.aria,t.aria),t.aria={expanded:t.aria.expanded==="auto"?e.interactive:t.aria.expanded,content:t.aria.content==="auto"?e.interactive?null:"describedby":t.aria.content},t}var AP=function(){return"innerHTML"};function gf(n,e){n[AP()]=e}function v0(n){var e=po();return n===!0?e.className=o0:(e.className=a0,el(n)?e.appendChild(n):gf(e,n)),e}function w0(n,e){el(e.content)?(gf(n,""),n.appendChild(e.content)):typeof e.content!="function"&&(e.allowHTML?gf(n,e.content):n.textContent=e.content)}function yf(n){var e=n.firstElementChild,t=Za(e.children);return{box:e,content:t.find(function(r){return r.classList.contains(s0)}),arrow:t.find(function(r){return r.classList.contains(o0)||r.classList.contains(a0)}),backdrop:t.find(function(r){return r.classList.contains(fP)})}}function C0(n){var e=po(),t=po();t.className=uP,t.setAttribute("data-state","hidden"),t.setAttribute("tabindex","-1");var r=po();r.className=s0,r.setAttribute("data-state","hidden"),w0(r,n.props),e.appendChild(t),t.appendChild(r),i(n.props,n.props);function i(s,o){var a=yf(e),l=a.box,c=a.content,u=a.arrow;o.theme?l.setAttribute("data-theme",o.theme):l.removeAttribute("data-theme"),typeof o.animation=="string"?l.setAttribute("data-animation",o.animation):l.removeAttribute("data-animation"),o.inertia?l.setAttribute("data-inertia",""):l.removeAttribute("data-inertia"),l.style.maxWidth=typeof o.maxWidth=="number"?o.maxWidth+"px":o.maxWidth,o.role?l.setAttribute("role",o.role):l.removeAttribute("role"),(s.content!==o.content||s.allowHTML!==o.allowHTML)&&w0(c,n.props),o.arrow?u?s.arrow!==o.arrow&&(l.removeChild(u),l.appendChild(v0(o.arrow))):l.appendChild(v0(o.arrow)):u&&l.removeChild(u)}return{popper:e,onUpdate:i}}C0.$$tippy=!0;var PP=1,tl=[],bf=[];function IP(n,e){var t=b0(n,Object.assign({},sn,y0(d0(e)))),r,i,s,o=!1,a=!1,l=!1,c=!1,u,d,h,m=[],p=u0(R,t.interactiveDebounce),g,y=PP++,v=null,C=hP(t.plugins),w={isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},b={id:y,reference:n,popper:po(),popperInstance:v,props:t,state:w,plugins:C,clearDelayTimeouts:N,setProps:D,setContent:pe,show:Ie,hide:xn,hideWithInteractivity:ts,enable:ye,disable:Z,unmount:Tr,destroy:$f};if(!t.render)return b;var E=t.render(b),k=E.popper,x=E.onUpdate;k.setAttribute("data-tippy-root",""),k.id="tippy-"+b.id,b.popper=k,n._tippy=b,k._tippy=b;var O=C.map(function(M){return M.fn(b)}),T=n.hasAttribute("aria-expanded");return Wt(),Ge(),ve(),he("onCreate",[b]),t.showOnCreate&&P(),k.addEventListener("mouseenter",function(){b.props.interactive&&b.state.isVisible&&b.clearDelayTimeouts()}),k.addEventListener("mouseleave",function(){b.props.interactive&&b.props.trigger.indexOf("mouseenter")>=0&&_e().addEventListener("mousemove",p)}),b;function B(){var M=b.props.touch;return Array.isArray(M)?M:[M,0]}function U(){return B()[0]==="hold"}function $(){var M;return!!((M=b.props.render)!=null&&M.$$tippy)}function K(){return g||n}function _e(){var M=K().parentNode;return M?vP(M):document}function Ee(){return yf(k)}function fe(M){return b.state.isMounted&&!b.state.isVisible||vn.isTouch||u&&u.type==="focus"?0:df(b.props.delay,M?0:1,sn.delay)}function ve(M){M===void 0&&(M=!1),k.style.pointerEvents=b.props.interactive&&!M?"":"none",k.style.zIndex=""+b.props.zIndex}function he(M,W,te){if(te===void 0&&(te=!0),O.forEach(function(de){de[M]&&de[M].apply(de,W)}),te){var be;(be=b.props)[M].apply(be,W)}}function He(){var M=b.props.aria;if(M.content){var W="aria-"+M.content,te=k.id,be=Ki(b.props.triggerTarget||n);be.forEach(function(de){var gt=de.getAttribute(W);if(b.state.isVisible)de.setAttribute(W,gt?gt+" "+te:te);else{var qt=gt&&gt.replace(te,"").trim();qt?de.setAttribute(W,qt):de.removeAttribute(W)}})}}function Ge(){if(!(T||!b.props.aria.expanded)){var M=Ki(b.props.triggerTarget||n);M.forEach(function(W){b.props.interactive?W.setAttribute("aria-expanded",b.state.isVisible&&W===K()?"true":"false"):W.removeAttribute("aria-expanded")})}}function Le(){_e().removeEventListener("mousemove",p),tl=tl.filter(function(M){return M!==p})}function Be(M){if(!(vn.isTouch&&(l||M.type==="mousedown"))){var W=M.composedPath&&M.composedPath()[0]||M.target;if(!(b.props.interactive&&p0(k,W))){if(Ki(b.props.triggerTarget||n).some(function(te){return p0(te,W)})){if(vn.isTouch||b.state.isVisible&&b.props.trigger.indexOf("click")>=0)return}else he("onClickOutside",[b,M]);b.props.hideOnClick===!0&&(b.clearDelayTimeouts(),b.hide(),a=!0,setTimeout(function(){a=!1}),b.state.isMounted||oe())}}}function at(){l=!0}function Ue(){l=!1}function je(){var M=_e();M.addEventListener("mousedown",Be,!0),M.addEventListener("touchend",Be,ii),M.addEventListener("touchstart",Ue,ii),M.addEventListener("touchmove",at,ii)}function oe(){var M=_e();M.removeEventListener("mousedown",Be,!0),M.removeEventListener("touchend",Be,ii),M.removeEventListener("touchstart",Ue,ii),M.removeEventListener("touchmove",at,ii)}function Gt(M,W){Ut(M,function(){!b.state.isVisible&&k.parentNode&&k.parentNode.contains(k)&&W()})}function pt(M,W){Ut(M,W)}function Ut(M,W){var te=Ee().box;function be(de){de.target===te&&(mf(te,"remove",be),W())}if(M===0)return W();mf(te,"remove",d),mf(te,"add",be),d=be}function mt(M,W,te){te===void 0&&(te=!1);var be=Ki(b.props.triggerTarget||n);be.forEach(function(de){de.addEventListener(M,W,te),m.push({node:de,eventType:M,handler:W,options:te})})}function Wt(){U()&&(mt("touchstart",cn,{passive:!0}),mt("touchend",le,{passive:!0})),dP(b.props.trigger).forEach(function(M){if(M!=="manual")switch(mt(M,cn),M){case"mouseenter":mt("mouseleave",le);break;case"focus":mt(_P?"focusout":"blur",Kt);break;case"focusin":mt("focusout",Kt);break}})}function kn(){m.forEach(function(M){var W=M.node,te=M.eventType,be=M.handler,de=M.options;W.removeEventListener(te,be,de)}),m=[]}function cn(M){var W,te=!1;if(!(!b.state.isEnabled||Yt(M)||a)){var be=((W=u)==null?void 0:W.type)==="focus";u=M,g=M.currentTarget,Ge(),!b.state.isVisible&&gP(M)&&tl.forEach(function(de){return de(M)}),M.type==="click"&&(b.props.trigger.indexOf("mouseenter")<0||o)&&b.props.hideOnClick!==!1&&b.state.isVisible?te=!0:P(M),M.type==="click"&&(o=!te),te&&!be&&H(M)}}function R(M){var W=M.target,te=K().contains(W)||k.contains(W);if(!(M.type==="mousemove"&&te)){var be=_().concat(k).map(function(de){var gt,qt=de._tippy,ns=(gt=qt.popperInstance)==null?void 0:gt.state;return ns?{popperRect:de.getBoundingClientRect(),popperState:ns,props:t}:null}).filter(Boolean);wP(be,M)&&(Le(),H(M))}}function le(M){var W=Yt(M)||b.props.trigger.indexOf("click")>=0&&o;if(!W){if(b.props.interactive){b.hideWithInteractivity(M);return}H(M)}}function Kt(M){b.props.trigger.indexOf("focusin")<0&&M.target!==K()||b.props.interactive&&M.relatedTarget&&k.contains(M.relatedTarget)||H(M)}function Yt(M){return vn.isTouch?U()!==M.type.indexOf("touch")>=0:!1}function Sn(){Er();var M=b.props,W=M.popperOptions,te=M.placement,be=M.offset,de=M.getReferenceClientRect,gt=M.moveTransition,qt=$()?yf(k).arrow:null,ns=de?{getBoundingClientRect:de,contextElement:de.contextElement||K()}:n,Fb={name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(ml){var rs=ml.state;if($()){var C3=Ee(),zf=C3.box;["placement","reference-hidden","escaped"].forEach(function(gl){gl==="placement"?zf.setAttribute("data-placement",rs.placement):rs.attributes.popper["data-popper-"+gl]?zf.setAttribute("data-"+gl,""):zf.removeAttribute("data-"+gl)}),rs.attributes.popper={}}}},ci=[{name:"offset",options:{offset:be}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!gt}},Fb];$()&&qt&&ci.push({name:"arrow",options:{element:qt,padding:3}}),ci.push.apply(ci,(W==null?void 0:W.modifiers)||[]),b.popperInstance=cP(ns,k,Object.assign({},W,{placement:te,onFirstUpdate:h,modifiers:ci}))}function Er(){b.popperInstance&&(b.popperInstance.destroy(),b.popperInstance=null)}function S(){var M=b.props.appendTo,W,te=K();b.props.interactive&&M===l0||M==="parent"?W=te.parentNode:W=c0(M,[te]),W.contains(k)||W.appendChild(k),b.state.isMounted=!0,Sn()}function _(){return Za(k.querySelectorAll("[data-tippy-root]"))}function P(M){b.clearDelayTimeouts(),M&&he("onTrigger",[b,M]),je();var W=fe(!0),te=B(),be=te[0],de=te[1];vn.isTouch&&be==="hold"&&de&&(W=de),W?r=setTimeout(function(){b.show()},W):b.show()}function H(M){if(b.clearDelayTimeouts(),he("onUntrigger",[b,M]),!b.state.isVisible){oe();return}if(!(b.props.trigger.indexOf("mouseenter")>=0&&b.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(M.type)>=0&&o)){var W=fe(!1);W?i=setTimeout(function(){b.state.isVisible&&b.hide()},W):s=requestAnimationFrame(function(){b.hide()})}}function ye(){b.state.isEnabled=!0}function Z(){b.hide(),b.state.isEnabled=!1}function N(){clearTimeout(r),clearTimeout(i),cancelAnimationFrame(s)}function D(M){if(!b.state.isDestroyed){he("onBeforeUpdate",[b,M]),kn();var W=b.props,te=b0(n,Object.assign({},W,d0(M),{ignoreAttributes:!0}));b.props=te,Wt(),W.interactiveDebounce!==te.interactiveDebounce&&(Le(),p=u0(R,te.interactiveDebounce)),W.triggerTarget&&!te.triggerTarget?Ki(W.triggerTarget).forEach(function(be){be.removeAttribute("aria-expanded")}):te.triggerTarget&&n.removeAttribute("aria-expanded"),Ge(),ve(),x&&x(W,te),b.popperInstance&&(Sn(),_().forEach(function(be){requestAnimationFrame(be._tippy.popperInstance.forceUpdate)})),he("onAfterUpdate",[b,M])}}function pe(M){b.setProps({content:M})}function Ie(){var M=b.state.isVisible,W=b.state.isDestroyed,te=!b.state.isEnabled,be=vn.isTouch&&!b.props.touch,de=df(b.props.duration,0,sn.duration);if(!(M||W||te||be)&&!K().hasAttribute("disabled")&&(he("onShow",[b],!1),b.props.onShow(b)!==!1)){if(b.state.isVisible=!0,$()&&(k.style.visibility="visible"),ve(),je(),b.state.isMounted||(k.style.transition="none"),$()){var gt=Ee(),qt=gt.box,ns=gt.content;pf([qt,ns],0)}h=function(){var ci;if(!(!b.state.isVisible||c)){if(c=!0,k.offsetHeight,k.style.transition=b.props.moveTransition,$()&&b.props.animation){var jf=Ee(),ml=jf.box,rs=jf.content;pf([ml,rs],de),h0([ml,rs],"visible")}He(),Ge(),f0(bf,b),(ci=b.popperInstance)==null||ci.forceUpdate(),he("onMount",[b]),b.props.animation&&$()&&pt(de,function(){b.state.isShown=!0,he("onShown",[b])})}},S()}}function xn(){var M=!b.state.isVisible,W=b.state.isDestroyed,te=!b.state.isEnabled,be=df(b.props.duration,1,sn.duration);if(!(M||W||te)&&(he("onHide",[b],!1),b.props.onHide(b)!==!1)){if(b.state.isVisible=!1,b.state.isShown=!1,c=!1,o=!1,$()&&(k.style.visibility="hidden"),Le(),oe(),ve(!0),$()){var de=Ee(),gt=de.box,qt=de.content;b.props.animation&&(pf([gt,qt],be),h0([gt,qt],"hidden"))}He(),Ge(),b.props.animation?$()&&Gt(be,b.unmount):b.unmount()}}function ts(M){_e().addEventListener("mousemove",p),f0(tl,p),p(M)}function Tr(){b.state.isVisible&&b.hide(),b.state.isMounted&&(Er(),_().forEach(function(M){M._tippy.unmount()}),k.parentNode&&k.parentNode.removeChild(k),bf=bf.filter(function(M){return M!==b}),b.state.isMounted=!1,he("onHidden",[b]))}function $f(){b.state.isDestroyed||(b.clearDelayTimeouts(),b.unmount(),kn(),delete n._tippy,b.state.isDestroyed=!0,he("onDestroy",[b]))}}function Yi(n,e){e===void 0&&(e={});var t=sn.plugins.concat(e.plugins||[]);SP();var r=Object.assign({},e,{plugins:t}),i=bP(n),s=i.reduce(function(o,a){var l=a&&IP(a,r);return l&&o.push(l),o},[]);return el(n)?s[0]:s}Yi.defaultProps=sn,Yi.setDefaultProps=NP,Yi.currentInput=vn,Object.assign({},Hy,{effect:function(e){var t=e.state,r={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(t.elements.popper.style,r.popper),t.styles=r,t.elements.arrow&&Object.assign(t.elements.arrow.style,r.arrow)}}),Yi.setDefaultProps({render:C0});class DP{constructor({editor:e,element:t,view:r,tippyOptions:i={},updateDelay:s=250,shouldShow:o}){this.preventHide=!1,this.shouldShow=({view:a,state:l,from:c,to:u})=>{const{doc:d,selection:h}=l,{empty:m}=h,p=!d.textBetween(c,u).length&&Ku(l.selection),g=this.element.contains(document.activeElement);return!(!(a.hasFocus()||g)||m||p||!this.editor.isEditable)},this.mousedownHandler=()=>{this.preventHide=!0},this.dragstartHandler=()=>{this.hide()},this.focusHandler=()=>{setTimeout(()=>this.update(this.editor.view))},this.blurHandler=({event:a})=>{var l;if(this.preventHide){this.preventHide=!1;return}a!=null&&a.relatedTarget&&(!((l=this.element.parentNode)===null||l===void 0)&&l.contains(a.relatedTarget))||(a==null?void 0:a.relatedTarget)!==this.editor.view.dom&&this.hide()},this.tippyBlurHandler=a=>{this.blurHandler({event:a})},this.handleDebouncedUpdate=(a,l)=>{const c=!(l!=null&&l.selection.eq(a.state.selection)),u=!(l!=null&&l.doc.eq(a.state.doc));!c&&!u||(this.updateDebounceTimer&&clearTimeout(this.updateDebounceTimer),this.updateDebounceTimer=window.setTimeout(()=>{this.updateHandler(a,c,u,l)},this.updateDelay))},this.updateHandler=(a,l,c,u)=>{var d,h,m;const{state:p,composing:g}=a,{selection:y}=p;if(g||!l&&!c)return;this.createTooltip();const{ranges:C}=y,w=Math.min(...C.map(k=>k.$from.pos)),b=Math.max(...C.map(k=>k.$to.pos));if(!((d=this.shouldShow)===null||d===void 0?void 0:d.call(this,{editor:this.editor,element:this.element,view:a,state:p,oldState:u,from:w,to:b}))){this.hide();return}(h=this.tippy)===null||h===void 0||h.setProps({getReferenceClientRect:((m=this.tippyOptions)===null||m===void 0?void 0:m.getReferenceClientRect)||(()=>{if(Fy(p.selection)){let k=a.nodeDOM(w);if(k){const x=k.dataset.nodeViewWrapper?k:k.querySelector("[data-node-view-wrapper]");if(x&&(k=x.firstChild),k)return k.getBoundingClientRect()}}return By(a,w,b)})}),this.show()},this.editor=e,this.element=t,this.view=r,this.updateDelay=s,o&&(this.shouldShow=o),this.element.addEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.view.dom.addEventListener("dragstart",this.dragstartHandler),this.editor.on("focus",this.focusHandler),this.editor.on("blur",this.blurHandler),this.tippyOptions=i,this.element.remove(),this.element.style.visibility="visible"}createTooltip(){const{element:e}=this.editor.options,t=!!e.parentElement;this.tippy||!t||(this.tippy=Yi(e,{duration:0,getReferenceClientRect:null,content:this.element,interactive:!0,trigger:"manual",placement:"top",hideOnClick:"toggle",...this.tippyOptions}),this.tippy.popper.firstChild&&this.tippy.popper.firstChild.addEventListener("blur",this.tippyBlurHandler))}update(e,t){const{state:r}=e,i=r.selection.from!==r.selection.to;if(this.updateDelay>0&&i){this.handleDebouncedUpdate(e,t);return}const s=!(t!=null&&t.selection.eq(e.state.selection)),o=!(t!=null&&t.doc.eq(e.state.doc));this.updateHandler(e,s,o,t)}show(){var e;(e=this.tippy)===null||e===void 0||e.show()}hide(){var e;(e=this.tippy)===null||e===void 0||e.hide()}destroy(){var e,t;!((e=this.tippy)===null||e===void 0)&&e.popper.firstChild&&this.tippy.popper.firstChild.removeEventListener("blur",this.tippyBlurHandler),(t=this.tippy)===null||t===void 0||t.destroy(),this.element.removeEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.view.dom.removeEventListener("dragstart",this.dragstartHandler),this.editor.off("focus",this.focusHandler),this.editor.off("blur",this.blurHandler)}}const k0=n=>new nt({key:typeof n.pluginKey=="string"?new Lt(n.pluginKey):n.pluginKey,view:e=>new DP({view:e,...n})});et.create({name:"bubbleMenu",addOptions(){return{element:null,tippyOptions:{},pluginKey:"bubbleMenu",updateDelay:void 0,shouldShow:null}},addProseMirrorPlugins(){return this.options.element?[k0({pluginKey:this.options.pluginKey,editor:this.editor,element:this.options.element,tippyOptions:this.options.tippyOptions,updateDelay:this.options.updateDelay,shouldShow:this.options.shouldShow})]:[]}});class LP{constructor({editor:e,element:t,view:r,tippyOptions:i={},shouldShow:s}){this.preventHide=!1,this.shouldShow=({view:o,state:a})=>{const{selection:l}=a,{$anchor:c,empty:u}=l,d=c.depth===1,h=c.parent.isTextblock&&!c.parent.type.spec.code&&!c.parent.textContent;return!(!o.hasFocus()||!u||!d||!h||!this.editor.isEditable)},this.mousedownHandler=()=>{this.preventHide=!0},this.focusHandler=()=>{setTimeout(()=>this.update(this.editor.view))},this.blurHandler=({event:o})=>{var a;if(this.preventHide){this.preventHide=!1;return}o!=null&&o.relatedTarget&&(!((a=this.element.parentNode)===null||a===void 0)&&a.contains(o.relatedTarget))||(o==null?void 0:o.relatedTarget)!==this.editor.view.dom&&this.hide()},this.tippyBlurHandler=o=>{this.blurHandler({event:o})},this.editor=e,this.element=t,this.view=r,s&&(this.shouldShow=s),this.element.addEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.editor.on("focus",this.focusHandler),this.editor.on("blur",this.blurHandler),this.tippyOptions=i,this.element.remove(),this.element.style.visibility="visible"}createTooltip(){const{element:e}=this.editor.options,t=!!e.parentElement;this.tippy||!t||(this.tippy=Yi(e,{duration:0,getReferenceClientRect:null,content:this.element,interactive:!0,trigger:"manual",placement:"right",hideOnClick:"toggle",...this.tippyOptions}),this.tippy.popper.firstChild&&this.tippy.popper.firstChild.addEventListener("blur",this.tippyBlurHandler))}update(e,t){var r,i,s;const{state:o}=e,{doc:a,selection:l}=o,{from:c,to:u}=l;if(t&&t.doc.eq(a)&&t.selection.eq(l))return;if(this.createTooltip(),!((r=this.shouldShow)===null||r===void 0?void 0:r.call(this,{editor:this.editor,view:e,state:o,oldState:t}))){this.hide();return}(i=this.tippy)===null||i===void 0||i.setProps({getReferenceClientRect:((s=this.tippyOptions)===null||s===void 0?void 0:s.getReferenceClientRect)||(()=>By(e,c,u))}),this.show()}show(){var e;(e=this.tippy)===null||e===void 0||e.show()}hide(){var e;(e=this.tippy)===null||e===void 0||e.hide()}destroy(){var e,t;!((e=this.tippy)===null||e===void 0)&&e.popper.firstChild&&this.tippy.popper.firstChild.removeEventListener("blur",this.tippyBlurHandler),(t=this.tippy)===null||t===void 0||t.destroy(),this.element.removeEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.editor.off("focus",this.focusHandler),this.editor.off("blur",this.blurHandler)}}const S0=n=>new nt({key:typeof n.pluginKey=="string"?new Lt(n.pluginKey):n.pluginKey,view:e=>new LP({view:e,...n})});et.create({name:"floatingMenu",addOptions(){return{element:null,tippyOptions:{},pluginKey:"floatingMenu",shouldShow:null}},addProseMirrorPlugins(){return this.options.element?[S0({pluginKey:this.options.pluginKey,editor:this.editor,element:this.options.element,tippyOptions:this.options.tippyOptions,shouldShow:this.options.shouldShow})]:[]}});const RP=f.defineComponent({name:"BubbleMenu",props:{pluginKey:{type:[String,Object],default:"bubbleMenu"},editor:{type:Object,required:!0},updateDelay:{type:Number,default:void 0},tippyOptions:{type:Object,default:()=>({})},shouldShow:{type:Function,default:null}},setup(n,{slots:e}){const t=f.ref(null);return f.onMounted(()=>{const{updateDelay:r,editor:i,pluginKey:s,shouldShow:o,tippyOptions:a}=n;i.registerPlugin(k0({updateDelay:r,editor:i,element:t.value,pluginKey:s,shouldShow:o,tippyOptions:a}))}),f.onBeforeUnmount(()=>{const{pluginKey:r,editor:i}=n;i.unregisterPlugin(r)}),()=>{var r;return f.h("div",{ref:t},(r=e.default)===null||r===void 0?void 0:r.call(e))}}});function x0(n){return f.customRef((e,t)=>({get(){return e(),n},set(r){n=r,requestAnimationFrame(()=>{requestAnimationFrame(()=>{t()})})}}))}class FP extends rA{constructor(e={}){return super(e),this.contentComponent=null,this.appContext=null,this.reactiveState=x0(this.view.state),this.reactiveExtensionStorage=x0(this.extensionStorage),this.on("beforeTransaction",({nextState:t})=>{this.reactiveState.value=t,this.reactiveExtensionStorage.value=this.extensionStorage}),f.markRaw(this)}get state(){return this.reactiveState?this.reactiveState.value:this.view.state}get storage(){return this.reactiveExtensionStorage?this.reactiveExtensionStorage.value:super.storage}registerPlugin(e,t){const r=super.registerPlugin(e,t);return this.reactiveState&&(this.reactiveState.value=r),r}unregisterPlugin(e){const t=super.unregisterPlugin(e);return this.reactiveState&&t&&(this.reactiveState.value=t),t}}const BP=f.defineComponent({name:"EditorContent",props:{editor:{default:null,type:Object}},setup(n){const e=f.ref(),t=f.getCurrentInstance();return f.watchEffect(()=>{const r=n.editor;r&&r.options.element&&e.value&&f.nextTick(()=>{if(!e.value||!r.options.element.firstChild)return;const i=f.unref(e.value);e.value.append(...r.options.element.childNodes),r.contentComponent=t.ctx._,t&&(r.appContext={...t.appContext,provides:t.provides}),r.setOptions({element:i}),r.createNodeViews()})}),f.onBeforeUnmount(()=>{const r=n.editor;r&&(r.contentComponent=null,r.appContext=null)}),{rootEl:e}},render(){return f.h("div",{ref:n=>{this.rootEl=n}})}});f.defineComponent({name:"FloatingMenu",props:{pluginKey:{type:null,default:"floatingMenu"},editor:{type:Object,required:!0},tippyOptions:{type:Object,default:()=>({})},shouldShow:{type:Function,default:null}},setup(n,{slots:e}){const t=f.ref(null);return f.onMounted(()=>{const{pluginKey:r,editor:i,tippyOptions:s,shouldShow:o}=n;i.registerPlugin(S0({pluginKey:r,editor:i,element:t.value,tippyOptions:s,shouldShow:o}))}),f.onBeforeUnmount(()=>{const{pluginKey:r,editor:i}=n;i.unregisterPlugin(r)}),()=>{var r;return f.h("div",{ref:t},(r=e.default)===null||r===void 0?void 0:r.call(e))}}}),f.defineComponent({name:"NodeViewContent",props:{as:{type:String,default:"div"}},render(){return f.h(this.as,{style:{whiteSpace:"pre-wrap"},"data-node-view-content":""})}}),f.defineComponent({name:"NodeViewWrapper",props:{as:{type:String,default:"div"}},inject:["onDragStart","decorationClasses"],render(){var n,e;return f.h(this.as,{class:this.decorationClasses,style:{whiteSpace:"normal"},"data-node-view-wrapper":"",onDragstart:this.onDragStart},(e=(n=this.$slots).default)===null||e===void 0?void 0:e.call(n))}});const VP=(n={})=>{const e=f.shallowRef();return f.onMounted(()=>{e.value=new FP(n)}),f.onBeforeUnmount(()=>{var t,r,i;const s=(t=e.value)===null||t===void 0?void 0:t.options.element,o=s==null?void 0:s.cloneNode(!0);(r=s==null?void 0:s.parentNode)===null||r===void 0||r.replaceChild(o,s),(i=e.value)===null||i===void 0||i.destroy()}),e},$P=/^\s*>\s$/,jP=rn.create({name:"blockquote",addOptions(){return{HTMLAttributes:{}}},content:"block+",group:"block",defining:!0,parseHTML(){return[{tag:"blockquote"}]},renderHTML({HTMLAttributes:n}){return["blockquote",dt(this.options.HTMLAttributes,n),0]},addCommands(){return{setBlockquote:()=>({commands:n})=>n.wrapIn(this.name),toggleBlockquote:()=>({commands:n})=>n.toggleWrap(this.name),unsetBlockquote:()=>({commands:n})=>n.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[so({find:$P,type:this.type})]}}),zP=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,HP=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,GP=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,UP=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,WP=vr.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:n=>n.style.fontWeight!=="normal"&&null},{style:"font-weight=400",clearMark:n=>n.type.name===this.name},{style:"font-weight",getAttrs:n=>/^(bold(er)?|[5-9]\d{2,})$/.test(n)&&null}]},renderHTML({HTMLAttributes:n}){return["strong",dt(this.options.HTMLAttributes,n),0]},addCommands(){return{setBold:()=>({commands:n})=>n.setMark(this.name),toggleBold:()=>({commands:n})=>n.toggleMark(this.name),unsetBold:()=>({commands:n})=>n.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[ji({find:zP,type:this.type}),ji({find:GP,type:this.type})]},addPasteRules(){return[zi({find:HP,type:this.type}),zi({find:UP,type:this.type})]}}),KP="listItem",_0="textStyle",E0=/^\s*([-+*])\s$/,YP=rn.create({name:"bulletList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:n}){return["ul",dt(this.options.HTMLAttributes,n),0]},addCommands(){return{toggleBulletList:()=>({commands:n,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(KP,this.editor.getAttributes(_0)).run():n.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let n=so({find:E0,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(n=so({find:E0,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(_0),editor:this.editor})),[n]}}),qP=new RegExp("(?<!`)`([^`]+)`(?!`)"),XP=new RegExp("(?<!`)`([^`]+)`(?!`)","g"),JP=vr.create({name:"code",addOptions(){return{HTMLAttributes:{}}},excludes:"_",code:!0,exitable:!0,parseHTML(){return[{tag:"code"}]},renderHTML({HTMLAttributes:n}){return["code",dt(this.options.HTMLAttributes,n),0]},addCommands(){return{setCode:()=>({commands:n})=>n.setMark(this.name),toggleCode:()=>({commands:n})=>n.toggleMark(this.name),unsetCode:()=>({commands:n})=>n.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[ji({find:qP,type:this.type})]},addPasteRules(){return[zi({find:XP,type:this.type})]}}),QP=/^```([a-z]+)?[\s\n]$/,ZP=/^~~~([a-z]+)?[\s\n]$/,eI=rn.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:this.options.defaultLanguage,parseHTML:n=>{var e;const{languageClassPrefix:t}=this.options,s=[...((e=n.firstElementChild)===null||e===void 0?void 0:e.classList)||[]].filter(o=>o.startsWith(t)).map(o=>o.replace(t,""))[0];return s||null},rendered:!1}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({node:n,HTMLAttributes:e}){return["pre",dt(this.options.HTMLAttributes,e),["code",{class:n.attrs.language?this.options.languageClassPrefix+n.attrs.language:null},0]]},addCommands(){return{setCodeBlock:n=>({commands:e})=>e.setNode(this.name,n),toggleCodeBlock:n=>({commands:e})=>e.toggleNode(this.name,"paragraph",n)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:n,$anchor:e}=this.editor.state.selection,t=e.pos===1;return!n||e.parent.type.name!==this.name?!1:t||!e.parent.textContent.length?this.editor.commands.clearNodes():!1},Enter:({editor:n})=>{if(!this.options.exitOnTripleEnter)return!1;const{state:e}=n,{selection:t}=e,{$from:r,empty:i}=t;if(!i||r.parent.type!==this.type)return!1;const s=r.parentOffset===r.parent.nodeSize-2,o=r.parent.textContent.endsWith(`

`);return!s||!o?!1:n.chain().command(({tr:a})=>(a.delete(r.pos-2,r.pos),!0)).exitCode().run()},ArrowDown:({editor:n})=>{if(!this.options.exitOnArrowDown)return!1;const{state:e}=n,{selection:t,doc:r}=e,{$from:i,empty:s}=t;if(!s||i.parent.type!==this.type||!(i.parentOffset===i.parent.nodeSize-2))return!1;const a=i.after();return a===void 0?!1:r.nodeAt(a)?n.commands.command(({tr:c})=>(c.setSelection(re.near(r.resolve(a))),!0)):n.commands.exitCode()}}},addInputRules(){return[tf({find:QP,type:this.type,getAttributes:n=>({language:n[1]})}),tf({find:ZP,type:this.type,getAttributes:n=>({language:n[1]})})]},addProseMirrorPlugins(){return[new nt({key:new Lt("codeBlockVSCodeHandler"),props:{handlePaste:(n,e)=>{if(!e.clipboardData||this.editor.isActive(this.type.name))return!1;const t=e.clipboardData.getData("text/plain"),r=e.clipboardData.getData("vscode-editor-data"),i=r?JSON.parse(r):void 0,s=i==null?void 0:i.mode;if(!t||!s)return!1;const{tr:o,schema:a}=n.state,l=a.text(t.replace(/\r\n?/g,`
`));return o.replaceSelectionWith(this.type.create({language:s},l)),o.selection.$from.parent.type!==this.type&&o.setSelection(ne.near(o.doc.resolve(Math.max(0,o.selection.from-2)))),o.setMeta("paste",!0),n.dispatch(o),!0}}})]}}),tI=rn.create({name:"doc",topNode:!0,content:"block+"});function nI(n={}){return new nt({view(e){return new rI(e,n)}})}class rI{constructor(e,t){var r;this.editorView=e,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=(r=t.width)!==null&&r!==void 0?r:1,this.color=t.color===!1?void 0:t.color||"black",this.class=t.class,this.handlers=["dragover","dragend","drop","dragleave"].map(i=>{let s=o=>{this[i](o)};return e.dom.addEventListener(i,s),{name:i,handler:s}})}destroy(){this.handlers.forEach(({name:e,handler:t})=>this.editorView.dom.removeEventListener(e,t))}update(e,t){this.cursorPos!=null&&t.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(e){e!=this.cursorPos&&(this.cursorPos=e,e==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let e=this.editorView.state.doc.resolve(this.cursorPos),t=!e.parent.inlineContent,r;if(t){let a=e.nodeBefore,l=e.nodeAfter;if(a||l){let c=this.editorView.nodeDOM(this.cursorPos-(a?a.nodeSize:0));if(c){let u=c.getBoundingClientRect(),d=a?u.bottom:u.top;a&&l&&(d=(d+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2),r={left:u.left,right:u.right,top:d-this.width/2,bottom:d+this.width/2}}}}if(!r){let a=this.editorView.coordsAtPos(this.cursorPos);r={left:a.left-this.width/2,right:a.left+this.width/2,top:a.top,bottom:a.bottom}}let i=this.editorView.dom.offsetParent;this.element||(this.element=i.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",t),this.element.classList.toggle("prosemirror-dropcursor-inline",!t);let s,o;if(!i||i==document.body&&getComputedStyle(i).position=="static")s=-pageXOffset,o=-pageYOffset;else{let a=i.getBoundingClientRect();s=a.left-i.scrollLeft,o=a.top-i.scrollTop}this.element.style.left=r.left-s+"px",this.element.style.top=r.top-o+"px",this.element.style.width=r.right-r.left+"px",this.element.style.height=r.bottom-r.top+"px"}scheduleRemoval(e){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),e)}dragover(e){if(!this.editorView.editable)return;let t=this.editorView.posAtCoords({left:e.clientX,top:e.clientY}),r=t&&t.inside>=0&&this.editorView.state.doc.nodeAt(t.inside),i=r&&r.type.spec.disableDropCursor,s=typeof i=="function"?i(this.editorView,t,e):i;if(t&&!s){let o=t.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let a=jm(this.editorView.state.doc,o,this.editorView.dragging.slice);a!=null&&(o=a)}this.setCursor(o),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(e){(e.target==this.editorView.dom||!this.editorView.dom.contains(e.relatedTarget))&&this.setCursor(null)}}const iI=et.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins(){return[nI(this.options)]}});class De extends re{constructor(e){super(e,e)}map(e,t){let r=e.resolve(t.map(this.head));return De.valid(r)?new De(r):re.near(r)}content(){return V.empty}eq(e){return e instanceof De&&e.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new De(e.resolve(t.pos))}getBookmark(){return new vf(this.anchor)}static valid(e){let t=e.parent;if(t.isTextblock||!sI(e)||!oI(e))return!1;let r=t.type.spec.allowGapCursor;if(r!=null)return r;let i=t.contentMatchAt(e.index()).defaultType;return i&&i.isTextblock}static findGapCursorFrom(e,t,r=!1){e:for(;;){if(!r&&De.valid(e))return e;let i=e.pos,s=null;for(let o=e.depth;;o--){let a=e.node(o);if(t>0?e.indexAfter(o)<a.childCount:e.index(o)>0){s=a.child(t>0?e.indexAfter(o):e.index(o)-1);break}else if(o==0)return null;i+=t;let l=e.doc.resolve(i);if(De.valid(l))return l}for(;;){let o=t>0?s.firstChild:s.lastChild;if(!o){if(s.isAtom&&!s.isText&&!q.isSelectable(s)){e=e.doc.resolve(i+s.nodeSize*t),r=!1;continue e}break}s=o,i+=t;let a=e.doc.resolve(i);if(De.valid(a))return a}return null}}}De.prototype.visible=!1,De.findFrom=De.findGapCursorFrom,re.jsonID("gapcursor",De);class vf{constructor(e){this.pos=e}map(e){return new vf(e.map(this.pos))}resolve(e){let t=e.resolve(this.pos);return De.valid(t)?new De(t):re.near(t)}}function sI(n){for(let e=n.depth;e>=0;e--){let t=n.index(e),r=n.node(e);if(t==0){if(r.type.spec.isolating)return!0;continue}for(let i=r.child(t-1);;i=i.lastChild){if(i.childCount==0&&!i.inlineContent||i.isAtom||i.type.spec.isolating)return!0;if(i.inlineContent)return!1}}return!0}function oI(n){for(let e=n.depth;e>=0;e--){let t=n.indexAfter(e),r=n.node(e);if(t==r.childCount){if(r.type.spec.isolating)return!0;continue}for(let i=r.child(t);;i=i.firstChild){if(i.childCount==0&&!i.inlineContent||i.isAtom||i.type.spec.isolating)return!0;if(i.inlineContent)return!1}}return!0}function aI(){return new nt({props:{decorations:fI,createSelectionBetween(n,e,t){return e.pos==t.pos&&De.valid(t)?new De(t):null},handleClick:cI,handleKeyDown:lI,handleDOMEvents:{beforeinput:uI}}})}const lI=hy({ArrowLeft:nl("horiz",-1),ArrowRight:nl("horiz",1),ArrowUp:nl("vert",-1),ArrowDown:nl("vert",1)});function nl(n,e){const t=n=="vert"?e>0?"down":"up":e>0?"right":"left";return function(r,i,s){let o=r.selection,a=e>0?o.$to:o.$from,l=o.empty;if(o instanceof ne){if(!s.endOfTextblock(t)||a.depth==0)return!1;l=!1,a=r.doc.resolve(e>0?a.after():a.before())}let c=De.findGapCursorFrom(a,e,l);return c?(i&&i(r.tr.setSelection(new De(c))),!0):!1}}function cI(n,e,t){if(!n||!n.editable)return!1;let r=n.state.doc.resolve(e);if(!De.valid(r))return!1;let i=n.posAtCoords({left:t.clientX,top:t.clientY});return i&&i.inside>-1&&q.isSelectable(n.state.doc.nodeAt(i.inside))?!1:(n.dispatch(n.state.tr.setSelection(new De(r))),!0)}function uI(n,e){if(e.inputType!="insertCompositionText"||!(n.state.selection instanceof De))return!1;let{$from:t}=n.state.selection,r=t.parent.contentMatchAt(t.index()).findWrapping(n.state.schema.nodes.text);if(!r)return!1;let i=I.empty;for(let o=r.length-1;o>=0;o--)i=I.from(r[o].createAndFill(null,i));let s=n.state.tr.replace(t.pos,t.pos,new V(i,0,0));return s.setSelection(ne.near(s.doc.resolve(t.pos+1))),n.dispatch(s),!1}function fI(n){if(!(n.selection instanceof De))return null;let e=document.createElement("div");return e.className="ProseMirror-gapcursor",ze.create(n.doc,[Vt.widget(n.selection.head,e,{key:"gapcursor"})])}const dI=et.create({name:"gapCursor",addProseMirrorPlugins(){return[aI()]},extendNodeSchema(n){var e;const t={name:n.name,options:n.options,storage:n.storage};return{allowGapCursor:(e=se(j(n,"allowGapCursor",t)))!==null&&e!==void 0?e:null}}}),hI=rn.create({name:"hardBreak",addOptions(){return{keepMarks:!0,HTMLAttributes:{}}},inline:!0,group:"inline",selectable:!1,linebreakReplacement:!0,parseHTML(){return[{tag:"br"}]},renderHTML({HTMLAttributes:n}){return["br",dt(this.options.HTMLAttributes,n)]},renderText(){return`
`},addCommands(){return{setHardBreak:()=>({commands:n,chain:e,state:t,editor:r})=>n.first([()=>n.exitCode(),()=>n.command(()=>{const{selection:i,storedMarks:s}=t;if(i.$from.parent.type.spec.isolating)return!1;const{keepMarks:o}=this.options,{splittableMarks:a}=r.extensionManager,l=s||i.$to.parentOffset&&i.$from.marks();return e().insertContent({type:this.name}).command(({tr:c,dispatch:u})=>{if(u&&l&&o){const d=l.filter(h=>a.includes(h.type.name));c.ensureMarks(d)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),pI=rn.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map(n=>({tag:`h${n}`,attrs:{level:n}}))},renderHTML({node:n,HTMLAttributes:e}){return[`h${this.options.levels.includes(n.attrs.level)?n.attrs.level:this.options.levels[0]}`,dt(this.options.HTMLAttributes,e),0]},addCommands(){return{setHeading:n=>({commands:e})=>this.options.levels.includes(n.level)?e.setNode(this.name,n):!1,toggleHeading:n=>({commands:e})=>this.options.levels.includes(n.level)?e.toggleNode(this.name,"paragraph",n):!1}},addKeyboardShortcuts(){return this.options.levels.reduce((n,e)=>({...n,[`Mod-Alt-${e}`]:()=>this.editor.commands.toggleHeading({level:e})}),{})},addInputRules(){return this.options.levels.map(n=>tf({find:new RegExp(`^(#{1,${n}})\\s$`),type:this.type,getAttributes:{level:n}}))}});var rl=200,qe=function(){};qe.prototype.append=function(e){return e.length?(e=qe.from(e),!this.length&&e||e.length<rl&&this.leafAppend(e)||this.length<rl&&e.leafPrepend(this)||this.appendInner(e)):this},qe.prototype.prepend=function(e){return e.length?qe.from(e).append(this):this},qe.prototype.appendInner=function(e){return new mI(this,e)},qe.prototype.slice=function(e,t){return e===void 0&&(e=0),t===void 0&&(t=this.length),e>=t?qe.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,t))},qe.prototype.get=function(e){if(!(e<0||e>=this.length))return this.getInner(e)},qe.prototype.forEach=function(e,t,r){t===void 0&&(t=0),r===void 0&&(r=this.length),t<=r?this.forEachInner(e,t,r,0):this.forEachInvertedInner(e,t,r,0)},qe.prototype.map=function(e,t,r){t===void 0&&(t=0),r===void 0&&(r=this.length);var i=[];return this.forEach(function(s,o){return i.push(e(s,o))},t,r),i},qe.from=function(e){return e instanceof qe?e:e&&e.length?new T0(e):qe.empty};var T0=function(n){function e(r){n.call(this),this.values=r}n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e;var t={length:{configurable:!0},depth:{configurable:!0}};return e.prototype.flatten=function(){return this.values},e.prototype.sliceInner=function(i,s){return i==0&&s==this.length?this:new e(this.values.slice(i,s))},e.prototype.getInner=function(i){return this.values[i]},e.prototype.forEachInner=function(i,s,o,a){for(var l=s;l<o;l++)if(i(this.values[l],a+l)===!1)return!1},e.prototype.forEachInvertedInner=function(i,s,o,a){for(var l=s-1;l>=o;l--)if(i(this.values[l],a+l)===!1)return!1},e.prototype.leafAppend=function(i){if(this.length+i.length<=rl)return new e(this.values.concat(i.flatten()))},e.prototype.leafPrepend=function(i){if(this.length+i.length<=rl)return new e(i.flatten().concat(this.values))},t.length.get=function(){return this.values.length},t.depth.get=function(){return 0},Object.defineProperties(e.prototype,t),e}(qe);qe.empty=new T0([]);var mI=function(n){function e(t,r){n.call(this),this.left=t,this.right=r,this.length=t.length+r.length,this.depth=Math.max(t.depth,r.depth)+1}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},e.prototype.getInner=function(r){return r<this.left.length?this.left.get(r):this.right.get(r-this.left.length)},e.prototype.forEachInner=function(r,i,s,o){var a=this.left.length;if(i<a&&this.left.forEachInner(r,i,Math.min(s,a),o)===!1||s>a&&this.right.forEachInner(r,Math.max(i-a,0),Math.min(this.length,s)-a,o+a)===!1)return!1},e.prototype.forEachInvertedInner=function(r,i,s,o){var a=this.left.length;if(i>a&&this.right.forEachInvertedInner(r,i-a,Math.max(s,a)-a,o+a)===!1||s<a&&this.left.forEachInvertedInner(r,Math.min(i,a),s,o)===!1)return!1},e.prototype.sliceInner=function(r,i){if(r==0&&i==this.length)return this;var s=this.left.length;return i<=s?this.left.slice(r,i):r>=s?this.right.slice(r-s,i-s):this.left.slice(r,s).append(this.right.slice(0,i-s))},e.prototype.leafAppend=function(r){var i=this.right.leafAppend(r);if(i)return new e(this.left,i)},e.prototype.leafPrepend=function(r){var i=this.left.leafPrepend(r);if(i)return new e(i,this.right)},e.prototype.appendInner=function(r){return this.left.depth>=Math.max(this.right.depth,r.depth)+1?new e(this.left,new e(this.right,r)):new e(this,r)},e}(qe);const gI=500;class on{constructor(e,t){this.items=e,this.eventCount=t}popEvent(e,t){if(this.eventCount==0)return null;let r=this.items.length;for(;;r--)if(this.items.get(r-1).selection){--r;break}let i,s;t&&(i=this.remapping(r,this.items.length),s=i.maps.length);let o=e.tr,a,l,c=[],u=[];return this.items.forEach((d,h)=>{if(!d.step){i||(i=this.remapping(r,h+1),s=i.maps.length),s--,u.push(d);return}if(i){u.push(new wn(d.map));let m=d.step.map(i.slice(s)),p;m&&o.maybeStep(m).doc&&(p=o.mapping.maps[o.mapping.maps.length-1],c.push(new wn(p,void 0,void 0,c.length+u.length))),s--,p&&i.appendMap(p,s)}else o.maybeStep(d.step);if(d.selection)return a=i?d.selection.map(i.slice(s)):d.selection,l=new on(this.items.slice(0,r).append(u.reverse().concat(c)),this.eventCount-1),!1},this.items.length,0),{remaining:l,transform:o,selection:a}}addTransform(e,t,r,i){let s=[],o=this.eventCount,a=this.items,l=!i&&a.length?a.get(a.length-1):null;for(let u=0;u<e.steps.length;u++){let d=e.steps[u].invert(e.docs[u]),h=new wn(e.mapping.maps[u],d,t),m;(m=l&&l.merge(h))&&(h=m,u?s.pop():a=a.slice(0,a.length-1)),s.push(h),t&&(o++,t=void 0),i||(l=h)}let c=o-r.depth;return c>bI&&(a=yI(a,c),o-=c),new on(a.append(s),o)}remapping(e,t){let r=new Ei;return this.items.forEach((i,s)=>{let o=i.mirrorOffset!=null&&s-i.mirrorOffset>=e?r.maps.length-i.mirrorOffset:void 0;r.appendMap(i.map,o)},e,t),r}addMaps(e){return this.eventCount==0?this:new on(this.items.append(e.map(t=>new wn(t))),this.eventCount)}rebased(e,t){if(!this.eventCount)return this;let r=[],i=Math.max(0,this.items.length-t),s=e.mapping,o=e.steps.length,a=this.eventCount;this.items.forEach(h=>{h.selection&&a--},i);let l=t;this.items.forEach(h=>{let m=s.getMirror(--l);if(m==null)return;o=Math.min(o,m);let p=s.maps[m];if(h.step){let g=e.steps[m].invert(e.docs[m]),y=h.selection&&h.selection.map(s.slice(l+1,m));y&&a++,r.push(new wn(p,g,y))}else r.push(new wn(p))},i);let c=[];for(let h=t;h<o;h++)c.push(new wn(s.maps[h]));let u=this.items.slice(0,i).append(c).append(r),d=new on(u,a);return d.emptyItemCount()>gI&&(d=d.compress(this.items.length-r.length)),d}emptyItemCount(){let e=0;return this.items.forEach(t=>{t.step||e++}),e}compress(e=this.items.length){let t=this.remapping(0,e),r=t.maps.length,i=[],s=0;return this.items.forEach((o,a)=>{if(a>=e)i.push(o),o.selection&&s++;else if(o.step){let l=o.step.map(t.slice(r)),c=l&&l.getMap();if(r--,c&&t.appendMap(c,r),l){let u=o.selection&&o.selection.map(t.slice(r));u&&s++;let d=new wn(c.invert(),l,u),h,m=i.length-1;(h=i.length&&i[m].merge(d))?i[m]=h:i.push(d)}}else o.map&&r--},this.items.length,0),new on(qe.from(i.reverse()),s)}}on.empty=new on(qe.empty,0);function yI(n,e){let t;return n.forEach((r,i)=>{if(r.selection&&e--==0)return t=i,!1}),n.slice(t)}class wn{constructor(e,t,r,i){this.map=e,this.step=t,this.selection=r,this.mirrorOffset=i}merge(e){if(this.step&&e.step&&!e.selection){let t=e.step.merge(this.step);if(t)return new wn(t.getMap().invert(),t,this.selection)}}}class kr{constructor(e,t,r,i,s){this.done=e,this.undone=t,this.prevRanges=r,this.prevTime=i,this.prevComposition=s}}const bI=20;function vI(n,e,t,r){let i=t.getMeta(si),s;if(i)return i.historyState;t.getMeta(kI)&&(n=new kr(n.done,n.undone,null,0,-1));let o=t.getMeta("appendedTransaction");if(t.steps.length==0)return n;if(o&&o.getMeta(si))return o.getMeta(si).redo?new kr(n.done.addTransform(t,void 0,r,il(e)),n.undone,O0(t.mapping.maps),n.prevTime,n.prevComposition):new kr(n.done,n.undone.addTransform(t,void 0,r,il(e)),null,n.prevTime,n.prevComposition);if(t.getMeta("addToHistory")!==!1&&!(o&&o.getMeta("addToHistory")===!1)){let a=t.getMeta("composition"),l=n.prevTime==0||!o&&n.prevComposition!=a&&(n.prevTime<(t.time||0)-r.newGroupDelay||!wI(t,n.prevRanges)),c=o?wf(n.prevRanges,t.mapping):O0(t.mapping.maps);return new kr(n.done.addTransform(t,l?e.selection.getBookmark():void 0,r,il(e)),on.empty,c,t.time,a??n.prevComposition)}else return(s=t.getMeta("rebased"))?new kr(n.done.rebased(t,s),n.undone.rebased(t,s),wf(n.prevRanges,t.mapping),n.prevTime,n.prevComposition):new kr(n.done.addMaps(t.mapping.maps),n.undone.addMaps(t.mapping.maps),wf(n.prevRanges,t.mapping),n.prevTime,n.prevComposition)}function wI(n,e){if(!e)return!1;if(!n.docChanged)return!0;let t=!1;return n.mapping.maps[0].forEach((r,i)=>{for(let s=0;s<e.length;s+=2)r<=e[s+1]&&i>=e[s]&&(t=!0)}),t}function O0(n){let e=[];for(let t=n.length-1;t>=0&&e.length==0;t--)n[t].forEach((r,i,s,o)=>e.push(s,o));return e}function wf(n,e){if(!n)return null;let t=[];for(let r=0;r<n.length;r+=2){let i=e.map(n[r],1),s=e.map(n[r+1],-1);i<=s&&t.push(i,s)}return t}function CI(n,e,t){let r=il(e),i=si.get(e).spec.config,s=(t?n.undone:n.done).popEvent(e,r);if(!s)return null;let o=s.selection.resolve(s.transform.doc),a=(t?n.done:n.undone).addTransform(s.transform,e.selection.getBookmark(),i,r),l=new kr(t?a:s.remaining,t?s.remaining:a,null,0,-1);return s.transform.setSelection(o).setMeta(si,{redo:t,historyState:l})}let Cf=!1,N0=null;function il(n){let e=n.plugins;if(N0!=e){Cf=!1,N0=e;for(let t=0;t<e.length;t++)if(e[t].spec.historyPreserveItems){Cf=!0;break}}return Cf}const si=new Lt("history"),kI=new Lt("closeHistory");function SI(n={}){return n={depth:n.depth||100,newGroupDelay:n.newGroupDelay||500},new nt({key:si,state:{init(){return new kr(on.empty,on.empty,null,0,-1)},apply(e,t,r){return vI(t,r,e,n)}},config:n,props:{handleDOMEvents:{beforeinput(e,t){let r=t.inputType,i=r=="historyUndo"?A0:r=="historyRedo"?P0:null;return i?(t.preventDefault(),i(e.state,e.dispatch)):!1}}}})}function M0(n,e){return(t,r)=>{let i=si.getState(t);if(!i||(n?i.undone:i.done).eventCount==0)return!1;if(r){let s=CI(i,t,n);s&&r(e?s.scrollIntoView():s)}return!0}}const A0=M0(!1,!0),P0=M0(!0,!0),xI=et.create({name:"history",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:n,dispatch:e})=>A0(n,e),redo:()=>({state:n,dispatch:e})=>P0(n,e)}},addProseMirrorPlugins(){return[SI(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-я":()=>this.editor.commands.undo(),"Shift-Mod-я":()=>this.editor.commands.redo()}}}),_I=rn.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{}}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:n}){return["hr",dt(this.options.HTMLAttributes,n)]},addCommands(){return{setHorizontalRule:()=>({chain:n,state:e})=>{const{selection:t}=e,{$from:r,$to:i}=t,s=n();return r.parentOffset===0?s.insertContentAt({from:Math.max(r.pos-1,0),to:i.pos},{type:this.name}):Fy(t)?s.insertContentAt(i.pos,{type:this.name}):s.insertContent({type:this.name}),s.command(({tr:o,dispatch:a})=>{var l;if(a){const{$to:c}=o.selection,u=c.end();if(c.nodeAfter)c.nodeAfter.isTextblock?o.setSelection(ne.create(o.doc,c.pos+1)):c.nodeAfter.isBlock?o.setSelection(q.create(o.doc,c.pos)):o.setSelection(ne.create(o.doc,c.pos));else{const d=(l=c.parent.type.contentMatch.defaultType)===null||l===void 0?void 0:l.create();d&&(o.insert(u,d),o.setSelection(ne.create(o.doc,u+1)))}o.scrollIntoView()}return!0}).run()}}},addInputRules(){return[iA({find:/^(?:---|—-|___\s|\*\*\*\s)$/,type:this.type})]}}),EI=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,TI=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,OI=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,NI=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,MI=vr.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:n=>n.style.fontStyle!=="normal"&&null},{style:"font-style=normal",clearMark:n=>n.type.name===this.name},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:n}){return["em",dt(this.options.HTMLAttributes,n),0]},addCommands(){return{setItalic:()=>({commands:n})=>n.setMark(this.name),toggleItalic:()=>({commands:n})=>n.toggleMark(this.name),unsetItalic:()=>({commands:n})=>n.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[ji({find:EI,type:this.type}),ji({find:OI,type:this.type})]},addPasteRules(){return[zi({find:TI,type:this.type}),zi({find:NI,type:this.type})]}}),AI=rn.create({name:"listItem",addOptions(){return{HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:n}){return["li",dt(this.options.HTMLAttributes,n),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),PI="listItem",I0="textStyle",D0=/^(\d+)\.\s$/,II=rn.create({name:"orderedList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes(){return{start:{default:1,parseHTML:n=>n.hasAttribute("start")?parseInt(n.getAttribute("start")||"",10):1},type:{default:void 0,parseHTML:n=>n.getAttribute("type")}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:n}){const{start:e,...t}=n;return e===1?["ol",dt(this.options.HTMLAttributes,t),0]:["ol",dt(this.options.HTMLAttributes,n),0]},addCommands(){return{toggleOrderedList:()=>({commands:n,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(PI,this.editor.getAttributes(I0)).run():n.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let n=so({find:D0,type:this.type,getAttributes:e=>({start:+e[1]}),joinPredicate:(e,t)=>t.childCount+t.attrs.start===+e[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(n=so({find:D0,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:e=>({start:+e[1],...this.editor.getAttributes(I0)}),joinPredicate:(e,t)=>t.childCount+t.attrs.start===+e[1],editor:this.editor})),[n]}}),DI=rn.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:n}){return["p",dt(this.options.HTMLAttributes,n),0]},addCommands(){return{setParagraph:()=>({commands:n})=>n.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),LI=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))$/,RI=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))/g,FI=vr.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:n=>n.includes("line-through")?{}:!1}]},renderHTML({HTMLAttributes:n}){return["s",dt(this.options.HTMLAttributes,n),0]},addCommands(){return{setStrike:()=>({commands:n})=>n.setMark(this.name),toggleStrike:()=>({commands:n})=>n.toggleMark(this.name),unsetStrike:()=>({commands:n})=>n.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-s":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[ji({find:LI,type:this.type})]},addPasteRules(){return[zi({find:RI,type:this.type})]}}),BI=rn.create({name:"text",group:"inline"}),VI=et.create({name:"starterKit",addExtensions(){var n,e,t,r,i,s,o,a,l,c,u,d,h,m,p,g,y,v;const C=[];return this.options.bold!==!1&&C.push(WP.configure((n=this.options)===null||n===void 0?void 0:n.bold)),this.options.blockquote!==!1&&C.push(jP.configure((e=this.options)===null||e===void 0?void 0:e.blockquote)),this.options.bulletList!==!1&&C.push(YP.configure((t=this.options)===null||t===void 0?void 0:t.bulletList)),this.options.code!==!1&&C.push(JP.configure((r=this.options)===null||r===void 0?void 0:r.code)),this.options.codeBlock!==!1&&C.push(eI.configure((i=this.options)===null||i===void 0?void 0:i.codeBlock)),this.options.document!==!1&&C.push(tI.configure((s=this.options)===null||s===void 0?void 0:s.document)),this.options.dropcursor!==!1&&C.push(iI.configure((o=this.options)===null||o===void 0?void 0:o.dropcursor)),this.options.gapcursor!==!1&&C.push(dI.configure((a=this.options)===null||a===void 0?void 0:a.gapcursor)),this.options.hardBreak!==!1&&C.push(hI.configure((l=this.options)===null||l===void 0?void 0:l.hardBreak)),this.options.heading!==!1&&C.push(pI.configure((c=this.options)===null||c===void 0?void 0:c.heading)),this.options.history!==!1&&C.push(xI.configure((u=this.options)===null||u===void 0?void 0:u.history)),this.options.horizontalRule!==!1&&C.push(_I.configure((d=this.options)===null||d===void 0?void 0:d.horizontalRule)),this.options.italic!==!1&&C.push(MI.configure((h=this.options)===null||h===void 0?void 0:h.italic)),this.options.listItem!==!1&&C.push(AI.configure((m=this.options)===null||m===void 0?void 0:m.listItem)),this.options.orderedList!==!1&&C.push(II.configure((p=this.options)===null||p===void 0?void 0:p.orderedList)),this.options.paragraph!==!1&&C.push(DI.configure((g=this.options)===null||g===void 0?void 0:g.paragraph)),this.options.strike!==!1&&C.push(FI.configure((y=this.options)===null||y===void 0?void 0:y.strike)),this.options.text!==!1&&C.push(BI.configure((v=this.options)===null||v===void 0?void 0:v.text)),C}}),$I={class:"rounded-main p-2 border border-solid border-body-dark"},jI={class:"flex gap-2 p-2 bg-white border border-solid border-body-dark rounded-main"},sl=f.defineComponent({__name:"BaseEditor",props:{modelValue:{type:String,default:""}},emits:["update:modelValue"],setup(n,{emit:e}){const t=n,r=e,i=VP({content:t.modelValue,extensions:[VI],onUpdate:()=>{i.value&&r("update:modelValue",i.value.getHTML())}});return f.onBeforeUnmount(()=>{var s;(s=i.value)==null||s.destroy()}),f.watch(()=>t.modelValue,s=>{!i.value||i.value.getHTML()===s||i.value.commands.setContent(s,!1)}),(s,o)=>(f.openBlock(),f.createElementBlock("div",$I,[f.createVNode(f.unref(BP),{editor:f.unref(i)},null,8,["editor"]),f.unref(i)?(f.openBlock(),f.createBlock(f.unref(RP),{key:0,editor:f.unref(i),"tippy-options":{duration:100}},{default:f.withCtx(()=>[f.createElementVNode("div",jI,[f.createElementVNode("button",{onClick:o[0]||(o[0]=a=>f.unref(i).chain().focus().toggleBold().run()),class:f.normalizeClass({"font-bold":f.unref(i).isActive("bold")})}," bold ",2),f.createElementVNode("button",{onClick:o[1]||(o[1]=a=>f.unref(i).chain().focus().toggleItalic().run()),class:f.normalizeClass({"font-bold":f.unref(i).isActive("italic")})}," italic ",2),f.createElementVNode("button",{onClick:o[2]||(o[2]=a=>f.unref(i).chain().focus().toggleStrike().run()),class:f.normalizeClass({"font-bold":f.unref(i).isActive("strike")})}," strike ",2)])]),_:1},8,["editor"])):f.createCommentVNode("",!0)]))}}),zI=["value"],HI=f.defineComponent({__name:"BaseSelect",props:{modelValue:{type:[String,Number],default:""},items:{type:Array,required:!0},optionId:{type:String,required:!0},optionLabel:{type:String,required:!0}},emits:["update:modelValue"],setup(n,{emit:e}){const t=n,i=xo(t,"modelValue",e);return(s,o)=>f.withDirectives((f.openBlock(),f.createElementBlock("select",{label:"select","onUpdate:modelValue":o[0]||(o[0]=a=>f.isRef(i)?i.value=a:null),class:"block bg-white rounded-main w-full p-2 border border-solid border-body-dark"},[(f.openBlock(!0),f.createElementBlock(f.Fragment,null,f.renderList(t.items,a=>(f.openBlock(),f.createElementBlock("option",{key:a[t.optionId],value:a[t.optionId]},f.toDisplayString(a[t.optionLabel]),9,zI))),128))],512)),[[f.vModelSelect,f.unref(i)]])}}),GI={class:"text-lg font-bold"},UI={key:0,class:"flex gap-2 items-center"},WI={key:1,class:"flex gap-2 mt-2"},KI={key:0},YI={key:1},qI={key:0,class:"flex flex-col gap-2"},XI={class:"FormObject-Inner"},JI={class:"FormObject-Row"},QI={class:"FormObject-Row"},ZI={class:"FormObject-Row"},eD={class:"my-2"},tD={class:"FormObject-Title"},nD={class:"FormObject-Row"},rD={class:"FormObject-Title"},iD={class:"FormObject-Row"},sD={key:0,class:"FormObject-ArrowName"},oD={class:"py-3 flex gap-1"},aD=f.defineComponent({__name:"FormObject",setup(n){const e=cd("FormObject"),{mapObjectCurrent:t,mapFile:r,mapObject:i,mapCurrent:s,drawer:o,mapObjectRemoved:a,mapObjectRelationRemoved:l,mapObjectUrl:c,controlCombo:u}=Fe(),{patron:d,chain:h,guest:m}=yt(),p=new nm(()=>{const x=h.create();t.objectId(d.create(x.receiveKey("objectId"))),t.objectId(d.create(O=>{e("sep obj",O)})),r.currentMap(d.create(x.receiveKey("map"))),r.currentMap(d.create(O=>{e("sep map",O)})),x.result(d.create(m.create(({map:O,objectId:T})=>{e("object opened",T),p.value=O.objects[T]})))}).ref(),g=s.types(new ae).ref(),y=r.currentMap(new ae).ref(),v=new Qc(p),C=c.url(v,new ae).ref(),w=()=>{t.give(""),o.give("")},b=()=>{a.give(p.value),w()},E=()=>{i.give({...p.value,outlink:p.value.outlink||C.value}),w()},k=x=>{l.give({index:x,object:p.value})};return u.happenedConditional("KeyS",o.openedByName("object"),d.create(m.create(E))),(x,O)=>(f.openBlock(),f.createBlock(pc,{name:"object",onClose:w},{header:f.withCtx(()=>[f.createElementVNode("h2",GI,f.toDisplayString(x.$t("general.mapObject")),1),f.unref(p)?(f.openBlock(),f.createElementBlock("small",UI,[f.createElementVNode("span",null," ID #"+f.toDisplayString(f.unref(p).id),1)])):f.createCommentVNode("",!0),f.unref(p)?(f.openBlock(),f.createElementBlock("div",WI,[f.unref(p).createTimestamp?(f.openBlock(),f.createElementBlock("div",KI," Создан: "+f.toDisplayString(new Date(f.unref(p).createTimestamp).toLocaleString()),1)):f.createCommentVNode("",!0),f.unref(p).changeTimestamp?(f.openBlock(),f.createElementBlock("div",YI," Изменен: "+f.toDisplayString(new Date(f.unref(p).changeTimestamp).toLocaleString()),1)):f.createCommentVNode("",!0)])):f.createCommentVNode("",!0)]),footer:f.withCtx(()=>[f.createElementVNode("div",oD,[f.createVNode(ke,{type:"success",onClick:E},{default:f.withCtx(()=>[f.createTextVNode(f.toDisplayString(x.$t("general.save")),1)]),_:1}),f.createVNode(ke,{type:"danger",onClick:b},{default:f.withCtx(()=>[f.createTextVNode(f.toDisplayString(x.$t("general.delete")),1)]),_:1}),f.createVNode(ke,{onClick:w},{default:f.withCtx(()=>[f.createTextVNode(f.toDisplayString(x.$t("general.cancel")),1)]),_:1})])]),default:f.withCtx(()=>[f.unref(p)?(f.openBlock(),f.createElementBlock("div",qI,[f.createElementVNode("div",XI,[f.createElementVNode("div",JI,[f.createVNode(Zc,{modelValue:f.unref(p).linked,"onUpdate:modelValue":O[0]||(O[0]=T=>f.unref(p).linked=T),label:x.$t("general.nameAsLink")},null,8,["modelValue","label"])]),f.unref(p).linked?(f.openBlock(),f.createElementBlock(f.Fragment,{key:0},[f.createVNode(Ot,null,{default:f.withCtx(()=>[f.createTextVNode(f.toDisplayString(x.$t("general.outerLink")),1)]),_:1}),f.createElementVNode("div",QI,[f.createVNode(hn,{"model-value":f.unref(p).outlink||f.unref(C),"onUpdate:modelValue":O[1]||(O[1]=T=>f.unref(p).outlink=T)},null,8,["model-value"])]),f.createElementVNode("div",ZI,[f.createVNode(Zc,{modelValue:f.unref(p).targetBlank,"onUpdate:modelValue":O[2]||(O[2]=T=>f.unref(p).targetBlank=T),label:x.$t("general.inNewTab")},null,8,["modelValue","label"])])],64)):f.createCommentVNode("",!0),(f.openBlock(!0),f.createElementBlock(f.Fragment,null,f.renderList(f.unref(p).additionalFields,(T,B)=>(f.openBlock(),f.createBlock(Dt,{class:"mb-2",key:B},{default:f.withCtx(()=>[f.createVNode(Ot,{class:"mb-1"},{default:f.withCtx(()=>[f.createTextVNode(f.toDisplayString(B),1)]),_:2},1024),f.createVNode(sl,{modelValue:f.unref(p).additionalFields[B],"onUpdate:modelValue":U=>f.unref(p).additionalFields[B]=U},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024))),128)),f.createVNode(Dt,null,{default:f.withCtx(()=>[f.createVNode(Ot,null,{default:f.withCtx(()=>[f.createTextVNode(f.toDisplayString(x.$t("general.topName")),1)]),_:1}),f.createVNode(sl,{modelValue:f.unref(p).additionalName,"onUpdate:modelValue":O[3]||(O[3]=T=>f.unref(p).additionalName=T)},null,8,["modelValue"])]),_:1}),f.createVNode(Dt,null,{default:f.withCtx(()=>[f.createVNode(Ot,null,{default:f.withCtx(()=>[f.createTextVNode(f.toDisplayString(x.$t("general.bottomName")),1)]),_:1}),f.createVNode(sl,{modelValue:f.unref(p).name,"onUpdate:modelValue":O[4]||(O[4]=T=>f.unref(p).name=T)},null,8,["modelValue"])]),_:1}),f.createVNode(Dt,null,{default:f.withCtx(()=>[f.createVNode(Ot,null,{default:f.withCtx(()=>[f.createTextVNode(f.toDisplayString(x.$t("general.description")),1)]),_:1}),f.createVNode(sl,{modelValue:f.unref(p).description,"onUpdate:modelValue":O[5]||(O[5]=T=>f.unref(p).description=T)},null,8,["modelValue"])]),_:1}),f.createVNode(Dt,null,{default:f.withCtx(()=>[f.createVNode(Ot,null,{default:f.withCtx(()=>O[12]||(O[12]=[f.createTextVNode(" Z-Index ")])),_:1}),f.createVNode(hn,{modelValue:f.unref(p).zindex,"onUpdate:modelValue":O[6]||(O[6]=T=>f.unref(p).zindex=T),type:"number"},null,8,["modelValue"])]),_:1}),f.createVNode(Dt,null,{default:f.withCtx(()=>[f.createVNode(Ot,null,{default:f.withCtx(()=>O[13]||(O[13]=[f.createTextVNode(" Width ")])),_:1}),f.createVNode(hn,{modelValue:f.unref(p).width,"onUpdate:modelValue":O[7]||(O[7]=T=>f.unref(p).width=T),step:"20",type:"number"},null,8,["modelValue"])]),_:1}),f.createVNode(Dt,null,{default:f.withCtx(()=>[f.createVNode(Ot,null,{default:f.withCtx(()=>O[14]||(O[14]=[f.createTextVNode(" Height ")])),_:1}),f.createVNode(hn,{modelValue:f.unref(p).height,"onUpdate:modelValue":O[8]||(O[8]=T=>f.unref(p).height=T),step:"20",type:"number"},null,8,["modelValue"])]),_:1}),f.createVNode(Dt,null,{default:f.withCtx(()=>[f.createVNode(Ot,null,{default:f.withCtx(()=>[f.createTextVNode(f.toDisplayString(x.$t("general.objectType")),1)]),_:1}),f.createVNode(HI,{modelValue:f.unref(p).type,"onUpdate:modelValue":O[9]||(O[9]=T=>f.unref(p).type=T),items:f.unref(g),"option-id":"id","option-label":"name"},null,8,["modelValue","items"])]),_:1}),f.createElementVNode("div",eD,[f.createVNode(Zc,{modelValue:f.unref(p).inMenu,"onUpdate:modelValue":O[10]||(O[10]=T=>f.unref(p).inMenu=T),label:x.$t("general.useInMenu")},null,8,["modelValue","label"])]),f.unref(p).inMenu?(f.openBlock(),f.createElementBlock(f.Fragment,{key:1},[f.createElementVNode("div",tD,f.toDisplayString(x.$t("general.menuOrder")),1),f.createElementVNode("div",nD,[f.createVNode(hn,{modelValue:f.unref(p).menuOrder,"onUpdate:modelValue":O[11]||(O[11]=T=>f.unref(p).menuOrder=T),type:"number"},null,8,["modelValue"])])],64)):f.createCommentVNode("",!0),f.unref(p).arrows&&f.unref(p).arrows.length?(f.openBlock(),f.createElementBlock(f.Fragment,{key:2},[f.createElementVNode("div",rD,f.toDisplayString(x.$t("general.relations")),1),f.createElementVNode("div",iD,[(f.openBlock(!0),f.createElementBlock(f.Fragment,null,f.renderList(f.unref(p).arrows,(T,B)=>{var U;return f.openBlock(),f.createElementBlock("div",{key:T.id,class:"FormObject-Arrow"},[(U=f.unref(y))!=null&&U.objects[T.id]?(f.openBlock(),f.createElementBlock("span",sD," #"+f.toDisplayString(B+1)+" "+f.toDisplayString(f.unref(y).objects[T.id].name),1)):f.createCommentVNode("",!0),f.createVNode(ke,{class:"FormObject-ArrowButton",type:"danger",size:"sm",onClick:$=>k(B)},{default:f.withCtx(()=>[f.createTextVNode(f.toDisplayString(x.$t("general.delete")),1)]),_:2},1032,["onClick"])])}),128))])],64)):f.createCommentVNode("",!0)])])):f.createCommentVNode("",!0)]),_:1}))}}),lD={class:"BaseTextarea"},cD=["v-bind"],L0=f.defineComponent({inheritAttrs:!1,__name:"BaseTextarea",props:{modelValue:{type:String,default:""}},emits:["update:modelValue"],setup(n,{emit:e}){const i=xo(n,"modelValue",e);return(s,o)=>(f.openBlock(),f.createElementBlock("div",lD,[f.withDirectives(f.createElementVNode("textarea",{ref:"textarea","v-bind":s.$attrs,"onUpdate:modelValue":o[0]||(o[0]=a=>f.isRef(i)?i.value=a:null),class:"rounded-main block w-full p-2 border min-h-[200px] border-solid border-body-dark"},null,8,cD),[[f.vModelText,f.unref(i)]])]))}}),uD={class:"text-lg font-bold"},fD={key:0,class:"flex flex-col"},dD={class:"flex justify-end pt-4 gap-2"},hD=f.defineComponent({__name:"FormType",setup(n){const{mapTypeCurrent:e,mapFile:t,mapType:r,modal:i,controlCombo:s}=Fe(),{patron:o,chain:a,guest:l}=yt();e.typeId(o.create(l.create(p=>{p&&i.give("type")})));const c=f.ref(""),u=a.create(),d=new nm(()=>{e.typeId(o.create(u.receiveKey("typeId"))),t.currentMap(o.create(u.receiveKey("map"))),u.result(o.create(l.create(({map:p,typeId:g})=>{var y;d.value=p.types[g],c.value=(y=d.value)==null?void 0:y.name})))}).ref(),h=()=>{e.give(""),i.give(""),u.receiveKey("typeId").give("")},m=()=>{r.give({name:c.value,type:d.value}),h()};return s.happenedConditional("KeyS",i.openedByName("type"),o.create(l.create(m))),(p,g)=>(f.openBlock(),f.createBlock(Hr,{name:"type"},{header:f.withCtx(()=>[f.createElementVNode("h2",uD,f.toDisplayString(p.$t("general.mapType")),1)]),footer:f.withCtx(()=>[f.createElementVNode("div",dD,[f.createVNode(ke,{type:"success",onClick:m},{default:f.withCtx(()=>[f.createTextVNode(f.toDisplayString(p.$t("general.save")),1)]),_:1}),f.createVNode(ke,{onClick:h},{default:f.withCtx(()=>[f.createTextVNode(f.toDisplayString(p.$t("general.cancel")),1)]),_:1})])]),default:f.withCtx(()=>[f.unref(d)?(f.openBlock(),f.createElementBlock("div",fD,[f.createVNode(Dt,null,{default:f.withCtx(()=>[f.createVNode(Ot,null,{default:f.withCtx(()=>g[4]||(g[4]=[f.createTextVNode(" Название типа ")])),_:1}),f.createVNode(hn,{modelValue:f.unref(d).name,"onUpdate:modelValue":g[0]||(g[0]=y=>f.unref(d).name=y)},null,8,["modelValue"])]),_:1}),f.createVNode(Dt,null,{default:f.withCtx(()=>[f.createVNode(Ot,null,{default:f.withCtx(()=>g[5]||(g[5]=[f.createTextVNode(" SVG ")])),_:1}),f.createVNode(L0,{modelValue:f.unref(d).svg,"onUpdate:modelValue":g[1]||(g[1]=y=>f.unref(d).svg=y)},null,8,["modelValue"])]),_:1}),f.createVNode(Dt,null,{default:f.withCtx(()=>[f.createVNode(Ot,null,{default:f.withCtx(()=>g[6]||(g[6]=[f.createTextVNode(" Ширина ")])),_:1}),f.createVNode(hn,{modelValue:f.unref(d).width,"onUpdate:modelValue":g[2]||(g[2]=y=>f.unref(d).width=y)},null,8,["modelValue"])]),_:1}),f.createVNode(Dt,null,{default:f.withCtx(()=>[f.createVNode(Ot,null,{default:f.withCtx(()=>g[7]||(g[7]=[f.createTextVNode(" Высота ")])),_:1}),f.createVNode(hn,{modelValue:f.unref(d).height,"onUpdate:modelValue":g[3]||(g[3]=y=>f.unref(d).height=y)},null,8,["modelValue"])]),_:1})])):f.createCommentVNode("",!0)]),_:1}))}}),kf=ie.debug("MapObjectsWithTemplates");class pD{constructor(e,t,r){this.mapObjects=e,this.map=t,this.factories=r}objects(e){const t=this.factories.chain.create();return this.map.types(this.factories.guestCast.create(e,t.receiveKey("types"))),this.mapObjects.objects(this.factories.guestCast.create(e,t.receiveKey("objects"))),t.result(this.factories.guestInTheMiddle.create(e,({types:r,objects:i})=>{kf("visible objects",i);const s=i.map(o=>{const a=r.find(c=>String(c.id)===String(o.type));if(kf("check type existed",a),!a)return{obj:o,template:""};let{svg:l}=a;return kf("type svg",l),o.additionalFields&&Object.entries(o.additionalFields).forEach(([c,u])=>{l=l.replaceAll(`\${${c}}`,u)}),["width","height"].forEach(c=>{l=l.replaceAll(`\${${c}}`,o[c])}),{obj:o,template:l}});e.give(s)})),e}}const mD=f.defineComponent({__name:"BaseNotify",setup(n){const{notification:e}=Fe(),t=e.message(new ae).ref();return(r,i)=>f.unref(t)&&f.unref(t).text!=="hide"?(f.openBlock(),f.createElementBlock("div",{key:0,class:f.normalizeClass(["inline font-bold",`text-${f.unref(t).type}-second`])},f.toDisplayString(f.unref(t).text),3)):f.createCommentVNode("",!0)}}),gD={class:"relative"},yD={class:"absolute top-0 left-0 w-full h-full pointer-events-none overflow-hidden z-1"},bD={class:"text-sm z-10 p-2 absolute bottom-0 left-5"},vD=["title"],wD={class:"font-bold"},CD=["title"],kD={class:"font-bold"},SD=["title"],xD={class:"font-bold"},_D=["title"],ED={class:"font-bold"},TD=["data-object-id"],OD={class:"absolute bottom-[100%] left-[50%] translate-x-[-50%] text-center pb-2 pointer-events-auto text-sm w-[300px]"},ND=["innerHTML","onClick"],MD=["innerHTML"],AD=["data-object-id","innerHTML"],PD=f.defineComponent({__name:"TheEditor",setup(n){const{canvas:e,mapObjectsVisible:t,mapCurrent:r,konvaLayer:i,fps:s,mapCurrentID:o,mapObjectUrl:a,stageSize:l,objectsOutsideScreen:c,stagePositionByObjectId:u,mapCurrentSource:d}=Fe(),h=yt(),m=s.value(new ae).ref(),g=new pD(t,r,h).objects(new ae([])).ref(),y=l.value(new ae).ref(),v=i.position(new ae).ref(),C=f.computed(()=>{var $;return($=y.value)==null?void 0:$.width}),w=new Qc(C),b=h.numberChunks.create(10,w).chunks(new ae).ref(),E=f.ref();f.onMounted(()=>{e.give(E.value)});const k=$=>{a.open($,h.guest.create(K=>{o.give(K)}))},x=c.count({axis:"x",direction:"negative"},new ae).ref(),O=c.count({axis:"x",direction:"positive"},new ae).ref(),T=c.count({axis:"y",direction:"negative"},new ae).ref(),B=c.count({axis:"y",direction:"positive"},new ae).ref(),U=u.move.bind(u,d);return($,K)=>{var _e,Ee,fe,ve,he,He,Ge,Le,Be,at,Ue,je;return f.openBlock(),f.createElementBlock("div",gD,[f.createElementVNode("div",yD,[f.createElementVNode("div",bD,[f.createTextVNode(" Видимых объектов: "+f.toDisplayString(f.unref(g).length)+", FPS: "+f.toDisplayString(f.unref(m))+", ",1),f.createVNode(mD)]),K[4]||(K[4]=f.createStaticVNode('<div class="absolute bottom-3 shadow-standard-second shadow-md drop-shadow right-3 z-10"><div class="grid-example grid grid-rows-2 grid-cols-2 bg-standard-second border border-standard-second gap-[1px] border-t-0 border-l-0"><div class="w-[14px] h-[14px] bg-white"></div><div class="w-[14px] h-[14px] bg-white"></div><div class="w-[14px] h-[14px] bg-white"></div><div class="w-[14px] h-[14px] bg-white"></div></div></div><div class="absolute z-30 top-0 left-0 h-[18px] w-[22px] bg-white"></div>',2)),((_e=f.unref(x))==null?void 0:_e.count)>0?(f.openBlock(),f.createElementBlock("div",{key:0,class:"pointer-events-auto absolute z-30 top-0 left-4 h-[18px] bg-white flex items-center gap-1 text-body-dark text-sm cursor-pointer",title:`${(Ee=f.unref(x))==null?void 0:Ee.count} шт. объектов левее`,onClick:K[0]||(K[0]=oe=>f.unref(U)(f.unref(x).nearestObjectId))},[f.createVNode(Tt,{icon:"fa-arrow-left"}),f.createElementVNode("span",wD,f.toDisplayString((fe=f.unref(x))==null?void 0:fe.count),1)],8,vD)):f.createCommentVNode("",!0),((ve=f.unref(O))==null?void 0:ve.count)>0?(f.openBlock(),f.createElementBlock("div",{key:1,class:"pointer-events-auto absolute z-30 p-1 top-0 right-0 h-[18px] bg-white flex items-center gap-1 text-body-dark text-sm cursor-pointer",title:`${(he=f.unref(O))==null?void 0:he.count} шт. объектов правее`,onClick:K[1]||(K[1]=oe=>f.unref(U)(f.unref(O).nearestObjectId))},[f.createElementVNode("span",kD,f.toDisplayString((He=f.unref(O))==null?void 0:He.count),1),f.createVNode(Tt,{icon:"fa-arrow-right"})],8,CD)):f.createCommentVNode("",!0),((Ge=f.unref(T))==null?void 0:Ge.count)>0?(f.openBlock(),f.createElementBlock("div",{key:2,class:"pointer-events-auto absolute z-30 top-[18px] left-0 w-[18px] bg-white flex flex-col leading-4 items-center gap-1 text-body-dark text-sm cursor-pointer",title:`${(Le=f.unref(T))==null?void 0:Le.count} шт. объектов выше`,onClick:K[2]||(K[2]=oe=>f.unref(U)(f.unref(T).nearestObjectId))},[f.createVNode(Tt,{icon:"fa-arrow-up"}),f.createElementVNode("span",xD,f.toDisplayString((Be=f.unref(T))==null?void 0:Be.count),1)],8,SD)):f.createCommentVNode("",!0),((at=f.unref(B))==null?void 0:at.count)>0?(f.openBlock(),f.createElementBlock("div",{key:3,class:"pointer-events-auto absolute z-30 p-1 bottom-0 left-0 w-[18px] bg-white flex flex-col-reverse leading-4 items-center gap-1 text-body-dark text-sm cursor-pointer",title:`${(Ue=f.unref(B))==null?void 0:Ue.count} шт. объектов ниже`,onClick:K[3]||(K[3]=oe=>f.unref(U)(f.unref(B).nearestObjectId))},[f.createVNode(Tt,{icon:"fa-arrow-down"}),f.createElementVNode("span",ED,f.toDisplayString((je=f.unref(B))==null?void 0:je.count),1)],8,_D)):f.createCommentVNode("",!0),f.createElementVNode("div",{class:f.normalizeClass({"objects-container absolute top-0 left-0":!0}),style:f.normalizeStyle({width:`${f.unref(y).width}px`,height:`${f.unref(y).height}px`,transform:`translate(${f.unref(v).x}px, ${f.unref(v).y}px)`})},[f.createElementVNode("div",{class:"absolute flex top-0 left-0 w-full z-20 h-[20px] bg-default border-b-2 border-border text-right text-sm px-2",style:f.normalizeStyle({transform:`translate(0, ${-f.unref(v).y}px)`})},[(f.openBlock(!0),f.createElementBlock(f.Fragment,null,f.renderList(f.unref(b),oe=>(f.openBlock(),f.createElementBlock("span",{class:"flex-1 text-body-dark",key:`horiz_${oe}`},f.toDisplayString(oe)+"px",1))),128))],4),f.createElementVNode("div",{class:"absolute flex [writing-mode:vertical-lr] top-0 left-0 h-full z-20 w-[20px] bg-default border-r-2 border-border text-left text-sm py-2",style:f.normalizeStyle({transform:`translate(${-f.unref(v).x}px, 0)`})},[(f.openBlock(!0),f.createElementBlock(f.Fragment,null,f.renderList(f.unref(b),oe=>(f.openBlock(),f.createElementBlock("span",{class:"flex-1 rotate-180 text-body-dark",key:`vert_${oe}`},f.toDisplayString(oe)+"px",1))),128))],4),(f.openBlock(!0),f.createElementBlock(f.Fragment,null,f.renderList(f.unref(g),oe=>(f.openBlock(),f.createElementBlock("div",{key:oe.obj.id,class:"absolute z-10","data-object-id":oe.obj.id,style:f.normalizeStyle(`width:${oe.obj.width}px;height: ${oe.obj.height}px;top: ${oe.obj.position[1]}px;left:${oe.obj.position[0]}px;z-index:${oe.obj.zindex}`)},[f.createElementVNode("div",OD,[f.createElementVNode("span",{innerHTML:oe.obj.additionalName,class:f.normalizeClass([oe.obj.linked&&"cursor-pointer underline"]),onClick:Gt=>k(oe.obj)},null,10,ND)]),f.createElementVNode("div",{class:"absolute top-[100%] left-[50%] translate-x-[-50%] text-center pt-2 text-sm w-[300px]",innerHTML:oe.obj.name},null,8,MD),f.createElementVNode("div",{"data-object-id":oe.obj.id,class:"rendered-object",innerHTML:oe.template},null,8,AD)],12,TD))),128))],4)]),f.createElementVNode("div",{class:"h-full",ref_key:"canvasWrapper",ref:E},null,512)])}}}),ID={class:"flex flex-wrap gap-2"},DD={key:0},LD={key:1},RD=["onClick"],FD=f.defineComponent({__name:"BaseBreadcrumbs",setup(n){const{breadcrumbs:e,mapCurrentID:t}=Fe(),r=e.list(new ae).ref();return(i,s)=>(f.openBlock(),f.createElementBlock("div",ID,[(f.openBlock(!0),f.createElementBlock(f.Fragment,null,f.renderList(f.unref(r),(o,a)=>(f.openBlock(),f.createElementBlock("span",{class:"flex gap-2",key:o.name},[a!==0?(f.openBlock(),f.createElementBlock("span",DD,"/")):f.createCommentVNode("",!0),a===f.unref(r).length-1?(f.openBlock(),f.createElementBlock("b",LD,"Открыто: "+f.toDisplayString(o.title),1)):(f.openBlock(),f.createElementBlock("a",{key:2,href:"#",onClick:f.withModifiers(l=>f.unref(t).give(o.name),["prevent"])},f.toDisplayString(o.title),9,RD))]))),128))]))}}),BD={class:"flex items-center p-3 gap-3"},VD={class:"ml-auto gap-1 flex"},$D=f.defineComponent({__name:"TheHeader",setup(n){const{drawer:e,modal:t,mapHistory:r,controlCombo:i,settings:s}=Fe(),{patron:o,guest:a}=yt(),l=r.isNextPossible(new ae).ref(),c=r.isPrevPossible(new ae).ref();i.happened("KeyZ",o.create(a.create(()=>{c.value&&r.prev()}))),i.happened("KeyP",o.create(a.create(()=>{l.value&&r.next()})));const u=new ae;return s.value(u),(d,h)=>(f.openBlock(),f.createElementBlock("div",BD,[f.createVNode(FD,{class:"TheHeader-Breadcrumbs"}),f.createElementVNode("div",VD,[f.unref(l)&&!f.unref(u).value.readonly?(f.openBlock(),f.createBlock(ke,{key:0,size:"sm",title:"Отменить последнее действие",class:"w-7 block",onClick:h[0]||(h[0]=m=>f.unref(r).next())},{default:f.withCtx(()=>[f.createVNode(Tt,{icon:"fa-rotate-left"})]),_:1})):f.createCommentVNode("",!0),f.unref(c)&&!f.unref(u).value.readonly?(f.openBlock(),f.createBlock(ke,{key:1,size:"sm",title:"Вернуть отмененное действие",class:"w-7 block",onClick:h[1]||(h[1]=m=>f.unref(r).prev())},{default:f.withCtx(()=>[f.createVNode(Tt,{icon:"fa-rotate-right"})]),_:1})):f.createCommentVNode("",!0),f.createVNode(ke,{type:"success",size:"sm",class:"w-7 block e2e-open-menu",title:d.$t("general.menu"),onClick:h[2]||(h[2]=m=>f.unref(e).give("menu"))},{default:f.withCtx(()=>[f.createVNode(Tt,{icon:"fa-bars"})]),_:1},8,["title"]),f.createVNode(ke,{title:d.$t("general.byText"),type:"primary",size:"sm",class:"w-7 block",onClick:h[3]||(h[3]=m=>f.unref(t).give("mapAsText"))},{default:f.withCtx(()=>[f.createVNode(Tt,{icon:"fa-text-width"})]),_:1},8,["title"]),f.createVNode(ke,{class:"w-7 block e2e-search",size:"sm",onClick:h[4]||(h[4]=m=>f.unref(t).give("search"))},{default:f.withCtx(()=>[f.createVNode(Tt,{icon:"fa-search"})]),_:1}),f.createVNode(ke,{size:"sm",title:"Все карты файла",class:"w-7 block",onClick:h[5]||(h[5]=m=>f.unref(e).give("fileMaps"))},{default:f.withCtx(()=>[f.createVNode(Tt,{icon:"fa-map"})]),_:1})])]))}});/*!
  * shared v9.14.0
  * (c) 2024 kazuya kawaguchi
  * Released under the MIT License.
  */const R0=typeof window<"u",oi=(n,e=!1)=>e?Symbol.for(n):Symbol(n),jD=(n,e,t)=>zD({l:n,k:e,s:t}),zD=n=>JSON.stringify(n).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029").replace(/\u0027/g,"\\u0027"),st=n=>typeof n=="number"&&isFinite(n),HD=n=>$0(n)==="[object Date]",qi=n=>$0(n)==="[object RegExp]",ol=n=>ce(n)&&Object.keys(n).length===0,ot=Object.assign;let F0;const Bn=()=>F0||(F0=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function B0(n){return n.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}const GD=Object.prototype.hasOwnProperty;function al(n,e){return GD.call(n,e)}const $e=Array.isArray,Ae=n=>typeof n=="function",z=n=>typeof n=="string",xe=n=>typeof n=="boolean",ge=n=>n!==null&&typeof n=="object",UD=n=>ge(n)&&Ae(n.then)&&Ae(n.catch),V0=Object.prototype.toString,$0=n=>V0.call(n),ce=n=>{if(!ge(n))return!1;const e=Object.getPrototypeOf(n);return e===null||e.constructor===Object},WD=n=>n==null?"":$e(n)||ce(n)&&n.toString===V0?JSON.stringify(n,null,2):String(n);function KD(n,e=""){return n.reduce((t,r,i)=>i===0?t+r:t+e+r,"")}function ll(n){let e=n;return()=>++e}function YD(n,e){typeof console<"u"&&(console.warn("[intlify] "+n),e&&console.warn(e.stack))}const cl=n=>!ge(n)||$e(n);function ul(n,e){if(cl(n)||cl(e))throw new Error("Invalid value");const t=[{src:n,des:e}];for(;t.length;){const{src:r,des:i}=t.pop();Object.keys(r).forEach(s=>{cl(r[s])||cl(i[s])?i[s]=r[s]:t.push({src:r[s],des:i[s]})})}}/*!
  * message-compiler v9.14.0
  * (c) 2024 kazuya kawaguchi
  * Released under the MIT License.
  */function qD(n,e,t){return{line:n,column:e,offset:t}}function fl(n,e,t){return{start:n,end:e}}const XD=/\{([0-9a-zA-Z]+)\}/g;function j0(n,...e){return e.length===1&&JD(e[0])&&(e=e[0]),(!e||!e.hasOwnProperty)&&(e={}),n.replace(XD,(t,r)=>e.hasOwnProperty(r)?e[r]:"")}const z0=Object.assign,H0=n=>typeof n=="string",JD=n=>n!==null&&typeof n=="object";function G0(n,e=""){return n.reduce((t,r,i)=>i===0?t+r:t+e+r,"")}const Sf={USE_MODULO_SYNTAX:1,__EXTEND_POINT__:2},QD={[Sf.USE_MODULO_SYNTAX]:"Use modulo before '{{0}}'."};function ZD(n,e,...t){const r=j0(QD[n],...t||[]),i={message:String(r),code:n};return e&&(i.location=e),i}const Q={EXPECTED_TOKEN:1,INVALID_TOKEN_IN_PLACEHOLDER:2,UNTERMINATED_SINGLE_QUOTE_IN_PLACEHOLDER:3,UNKNOWN_ESCAPE_SEQUENCE:4,INVALID_UNICODE_ESCAPE_SEQUENCE:5,UNBALANCED_CLOSING_BRACE:6,UNTERMINATED_CLOSING_BRACE:7,EMPTY_PLACEHOLDER:8,NOT_ALLOW_NEST_PLACEHOLDER:9,INVALID_LINKED_FORMAT:10,MUST_HAVE_MESSAGES_IN_PLURAL:11,UNEXPECTED_EMPTY_LINKED_MODIFIER:12,UNEXPECTED_EMPTY_LINKED_KEY:13,UNEXPECTED_LEXICAL_ANALYSIS:14,UNHANDLED_CODEGEN_NODE_TYPE:15,UNHANDLED_MINIFIER_NODE_TYPE:16,__EXTEND_POINT__:17},eL={[Q.EXPECTED_TOKEN]:"Expected token: '{0}'",[Q.INVALID_TOKEN_IN_PLACEHOLDER]:"Invalid token in placeholder: '{0}'",[Q.UNTERMINATED_SINGLE_QUOTE_IN_PLACEHOLDER]:"Unterminated single quote in placeholder",[Q.UNKNOWN_ESCAPE_SEQUENCE]:"Unknown escape sequence: \\{0}",[Q.INVALID_UNICODE_ESCAPE_SEQUENCE]:"Invalid unicode escape sequence: {0}",[Q.UNBALANCED_CLOSING_BRACE]:"Unbalanced closing brace",[Q.UNTERMINATED_CLOSING_BRACE]:"Unterminated closing brace",[Q.EMPTY_PLACEHOLDER]:"Empty placeholder",[Q.NOT_ALLOW_NEST_PLACEHOLDER]:"Not allowed nest placeholder",[Q.INVALID_LINKED_FORMAT]:"Invalid linked format",[Q.MUST_HAVE_MESSAGES_IN_PLURAL]:"Plural must have messages",[Q.UNEXPECTED_EMPTY_LINKED_MODIFIER]:"Unexpected empty linked modifier",[Q.UNEXPECTED_EMPTY_LINKED_KEY]:"Unexpected empty linked key",[Q.UNEXPECTED_LEXICAL_ANALYSIS]:"Unexpected lexical analysis in token: '{0}'",[Q.UNHANDLED_CODEGEN_NODE_TYPE]:"unhandled codegen node type: '{0}'",[Q.UNHANDLED_MINIFIER_NODE_TYPE]:"unhandled mimifier node type: '{0}'"};function Xi(n,e,t={}){const{domain:r,messages:i,args:s}=t,o=j0((i||eL)[n]||"",...s||[]),a=new SyntaxError(String(o));return a.code=n,e&&(a.location=e),a.domain=r,a}function tL(n){throw n}const Vn=" ",nL="\r",ht=`
`,rL="\u2028",iL="\u2029";function sL(n){const e=n;let t=0,r=1,i=1,s=0;const o=x=>e[x]===nL&&e[x+1]===ht,a=x=>e[x]===ht,l=x=>e[x]===iL,c=x=>e[x]===rL,u=x=>o(x)||a(x)||l(x)||c(x),d=()=>t,h=()=>r,m=()=>i,p=()=>s,g=x=>o(x)||l(x)||c(x)?ht:e[x],y=()=>g(t),v=()=>g(t+s);function C(){return s=0,u(t)&&(r++,i=0),o(t)&&t++,t++,i++,e[t]}function w(){return o(t+s)&&s++,s++,e[t+s]}function b(){t=0,r=1,i=1,s=0}function E(x=0){s=x}function k(){const x=t+s;for(;x!==t;)C();s=0}return{index:d,line:h,column:m,peekOffset:p,charAt:g,currentChar:y,currentPeek:v,next:C,peek:w,reset:b,resetPeek:E,skipToPeek:k}}const Sr=void 0,oL=".",U0="'",aL="tokenizer";function lL(n,e={}){const t=e.location!==!1,r=sL(n),i=()=>r.index(),s=()=>qD(r.line(),r.column(),r.index()),o=s(),a=i(),l={currentType:14,offset:a,startLoc:o,endLoc:o,lastType:14,lastOffset:a,lastStartLoc:o,lastEndLoc:o,braceNest:0,inLinked:!1,text:""},c=()=>l,{onError:u}=e;function d(S,_,P,...H){const ye=c();if(_.column+=P,_.offset+=P,u){const Z=t?fl(ye.startLoc,_):null,N=Xi(S,Z,{domain:aL,args:H});u(N)}}function h(S,_,P){S.endLoc=s(),S.currentType=_;const H={type:_};return t&&(H.loc=fl(S.startLoc,S.endLoc)),P!=null&&(H.value=P),H}const m=S=>h(S,14);function p(S,_){return S.currentChar()===_?(S.next(),_):(d(Q.EXPECTED_TOKEN,s(),0,_),"")}function g(S){let _="";for(;S.currentPeek()===Vn||S.currentPeek()===ht;)_+=S.currentPeek(),S.peek();return _}function y(S){const _=g(S);return S.skipToPeek(),_}function v(S){if(S===Sr)return!1;const _=S.charCodeAt(0);return _>=97&&_<=122||_>=65&&_<=90||_===95}function C(S){if(S===Sr)return!1;const _=S.charCodeAt(0);return _>=48&&_<=57}function w(S,_){const{currentType:P}=_;if(P!==2)return!1;g(S);const H=v(S.currentPeek());return S.resetPeek(),H}function b(S,_){const{currentType:P}=_;if(P!==2)return!1;g(S);const H=S.currentPeek()==="-"?S.peek():S.currentPeek(),ye=C(H);return S.resetPeek(),ye}function E(S,_){const{currentType:P}=_;if(P!==2)return!1;g(S);const H=S.currentPeek()===U0;return S.resetPeek(),H}function k(S,_){const{currentType:P}=_;if(P!==8)return!1;g(S);const H=S.currentPeek()===".";return S.resetPeek(),H}function x(S,_){const{currentType:P}=_;if(P!==9)return!1;g(S);const H=v(S.currentPeek());return S.resetPeek(),H}function O(S,_){const{currentType:P}=_;if(!(P===8||P===12))return!1;g(S);const H=S.currentPeek()===":";return S.resetPeek(),H}function T(S,_){const{currentType:P}=_;if(P!==10)return!1;const H=()=>{const Z=S.currentPeek();return Z==="{"?v(S.peek()):Z==="@"||Z==="%"||Z==="|"||Z===":"||Z==="."||Z===Vn||!Z?!1:Z===ht?(S.peek(),H()):$(S,!1)},ye=H();return S.resetPeek(),ye}function B(S){g(S);const _=S.currentPeek()==="|";return S.resetPeek(),_}function U(S){const _=g(S),P=S.currentPeek()==="%"&&S.peek()==="{";return S.resetPeek(),{isModulo:P,hasSpace:_.length>0}}function $(S,_=!0){const P=(ye=!1,Z="",N=!1)=>{const D=S.currentPeek();return D==="{"?Z==="%"?!1:ye:D==="@"||!D?Z==="%"?!0:ye:D==="%"?(S.peek(),P(ye,"%",!0)):D==="|"?Z==="%"||N?!0:!(Z===Vn||Z===ht):D===Vn?(S.peek(),P(!0,Vn,N)):D===ht?(S.peek(),P(!0,ht,N)):!0},H=P();return _&&S.resetPeek(),H}function K(S,_){const P=S.currentChar();return P===Sr?Sr:_(P)?(S.next(),P):null}function _e(S){const _=S.charCodeAt(0);return _>=97&&_<=122||_>=65&&_<=90||_>=48&&_<=57||_===95||_===36}function Ee(S){return K(S,_e)}function fe(S){const _=S.charCodeAt(0);return _>=97&&_<=122||_>=65&&_<=90||_>=48&&_<=57||_===95||_===36||_===45}function ve(S){return K(S,fe)}function he(S){const _=S.charCodeAt(0);return _>=48&&_<=57}function He(S){return K(S,he)}function Ge(S){const _=S.charCodeAt(0);return _>=48&&_<=57||_>=65&&_<=70||_>=97&&_<=102}function Le(S){return K(S,Ge)}function Be(S){let _="",P="";for(;_=He(S);)P+=_;return P}function at(S){y(S);const _=S.currentChar();return _!=="%"&&d(Q.EXPECTED_TOKEN,s(),0,_),S.next(),"%"}function Ue(S){let _="";for(;;){const P=S.currentChar();if(P==="{"||P==="}"||P==="@"||P==="|"||!P)break;if(P==="%")if($(S))_+=P,S.next();else break;else if(P===Vn||P===ht)if($(S))_+=P,S.next();else{if(B(S))break;_+=P,S.next()}else _+=P,S.next()}return _}function je(S){y(S);let _="",P="";for(;_=ve(S);)P+=_;return S.currentChar()===Sr&&d(Q.UNTERMINATED_CLOSING_BRACE,s(),0),P}function oe(S){y(S);let _="";return S.currentChar()==="-"?(S.next(),_+=`-${Be(S)}`):_+=Be(S),S.currentChar()===Sr&&d(Q.UNTERMINATED_CLOSING_BRACE,s(),0),_}function Gt(S){return S!==U0&&S!==ht}function pt(S){y(S),p(S,"'");let _="",P="";for(;_=K(S,Gt);)_==="\\"?P+=Ut(S):P+=_;const H=S.currentChar();return H===ht||H===Sr?(d(Q.UNTERMINATED_SINGLE_QUOTE_IN_PLACEHOLDER,s(),0),H===ht&&(S.next(),p(S,"'")),P):(p(S,"'"),P)}function Ut(S){const _=S.currentChar();switch(_){case"\\":case"'":return S.next(),`\\${_}`;case"u":return mt(S,_,4);case"U":return mt(S,_,6);default:return d(Q.UNKNOWN_ESCAPE_SEQUENCE,s(),0,_),""}}function mt(S,_,P){p(S,_);let H="";for(let ye=0;ye<P;ye++){const Z=Le(S);if(!Z){d(Q.INVALID_UNICODE_ESCAPE_SEQUENCE,s(),0,`\\${_}${H}${S.currentChar()}`);break}H+=Z}return`\\${_}${H}`}function Wt(S){return S!=="{"&&S!=="}"&&S!==Vn&&S!==ht}function kn(S){y(S);let _="",P="";for(;_=K(S,Wt);)P+=_;return P}function cn(S){let _="",P="";for(;_=Ee(S);)P+=_;return P}function R(S){const _=P=>{const H=S.currentChar();return H==="{"||H==="%"||H==="@"||H==="|"||H==="("||H===")"||!H||H===Vn?P:(P+=H,S.next(),_(P))};return _("")}function le(S){y(S);const _=p(S,"|");return y(S),_}function Kt(S,_){let P=null;switch(S.currentChar()){case"{":return _.braceNest>=1&&d(Q.NOT_ALLOW_NEST_PLACEHOLDER,s(),0),S.next(),P=h(_,2,"{"),y(S),_.braceNest++,P;case"}":return _.braceNest>0&&_.currentType===2&&d(Q.EMPTY_PLACEHOLDER,s(),0),S.next(),P=h(_,3,"}"),_.braceNest--,_.braceNest>0&&y(S),_.inLinked&&_.braceNest===0&&(_.inLinked=!1),P;case"@":return _.braceNest>0&&d(Q.UNTERMINATED_CLOSING_BRACE,s(),0),P=Yt(S,_)||m(_),_.braceNest=0,P;default:{let ye=!0,Z=!0,N=!0;if(B(S))return _.braceNest>0&&d(Q.UNTERMINATED_CLOSING_BRACE,s(),0),P=h(_,1,le(S)),_.braceNest=0,_.inLinked=!1,P;if(_.braceNest>0&&(_.currentType===5||_.currentType===6||_.currentType===7))return d(Q.UNTERMINATED_CLOSING_BRACE,s(),0),_.braceNest=0,Sn(S,_);if(ye=w(S,_))return P=h(_,5,je(S)),y(S),P;if(Z=b(S,_))return P=h(_,6,oe(S)),y(S),P;if(N=E(S,_))return P=h(_,7,pt(S)),y(S),P;if(!ye&&!Z&&!N)return P=h(_,13,kn(S)),d(Q.INVALID_TOKEN_IN_PLACEHOLDER,s(),0,P.value),y(S),P;break}}return P}function Yt(S,_){const{currentType:P}=_;let H=null;const ye=S.currentChar();switch((P===8||P===9||P===12||P===10)&&(ye===ht||ye===Vn)&&d(Q.INVALID_LINKED_FORMAT,s(),0),ye){case"@":return S.next(),H=h(_,8,"@"),_.inLinked=!0,H;case".":return y(S),S.next(),h(_,9,".");case":":return y(S),S.next(),h(_,10,":");default:return B(S)?(H=h(_,1,le(S)),_.braceNest=0,_.inLinked=!1,H):k(S,_)||O(S,_)?(y(S),Yt(S,_)):x(S,_)?(y(S),h(_,12,cn(S))):T(S,_)?(y(S),ye==="{"?Kt(S,_)||H:h(_,11,R(S))):(P===8&&d(Q.INVALID_LINKED_FORMAT,s(),0),_.braceNest=0,_.inLinked=!1,Sn(S,_))}}function Sn(S,_){let P={type:14};if(_.braceNest>0)return Kt(S,_)||m(_);if(_.inLinked)return Yt(S,_)||m(_);switch(S.currentChar()){case"{":return Kt(S,_)||m(_);case"}":return d(Q.UNBALANCED_CLOSING_BRACE,s(),0),S.next(),h(_,3,"}");case"@":return Yt(S,_)||m(_);default:{if(B(S))return P=h(_,1,le(S)),_.braceNest=0,_.inLinked=!1,P;const{isModulo:ye,hasSpace:Z}=U(S);if(ye)return Z?h(_,0,Ue(S)):h(_,4,at(S));if($(S))return h(_,0,Ue(S));break}}return P}function Er(){const{currentType:S,offset:_,startLoc:P,endLoc:H}=l;return l.lastType=S,l.lastOffset=_,l.lastStartLoc=P,l.lastEndLoc=H,l.offset=i(),l.startLoc=s(),r.currentChar()===Sr?h(l,14):Sn(r,l)}return{nextToken:Er,currentOffset:i,currentPosition:s,context:c}}const cL="parser",uL=/(?:\\\\|\\'|\\u([0-9a-fA-F]{4})|\\U([0-9a-fA-F]{6}))/g;function fL(n,e,t){switch(n){case"\\\\":return"\\";case"\\'":return"'";default:{const r=parseInt(e||t,16);return r<=55295||r>=57344?String.fromCodePoint(r):"�"}}}function dL(n={}){const e=n.location!==!1,{onError:t,onWarn:r}=n;function i(w,b,E,k,...x){const O=w.currentPosition();if(O.offset+=k,O.column+=k,t){const T=e?fl(E,O):null,B=Xi(b,T,{domain:cL,args:x});t(B)}}function s(w,b,E,k,...x){const O=w.currentPosition();if(O.offset+=k,O.column+=k,r){const T=e?fl(E,O):null;r(ZD(b,T,x))}}function o(w,b,E){const k={type:w};return e&&(k.start=b,k.end=b,k.loc={start:E,end:E}),k}function a(w,b,E,k){e&&(w.end=b,w.loc&&(w.loc.end=E))}function l(w,b){const E=w.context(),k=o(3,E.offset,E.startLoc);return k.value=b,a(k,w.currentOffset(),w.currentPosition()),k}function c(w,b){const E=w.context(),{lastOffset:k,lastStartLoc:x}=E,O=o(5,k,x);return O.index=parseInt(b,10),w.nextToken(),a(O,w.currentOffset(),w.currentPosition()),O}function u(w,b,E){const k=w.context(),{lastOffset:x,lastStartLoc:O}=k,T=o(4,x,O);return T.key=b,E===!0&&(T.modulo=!0),w.nextToken(),a(T,w.currentOffset(),w.currentPosition()),T}function d(w,b){const E=w.context(),{lastOffset:k,lastStartLoc:x}=E,O=o(9,k,x);return O.value=b.replace(uL,fL),w.nextToken(),a(O,w.currentOffset(),w.currentPosition()),O}function h(w){const b=w.nextToken(),E=w.context(),{lastOffset:k,lastStartLoc:x}=E,O=o(8,k,x);return b.type!==12?(i(w,Q.UNEXPECTED_EMPTY_LINKED_MODIFIER,E.lastStartLoc,0),O.value="",a(O,k,x),{nextConsumeToken:b,node:O}):(b.value==null&&i(w,Q.UNEXPECTED_LEXICAL_ANALYSIS,E.lastStartLoc,0,an(b)),O.value=b.value||"",a(O,w.currentOffset(),w.currentPosition()),{node:O})}function m(w,b){const E=w.context(),k=o(7,E.offset,E.startLoc);return k.value=b,a(k,w.currentOffset(),w.currentPosition()),k}function p(w){const b=w.context(),E=o(6,b.offset,b.startLoc);let k=w.nextToken();if(k.type===9){const x=h(w);E.modifier=x.node,k=x.nextConsumeToken||w.nextToken()}switch(k.type!==10&&i(w,Q.UNEXPECTED_LEXICAL_ANALYSIS,b.lastStartLoc,0,an(k)),k=w.nextToken(),k.type===2&&(k=w.nextToken()),k.type){case 11:k.value==null&&i(w,Q.UNEXPECTED_LEXICAL_ANALYSIS,b.lastStartLoc,0,an(k)),E.key=m(w,k.value||"");break;case 5:k.value==null&&i(w,Q.UNEXPECTED_LEXICAL_ANALYSIS,b.lastStartLoc,0,an(k)),E.key=u(w,k.value||"");break;case 6:k.value==null&&i(w,Q.UNEXPECTED_LEXICAL_ANALYSIS,b.lastStartLoc,0,an(k)),E.key=c(w,k.value||"");break;case 7:k.value==null&&i(w,Q.UNEXPECTED_LEXICAL_ANALYSIS,b.lastStartLoc,0,an(k)),E.key=d(w,k.value||"");break;default:{i(w,Q.UNEXPECTED_EMPTY_LINKED_KEY,b.lastStartLoc,0);const x=w.context(),O=o(7,x.offset,x.startLoc);return O.value="",a(O,x.offset,x.startLoc),E.key=O,a(E,x.offset,x.startLoc),{nextConsumeToken:k,node:E}}}return a(E,w.currentOffset(),w.currentPosition()),{node:E}}function g(w){const b=w.context(),E=b.currentType===1?w.currentOffset():b.offset,k=b.currentType===1?b.endLoc:b.startLoc,x=o(2,E,k);x.items=[];let O=null,T=null;do{const $=O||w.nextToken();switch(O=null,$.type){case 0:$.value==null&&i(w,Q.UNEXPECTED_LEXICAL_ANALYSIS,b.lastStartLoc,0,an($)),x.items.push(l(w,$.value||""));break;case 6:$.value==null&&i(w,Q.UNEXPECTED_LEXICAL_ANALYSIS,b.lastStartLoc,0,an($)),x.items.push(c(w,$.value||""));break;case 4:T=!0;break;case 5:$.value==null&&i(w,Q.UNEXPECTED_LEXICAL_ANALYSIS,b.lastStartLoc,0,an($)),x.items.push(u(w,$.value||"",!!T)),T&&(s(w,Sf.USE_MODULO_SYNTAX,b.lastStartLoc,0,an($)),T=null);break;case 7:$.value==null&&i(w,Q.UNEXPECTED_LEXICAL_ANALYSIS,b.lastStartLoc,0,an($)),x.items.push(d(w,$.value||""));break;case 8:{const K=p(w);x.items.push(K.node),O=K.nextConsumeToken||null;break}}}while(b.currentType!==14&&b.currentType!==1);const B=b.currentType===1?b.lastOffset:w.currentOffset(),U=b.currentType===1?b.lastEndLoc:w.currentPosition();return a(x,B,U),x}function y(w,b,E,k){const x=w.context();let O=k.items.length===0;const T=o(1,b,E);T.cases=[],T.cases.push(k);do{const B=g(w);O||(O=B.items.length===0),T.cases.push(B)}while(x.currentType!==14);return O&&i(w,Q.MUST_HAVE_MESSAGES_IN_PLURAL,E,0),a(T,w.currentOffset(),w.currentPosition()),T}function v(w){const b=w.context(),{offset:E,startLoc:k}=b,x=g(w);return b.currentType===14?x:y(w,E,k,x)}function C(w){const b=lL(w,z0({},n)),E=b.context(),k=o(0,E.offset,E.startLoc);return e&&k.loc&&(k.loc.source=w),k.body=v(b),n.onCacheKey&&(k.cacheKey=n.onCacheKey(w)),E.currentType!==14&&i(b,Q.UNEXPECTED_LEXICAL_ANALYSIS,E.lastStartLoc,0,w[E.offset]||""),a(k,b.currentOffset(),b.currentPosition()),k}return{parse:C}}function an(n){if(n.type===14)return"EOF";const e=(n.value||"").replace(/\r?\n/gu,"\\n");return e.length>10?e.slice(0,9)+"…":e}function hL(n,e={}){const t={ast:n,helpers:new Set};return{context:()=>t,helper:s=>(t.helpers.add(s),s)}}function W0(n,e){for(let t=0;t<n.length;t++)xf(n[t],e)}function xf(n,e){switch(n.type){case 1:W0(n.cases,e),e.helper("plural");break;case 2:W0(n.items,e);break;case 6:{xf(n.key,e),e.helper("linked"),e.helper("type");break}case 5:e.helper("interpolate"),e.helper("list");break;case 4:e.helper("interpolate"),e.helper("named");break}}function pL(n,e={}){const t=hL(n);t.helper("normalize"),n.body&&xf(n.body,t);const r=t.context();n.helpers=Array.from(r.helpers)}function mL(n){const e=n.body;return e.type===2?K0(e):e.cases.forEach(t=>K0(t)),n}function K0(n){if(n.items.length===1){const e=n.items[0];(e.type===3||e.type===9)&&(n.static=e.value,delete e.value)}else{const e=[];for(let t=0;t<n.items.length;t++){const r=n.items[t];if(!(r.type===3||r.type===9)||r.value==null)break;e.push(r.value)}if(e.length===n.items.length){n.static=G0(e);for(let t=0;t<n.items.length;t++){const r=n.items[t];(r.type===3||r.type===9)&&delete r.value}}}}const gL="minifier";function Ji(n){switch(n.t=n.type,n.type){case 0:{const e=n;Ji(e.body),e.b=e.body,delete e.body;break}case 1:{const e=n,t=e.cases;for(let r=0;r<t.length;r++)Ji(t[r]);e.c=t,delete e.cases;break}case 2:{const e=n,t=e.items;for(let r=0;r<t.length;r++)Ji(t[r]);e.i=t,delete e.items,e.static&&(e.s=e.static,delete e.static);break}case 3:case 9:case 8:case 7:{const e=n;e.value&&(e.v=e.value,delete e.value);break}case 6:{const e=n;Ji(e.key),e.k=e.key,delete e.key,e.modifier&&(Ji(e.modifier),e.m=e.modifier,delete e.modifier);break}case 5:{const e=n;e.i=e.index,delete e.index;break}case 4:{const e=n;e.k=e.key,delete e.key;break}default:throw Xi(Q.UNHANDLED_MINIFIER_NODE_TYPE,null,{domain:gL,args:[n.type]})}delete n.type}const yL="parser";function bL(n,e){const{sourceMap:t,filename:r,breakLineCode:i,needIndent:s}=e,o=e.location!==!1,a={filename:r,code:"",column:1,line:1,offset:0,map:void 0,breakLineCode:i,needIndent:s,indentLevel:0};o&&n.loc&&(a.source=n.loc.source);const l=()=>a;function c(y,v){a.code+=y}function u(y,v=!0){const C=v?i:"";c(s?C+"  ".repeat(y):C)}function d(y=!0){const v=++a.indentLevel;y&&u(v)}function h(y=!0){const v=--a.indentLevel;y&&u(v)}function m(){u(a.indentLevel)}return{context:l,push:c,indent:d,deindent:h,newline:m,helper:y=>`_${y}`,needIndent:()=>a.needIndent}}function vL(n,e){const{helper:t}=n;n.push(`${t("linked")}(`),Qi(n,e.key),e.modifier?(n.push(", "),Qi(n,e.modifier),n.push(", _type")):n.push(", undefined, _type"),n.push(")")}function wL(n,e){const{helper:t,needIndent:r}=n;n.push(`${t("normalize")}([`),n.indent(r());const i=e.items.length;for(let s=0;s<i&&(Qi(n,e.items[s]),s!==i-1);s++)n.push(", ");n.deindent(r()),n.push("])")}function CL(n,e){const{helper:t,needIndent:r}=n;if(e.cases.length>1){n.push(`${t("plural")}([`),n.indent(r());const i=e.cases.length;for(let s=0;s<i&&(Qi(n,e.cases[s]),s!==i-1);s++)n.push(", ");n.deindent(r()),n.push("])")}}function kL(n,e){e.body?Qi(n,e.body):n.push("null")}function Qi(n,e){const{helper:t}=n;switch(e.type){case 0:kL(n,e);break;case 1:CL(n,e);break;case 2:wL(n,e);break;case 6:vL(n,e);break;case 8:n.push(JSON.stringify(e.value),e);break;case 7:n.push(JSON.stringify(e.value),e);break;case 5:n.push(`${t("interpolate")}(${t("list")}(${e.index}))`,e);break;case 4:n.push(`${t("interpolate")}(${t("named")}(${JSON.stringify(e.key)}))`,e);break;case 9:n.push(JSON.stringify(e.value),e);break;case 3:n.push(JSON.stringify(e.value),e);break;default:throw Xi(Q.UNHANDLED_CODEGEN_NODE_TYPE,null,{domain:yL,args:[e.type]})}}const SL=(n,e={})=>{const t=H0(e.mode)?e.mode:"normal",r=H0(e.filename)?e.filename:"message.intl",i=!!e.sourceMap,s=e.breakLineCode!=null?e.breakLineCode:t==="arrow"?";":`
`,o=e.needIndent?e.needIndent:t!=="arrow",a=n.helpers||[],l=bL(n,{mode:t,filename:r,sourceMap:i,breakLineCode:s,needIndent:o});l.push(t==="normal"?"function __msg__ (ctx) {":"(ctx) => {"),l.indent(o),a.length>0&&(l.push(`const { ${G0(a.map(d=>`${d}: _${d}`),", ")} } = ctx`),l.newline()),l.push("return "),Qi(l,n),l.deindent(o),l.push("}"),delete n.helpers;const{code:c,map:u}=l.context();return{ast:n,code:c,map:u?u.toJSON():void 0}};function xL(n,e={}){const t=z0({},e),r=!!t.jit,i=!!t.minify,s=t.optimize==null?!0:t.optimize,a=dL(t).parse(n);return r?(s&&mL(a),i&&Ji(a),{ast:a,code:""}):(pL(a,t),SL(a,t))}/*!
  * core-base v9.14.0
  * (c) 2024 kazuya kawaguchi
  * Released under the MIT License.
  */function _L(){typeof __INTLIFY_PROD_DEVTOOLS__!="boolean"&&(Bn().__INTLIFY_PROD_DEVTOOLS__=!1),typeof __INTLIFY_JIT_COMPILATION__!="boolean"&&(Bn().__INTLIFY_JIT_COMPILATION__=!1),typeof __INTLIFY_DROP_MESSAGE_COMPILER__!="boolean"&&(Bn().__INTLIFY_DROP_MESSAGE_COMPILER__=!1)}const xr=[];xr[0]={w:[0],i:[3,0],"[":[4],o:[7]},xr[1]={w:[1],".":[2],"[":[4],o:[7]},xr[2]={w:[2],i:[3,0],0:[3,0]},xr[3]={i:[3,0],0:[3,0],w:[1,1],".":[2,1],"[":[4,1],o:[7,1]},xr[4]={"'":[5,0],'"':[6,0],"[":[4,2],"]":[1,3],o:8,l:[4,0]},xr[5]={"'":[4,0],o:8,l:[5,0]},xr[6]={'"':[4,0],o:8,l:[6,0]};const EL=/^\s?(?:true|false|-?[\d.]+|'[^']*'|"[^"]*")\s?$/;function TL(n){return EL.test(n)}function OL(n){const e=n.charCodeAt(0),t=n.charCodeAt(n.length-1);return e===t&&(e===34||e===39)?n.slice(1,-1):n}function NL(n){if(n==null)return"o";switch(n.charCodeAt(0)){case 91:case 93:case 46:case 34:case 39:return n;case 95:case 36:case 45:return"i";case 9:case 10:case 13:case 160:case 65279:case 8232:case 8233:return"w"}return"i"}function ML(n){const e=n.trim();return n.charAt(0)==="0"&&isNaN(parseInt(n))?!1:TL(e)?OL(e):"*"+e}function AL(n){const e=[];let t=-1,r=0,i=0,s,o,a,l,c,u,d;const h=[];h[0]=()=>{o===void 0?o=a:o+=a},h[1]=()=>{o!==void 0&&(e.push(o),o=void 0)},h[2]=()=>{h[0](),i++},h[3]=()=>{if(i>0)i--,r=4,h[0]();else{if(i=0,o===void 0||(o=ML(o),o===!1))return!1;h[1]()}};function m(){const p=n[t+1];if(r===5&&p==="'"||r===6&&p==='"')return t++,a="\\"+p,h[0](),!0}for(;r!==null;)if(t++,s=n[t],!(s==="\\"&&m())){if(l=NL(s),d=xr[r],c=d[l]||d.l||8,c===8||(r=c[0],c[1]!==void 0&&(u=h[c[1]],u&&(a=s,u()===!1))))return;if(r===7)return e}}const Y0=new Map;function PL(n,e){return ge(n)?n[e]:null}function IL(n,e){if(!ge(n))return null;let t=Y0.get(e);if(t||(t=AL(e),t&&Y0.set(e,t)),!t)return null;const r=t.length;let i=n,s=0;for(;s<r;){const o=i[t[s]];if(o===void 0||Ae(i))return null;i=o,s++}return i}const DL=n=>n,LL=n=>"",RL="text",FL=n=>n.length===0?"":KD(n),BL=WD;function q0(n,e){return n=Math.abs(n),e===2?n?n>1?1:0:1:n?Math.min(n,2):0}function VL(n){const e=st(n.pluralIndex)?n.pluralIndex:-1;return n.named&&(st(n.named.count)||st(n.named.n))?st(n.named.count)?n.named.count:st(n.named.n)?n.named.n:e:e}function $L(n,e){e.count||(e.count=n),e.n||(e.n=n)}function jL(n={}){const e=n.locale,t=VL(n),r=ge(n.pluralRules)&&z(e)&&Ae(n.pluralRules[e])?n.pluralRules[e]:q0,i=ge(n.pluralRules)&&z(e)&&Ae(n.pluralRules[e])?q0:void 0,s=v=>v[r(t,v.length,i)],o=n.list||[],a=v=>o[v],l=n.named||{};st(n.pluralIndex)&&$L(t,l);const c=v=>l[v];function u(v){const C=Ae(n.messages)?n.messages(v):ge(n.messages)?n.messages[v]:!1;return C||(n.parent?n.parent.message(v):LL)}const d=v=>n.modifiers?n.modifiers[v]:DL,h=ce(n.processor)&&Ae(n.processor.normalize)?n.processor.normalize:FL,m=ce(n.processor)&&Ae(n.processor.interpolate)?n.processor.interpolate:BL,p=ce(n.processor)&&z(n.processor.type)?n.processor.type:RL,y={list:a,named:c,plural:s,linked:(v,...C)=>{const[w,b]=C;let E="text",k="";C.length===1?ge(w)?(k=w.modifier||k,E=w.type||E):z(w)&&(k=w||k):C.length===2&&(z(w)&&(k=w||k),z(b)&&(E=b||E));const x=u(v)(y),O=E==="vnode"&&$e(x)&&k?x[0]:x;return k?d(k)(O,E):O},message:u,type:p,interpolate:m,normalize:h,values:ot({},o,l)};return y}let mo=null;function zL(n){mo=n}function HL(n,e,t){mo&&mo.emit("i18n:init",{timestamp:Date.now(),i18n:n,version:e,meta:t})}const GL=UL("function:translate");function UL(n){return e=>mo&&mo.emit(n,e)}const X0=Sf.__EXTEND_POINT__,ai=ll(X0),WL={NOT_FOUND_KEY:X0,FALLBACK_TO_TRANSLATE:ai(),CANNOT_FORMAT_NUMBER:ai(),FALLBACK_TO_NUMBER_FORMAT:ai(),CANNOT_FORMAT_DATE:ai(),FALLBACK_TO_DATE_FORMAT:ai(),EXPERIMENTAL_CUSTOM_MESSAGE_COMPILER:ai(),__EXTEND_POINT__:ai()},J0=Q.__EXTEND_POINT__,li=ll(J0),ln={INVALID_ARGUMENT:J0,INVALID_DATE_ARGUMENT:li(),INVALID_ISO_DATE_ARGUMENT:li(),NOT_SUPPORT_NON_STRING_MESSAGE:li(),NOT_SUPPORT_LOCALE_PROMISE_VALUE:li(),NOT_SUPPORT_LOCALE_ASYNC_FUNCTION:li(),NOT_SUPPORT_LOCALE_TYPE:li(),__EXTEND_POINT__:li()};function Cn(n){return Xi(n,null,void 0)}function _f(n,e){return e.locale!=null?Q0(e.locale):Q0(n.locale)}let Ef;function Q0(n){if(z(n))return n;if(Ae(n)){if(n.resolvedOnce&&Ef!=null)return Ef;if(n.constructor.name==="Function"){const e=n();if(UD(e))throw Cn(ln.NOT_SUPPORT_LOCALE_PROMISE_VALUE);return Ef=e}else throw Cn(ln.NOT_SUPPORT_LOCALE_ASYNC_FUNCTION)}else throw Cn(ln.NOT_SUPPORT_LOCALE_TYPE)}function KL(n,e,t){return[...new Set([t,...$e(e)?e:ge(e)?Object.keys(e):z(e)?[e]:[t]])]}function Z0(n,e,t){const r=z(t)?t:go,i=n;i.__localeChainCache||(i.__localeChainCache=new Map);let s=i.__localeChainCache.get(r);if(!s){s=[];let o=[t];for(;$e(o);)o=eb(s,o,e);const a=$e(e)||!ce(e)?e:e.default?e.default:null;o=z(a)?[a]:a,$e(o)&&eb(s,o,!1),i.__localeChainCache.set(r,s)}return s}function eb(n,e,t){let r=!0;for(let i=0;i<e.length&&xe(r);i++){const s=e[i];z(s)&&(r=YL(n,e[i],t))}return r}function YL(n,e,t){let r;const i=e.split("-");do{const s=i.join("-");r=qL(n,s,t),i.splice(-1,1)}while(i.length&&r===!0);return r}function qL(n,e,t){let r=!1;if(!n.includes(e)&&(r=!0,e)){r=e[e.length-1]!=="!";const i=e.replace(/!/g,"");n.push(i),($e(t)||ce(t))&&t[i]&&(r=t[i])}return r}const XL="9.14.0",dl=-1,go="en-US",tb="",nb=n=>`${n.charAt(0).toLocaleUpperCase()}${n.substr(1)}`;function JL(){return{upper:(n,e)=>e==="text"&&z(n)?n.toUpperCase():e==="vnode"&&ge(n)&&"__v_isVNode"in n?n.children.toUpperCase():n,lower:(n,e)=>e==="text"&&z(n)?n.toLowerCase():e==="vnode"&&ge(n)&&"__v_isVNode"in n?n.children.toLowerCase():n,capitalize:(n,e)=>e==="text"&&z(n)?nb(n):e==="vnode"&&ge(n)&&"__v_isVNode"in n?nb(n.children):n}}let rb;function ib(n){rb=n}let sb;function QL(n){sb=n}let ob;function ZL(n){ob=n}let ab=null;const eR=n=>{ab=n},tR=()=>ab;let lb=null;const cb=n=>{lb=n},nR=()=>lb;let ub=0;function rR(n={}){const e=Ae(n.onWarn)?n.onWarn:YD,t=z(n.version)?n.version:XL,r=z(n.locale)||Ae(n.locale)?n.locale:go,i=Ae(r)?go:r,s=$e(n.fallbackLocale)||ce(n.fallbackLocale)||z(n.fallbackLocale)||n.fallbackLocale===!1?n.fallbackLocale:i,o=ce(n.messages)?n.messages:{[i]:{}},a=ce(n.datetimeFormats)?n.datetimeFormats:{[i]:{}},l=ce(n.numberFormats)?n.numberFormats:{[i]:{}},c=ot({},n.modifiers||{},JL()),u=n.pluralRules||{},d=Ae(n.missing)?n.missing:null,h=xe(n.missingWarn)||qi(n.missingWarn)?n.missingWarn:!0,m=xe(n.fallbackWarn)||qi(n.fallbackWarn)?n.fallbackWarn:!0,p=!!n.fallbackFormat,g=!!n.unresolving,y=Ae(n.postTranslation)?n.postTranslation:null,v=ce(n.processor)?n.processor:null,C=xe(n.warnHtmlMessage)?n.warnHtmlMessage:!0,w=!!n.escapeParameter,b=Ae(n.messageCompiler)?n.messageCompiler:rb,E=Ae(n.messageResolver)?n.messageResolver:sb||PL,k=Ae(n.localeFallbacker)?n.localeFallbacker:ob||KL,x=ge(n.fallbackContext)?n.fallbackContext:void 0,O=n,T=ge(O.__datetimeFormatters)?O.__datetimeFormatters:new Map,B=ge(O.__numberFormatters)?O.__numberFormatters:new Map,U=ge(O.__meta)?O.__meta:{};ub++;const $={version:t,cid:ub,locale:r,fallbackLocale:s,messages:o,modifiers:c,pluralRules:u,missing:d,missingWarn:h,fallbackWarn:m,fallbackFormat:p,unresolving:g,postTranslation:y,processor:v,warnHtmlMessage:C,escapeParameter:w,messageCompiler:b,messageResolver:E,localeFallbacker:k,fallbackContext:x,onWarn:e,__meta:U};return $.datetimeFormats=a,$.numberFormats=l,$.__datetimeFormatters=T,$.__numberFormatters=B,__INTLIFY_PROD_DEVTOOLS__&&HL($,t,U),$}function Tf(n,e,t,r,i){const{missing:s,onWarn:o}=n;if(s!==null){const a=s(n,t,e,i);return z(a)?a:e}else return e}function yo(n,e,t){const r=n;r.__localeChainCache=new Map,n.localeFallbacker(n,t,e)}function iR(n,e){return n===e?!1:n.split("-")[0]===e.split("-")[0]}function sR(n,e){const t=e.indexOf(n);if(t===-1)return!1;for(let r=t+1;r<e.length;r++)if(iR(n,e[r]))return!0;return!1}function Of(n){return t=>oR(t,n)}function oR(n,e){const t=e.b||e.body;if((t.t||t.type)===1){const r=t,i=r.c||r.cases;return n.plural(i.reduce((s,o)=>[...s,fb(n,o)],[]))}else return fb(n,t)}function fb(n,e){const t=e.s||e.static;if(t)return n.type==="text"?t:n.normalize([t]);{const r=(e.i||e.items).reduce((i,s)=>[...i,Nf(n,s)],[]);return n.normalize(r)}}function Nf(n,e){const t=e.t||e.type;switch(t){case 3:{const r=e;return r.v||r.value}case 9:{const r=e;return r.v||r.value}case 4:{const r=e;return n.interpolate(n.named(r.k||r.key))}case 5:{const r=e;return n.interpolate(n.list(r.i!=null?r.i:r.index))}case 6:{const r=e,i=r.m||r.modifier;return n.linked(Nf(n,r.k||r.key),i?Nf(n,i):void 0,n.type)}case 7:{const r=e;return r.v||r.value}case 8:{const r=e;return r.v||r.value}default:throw new Error(`unhandled node type on format message part: ${t}`)}}const db=n=>n;let Zi=Object.create(null);const es=n=>ge(n)&&(n.t===0||n.type===0)&&("b"in n||"body"in n);function hb(n,e={}){let t=!1;const r=e.onError||tL;return e.onError=i=>{t=!0,r(i)},{...xL(n,e),detectError:t}}const aR=(n,e)=>{if(!z(n))throw Cn(ln.NOT_SUPPORT_NON_STRING_MESSAGE);{xe(e.warnHtmlMessage)&&e.warnHtmlMessage;const r=(e.onCacheKey||db)(n),i=Zi[r];if(i)return i;const{code:s,detectError:o}=hb(n,e),a=new Function(`return ${s}`)();return o?a:Zi[r]=a}};function lR(n,e){if(__INTLIFY_JIT_COMPILATION__&&!__INTLIFY_DROP_MESSAGE_COMPILER__&&z(n)){xe(e.warnHtmlMessage)&&e.warnHtmlMessage;const r=(e.onCacheKey||db)(n),i=Zi[r];if(i)return i;const{ast:s,detectError:o}=hb(n,{...e,location:!1,jit:!0}),a=Of(s);return o?a:Zi[r]=a}else{const t=n.cacheKey;if(t){const r=Zi[t];return r||(Zi[t]=Of(n))}else return Of(n)}}const pb=()=>"",Ht=n=>Ae(n);function mb(n,...e){const{fallbackFormat:t,postTranslation:r,unresolving:i,messageCompiler:s,fallbackLocale:o,messages:a}=n,[l,c]=Mf(...e),u=xe(c.missingWarn)?c.missingWarn:n.missingWarn,d=xe(c.fallbackWarn)?c.fallbackWarn:n.fallbackWarn,h=xe(c.escapeParameter)?c.escapeParameter:n.escapeParameter,m=!!c.resolvedMessage,p=z(c.default)||xe(c.default)?xe(c.default)?s?l:()=>l:c.default:t?s?l:()=>l:"",g=t||p!=="",y=_f(n,c);h&&cR(c);let[v,C,w]=m?[l,y,a[y]||{}]:gb(n,l,y,o,d,u),b=v,E=l;if(!m&&!(z(b)||es(b)||Ht(b))&&g&&(b=p,E=b),!m&&(!(z(b)||es(b)||Ht(b))||!z(C)))return i?dl:l;let k=!1;const x=()=>{k=!0},O=Ht(b)?b:yb(n,l,C,b,E,x);if(k)return b;const T=dR(n,C,w,c),B=jL(T),U=uR(n,O,B),$=r?r(U,l):U;if(__INTLIFY_PROD_DEVTOOLS__){const K={timestamp:Date.now(),key:z(l)?l:Ht(b)?b.key:"",locale:C||(Ht(b)?b.locale:""),format:z(b)?b:Ht(b)?b.source:"",message:$};K.meta=ot({},n.__meta,tR()||{}),GL(K)}return $}function cR(n){$e(n.list)?n.list=n.list.map(e=>z(e)?B0(e):e):ge(n.named)&&Object.keys(n.named).forEach(e=>{z(n.named[e])&&(n.named[e]=B0(n.named[e]))})}function gb(n,e,t,r,i,s){const{messages:o,onWarn:a,messageResolver:l,localeFallbacker:c}=n,u=c(n,r,t);let d={},h,m=null;const p="translate";for(let g=0;g<u.length&&(h=u[g],d=o[h]||{},(m=l(d,e))===null&&(m=d[e]),!(z(m)||es(m)||Ht(m)));g++)if(!sR(h,u)){const y=Tf(n,e,h,s,p);y!==e&&(m=y)}return[m,h,d]}function yb(n,e,t,r,i,s){const{messageCompiler:o,warnHtmlMessage:a}=n;if(Ht(r)){const c=r;return c.locale=c.locale||t,c.key=c.key||e,c}if(o==null){const c=()=>r;return c.locale=t,c.key=e,c}const l=o(r,fR(n,t,i,r,a,s));return l.locale=t,l.key=e,l.source=r,l}function uR(n,e,t){return e(t)}function Mf(...n){const[e,t,r]=n,i={};if(!z(e)&&!st(e)&&!Ht(e)&&!es(e))throw Cn(ln.INVALID_ARGUMENT);const s=st(e)?String(e):(Ht(e),e);return st(t)?i.plural=t:z(t)?i.default=t:ce(t)&&!ol(t)?i.named=t:$e(t)&&(i.list=t),st(r)?i.plural=r:z(r)?i.default=r:ce(r)&&ot(i,r),[s,i]}function fR(n,e,t,r,i,s){return{locale:e,key:t,warnHtmlMessage:i,onError:o=>{throw s&&s(o),o},onCacheKey:o=>jD(e,t,o)}}function dR(n,e,t,r){const{modifiers:i,pluralRules:s,messageResolver:o,fallbackLocale:a,fallbackWarn:l,missingWarn:c,fallbackContext:u}=n,h={locale:e,modifiers:i,pluralRules:s,messages:m=>{let p=o(t,m);if(p==null&&u){const[,,g]=gb(u,m,e,a,l,c);p=o(g,m)}if(z(p)||es(p)){let g=!1;const v=yb(n,m,e,p,m,()=>{g=!0});return g?pb:v}else return Ht(p)?p:pb}};return n.processor&&(h.processor=n.processor),r.list&&(h.list=r.list),r.named&&(h.named=r.named),st(r.plural)&&(h.pluralIndex=r.plural),h}function bb(n,...e){const{datetimeFormats:t,unresolving:r,fallbackLocale:i,onWarn:s,localeFallbacker:o}=n,{__datetimeFormatters:a}=n,[l,c,u,d]=Af(...e),h=xe(u.missingWarn)?u.missingWarn:n.missingWarn;xe(u.fallbackWarn)?u.fallbackWarn:n.fallbackWarn;const m=!!u.part,p=_f(n,u),g=o(n,i,p);if(!z(l)||l==="")return new Intl.DateTimeFormat(p,d).format(c);let y={},v,C=null;const w="datetime format";for(let k=0;k<g.length&&(v=g[k],y=t[v]||{},C=y[l],!ce(C));k++)Tf(n,l,v,h,w);if(!ce(C)||!z(v))return r?dl:l;let b=`${v}__${l}`;ol(d)||(b=`${b}__${JSON.stringify(d)}`);let E=a.get(b);return E||(E=new Intl.DateTimeFormat(v,ot({},C,d)),a.set(b,E)),m?E.formatToParts(c):E.format(c)}const vb=["localeMatcher","weekday","era","year","month","day","hour","minute","second","timeZoneName","formatMatcher","hour12","timeZone","dateStyle","timeStyle","calendar","dayPeriod","numberingSystem","hourCycle","fractionalSecondDigits"];function Af(...n){const[e,t,r,i]=n,s={};let o={},a;if(z(e)){const l=e.match(/(\d{4}-\d{2}-\d{2})(T|\s)?(.*)/);if(!l)throw Cn(ln.INVALID_ISO_DATE_ARGUMENT);const c=l[3]?l[3].trim().startsWith("T")?`${l[1].trim()}${l[3].trim()}`:`${l[1].trim()}T${l[3].trim()}`:l[1].trim();a=new Date(c);try{a.toISOString()}catch{throw Cn(ln.INVALID_ISO_DATE_ARGUMENT)}}else if(HD(e)){if(isNaN(e.getTime()))throw Cn(ln.INVALID_DATE_ARGUMENT);a=e}else if(st(e))a=e;else throw Cn(ln.INVALID_ARGUMENT);return z(t)?s.key=t:ce(t)&&Object.keys(t).forEach(l=>{vb.includes(l)?o[l]=t[l]:s[l]=t[l]}),z(r)?s.locale=r:ce(r)&&(o=r),ce(i)&&(o=i),[s.key||"",a,s,o]}function wb(n,e,t){const r=n;for(const i in t){const s=`${e}__${i}`;r.__datetimeFormatters.has(s)&&r.__datetimeFormatters.delete(s)}}function Cb(n,...e){const{numberFormats:t,unresolving:r,fallbackLocale:i,onWarn:s,localeFallbacker:o}=n,{__numberFormatters:a}=n,[l,c,u,d]=Pf(...e),h=xe(u.missingWarn)?u.missingWarn:n.missingWarn;xe(u.fallbackWarn)?u.fallbackWarn:n.fallbackWarn;const m=!!u.part,p=_f(n,u),g=o(n,i,p);if(!z(l)||l==="")return new Intl.NumberFormat(p,d).format(c);let y={},v,C=null;const w="number format";for(let k=0;k<g.length&&(v=g[k],y=t[v]||{},C=y[l],!ce(C));k++)Tf(n,l,v,h,w);if(!ce(C)||!z(v))return r?dl:l;let b=`${v}__${l}`;ol(d)||(b=`${b}__${JSON.stringify(d)}`);let E=a.get(b);return E||(E=new Intl.NumberFormat(v,ot({},C,d)),a.set(b,E)),m?E.formatToParts(c):E.format(c)}const kb=["localeMatcher","style","currency","currencyDisplay","currencySign","useGrouping","minimumIntegerDigits","minimumFractionDigits","maximumFractionDigits","minimumSignificantDigits","maximumSignificantDigits","compactDisplay","notation","signDisplay","unit","unitDisplay","roundingMode","roundingPriority","roundingIncrement","trailingZeroDisplay"];function Pf(...n){const[e,t,r,i]=n,s={};let o={};if(!st(e))throw Cn(ln.INVALID_ARGUMENT);const a=e;return z(t)?s.key=t:ce(t)&&Object.keys(t).forEach(l=>{kb.includes(l)?o[l]=t[l]:s[l]=t[l]}),z(r)?s.locale=r:ce(r)&&(o=r),ce(i)&&(o=i),[s.key||"",a,s,o]}function Sb(n,e,t){const r=n;for(const i in t){const s=`${e}__${i}`;r.__numberFormatters.has(s)&&r.__numberFormatters.delete(s)}}_L();/*!
  * vue-i18n v9.14.0
  * (c) 2024 kazuya kawaguchi
  * Released under the MIT License.
  */const hR="9.14.0";function pR(){typeof __VUE_I18N_FULL_INSTALL__!="boolean"&&(Bn().__VUE_I18N_FULL_INSTALL__=!0),typeof __VUE_I18N_LEGACY_API__!="boolean"&&(Bn().__VUE_I18N_LEGACY_API__=!0),typeof __INTLIFY_JIT_COMPILATION__!="boolean"&&(Bn().__INTLIFY_JIT_COMPILATION__=!1),typeof __INTLIFY_DROP_MESSAGE_COMPILER__!="boolean"&&(Bn().__INTLIFY_DROP_MESSAGE_COMPILER__=!1),typeof __INTLIFY_PROD_DEVTOOLS__!="boolean"&&(Bn().__INTLIFY_PROD_DEVTOOLS__=!1)}const xb=WL.__EXTEND_POINT__,$n=ll(xb);$n(),$n(),$n(),$n(),$n(),$n(),$n(),$n(),$n();const _b=ln.__EXTEND_POINT__,St=ll(_b),jn={UNEXPECTED_RETURN_TYPE:_b,INVALID_ARGUMENT:St(),MUST_BE_CALL_SETUP_TOP:St(),NOT_INSTALLED:St(),NOT_AVAILABLE_IN_LEGACY_MODE:St(),REQUIRED_VALUE:St(),INVALID_VALUE:St(),CANNOT_SETUP_VUE_DEVTOOLS_PLUGIN:St(),NOT_INSTALLED_WITH_PROVIDE:St(),UNEXPECTED_ERROR:St(),NOT_COMPATIBLE_LEGACY_VUE_I18N:St(),BRIDGE_SUPPORT_VUE_2_ONLY:St(),MUST_DEFINE_I18N_OPTION_IN_ALLOW_COMPOSITION:St(),NOT_AVAILABLE_COMPOSITION_IN_LEGACY:St(),__EXTEND_POINT__:St()};function _r(n,...e){return Xi(n,null,void 0)}const If=oi("__translateVNode"),Df=oi("__datetimeParts"),Lf=oi("__numberParts"),mR=oi("__setPluralRules"),Eb=oi("__injectWithOption"),Rf=oi("__dispose");function bo(n){if(!ge(n))return n;for(const e in n)if(al(n,e))if(!e.includes("."))ge(n[e])&&bo(n[e]);else{const t=e.split("."),r=t.length-1;let i=n,s=!1;for(let o=0;o<r;o++){if(t[o]in i||(i[t[o]]={}),!ge(i[t[o]])){s=!0;break}i=i[t[o]]}s||(i[t[r]]=n[e],delete n[e]),ge(i[t[r]])&&bo(i[t[r]])}return n}function Ff(n,e){const{messages:t,__i18n:r,messageResolver:i,flatJson:s}=e,o=ce(t)?t:$e(r)?{}:{[n]:{}};if($e(r)&&r.forEach(a=>{if("locale"in a&&"resource"in a){const{locale:l,resource:c}=a;l?(o[l]=o[l]||{},ul(c,o[l])):ul(c,o)}else z(a)&&ul(JSON.parse(a),o)}),i==null&&s)for(const a in o)al(o,a)&&bo(o[a]);return o}function Tb(n){return n.type}function gR(n,e,t){let r=ge(e.messages)?e.messages:{};"__i18nGlobal"in t&&(r=Ff(n.locale.value,{messages:r,__i18n:t.__i18nGlobal}));const i=Object.keys(r);i.length&&i.forEach(s=>{n.mergeLocaleMessage(s,r[s])});{if(ge(e.datetimeFormats)){const s=Object.keys(e.datetimeFormats);s.length&&s.forEach(o=>{n.mergeDateTimeFormat(o,e.datetimeFormats[o])})}if(ge(e.numberFormats)){const s=Object.keys(e.numberFormats);s.length&&s.forEach(o=>{n.mergeNumberFormat(o,e.numberFormats[o])})}}}function Ob(n){return f.createVNode(f.Text,null,n,0)}const Nb="__INTLIFY_META__",Mb=()=>[],yR=()=>!1;let Ab=0;function Pb(n){return(e,t,r,i)=>n(t,r,f.getCurrentInstance()||void 0,i)}const bR=()=>{const n=f.getCurrentInstance();let e=null;return n&&(e=Tb(n)[Nb])?{[Nb]:e}:null};function vR(n={},e){const{__root:t,__injectWithOption:r}=n,i=t===void 0,s=n.flatJson,o=R0?f.ref:f.shallowRef,a=!!n.translateExistCompatible;let l=xe(n.inheritLocale)?n.inheritLocale:!0;const c=o(t&&l?t.locale.value:z(n.locale)?n.locale:go),u=o(t&&l?t.fallbackLocale.value:z(n.fallbackLocale)||$e(n.fallbackLocale)||ce(n.fallbackLocale)||n.fallbackLocale===!1?n.fallbackLocale:c.value),d=o(Ff(c.value,n)),h=o(ce(n.datetimeFormats)?n.datetimeFormats:{[c.value]:{}}),m=o(ce(n.numberFormats)?n.numberFormats:{[c.value]:{}});let p=t?t.missingWarn:xe(n.missingWarn)||qi(n.missingWarn)?n.missingWarn:!0,g=t?t.fallbackWarn:xe(n.fallbackWarn)||qi(n.fallbackWarn)?n.fallbackWarn:!0,y=t?t.fallbackRoot:xe(n.fallbackRoot)?n.fallbackRoot:!0,v=!!n.fallbackFormat,C=Ae(n.missing)?n.missing:null,w=Ae(n.missing)?Pb(n.missing):null,b=Ae(n.postTranslation)?n.postTranslation:null,E=t?t.warnHtmlMessage:xe(n.warnHtmlMessage)?n.warnHtmlMessage:!0,k=!!n.escapeParameter;const x=t?t.modifiers:ce(n.modifiers)?n.modifiers:{};let O=n.pluralRules||t&&t.pluralRules,T;T=(()=>{i&&cb(null);const N={version:hR,locale:c.value,fallbackLocale:u.value,messages:d.value,modifiers:x,pluralRules:O,missing:w===null?void 0:w,missingWarn:p,fallbackWarn:g,fallbackFormat:v,unresolving:!0,postTranslation:b===null?void 0:b,warnHtmlMessage:E,escapeParameter:k,messageResolver:n.messageResolver,messageCompiler:n.messageCompiler,__meta:{framework:"vue"}};N.datetimeFormats=h.value,N.numberFormats=m.value,N.__datetimeFormatters=ce(T)?T.__datetimeFormatters:void 0,N.__numberFormatters=ce(T)?T.__numberFormatters:void 0;const D=rR(N);return i&&cb(D),D})(),yo(T,c.value,u.value);function U(){return[c.value,u.value,d.value,h.value,m.value]}const $=f.computed({get:()=>c.value,set:N=>{c.value=N,T.locale=c.value}}),K=f.computed({get:()=>u.value,set:N=>{u.value=N,T.fallbackLocale=u.value,yo(T,c.value,N)}}),_e=f.computed(()=>d.value),Ee=f.computed(()=>h.value),fe=f.computed(()=>m.value);function ve(){return Ae(b)?b:null}function he(N){b=N,T.postTranslation=N}function He(){return C}function Ge(N){N!==null&&(w=Pb(N)),C=N,T.missing=w}const Le=(N,D,pe,Ie,xn,ts)=>{U();let Tr;try{__INTLIFY_PROD_DEVTOOLS__,i||(T.fallbackContext=t?nR():void 0),Tr=N(T)}finally{__INTLIFY_PROD_DEVTOOLS__,i||(T.fallbackContext=void 0)}if(pe!=="translate exists"&&st(Tr)&&Tr===dl||pe==="translate exists"&&!Tr){const[$f,M]=D();return t&&y?Ie(t):xn($f)}else{if(ts(Tr))return Tr;throw _r(jn.UNEXPECTED_RETURN_TYPE)}};function Be(...N){return Le(D=>Reflect.apply(mb,null,[D,...N]),()=>Mf(...N),"translate",D=>Reflect.apply(D.t,D,[...N]),D=>D,D=>z(D))}function at(...N){const[D,pe,Ie]=N;if(Ie&&!ge(Ie))throw _r(jn.INVALID_ARGUMENT);return Be(D,pe,ot({resolvedMessage:!0},Ie||{}))}function Ue(...N){return Le(D=>Reflect.apply(bb,null,[D,...N]),()=>Af(...N),"datetime format",D=>Reflect.apply(D.d,D,[...N]),()=>tb,D=>z(D))}function je(...N){return Le(D=>Reflect.apply(Cb,null,[D,...N]),()=>Pf(...N),"number format",D=>Reflect.apply(D.n,D,[...N]),()=>tb,D=>z(D))}function oe(N){return N.map(D=>z(D)||st(D)||xe(D)?Ob(String(D)):D)}const pt={normalize:oe,interpolate:N=>N,type:"vnode"};function Ut(...N){return Le(D=>{let pe;const Ie=D;try{Ie.processor=pt,pe=Reflect.apply(mb,null,[Ie,...N])}finally{Ie.processor=null}return pe},()=>Mf(...N),"translate",D=>D[If](...N),D=>[Ob(D)],D=>$e(D))}function mt(...N){return Le(D=>Reflect.apply(Cb,null,[D,...N]),()=>Pf(...N),"number format",D=>D[Lf](...N),Mb,D=>z(D)||$e(D))}function Wt(...N){return Le(D=>Reflect.apply(bb,null,[D,...N]),()=>Af(...N),"datetime format",D=>D[Df](...N),Mb,D=>z(D)||$e(D))}function kn(N){O=N,T.pluralRules=O}function cn(N,D){return Le(()=>{if(!N)return!1;const pe=z(D)?D:c.value,Ie=Kt(pe),xn=T.messageResolver(Ie,N);return a?xn!=null:es(xn)||Ht(xn)||z(xn)},()=>[N],"translate exists",pe=>Reflect.apply(pe.te,pe,[N,D]),yR,pe=>xe(pe))}function R(N){let D=null;const pe=Z0(T,u.value,c.value);for(let Ie=0;Ie<pe.length;Ie++){const xn=d.value[pe[Ie]]||{},ts=T.messageResolver(xn,N);if(ts!=null){D=ts;break}}return D}function le(N){const D=R(N);return D??(t?t.tm(N)||{}:{})}function Kt(N){return d.value[N]||{}}function Yt(N,D){if(s){const pe={[N]:D};for(const Ie in pe)al(pe,Ie)&&bo(pe[Ie]);D=pe[N]}d.value[N]=D,T.messages=d.value}function Sn(N,D){d.value[N]=d.value[N]||{};const pe={[N]:D};if(s)for(const Ie in pe)al(pe,Ie)&&bo(pe[Ie]);D=pe[N],ul(D,d.value[N]),T.messages=d.value}function Er(N){return h.value[N]||{}}function S(N,D){h.value[N]=D,T.datetimeFormats=h.value,wb(T,N,D)}function _(N,D){h.value[N]=ot(h.value[N]||{},D),T.datetimeFormats=h.value,wb(T,N,D)}function P(N){return m.value[N]||{}}function H(N,D){m.value[N]=D,T.numberFormats=m.value,Sb(T,N,D)}function ye(N,D){m.value[N]=ot(m.value[N]||{},D),T.numberFormats=m.value,Sb(T,N,D)}Ab++,t&&R0&&(f.watch(t.locale,N=>{l&&(c.value=N,T.locale=N,yo(T,c.value,u.value))}),f.watch(t.fallbackLocale,N=>{l&&(u.value=N,T.fallbackLocale=N,yo(T,c.value,u.value))}));const Z={id:Ab,locale:$,fallbackLocale:K,get inheritLocale(){return l},set inheritLocale(N){l=N,N&&t&&(c.value=t.locale.value,u.value=t.fallbackLocale.value,yo(T,c.value,u.value))},get availableLocales(){return Object.keys(d.value).sort()},messages:_e,get modifiers(){return x},get pluralRules(){return O||{}},get isGlobal(){return i},get missingWarn(){return p},set missingWarn(N){p=N,T.missingWarn=p},get fallbackWarn(){return g},set fallbackWarn(N){g=N,T.fallbackWarn=g},get fallbackRoot(){return y},set fallbackRoot(N){y=N},get fallbackFormat(){return v},set fallbackFormat(N){v=N,T.fallbackFormat=v},get warnHtmlMessage(){return E},set warnHtmlMessage(N){E=N,T.warnHtmlMessage=N},get escapeParameter(){return k},set escapeParameter(N){k=N,T.escapeParameter=N},t:Be,getLocaleMessage:Kt,setLocaleMessage:Yt,mergeLocaleMessage:Sn,getPostTranslationHandler:ve,setPostTranslationHandler:he,getMissingHandler:He,setMissingHandler:Ge,[mR]:kn};return Z.datetimeFormats=Ee,Z.numberFormats=fe,Z.rt=at,Z.te=cn,Z.tm=le,Z.d=Ue,Z.n=je,Z.getDateTimeFormat=Er,Z.setDateTimeFormat=S,Z.mergeDateTimeFormat=_,Z.getNumberFormat=P,Z.setNumberFormat=H,Z.mergeNumberFormat=ye,Z[Eb]=r,Z[If]=Ut,Z[Df]=Wt,Z[Lf]=mt,Z}const Bf={tag:{type:[String,Object]},locale:{type:String},scope:{type:String,validator:n=>n==="parent"||n==="global",default:"parent"},i18n:{type:Object}};function wR({slots:n},e){return e.length===1&&e[0]==="default"?(n.default?n.default():[]).reduce((r,i)=>[...r,...i.type===f.Fragment?i.children:[i]],[]):e.reduce((t,r)=>{const i=n[r];return i&&(t[r]=i()),t},{})}function Ib(n){return f.Fragment}ot({keypath:{type:String,required:!0},plural:{type:[Number,String],validator:n=>st(n)||!isNaN(n)}},Bf);function CR(n){return $e(n)&&!z(n[0])}function Db(n,e,t,r){const{slots:i,attrs:s}=e;return()=>{const o={part:!0};let a={};n.locale&&(o.locale=n.locale),z(n.format)?o.key=n.format:ge(n.format)&&(z(n.format.key)&&(o.key=n.format.key),a=Object.keys(n.format).reduce((h,m)=>t.includes(m)?ot({},h,{[m]:n.format[m]}):h,{}));const l=r(n.value,o,a);let c=[o.key];$e(l)?c=l.map((h,m)=>{const p=i[h.type],g=p?p({[h.type]:h.value,index:m,parts:l}):[h.value];return CR(g)&&(g[0].key=`${h.type}-${m}`),g}):z(l)&&(c=[l]);const u=ot({},s),d=z(n.tag)||ge(n.tag)?n.tag:Ib();return f.h(d,u,c)}}ot({value:{type:Number,required:!0},format:{type:[String,Object]}},Bf),ot({value:{type:[Number,Date],required:!0},format:{type:[String,Object]}},Bf);const kR=oi("global-vue-i18n");function hl(n={}){const e=f.getCurrentInstance();if(e==null)throw _r(jn.MUST_BE_CALL_SETUP_TOP);if(!e.isCE&&e.appContext.app!=null&&!e.appContext.app.__VUE_I18N_SYMBOL__)throw _r(jn.NOT_INSTALLED);const t=SR(e),r=_R(t),i=Tb(e),s=xR(n,i);if(__VUE_I18N_LEGACY_API__&&t.mode==="legacy"&&!n.__useComponent){if(!t.allowComposition)throw _r(jn.NOT_AVAILABLE_IN_LEGACY_MODE);return NR(e,s,r,n)}if(s==="global")return gR(r,n,i),r;if(s==="parent"){let l=ER(t,e,n.__useComponent);return l==null&&(l=r),l}const o=t;let a=o.__getInstance(e);if(a==null){const l=ot({},n);"__i18n"in i&&(l.__i18n=i.__i18n),r&&(l.__root=r),a=vR(l),o.__composerExtend&&(a[Rf]=o.__composerExtend(a)),OR(o,e,a),o.__setInstance(e,a)}return a}function SR(n){{const e=f.inject(n.isCE?kR:n.appContext.app.__VUE_I18N_SYMBOL__);if(!e)throw _r(n.isCE?jn.NOT_INSTALLED_WITH_PROVIDE:jn.UNEXPECTED_ERROR);return e}}function xR(n,e){return ol(n)?"__i18n"in e?"local":"global":n.useScope?n.useScope:"local"}function _R(n){return n.mode==="composition"?n.global:n.global.__composer}function ER(n,e,t=!1){let r=null;const i=e.root;let s=TR(e,t);for(;s!=null;){const o=n;if(n.mode==="composition")r=o.__getInstance(s);else if(__VUE_I18N_LEGACY_API__){const a=o.__getInstance(s);a!=null&&(r=a.__composer,t&&r&&!r[Eb]&&(r=null))}if(r!=null||i===s)break;s=s.parent}return r}function TR(n,e=!1){return n==null?null:e&&n.vnode.ctx||n.parent}function OR(n,e,t){f.onMounted(()=>{},e),f.onUnmounted(()=>{const r=t;n.__deleteInstance(e);const i=r[Rf];i&&(i(),delete r[Rf])},e)}function NR(n,e,t,r={}){const i=e==="local",s=f.shallowRef(null);if(i&&n.proxy&&!(n.proxy.$options.i18n||n.proxy.$options.__i18n))throw _r(jn.MUST_DEFINE_I18N_OPTION_IN_ALLOW_COMPOSITION);const o=xe(r.inheritLocale)?r.inheritLocale:!z(r.locale),a=f.ref(!i||o?t.locale.value:z(r.locale)?r.locale:go),l=f.ref(!i||o?t.fallbackLocale.value:z(r.fallbackLocale)||$e(r.fallbackLocale)||ce(r.fallbackLocale)||r.fallbackLocale===!1?r.fallbackLocale:a.value),c=f.ref(Ff(a.value,r)),u=f.ref(ce(r.datetimeFormats)?r.datetimeFormats:{[a.value]:{}}),d=f.ref(ce(r.numberFormats)?r.numberFormats:{[a.value]:{}}),h=i?t.missingWarn:xe(r.missingWarn)||qi(r.missingWarn)?r.missingWarn:!0,m=i?t.fallbackWarn:xe(r.fallbackWarn)||qi(r.fallbackWarn)?r.fallbackWarn:!0,p=i?t.fallbackRoot:xe(r.fallbackRoot)?r.fallbackRoot:!0,g=!!r.fallbackFormat,y=Ae(r.missing)?r.missing:null,v=Ae(r.postTranslation)?r.postTranslation:null,C=i?t.warnHtmlMessage:xe(r.warnHtmlMessage)?r.warnHtmlMessage:!0,w=!!r.escapeParameter,b=i?t.modifiers:ce(r.modifiers)?r.modifiers:{},E=r.pluralRules||i&&t.pluralRules;function k(){return[a.value,l.value,c.value,u.value,d.value]}const x=f.computed({get:()=>s.value?s.value.locale.value:a.value,set:R=>{s.value&&(s.value.locale.value=R),a.value=R}}),O=f.computed({get:()=>s.value?s.value.fallbackLocale.value:l.value,set:R=>{s.value&&(s.value.fallbackLocale.value=R),l.value=R}}),T=f.computed(()=>s.value?s.value.messages.value:c.value),B=f.computed(()=>u.value),U=f.computed(()=>d.value);function $(){return s.value?s.value.getPostTranslationHandler():v}function K(R){s.value&&s.value.setPostTranslationHandler(R)}function _e(){return s.value?s.value.getMissingHandler():y}function Ee(R){s.value&&s.value.setMissingHandler(R)}function fe(R){return k(),R()}function ve(...R){return s.value?fe(()=>Reflect.apply(s.value.t,null,[...R])):fe(()=>"")}function he(...R){return s.value?Reflect.apply(s.value.rt,null,[...R]):""}function He(...R){return s.value?fe(()=>Reflect.apply(s.value.d,null,[...R])):fe(()=>"")}function Ge(...R){return s.value?fe(()=>Reflect.apply(s.value.n,null,[...R])):fe(()=>"")}function Le(R){return s.value?s.value.tm(R):{}}function Be(R,le){return s.value?s.value.te(R,le):!1}function at(R){return s.value?s.value.getLocaleMessage(R):{}}function Ue(R,le){s.value&&(s.value.setLocaleMessage(R,le),c.value[R]=le)}function je(R,le){s.value&&s.value.mergeLocaleMessage(R,le)}function oe(R){return s.value?s.value.getDateTimeFormat(R):{}}function Gt(R,le){s.value&&(s.value.setDateTimeFormat(R,le),u.value[R]=le)}function pt(R,le){s.value&&s.value.mergeDateTimeFormat(R,le)}function Ut(R){return s.value?s.value.getNumberFormat(R):{}}function mt(R,le){s.value&&(s.value.setNumberFormat(R,le),d.value[R]=le)}function Wt(R,le){s.value&&s.value.mergeNumberFormat(R,le)}const kn={get id(){return s.value?s.value.id:-1},locale:x,fallbackLocale:O,messages:T,datetimeFormats:B,numberFormats:U,get inheritLocale(){return s.value?s.value.inheritLocale:o},set inheritLocale(R){s.value&&(s.value.inheritLocale=R)},get availableLocales(){return s.value?s.value.availableLocales:Object.keys(c.value)},get modifiers(){return s.value?s.value.modifiers:b},get pluralRules(){return s.value?s.value.pluralRules:E},get isGlobal(){return s.value?s.value.isGlobal:!1},get missingWarn(){return s.value?s.value.missingWarn:h},set missingWarn(R){s.value&&(s.value.missingWarn=R)},get fallbackWarn(){return s.value?s.value.fallbackWarn:m},set fallbackWarn(R){s.value&&(s.value.missingWarn=R)},get fallbackRoot(){return s.value?s.value.fallbackRoot:p},set fallbackRoot(R){s.value&&(s.value.fallbackRoot=R)},get fallbackFormat(){return s.value?s.value.fallbackFormat:g},set fallbackFormat(R){s.value&&(s.value.fallbackFormat=R)},get warnHtmlMessage(){return s.value?s.value.warnHtmlMessage:C},set warnHtmlMessage(R){s.value&&(s.value.warnHtmlMessage=R)},get escapeParameter(){return s.value?s.value.escapeParameter:w},set escapeParameter(R){s.value&&(s.value.escapeParameter=R)},t:ve,getPostTranslationHandler:$,setPostTranslationHandler:K,getMissingHandler:_e,setMissingHandler:Ee,rt:he,d:He,n:Ge,tm:Le,te:Be,getLocaleMessage:at,setLocaleMessage:Ue,mergeLocaleMessage:je,getDateTimeFormat:oe,setDateTimeFormat:Gt,mergeDateTimeFormat:pt,getNumberFormat:Ut,setNumberFormat:mt,mergeNumberFormat:Wt};function cn(R){R.locale.value=a.value,R.fallbackLocale.value=l.value,Object.keys(c.value).forEach(le=>{R.mergeLocaleMessage(le,c.value[le])}),Object.keys(u.value).forEach(le=>{R.mergeDateTimeFormat(le,u.value[le])}),Object.keys(d.value).forEach(le=>{R.mergeNumberFormat(le,d.value[le])}),R.escapeParameter=w,R.fallbackFormat=g,R.fallbackRoot=p,R.fallbackWarn=m,R.missingWarn=h,R.warnHtmlMessage=C}return f.onBeforeMount(()=>{if(n.proxy==null||n.proxy.$i18n==null)throw _r(jn.NOT_AVAILABLE_COMPOSITION_IN_LEGACY);const R=s.value=n.proxy.$i18n.__composer;e==="global"?(a.value=R.locale.value,l.value=R.fallbackLocale.value,c.value=R.messages.value,u.value=R.datetimeFormats.value,d.value=R.numberFormats.value):i&&cn(R)}),kn}if(pR(),__INTLIFY_JIT_COMPILATION__?ib(lR):ib(aR),QL(IL),ZL(Z0),__INTLIFY_PROD_DEVTOOLS__){const n=Bn();n.__INTLIFY__=!0,zL(n.__INTLIFY_DEVTOOLS_GLOBAL_HOOK__)}const MR={},AR={class:"text-lg font-bold"};function PR(n,e){return f.openBlock(),f.createElementBlock("span",AR,[f.renderSlot(n.$slots,"default")])}const IR=fa(MR,[["render",PR]]),DR={class:"flex gap-1"},LR={key:0,class:"TheMapAsText select-auto"},RR=["innerHTML"],FR=f.defineComponent({__name:"TheMapAsText",setup(n){const{mapFile:e,mapCurrent:t}=Fe(),{guest:r,patron:i,textOf:s,textNlAsBr:o,textWithoutHTML:a}=yt(),l=e.currentMap(new ae).ref(),c=Jo(""),u=Jo([]);t.objects(i.create(r.create(di(v=>{u.value=v,o.create(s.create(v.map(C=>`<div class="TheMapAsText-Item">
                <h3>${C.name}</h3><p>${C.additionalName||""}</p><p>${C.description||""}</p><p>${C.additionalFields&&Object.values(C.additionalFields).join("</p><p>")}</p></div>`).join(""))).asString(r.create(C=>{c.value=C}))},500))));const d=hl(),{share:h,isSupported:m}=I1(),p=()=>{m.value||alert(d.t("general.notifications.sharingDontSupported")),a.create(s.create(c.value)).asString(r.create(v=>{h({text:v})}))},g=Jo(),y=()=>{var v,C;if(l.value){const w=new Range;w.setStart(g.value,0),w.setEnd(g.value,Object.values(u.value).length),(v=document.getSelection())==null||v.removeAllRanges(),(C=document.getSelection())==null||C.addRange(w)}};return(v,C)=>(f.openBlock(),f.createBlock(Hr,{name:"mapAsText"},{header:f.withCtx(()=>[f.createVNode(IR,{class:"block mb-3"},{default:f.withCtx(()=>[f.createTextVNode(f.toDisplayString(v.$t("general.mapAsText"))+" ",1),f.createElementVNode("div",DR,[f.createVNode(ke,{size:"sm",type:"success",class:"font-normal",onClick:p},{default:f.withCtx(()=>[f.createTextVNode(f.toDisplayString(v.$t("general.share")),1)]),_:1}),f.createVNode(ke,{size:"sm",type:"primary",class:"font-normal",onClick:y},{default:f.withCtx(()=>[f.createTextVNode(f.toDisplayString(v.$t("general.selectAll")),1)]),_:1})])]),_:1})]),default:f.withCtx(()=>[f.unref(l)?(f.openBlock(),f.createElementBlock("article",LR,[f.createElementVNode("div",{ref_key:"textRef",ref:g,innerHTML:f.unref(c)},null,8,RR)])):f.createCommentVNode("",!0)]),_:1}))}}),BR={key:1},VR=f.defineComponent({__name:"TheMiniMap",setup(n){const{miniMap:e}=Fe(),t=e.points(new ae).ref(),r=e.size(new ae).ref(),i=e.viewportSize(new ae).ref(),s=e.viewportPosition(new ae).ref();return(o,a)=>f.unref(r)?(f.openBlock(),f.createElementBlock("div",{key:0,style:f.normalizeStyle({width:`${f.unref(r).width}px`,height:`${f.unref(r).height}px`}),class:"absolute pointer-events-none block bg-white bottom-[10px] mt-3 right-3 z-1 border border-solid border-body-dark"},[f.unref(s)?(f.openBlock(),f.createElementBlock("div",{key:0,style:f.normalizeStyle({width:`${f.unref(i).width}px`,height:`${f.unref(i).height}px`,top:`${f.unref(s).y}px`,left:`${f.unref(s).x}px`}),class:"absolute bg-primary/50"},null,4)):f.createCommentVNode("",!0),f.unref(t)?(f.openBlock(),f.createElementBlock("div",BR,[(f.openBlock(!0),f.createElementBlock(f.Fragment,null,f.renderList(f.unref(t),l=>(f.openBlock(),f.createElementBlock("div",{key:l.id,class:"absolute w-1 h-1 block bg-danger",style:f.normalizeStyle({top:`${l.y}px`,left:`${l.x}px`,width:`${l.width}px`,height:`${l.height}px`})},null,4))),128))])):f.createCommentVNode("",!0)],4)):f.createCommentVNode("",!0)}}),$R={class:"text-lg font-bold"},jR={key:0,class:"TheSettings"},zR={class:"mb-2"},HR={class:"TheSettings-Row"},GR={class:"flex gap-2 mb-2"},UR={class:"mb-2"},WR={class:"mb-2"},KR={href:"https://github.com/kosukhin/mind-map-creator",target:"_blank"},YR={class:"flex gap-2"},qR=f.defineComponent({__name:"FormSettings",setup(n){const{modal:e,mapFile:t,mapRemoved:r,mapSettings:i,controlCombo:s,parentNames:o,mapCurrentID:a}=Fe(),{patron:l,guest:c}=yt(),u=o.names(new ae).ref(),d=t.currentMap(new ae).ref(),h=a.id(new ae).ref(),m=()=>{e.give("")},p=()=>{i.give(d.value.settings),m()};return s.happenedConditional("KeyS",e.openedByName("settings"),l.create(c.create(p))),(g,y)=>(f.openBlock(),f.createBlock(Hr,{name:"settings"},{header:f.withCtx(()=>[f.createElementVNode("h2",$R,f.toDisplayString(g.$t("general.mapSettings")),1)]),default:f.withCtx(()=>{var v;return[(v=f.unref(d))!=null&&v.settings?(f.openBlock(),f.createElementBlock("div",jR,[f.createElementVNode("div",zR,[f.createElementVNode("div",HR,[f.createElementVNode("div",GR,[f.unref(u).length>1?(f.openBlock(),f.createBlock(ke,{key:0,type:"primary",class:"text-white",onClick:y[0]||(y[0]=C=>f.unref(e).give("parentTypes"))},{default:f.withCtx(()=>[f.createTextVNode(f.toDisplayString(g.$t("general.parentTypes")),1)]),_:1})):f.createCommentVNode("",!0),f.createVNode(ke,{type:"primary",class:"text-white",onClick:y[1]||(y[1]=C=>f.unref(e).give("export"))},{default:f.withCtx(()=>[f.createTextVNode(f.toDisplayString(g.$t("general.exportOrImport")),1)]),_:1}),f.createVNode(ke,{type:"primary",class:"text-white e2e-open-presets",onClick:y[2]||(y[2]=C=>f.unref(e).give("presets"))},{default:f.withCtx(()=>y[6]||(y[6]=[f.createTextVNode(" Пресеты ")])),_:1})])]),f.createElementVNode("div",UR,[f.createElementVNode("label",null,[f.createElementVNode("b",null,f.toDisplayString(g.$t("general.mapName")),1),f.createVNode(hn,{modelValue:f.unref(d).settings.title,"onUpdate:modelValue":y[3]||(y[3]=C=>f.unref(d).settings.title=C)},null,8,["modelValue"])])]),f.createElementVNode("div",WR,[f.createElementVNode("a",KR,f.toDisplayString(g.$t("general.githubRepo")),1)])]),f.createElementVNode("div",YR,[f.createVNode(ke,{class:"TheSettings-Button",type:"success",onClick:y[4]||(y[4]=C=>p())},{default:f.withCtx(()=>[f.createTextVNode(f.toDisplayString(g.$t("general.save")),1)]),_:1}),f.createVNode(ke,{class:"TheSettings-Button",onClick:m},{default:f.withCtx(()=>[f.createTextVNode(f.toDisplayString(g.$t("general.cancel")),1)]),_:1}),f.createVNode(ke,{class:"TheSettings-Button",type:"danger",onClick:y[5]||(y[5]=C=>{f.unref(r).give(f.unref(h)),m()})},{default:f.withCtx(()=>[f.createTextVNode(f.toDisplayString(g.$t("general.removeMap")),1)]),_:1})])])):f.createCommentVNode("",!0)]}),_:1}))}}),XR={},JR={class:"BaseGroup"};function QR(n,e){return f.openBlock(),f.createElementBlock("div",JR,[f.renderSlot(n.$slots,"default")])}const ZR=fa(XR,[["render",QR]]),e3="default",t3=f.defineComponent({__name:"TheLinker",setup(n){const{mapObjectsLink:e}=Fe(),t=e.objectIds(new ae([])).ref();return(r,i)=>(f.openBlock(),f.createBlock(ke,{type:e3,onClick:i[0]||(i[0]=s=>f.unref(e).startLink())},{default:f.withCtx(()=>[f.createTextVNode(f.toDisplayString(f.unref(t).length===1?"Выбиретие объект":f.unref(t).length===2?"Второй объект":"Связать объекты"),1)]),_:1}))}}),n3={class:"flex e2e-sidebar flex-col items-center gap-3 max-h-[100%] overflow-hidden"},r3={class:"TheSideBar-ItemName"},i3=["innerHTML","draggable","title","onDragend"],s3={key:0,class:"flex gap-1"},o3={key:0,class:"mt-auto w-full p-3 pt-0"},a3=f.defineComponent({__name:"TheSideBar",setup(n){const{mapObjectNew:e,mapCurrent:t,mapTypeCurrent:r,mapTypeRemoved:i,mapTypeNew:s,modal:o,settings:a,sidebarDraggable:l}=Fe(),c=t.types(new ae).ref(),u=f.ref();f.onMounted(()=>{l.give(u.value)});const{svgMapTypeImage:d}=yt(),h=f.computed(()=>{var p;return(p=c.value)==null?void 0:p.map(g=>({type:g,image:d.create(g).markup()})).sort((g,y)=>+(g.type.name>=y.type.name))}),m=new ae;return a.value(m),(p,g)=>(f.openBlock(),f.createElementBlock("div",n3,[f.createElementVNode("div",{ref_key:"dragWrapperRef",ref:u,class:"flex flex-col gap-3 flex-grow w-full overflow-y-auto"},[(f.openBlock(!0),f.createElementBlock(f.Fragment,null,f.renderList(h.value,(y,v)=>(f.openBlock(),f.createElementBlock("div",{key:v,class:"flex flex-col items-center justify-center gap-2"},[f.createElementVNode("div",r3,f.toDisplayString(y.type.name),1),f.createElementVNode("div",{innerHTML:y.image,class:"TheSideBar-ItemImage",draggable:f.unref(m).value.readonly?"false":"true",style:f.normalizeStyle(`width:${y.type.width}px;height:${y.type.height}px`),title:p.$t("general.notifications.dragToCanvasToAdd"),onDragend:C=>f.unref(e).byTypeName(y.type.id,C)},null,44,i3),f.unref(m).value.readonly?f.createCommentVNode("",!0):(f.openBlock(),f.createElementBlock("div",s3,[f.createVNode(ke,{class:"text-white",size:"sm",type:"primary",onClick:C=>f.unref(r).give(y.type.id)},{default:f.withCtx(()=>[f.createTextVNode(f.toDisplayString(p.$t("general.change")),1)]),_:2},1032,["onClick"]),f.createVNode(ke,{class:"text-white",size:"sm",type:"danger",onClick:C=>f.unref(i).give(y.type)},{default:f.withCtx(()=>[f.createTextVNode(f.toDisplayString(p.$t("general.delete")),1)]),_:2},1032,["onClick"])]))]))),128))],512),f.unref(m).value.readonly?f.createCommentVNode("",!0):(f.openBlock(),f.createElementBlock("div",o3,[f.createVNode(ZR,{class:"mb-1 grid gap-1 grid-cols-2"},{default:f.withCtx(()=>[f.createVNode(ke,{title:p.$t("general.addType"),type:"success",onClick:g[0]||(g[0]=y=>f.unref(s).byName())},{default:f.withCtx(()=>[f.createVNode(Tt,{icon:"fa-plus-square"})]),_:1},8,["title"]),f.createVNode(ke,{class:"e2e-show-settings",title:p.$t("general.settings"),type:"primary",onClick:g[1]||(g[1]=y=>f.unref(o).give("settings"))},{default:f.withCtx(()=>[f.createVNode(Tt,{icon:"fa-cog"})]),_:1},8,["title"])]),_:1}),f.createVNode(t3,{class:"w-[100%] block mb-1"})]))]))}});class l3{constructor(e,t,r=!1){this.basePatron=e,this.guest=t,this.refWatcherCreated=r}ref(){return this.basePatron.ref()}get value(){return this.basePatron.value}introduction(){return this.basePatron.introduction()}give(e){return this.basePatron.give(e),this.refWatcherCreated||(this.refWatcherCreated=!0,f.watch(this.basePatron.ref(),t=>{t&&this.guest.give(t)},{deep:!0})),this}}class c3{constructor(e){this.baseSource=e}value(e){return this.baseSource.value(new ui(e,t=>{zn(JSON.stringify(t),e)})),this}give(e){return this.value(t=>{e!==t&&this.baseSource.give(JSON.parse(e))}),this}pool(){return this.baseSource.pool()}}class u3{constructor(e,t){this.baseGuest=e,this.baseGuestAware=t}value(e){return this.baseGuestAware.value(e),this}give(e){return zn(e,this.baseGuest),this}pool(){throw Error("No pool in SourceDynamic")}}const f3={class:"AppPresets"},d3={class:"flex flex-col gap-2"},h3=f.defineComponent({__name:"AppExport",setup(n){const{mapFile:e,mapCurrent:t}=Fe(),r=new u3(t,new yl(a=>{e.currentMap(new wo(a))})),i=new c3(r),s=new l3(new ae,i);i.value(s);const o=s.ref();return(a,l)=>(f.openBlock(),f.createBlock(Hr,{name:"export"},{default:f.withCtx(()=>[f.createElementVNode("div",f3,[l[1]||(l[1]=f.createElementVNode("div",{class:"text-md font-bold mb-2"},"Экспорт\\Импорт текущей карты",-1)),f.createElementVNode("div",d3,[f.createVNode(L0,{modelValue:f.unref(o),"onUpdate:modelValue":l[0]||(l[0]=c=>f.isRef(o)?o.value=c:null)},null,8,["modelValue"])])])]),_:1}))}}),p3={class:"bg-body absolute top-0 left-0 w-full h-full"},m3={class:"grid grid-cols-[200px_1fr] grid-rows-[50px_1fr] h-dvh relative"},g3=f.defineComponent({__name:"PatronSchemeEditor",props:{modelValue:{type:String,required:!0},readonly:{type:Boolean,default:!1},presets:{type:Object,default:()=>({})}},emits:["update:modelValue"],setup(n,{emit:e}){const t=n,r=e,{fileContent:i,settings:s}=Fe(),{guest:o,patron:a}=yt();return s.value(l=>{s.give({...l,readonly:t.readonly,presets:t.presets})}),f.watch(()=>t.modelValue,l=>{i.value(o.create(c=>{l!==c&&i.give(l)}))},{immediate:!0}),i.value(a.create(l=>{r("update:modelValue",l)})),(l,c)=>(f.openBlock(),f.createElementBlock("div",p3,[f.createElementVNode("div",m3,[f.createVNode($D,{class:"col-span-2"}),f.createVNode(a3),f.createVNode(PD,{class:"w-auto col-auto h-full"}),f.createVNode(VR)]),f.createVNode(aD),f.createVNode(hD),f.createVNode(qR),f.createVNode(RE),f.createVNode(fT),f.createVNode(h3),f.createVNode(_E),f.createVNode(FR),f.createVNode(oT),f.createVNode(vE)]))}}),Lb=ie.debug("FileSystemContent");class y3{constructor(e,t,r){X(this,"contentPatrons");X(this,"fileHandler",null);X(this,"contentSource");this.launchQueue=e,this.notification=t,this.factories=r,this.contentPatrons=r.pool.create(this),this.contentSource=r.sourceEmpty.create()}content(e){const t=this.factories.guest.create(r=>{this.fileHandler=r,this.factories.fileHandlerContent.create(r).content(this.factories.guest.create(i=>{this.contentPatrons.distribute(i,e),this.contentSource.give(i)}))});return this.fileHandler||this.launchQueue.fileHandler(t),this.contentSource.value(e),this}give(e){if(Lb("save file as content string",e),!this.fileHandler)throw new ss("Cant save file because no fileHandler");try{return this.contentSource.give(e),this.factories.browserFileSaved.create(this.fileHandler).save(e),this.contentPatrons.give(e),this}catch(t){throw new ss("Cant handle receive for map file FS",{cause:t})}finally{this.notification.give({type:"success",text:"Успешно сохранен файл карты!"})}}canBeUsed(e){const t="launchQueue"in window;Lb("can be used",t);const r=window&&window.matchMedia("(display-mode: standalone)");return e.give(t&&r.matches),e}}const pl=ie.debug("FirstPossibleFileContent");class b3{constructor(e,t){X(this,"firstPossibleFileContent",null);X(this,"contentSource",new fi);X(this,"canBeUsedSource",new fi);pl("length",e.length),e.forEach(r=>{r.canBeUsed(t.patronOnce.create(t.guest.create(i=>{pl("canbeused result",r,i),i&&!this.firstPossibleFileContent&&(this.firstPossibleFileContent=r,r.canBeUsed(t.patron.create(this.canBeUsedSource)),r.content(t.patron.create(this.contentSource)),this.contentSource.value(t.patron.create(s=>{r.content(t.guest.create(o=>{s!==o&&r.give(s)}))})))})))})}canBeUsed(e){return pl("can be used to",this.firstPossibleFileContent),this.canBeUsedSource.value(e),e}content(e){return pl("content to",this.firstPossibleFileContent),this.contentSource.value(e),this}give(e){return this.contentSource.give(e),this}}const Vf=ie.debug("UrlContent");class v3{constructor(e,t){X(this,"contentCache");this.notification=e,this.factories=t,this.contentCache=t.sourceEmpty.create()}canBeUsed(e){if(!window)return e.give(!1),this;const t=window.location.search.indexOf("?view=")>-1;if(Vf("can be used",t),e.give(window.location.search.indexOf("?view=")>-1),t){const r=window.location.search.split("=")[1]??"";fetch(r,{redirect:"follow"}).then(i=>i.text()).then(i=>{Vf("received text",i),this.contentCache.give(i)})}return e}content(e){if(!window)return this;const t=window.location.search.split("=")[1]??"";return Vf("visit url",t),this.contentCache.value(this.factories.patronOnce.create(e)),this}give(){return this.notification.give({type:"error",text:"Невозможно сохранить карту, открытую по ссылке!"}),this}}const Rb=new fi;class w3{constructor(e=window.launchQueue,t="launchQueue"in window){X(this,"isCalculated",!1);this.launchQueue=e,this.isLaunchQueueSupported=t}fileHandler(e){return this.isLaunchQueueSupported&&!this.isCalculated&&(this.isCalculated=!0,this.launchQueue.setConsumer(t=>{if(console.log("require file handler"),t.files&&t.files.length){const[r]=t.files;Rb.give(r)}})),Rb.value(e),this}}Re.BrowserLaunchQueue=w3,Re.FileSystemContent=y3,Re.FirstPossibleFileContent=b3,Re.PatronSchemeEditor=g3,Re.UrlContent=v3,Re.VueRefPatron=ae,Re.useApplication=Fe,Re.useFactories=yt,Object.defineProperty(Re,Symbol.toStringTag,{value:"Module"})});
